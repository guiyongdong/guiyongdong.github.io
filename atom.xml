<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>è´µå¤§å¤´çš„åšå®¢</title>
  <subtitle>è´µå¤§å¤´çš„åšå®¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.guiyongdong.com/"/>
  <updated>2017-03-31T09:02:12.000Z</updated>
  <id>http://www.guiyongdong.com/</id>
  
  <author>
    <name>è´µæ°¸å†¬</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸€å¤©ä¸€Androidä¹‹å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶</title>
    <link href="http://www.guiyongdong.com/2017/03/27/%E4%B8%80%E5%A4%A9%E4%B8%80Android%E4%B9%8B%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6/"/>
    <id>http://www.guiyongdong.com/2017/03/27/ä¸€å¤©ä¸€Androidä¹‹å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶/</id>
    <published>2017-03-27T09:37:50.000Z</published>
    <updated>2017-03-31T09:02:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ— è®ºæ˜¯<code>Android</code>è¿˜æ˜¯<code>iOS</code>ï¼Œå…³äºUIçš„æ“ä½œéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ‰€æœ‰çš„UIæ“ä½œåªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¼šåœ¨å­çº¿ç¨‹ä¸­åšä¸€äº›è€—æ—¶çš„æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œèµ„æºçš„è¯·æ±‚ï¼Œå½“è¿™äº›è€—æ—¶æ“ä½œç»“æŸæ—¶ï¼Œæˆ‘ä»¬åˆå¸Œæœ›æ‹¿è¿™äº›è¯·æ±‚ä¸‹æ¥çš„èµ„æºå»æ›´æ–°UIï¼Œä½†æ˜¯å½“å‰çº¿ç¨‹ä¸ºå­çº¿ç¨‹ï¼Œè€Œæ›´æ–°UIç”±å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†çº¿ç¨‹é—´çš„é€šä¿¡é—®é¢˜ã€‚</p>
<p>å­¦è¿‡iOSçš„åŒå­¦éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>GCD</code>æˆ–è€…<code>performSelectorOnMainThread:</code>ç­‰æŠ€æœ¯æ¥è¾¾åˆ°æˆ‘ä»¬çš„éœ€æ±‚ã€‚è€Œåœ¨Androidä¸­ï¼Œæˆ‘ä»¬å°±è¦ä½¿ç”¨åˆ°å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶äº†ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« å°±æ¥è¯¦ç»†è¯´ä¸€ä¸‹å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶ã€‚</p>
<a id="more"></a>
<h3 id="çº¿ç¨‹é—´é€šä¿¡å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆ"><a href="#çº¿ç¨‹é—´é€šä¿¡å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="çº¿ç¨‹é—´é€šä¿¡å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆ"></a>çº¿ç¨‹é—´é€šä¿¡å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆ</h3><h5 id="runOnUiThread"><a href="#runOnUiThread" class="headerlink" title="runOnUiThread"></a>runOnUiThread</h5><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>runOnUiThread</code>è¿™ç§æ–¹å¼å›åˆ°ä¸»çº¿ç¨‹æ˜¯æœ€ä¸ºæ–¹ä¾¿ï¼Œä»£ç é‡ä¹Ÿæ¯”è¾ƒå°‘ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹å¼ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">requestData</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="comment">//å­çº¿ç¨‹æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></div><div class="line">                Thread.sleep(<span class="number">3000</span>);</div><div class="line">                runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        <span class="comment">//ä¸»çº¿ç¨‹æ›´æ–°UI</span></div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å› ä¸ºè¿™ç§æ–¹å¼ä½¿ç”¨ç®€å•ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†ç»†è¯´ã€‚</p>
<h5 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h5><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Handler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> Handler mHandler;</div><div class="line">    <span class="keyword">private</span> TextView mTextView;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        mTextView = (TextView) findViewById(R.id.textView);</div><div class="line"></div><div class="line">        Button onUIButton = (Button) findViewById(R.id.button);</div><div class="line">        onUIButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                requestData();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">//åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºHandler</span></div><div class="line">        mHandler = <span class="keyword">new</span> Handler(<span class="keyword">new</span> Handler.Callback() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">                <span class="comment">//æ¥å—åˆ°æ¶ˆæ¯</span></div><div class="line">                String str = (String) msg.obj;</div><div class="line">                mTextView.setText(str);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">requestData</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    <span class="comment">//å­çº¿ç¨‹æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></div><div class="line">                    Thread.sleep(<span class="number">3000</span>);</div><div class="line">                    Message message = <span class="keyword">new</span> Message();</div><div class="line">                    message.obj = <span class="string">"æ¶ˆæ¯"</span>;</div><div class="line">                    <span class="comment">//handlerå‘é€æ¶ˆæ¯</span></div><div class="line">                    mHandler.sendMessage(message);</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆåœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»º<code>Handler</code>ï¼Œåœ¨<code>requestData</code>æ–¹æ³•ä¸­ï¼Œå¼€å¯ä¸€ä¸ªå­çº¿ç¨‹ï¼Œå­çº¿ç¨‹ä¸­æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œæ“ä½œç»“æŸåï¼Œä½¿ç”¨<code>Handler</code>å‘é€æ¶ˆæ¯ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ›´æ–°UIã€‚</p>
<p>è¿™ç§æ–¹å¼åœ¨å¼€å‘ä¸­ä½¿ç”¨çš„æœ€é¢‘ç¹ï¼Œè‡³äºå…¶ä¸­çš„åŸç†ï¼Œæˆ‘ä»¬æ…¢æ…¢æ¥æ¢ç©¶ã€‚</p>
<h3 id="HandleråŸç†å‰–æ"><a href="#HandleråŸç†å‰–æ" class="headerlink" title="HandleråŸç†å‰–æ"></a>HandleråŸç†å‰–æ</h3><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºHandleræ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºï¼Œå¯èƒ½ä½ ä¼šæƒ³äº†ï¼Œæˆ‘åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºè¡Œä¹ˆï¼Ÿæˆ‘ä»¬æ¥ç”¨ä»£ç å®éªŒä¸€ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">      </div><div class="line">    <span class="keyword">private</span> Handler handler1;  </div><div class="line">      </div><div class="line">    <span class="keyword">private</span> Handler handler2;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line">        handler1 = <span class="keyword">new</span> Handler();  </div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </div><div class="line">                handler2 = <span class="keyword">new</span> Handler();  </div><div class="line">            &#125;  </div><div class="line">        &#125;).start();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šæ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»º<code>handler1</code>ï¼Œåœ¨å­çº¿ç¨‹ä¸­åˆ›å»º<code>handler2</code>ã€‚å½“æ˜¯ï¼Œå½“æˆ‘ä»¬å…è®¸ç¨‹åºçš„æ—¶å€™ï¼Œç¨‹åºç«Ÿç„¶å´©æºƒäº†ï¼Œé”™è¯¯æç¤ºä¿¡æ¯æ˜¯Canâ€™t create handler inside thread that has not called Looper.prepare()ã€‚è¯´æ˜¯ä¸èƒ½å†æ²¡æœ‰è°ƒç”¨<code>Looper.prepare()</code>çš„çº¿ç¨‹ä¸­åˆ›å»º<code>Handler</code>ã€‚é‚£ç³»ç»Ÿæ—¢ç„¶è¿™ä¹ˆè¯´äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨å­çº¿ç¨‹ä¸­æ·»åŠ è¿™å¥ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </div><div class="line">        Looper.prepare();  </div><div class="line">        handler2 = <span class="keyword">new</span> Handler();  </div><div class="line">    &#125;  </div><div class="line">&#125;).start();</div></pre></td></tr></table></figure>
<p>æœç„¶ä¸ä¼šå´©æºƒäº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h5 id="Handlerä¸Looperçš„å…³ç³»"><a href="#Handlerä¸Looperçš„å…³ç³»" class="headerlink" title="Handlerä¸Looperçš„å…³ç³»"></a>Handlerä¸Looperçš„å…³ç³»</h5><p>ä¸ºä»€ä¹ˆåœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºHandlerä¼šå´©æºƒå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>Handler</code>çš„æœ‰å‚å’Œæ— å‚æ„é€ æ–¹æ³•:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="keyword">false</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(callback, <span class="keyword">false</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å‘ç°ä»–ä»¬éƒ½è°ƒç”¨äº†<code>public Handler(Callback callback, boolean async)</code>è¿™ä¸ªæ–¹æ³•ï¼Œæ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (FIND_POTENTIAL_LEAKS) &#123;</div><div class="line">        <span class="keyword">final</span> Class&lt;? extends Handler&gt; klass = getClass();</div><div class="line">        <span class="keyword">if</span> ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</div><div class="line">                (klass.getModifiers() &amp; Modifier.STATIC) == <span class="number">0</span>) &#123;</div><div class="line">            Log.w(TAG, <span class="string">"The following Handler class should be static or leaks might occur: "</span> +</div><div class="line">                klass.getCanonicalName());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    mLooper = Looper.myLooper();</div><div class="line">    <span class="keyword">if</span> (mLooper == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">            <span class="string">"Can't create handler inside thread that has not called Looper.prepare()"</span>);</div><div class="line">    &#125;</div><div class="line">    mQueue = mLooper.mQueue;</div><div class="line">    mCallback = callback;</div><div class="line">    mAsynchronous = async;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°è¿™æ®µä»£ç æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ­£å¥½æ˜¯åˆšæ‰æˆ‘ä»¬æ²¡æœ‰åˆ›å»º<code>Handler</code>çš„æ—¶å€™æ‰€å‡ºç°çš„ã€‚</p>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™æ®µä»£ç ä¸­ï¼Œè°ƒç”¨äº†<code>Looper.myLooper()</code>æ–¹æ³•è·å–ä¸€ä¸ªLooperå¯¹è±¡ï¼Œå¦‚æœLooperå¯¹è±¡ä¸ºç©ºï¼Œå°±ä¼šæŠ›å¼‚å¸¸ï¼Œé‚£ä»€ä¹ˆæ—¶å€™Looperå¯¹è±¡ä¸ºç©ºå‘¢ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹çœ‹<code>Looper.myLooper()</code>ä¸­çš„ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="meta">@Nullable</span> <span class="function">Looper <span class="title">myLooper</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> sThreadLocal.get();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯ä»<code>sThreadLocal</code>å¯¹è±¡ä¸­å–å‡º<code>Looper</code>ï¼Œå¦‚æœ<code>sThreadLocal</code>ä¸­æœ‰<code>Looper</code>å­˜åœ¨å°±è¿”å›<code>Looper</code>ï¼Œå¦åˆ™è¿”å›ç©ºã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨ä»€ä¹ˆæ—¶å€™ç»™<code>sThreadLocal</code>è®¾ç½®<code>Looper</code>å‘¢ï¼Ÿç»éªŒå¾—å‡ºï¼Œè‚¯å®šæ˜¯<code>Looper.prepare()</code>ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œç¨‹åºä¼šå´©æºƒã€‚ğŸ˜„</p>
<p>æˆ‘ä»¬æ¥çœ‹<code>Looper.prepare()</code>æ–¹æ³•çš„æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</div><div class="line">    prepare(<span class="keyword">true</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</div><div class="line">    &#125;</div><div class="line">    sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>prepare</code>æ–¹æ³•åˆè°ƒç”¨äº†<code>prepare(boolean quitAllowed)</code>æ–¹æ³•ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹<code>prepare(boolean quitAllowed)</code>æ–¹æ³•ã€‚</p>
<p>é¦–å…ˆåˆ¤æ–­<code>sThreadLocal</code>ä¸­æ˜¯å¦å·²ç»å­˜åœ¨<code>Looper</code>äº†ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¢<code>Looper</code>å¹¶è®¾ç½®ç»™<code>sThreadLocal</code>ã€‚è¿™å°±è§£é‡Šäº†ï¼Œæˆ‘ä»¬åˆ›å»º<code>Handler</code>çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆå¿…é¡»å…ˆè°ƒç”¨<code>Looper.prepare()</code>æ–¹æ³•ã€‚å¦‚æœå·²ç»å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ã€‚ç”±æ­¤å¾—å‡ºï¼Œä¸€ä¸ªçº¿ç¨‹ä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ª<code>Looper</code>ã€‚</p>
<p>å¯èƒ½ä½ è¿˜ä¼šç–‘æƒ‘ï¼Œæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹åˆ›å»º<code>Handler</code>åˆ°æ—¶å€™å¹¶æ²¡æœ‰å»è°ƒç”¨<code>Looper.prepare()</code>æ–¹æ³•ï¼Œç¨‹åºä¹Ÿæ²¡æœ‰å´©æºƒå•Šã€‚è¿™æ˜¯å› ä¸ºåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œç³»ç»Ÿå·²ç»å¸®æˆ‘ä»¬è‡ªåŠ¨è°ƒç”¨äº†<code>Looper.prepare()</code>æ–¹æ³•ã€‚çœ‹<code>ActivityThread</code>ä¸­çš„<code>main()</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </div><div class="line">    SamplingProfilerIntegration.start();  </div><div class="line">    CloseGuard.setEnabled(<span class="keyword">false</span>);  </div><div class="line">    Environment.initForCurrentUser();  </div><div class="line">    EventLogger.setReporter(<span class="keyword">new</span> EventLoggingReporter());  </div><div class="line">    Process.setArgV0(<span class="string">"&lt;pre-initialized&gt;"</span>);  </div><div class="line">    Looper.prepareMainLooper();  </div><div class="line">    ActivityThread thread = <span class="keyword">new</span> ActivityThread();  </div><div class="line">    thread.attach(<span class="keyword">false</span>);  </div><div class="line">    <span class="keyword">if</span> (sMainThreadHandler == <span class="keyword">null</span>) &#123;  </div><div class="line">        sMainThreadHandler = thread.getHandler();  </div><div class="line">    &#125;  </div><div class="line">    AsyncTask.init();  </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;  </div><div class="line">        Looper.myLooper().setMessageLogging(<span class="keyword">new</span> LogPrinter(Log.DEBUG, <span class="string">"ActivityThread"</span>));  </div><div class="line">    &#125;  </div><div class="line">    Looper.loop();  </div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Main thread loop unexpectedly exited"</span>);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿå¸®æˆ‘ä»¬è°ƒç”¨äº†<code>Looper.prepareMainLooper()</code>æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åˆä¼šå†å»è°ƒç”¨<code>Looper.prepare()</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepareMainLooper</span><span class="params">()</span> </span>&#123;</div><div class="line">    prepare(<span class="keyword">false</span>);</div><div class="line">    <span class="keyword">synchronized</span> (Looper.class) &#123;</div><div class="line">        <span class="keyword">if</span> (sMainLooper != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The main Looper has already been prepared."</span>);</div><div class="line">        &#125;</div><div class="line">        sMainLooper = myLooper();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å› æ­¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸­å§‹ç»ˆå­˜åœ¨ä¸€ä¸ª<code>Looper</code>å¯¹è±¡ï¼Œä»è€Œä¸éœ€è¦å†åŠ¨æ‰‹å»è°ƒç”¨<code>Looper.prepare()</code>ã€‚</p>
<p>è¿™æ ·å…³äº<code>Handler</code>å’Œ<code>Looper</code>çš„å…³ç³»å°±å¾ˆæ˜ç¡®äº†ï¼Œ<code>Handler</code>çš„åˆ›å»ºä¾èµ–ä¸<code>Looper</code>ã€‚ä¸€ä¸ªçº¿ç¨‹ä¸­è‡³å¤šæœ‰ä¸€ä¸ª<code>Handler</code>ã€‚</p>
<h5 id="Handlerã€Messageã€Looperçš„æ¶ˆæ¯æœºåˆ¶"><a href="#Handlerã€Messageã€Looperçš„æ¶ˆæ¯æœºåˆ¶" class="headerlink" title="Handlerã€Messageã€Looperçš„æ¶ˆæ¯æœºåˆ¶"></a>Handlerã€Messageã€Looperçš„æ¶ˆæ¯æœºåˆ¶</h5><p>æˆ‘ä»¬å·²ç»æ˜ç™½äº†<code>Handler</code>å’Œ<code>Looper</code>ä¹‹é—´çš„å¤§æ¦‚å…³ç³»ï¼Œé‚£ä¹ˆè¿™ä¸‰è€…ä¹‹é—´çš„å…·ä½“æ˜¯å¦‚ä½•ååŒæ“ä½œçš„å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>Handler</code>æ˜¯å¦‚ä½•å‘é€æ¶ˆæ¯çš„:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </div><div class="line">        Message message = <span class="keyword">new</span> Message();  </div><div class="line">        message.arg1 = <span class="number">1</span>;  </div><div class="line">        Bundle bundle = <span class="keyword">new</span> Bundle();  </div><div class="line">        bundle.putString(<span class="string">"data"</span>, <span class="string">"data"</span>);  </div><div class="line">        message.setData(bundle);  </div><div class="line">        handler.sendMessage(message);  </div><div class="line">    &#125;  </div><div class="line">&#125;).start();</div></pre></td></tr></table></figure>
<p>å…¶å®Messageåªæ˜¯ä¸€ä¸ªè½½ä½“ï¼Œå®ƒå¯ä»¥ä½¿ç”¨<code>setData()</code>æˆ–<code>arg</code>å‚æ•°ç­‰æ–¹æ³•æ¥æºå¸¦ä¸€äº›æ•°æ®ï¼Œç„¶åé€šè¿‡<code>Handler</code>å°†æ¶ˆæ¯å‘é€å‡ºå»ã€‚</p>
<p>é‚£ä¹ˆ<code>Handler</code>æŠŠ<code>Message</code>å‘é€åˆ°å“ªé‡Œäº†å‘¢ï¼Ÿè€Œä¸”æˆ‘ä»¬åˆå¯ä»¥åœ¨<code>Handler</code>çš„<code>handleMessage()</code>æ–¹æ³•ä¸­é‡æ–°å¾—åˆ°è¿™æ¡<code>Message</code>å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹<code>Handler</code>çš„<code>sendMessage</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">sendMessage</span><span class="params">(Message msg)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> sendMessageDelayed(msg, <span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">sendMessageDelayed</span><span class="params">(Message msg, <span class="keyword">long</span> delayMillis)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (delayMillis &lt; <span class="number">0</span>) &#123;</div><div class="line">        delayMillis = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</div><div class="line">    MessageQueue queue = mQueue;</div><div class="line">    <span class="keyword">if</span> (queue == <span class="keyword">null</span>) &#123;</div><div class="line">        RuntimeException e = <span class="keyword">new</span> RuntimeException(</div><div class="line">                <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</div><div class="line">        Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¾—è½¬ååˆ™æœ€åè°ƒç”¨äº†<code>sendMessageAtTime</code>ï¼Œåœ¨æ­¤æ–¹æ³•çš„å†…éƒ¨ï¼Œåˆè°ƒç”¨äº†<code>enqueueMessage</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°<code>queue</code>å°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒå°†æ‰€æœ‰æ”¶åˆ°çš„æ¶ˆæ¯ä»¥é˜Ÿåˆ—çš„å½¢å¼è¿›è¡Œæ’åˆ—ï¼Œå¹¶æä¾›å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„æ“ä½œï¼Œå…¶å®å½“å‰<code>Handler</code>ä¸­çš„<code>queue</code>æ˜¯ç”±<code>Looper</code>åˆ›å»ºçš„ï¼Œ<code>Handler</code>åªæ˜¯å¼•ç”¨äº†æ­¤<code>queue</code>ï¼Œæˆ‘ä»¬æŸ¥çœ‹<code>Handler</code>çš„æ„é€ æ–¹æ³•ï¼Œé‡Œé¢ä¼šæœ‰è¿™æ ·ä¸¤å¥ä»£ç :<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</div><div class="line">	...</div><div class="line">	mLooper = Looper.myLooper();</div><div class="line">	...</div><div class="line">	mQueue = mLooper.mQueue;</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å› æ­¤ï¼Œä¸€ä¸ªLooperä¹Ÿå°±åªæœ‰ä¸€ä¸ª<code>MessageQueue</code>ã€‚ç¬¬äºŒä¸ªå‚æ•°msgå°±æ˜¯æˆ‘ä»¬æ‰€è¦å‘é€çš„æ¶ˆæ¯<code>Message</code>ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°<code>uptimeMillis</code>åˆ™è¡¨ç¤ºå‘é€æ¶ˆæ¯çš„æ—¶é—´ï¼Œå®ƒçš„å€¼ç­‰äºç³»ç»Ÿå¼€æœºåˆ°å½“å‰æ—¶é—´çš„æ¯«ç§’æ•°å†åŠ ä¸Šå»¶è¿Ÿæ—¶é—´ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨çš„ä¸æ˜¯<code>endMessageDelayed()</code>æ–¹æ³•ï¼Œå»¶è¿Ÿæ—¶é—´å°±æ˜¯0ã€‚ç„¶åæˆ‘ä»¬å†æ¥çœ‹è°ƒç”¨çš„<code>enqueueMessage</code>æ–¹æ³•çš„å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(MessageQueue queue, Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</div><div class="line">    msg.target = <span class="keyword">this</span>;</div><div class="line">    <span class="keyword">if</span> (mAsynchronous) &#123;</div><div class="line">        msg.setAsynchronous(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ­¤æ–¹æ³•ä¼šæŠŠå½“å‰<code>Handler</code>è®¾ç½®ä¸º<code>msg</code>çš„<code>target</code>ï¼Œè¿™ä¸ª<code>target</code>çš„ä½œç”¨æˆ‘ä»¬ç­‰ä¼šå†è¯´ã€‚ç„¶åå°±æ˜¯è°ƒç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„<code>enqueueMessage</code>æ–¹æ³•ï¼Œæ¯«æ— ç–‘é—®ï¼Œå°±æ˜¯æŠŠæ¶ˆæ¯å…¥é˜Ÿäº†ã€‚æˆ‘ä»¬çœ‹æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(Message msg, <span class="keyword">long</span> when)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (msg.target == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Message must have a target."</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (msg.isInUse()) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(msg + <span class="string">" This message is already in use."</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (mQuitting) &#123;</div><div class="line">            IllegalStateException e = <span class="keyword">new</span> IllegalStateException(</div><div class="line">                    msg.target + <span class="string">" sending message to a Handler on a dead thread"</span>);</div><div class="line">            Log.w(TAG, e.getMessage(), e);</div><div class="line">            msg.recycle();</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        msg.markInUse();</div><div class="line">        msg.when = when;</div><div class="line">        Message p = mMessages;</div><div class="line">        <span class="keyword">boolean</span> needWake;</div><div class="line">        <span class="keyword">if</span> (p == <span class="keyword">null</span> || when == <span class="number">0</span> || when &lt; p.when) &#123;</div><div class="line">            <span class="comment">// New head, wake up the event queue if blocked.</span></div><div class="line">            msg.next = p;</div><div class="line">            mMessages = msg;</div><div class="line">            needWake = mBlocked;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            needWake = mBlocked &amp;&amp; p.target == <span class="keyword">null</span> &amp;&amp; msg.isAsynchronous();</div><div class="line">            Message prev;</div><div class="line">            <span class="keyword">for</span> (;;) &#123;</div><div class="line">                prev = p;</div><div class="line">                p = p.next;</div><div class="line">                <span class="keyword">if</span> (p == <span class="keyword">null</span> || when &lt; p.when) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (needWake &amp;&amp; p.isAsynchronous()) &#123;</div><div class="line">                    needWake = <span class="keyword">false</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            msg.next = p; <span class="comment">// invariant: p == prev.next</span></div><div class="line">            prev.next = msg;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// We can assume mPtr != 0 because mQuitting is false.</span></div><div class="line">        <span class="keyword">if</span> (needWake) &#123;</div><div class="line">            nativeWake(mPtr);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆåˆ¤æ–­<code>msg</code>çš„<code>target</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºæŠ›å¼‚å¸¸ï¼Œç”±æ­¤æˆ‘ä»¬çœ‹å‡º<code>target</code>åœ¨åé¢ä¼šæœ‰å¤§ä½œç”¨ã€‚å…¶æ¬¡åˆ¤æ–­æ­¤æ¶ˆæ¯æ˜¯å¦å·²ç»åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å»ã€‚ç„¶åè®¾ç½®<code>msg</code>ä¸ºå·²åŠ å…¥æ ‡è®°ï¼Œ<code>msg</code>è§¦å‘æ—¶é—´ï¼Œè¿™é‡Œä¼šå–å‡ºä¹‹å‰çš„æ¶ˆæ¯ï¼Œé¦–å…ˆä½ è¦çŸ¥é“ï¼Œ<code>MessageQueue</code>å¹¶æ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªé›†åˆæŠŠæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¿å­˜èµ·æ¥ï¼Œå®ƒåªä½¿ç”¨äº†ä¸€ä¸ª<code>Messages</code>å¯¹è±¡è¡¨ç¤ºå½“å‰å¾…å¤„ç†çš„æ¶ˆæ¯ï¼Œè€Œä¸”æ¯ä¸ª<code>Messages</code>å¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ª<code>next</code>å­—æ®µï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª<code>Messages</code>å¯¹è±¡ï¼Œç”±æ­¤å¯ä»¥ç»„æˆç±»ä¼¼äºé“¾è¡¨ä¸€æ ·çš„æ•°æ®ç»“æ„ã€‚è€Œä¸”è¿™é‡Œä¼šåˆ¤æ–­å½“å‰<code>msg</code>çš„è§¦å‘æ—¶é—´æ˜¯ä¸æ˜¯0ï¼Œå¦‚æœæ˜¯0ç›´æ¥åŠ å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚å¦‚æœ<code>msg</code>çš„è§¦å‘æ—¶é—´ä¸æ˜¯0ï¼Œä¼šä¸€ç›´å¾ªç¯éå†å½“å‰<code>MessageQueue</code>å¯¹è±¡ä¸­çš„æ¶ˆæ¯é“¾è¡¨ï¼Œå¹¶æ¯”è¾ƒè§¦å‘æ—¶é—´ï¼Œé‡æ–°æ’åˆ—æ¶ˆæ¯é“¾è¡¨ã€‚å¦‚æ­¤ï¼Œå½“å‰æ¶ˆæ¯å·²ç»è¢«æ’å…¥åˆ°æ•´ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p>
<p>æˆ‘ä»¬ä¼šç–‘æƒ‘ï¼Œä»£ç åˆ°è¿™é‡Œå·²ç»æ²¡æœ‰äº†ï¼Œä½†æ˜¯<code>Handler</code>åˆæ˜¯å¦‚ä½•æ¥æ”¶åˆ°æ¶ˆæ¯çš„å‘¢ï¼Ÿ</p>
<p>ä¸çŸ¥é“å¤§å®¶æ³¨æ„æ²¡ï¼Œæˆ‘ä»¬åœ¨çœ‹<code>ActivityThread</code>ä¸­çš„<code>main()</code>æ–¹æ³•ä¸­ï¼Œæœ‰æ²¡æœ‰è¿˜çœ‹åˆ°è¿™æ ·ä¸€å¥ä»£ç ï¼š<code>Looper.loop()</code>ï¼Œè¿™å¥ä»£ç ä¼šä¸ä¼šå’Œæˆ‘ä»¬çš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥åšä¸ªè¯•éªŒï¼šæˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ª<code>Handler</code>ï¼Œå¹¶ä¸”å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä½†æ˜¯æˆ‘ä»¬åªè°ƒç”¨<code>Looper.prepare()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ˜¯å¦èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">requestData</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Looper.prepare();</div><div class="line">                Handler handler = <span class="keyword">new</span> Handler(<span class="keyword">new</span> Handler.Callback() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">                    	<span class="comment">//æ ‡è®°ä¸€ä¸‹æ¥å—åˆ°æ¶ˆæ¯</span></div><div class="line">                        Log.d(<span class="string">"msg"</span>,<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯"</span>);</div><div class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line"></div><div class="line">                <span class="comment">//å­çº¿ç¨‹æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></div><div class="line">                Thread.sleep(<span class="number">3000</span>);</div><div class="line">				   <span class="comment">//å‘é€æ¶ˆæ¯</span></div><div class="line">                handler.sendMessage(<span class="keyword">new</span> Message());</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œç¨‹åºä»¥åï¼Œåœ¨æ§åˆ¶å°å¹¶æ²¡æœ‰çœ‹åˆ°æ‰“å°çš„ä¿¡æ¯ï¼Œç„¶åæˆ‘ä»¬åœ¨<code>handler.sendMessage(new Message())</code>åé¢æ·»åŠ <code>Looper.loop()</code>ä»£ç ï¼Œå†æ¬¡è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ§åˆ¶å°æœ‰ä¿¡æ¯æ‰“å°ï¼Œæ³¨æ„ï¼Œ<code>Looper.loop()</code>ä¼šé€ æˆä»£ç é˜»å¡ï¼Œå¿…é¡»æ”¾åœ¨ä»£ç çš„æœ€åé¢ã€‚ ç”±æ­¤æˆ‘ä»¬å¯ä»¥ç¡®ä¿¡ï¼Œæ¶ˆæ¯çš„å‘é€ç¡®å®å’Œ<code>Looper.loop()</code>æ–¹æ³•æœ‰å¾ˆå¤§å…³ç³»ï¼Œæˆ‘ä»¬çœ‹æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</div><div class="line">	 <span class="comment">//è·å–å½“å‰çº¿ç¨‹çš„Looper</span></div><div class="line">    <span class="keyword">final</span> Looper me = myLooper();</div><div class="line">    <span class="keyword">if</span> (me == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">//å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰Looper æŠ›å‡ºå¼‚å¸¸    </span></div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ‹¿åˆ°å½“å‰Looperçš„æ¶ˆæ¯é˜Ÿåˆ—</span></div><div class="line">    <span class="keyword">final</span> MessageQueue queue = me.mQueue;</div><div class="line">	</div><div class="line">    Binder.clearCallingIdentity();</div><div class="line">    <span class="keyword">final</span> <span class="keyword">long</span> ident = Binder.clearCallingIdentity();</div><div class="line">    </div><div class="line">	 <span class="comment">//æ­»å¾ªç¯å½“å‰æ¶ˆæ¯é˜Ÿåˆ—</span></div><div class="line">    <span class="keyword">for</span> (;;) &#123;</div><div class="line">        Message msg = queue.next(); <span class="comment">// might block</span></div><div class="line">        <span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</div><div class="line">        	<span class="comment">//æ²¡æœ‰æ¶ˆæ¯è¿”å›</span></div><div class="line">           <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// This must be in a local variable, in case a UI event sets the logger</span></div><div class="line">        <span class="keyword">final</span> Printer logging = me.mLogging;</div><div class="line">        <span class="keyword">if</span> (logging != <span class="keyword">null</span>) &#123;</div><div class="line">            logging.println(<span class="string">"&gt;&gt;&gt;&gt;&gt; Dispatching to "</span> + msg.target + <span class="string">" "</span> +</div><div class="line">                    msg.callback + <span class="string">": "</span> + msg.what);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">long</span> traceTag = me.mTraceTag;</div><div class="line">        <span class="keyword">if</span> (traceTag != <span class="number">0</span> &amp;&amp; Trace.isTagEnabled(traceTag)) &#123;</div><div class="line">            Trace.traceBegin(traceTag, msg.target.getTraceName(msg));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">        	  <span class="comment">//æ‹¿åˆ°æ¶ˆæ¯ä¹‹å‰å­˜å‚¨çš„targetä¹Ÿå°±æ˜¯Handler å‘é€æ¶ˆæ¯</span></div><div class="line">            msg.target.dispatchMessage(msg);</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">if</span> (traceTag != <span class="number">0</span>) &#123;</div><div class="line">                Trace.traceEnd(traceTag);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (logging != <span class="keyword">null</span>) &#123;</div><div class="line">            logging.println(<span class="string">"&lt;&lt;&lt;&lt;&lt; Finished to "</span> + msg.target + <span class="string">" "</span> + msg.callback);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Make sure that during the course of dispatching the</span></div><div class="line">        <span class="comment">// identity of the thread wasn't corrupted.</span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">long</span> newIdent = Binder.clearCallingIdentity();</div><div class="line">        <span class="keyword">if</span> (ident != newIdent) &#123;</div><div class="line">            Log.wtf(TAG, <span class="string">"Thread identity changed from 0x"</span></div><div class="line">                    + Long.toHexString(ident) + <span class="string">" to 0x"</span></div><div class="line">                    + Long.toHexString(newIdent) + <span class="string">" while dispatching to "</span></div><div class="line">                    + msg.target.getClass().getName() + <span class="string">" "</span></div><div class="line">                    + msg.callback + <span class="string">" what="</span> + msg.what);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        msg.recycleUnchecked();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æœ‰Looperï¼Œå¦‚æœæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥<code>Looper.loop()</code>ä¸€å®šè¦åœ¨<code>Looper.prepare()</code>æ–¹æ³•ä¹‹åï¼Œç„¶åæ‹¿åˆ°å½“å‰<code>Looper</code>çš„æ¶ˆæ¯é˜Ÿåˆ—<code>mQueue</code>ï¼Œä¹‹åè¿›å…¥æ— é™å¾ªç¯ï¼Œå–å‡ºç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆæ¯åˆ™é˜»å¡ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>Handler</code>å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™åˆ™èƒ½é€šè¿‡å¾ªç¯å–åˆ°æ¶ˆæ¯ï¼Œä¹‹åè°ƒç”¨æ¶ˆæ¯çš„<code>target</code>çš„<code>dispatchMessage()</code>æ–¹æ³•æ¥å›è°ƒæ¶ˆæ¯ä¿¡æ¯ã€‚å…¶å®æ¶ˆæ¯çš„targetå°±æ˜¯<code>Handler</code>ã€‚</p>
<p>å†æ¥çœ‹çœ‹<code>Handler</code>çš„<code>dispatchMessage()</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>&#123;  </div><div class="line">    <span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) &#123; </div><div class="line">    	 <span class="comment">//ä½¿ç”¨Handlerçš„postæ–¹æ³•å‘é€æ¶ˆæ¯ä¼šèµ°è¿™é‡Œ </span></div><div class="line">        handleCallback(msg);  </div><div class="line">    &#125; <span class="keyword">else</span> &#123;  </div><div class="line">        <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;  </div><div class="line">        	  <span class="comment">//ä½¿ç”¨Handlerçš„sendMessageæ–¹æ³•ä¼šèµ°è¿™é‡Œ</span></div><div class="line">            <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;  </div><div class="line">                <span class="keyword">return</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        handleMessage(msg);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨<code>Handler</code>çš„æœ‰å‚æ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œä¼šä¼ ä¸€ä¸ª<code>Callback</code>å¯¹è±¡ï¼Œä»–æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•<code>handleMessage()</code>ï¼Œæ‰€ä»¥ä¼šå†æ¬¡èµ°æˆ‘ä»¬çš„å›è°ƒå‡½æ•°ï¼Œä¼ é€’æ¶ˆæ¯ã€‚</p>
<p>è‡³æ­¤ï¼Œå…³äº<code>Looper</code>ã€<code>Handler</code>ã€<code>Message</code>è¿™ä¸‰è€…å…³ç³»æˆ‘ä»¬å·²ç»éå¸¸æ¸…æ¥šäº†ï¼Œæ¥å¼ å›¾è§£é‡Šä¸€ä¸‹ï¼š</p>
<div align="center"><br><img src="http://img.blog.csdn.net/20140805002935859?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbG1qNjIzNTY1Nzkx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><br></div>


<p>å¦å¤–é™¤äº†è¿˜æœ‰ä¸€ç§å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼š<code>Handler</code>çš„<code>post()</code>æ–¹æ³•ã€‚</p>
<p>å…ˆæ¥çœ‹çœ‹<code>post()</code>æ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable r)</span></span></div><div class="line">&#123;</div><div class="line">   <span class="keyword">return</span>  sendMessageDelayed(getPostMessage(r), <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åŸæ¥è¿™é‡Œè¿˜æ˜¯è°ƒç”¨äº†sendMessageDelayed()æ–¹æ³•å»å‘é€ä¸€æ¡æ¶ˆæ¯å•Šï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨äº†getPostMessage()æ–¹æ³•å°†Runnableå¯¹è±¡è½¬æ¢æˆäº†ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„æºç ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Message <span class="title">getPostMessage</span><span class="params">(Runnable r)</span> </span>&#123;</div><div class="line">    Message m = Message.obtain();</div><div class="line">    m.callback = r;</div><div class="line">    <span class="keyword">return</span> m;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°†æ¶ˆæ¯çš„callbackå­—æ®µçš„å€¼æŒ‡å®šä¸ºä¼ å…¥çš„Runnableå¯¹è±¡ã€‚å’¦ï¼Ÿè¿™ä¸ªcallbackå­—æ®µçœ‹èµ·æ¥æœ‰äº›çœ¼ç†Ÿå•Šï¼Œå–”ï¼åœ¨Handlerçš„dispatchMessage()æ–¹æ³•ä¸­åŸæ¥æœ‰åšä¸€ä¸ªæ£€æŸ¥ï¼Œå¦‚æœMessageçš„callbackç­‰äºnullæ‰ä¼šå»è°ƒç”¨handleMessage()æ–¹æ³•ï¼Œå¦åˆ™å°±è°ƒç”¨handleCallback()æ–¹æ³•ã€‚é‚£æˆ‘ä»¬å¿«æ¥çœ‹ä¸‹handleCallback()æ–¹æ³•ä¸­çš„ä»£ç å§ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handleCallback</span><span class="params">(Message message)</span> </span>&#123;</div><div class="line">    message.callback.run();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¹Ÿå¤ªç®€å•äº†ï¼ç«Ÿç„¶å°±æ˜¯ç›´æ¥è°ƒç”¨äº†ä¸€å¼€å§‹ä¼ å…¥çš„Runnableå¯¹è±¡çš„run()æ–¹æ³•ã€‚å› æ­¤åœ¨å­çº¿ç¨‹ä¸­é€šè¿‡Handlerçš„post()æ–¹æ³•è¿›è¡ŒUIæ“ä½œå°±å¯ä»¥è¿™ä¹ˆå†™ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> Handler handler;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line">        handler = <span class="keyword">new</span> Handler();  </div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </div><div class="line">                handler.post(<span class="keyword">new</span> Runnable() &#123;  </div><div class="line">                    <span class="meta">@Override</span>  </div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </div><div class="line">                        <span class="comment">// åœ¨è¿™é‡Œè¿›è¡ŒUIæ“ä½œ  </span></div><div class="line">                    &#125;  </div><div class="line">                &#125;);  </div><div class="line">            &#125;  </div><div class="line">        &#125;).start();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è™½ç„¶å†™æ³•ä¸Šç›¸å·®å¾ˆå¤šï¼Œä½†æ˜¯åŸç†æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åœ¨Runnableå¯¹è±¡çš„run()æ–¹æ³•é‡Œæ›´æ–°UIï¼Œæ•ˆæœå®Œå…¨ç­‰åŒäºåœ¨handleMessage()æ–¹æ³•ä¸­æ›´æ–°UIã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šæ‰€æœ‰æºç çš„åˆ†æï¼Œæˆ‘ä»¬å·²ç»å‘ç°äº†ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨å“ªç§æ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ›´æ–°UIï¼Œå…¶å®èƒŒåçš„åŸç†éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¿…é¡»éƒ½è¦å€ŸåŠ©å¼‚æ­¥æ¶ˆæ¯å¤„ç†çš„æœºåˆ¶æ¥å®ç°ï¼Œè€Œæˆ‘ä»¬åˆå·²ç»å°†è¿™ä¸ªæœºåˆ¶çš„æµç¨‹å®Œå…¨ææ˜ç™½äº†ã€‚çœŸå¥½ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ— è®ºæ˜¯&lt;code&gt;Android&lt;/code&gt;è¿˜æ˜¯&lt;code&gt;iOS&lt;/code&gt;ï¼Œå…³äºUIçš„æ“ä½œéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ‰€æœ‰çš„UIæ“ä½œåªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¼šåœ¨å­çº¿ç¨‹ä¸­åšä¸€äº›è€—æ—¶çš„æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œèµ„æºçš„è¯·æ±‚ï¼Œå½“è¿™äº›è€—æ—¶æ“ä½œç»“æŸæ—¶ï¼Œæˆ‘ä»¬åˆå¸Œæœ›æ‹¿è¿™äº›è¯·æ±‚ä¸‹æ¥çš„èµ„æºå»æ›´æ–°UIï¼Œä½†æ˜¯å½“å‰çº¿ç¨‹ä¸ºå­çº¿ç¨‹ï¼Œè€Œæ›´æ–°UIç”±å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†çº¿ç¨‹é—´çš„é€šä¿¡é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å­¦è¿‡iOSçš„åŒå­¦éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code&gt;GCD&lt;/code&gt;æˆ–è€…&lt;code&gt;performSelectorOnMainThread:&lt;/code&gt;ç­‰æŠ€æœ¯æ¥è¾¾åˆ°æˆ‘ä»¬çš„éœ€æ±‚ã€‚è€Œåœ¨Androidä¸­ï¼Œæˆ‘ä»¬å°±è¦ä½¿ç”¨åˆ°å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å°±æ¥è¯¦ç»†è¯´ä¸€ä¸‹å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä¸€å¤©ä¸€Androidä¹‹æ•°æ®æŒä¹…åŒ–æŠ€æœ¯</title>
    <link href="http://www.guiyongdong.com/2017/03/24/%E4%B8%80%E5%A4%A9%E4%B8%80Android%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%80%E6%9C%AF/"/>
    <id>http://www.guiyongdong.com/2017/03/24/ä¸€å¤©ä¸€Androidä¹‹æ•°æ®æŒä¹…åŒ–æŠ€æœ¯/</id>
    <published>2017-03-24T03:21:30.000Z</published>
    <updated>2017-03-25T07:39:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»»ä½•ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯´ç™½äº†éƒ½æ˜¯åœ¨ä¸åœçš„å’Œæ•°æ®æ‰“äº¤é“ï¼Œé€šè¿‡ç½‘ç»œè·å–çš„æ•°æ®ï¼Œä¸€èˆ¬ä¸ºç¬æ—¶æ•°æ®ï¼Œå½“æˆ‘ä»¬å…³é—­APPçš„æ—¶å€™ï¼Œè¿™äº›æ•°æ®å°±ä¼šæ¶ˆå¤±ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬å´å¸Œæœ›åœ¨APPå…³é—­çš„æ—¶å€™ï¼Œä¿å­˜è¿™äº›æ•°æ®ï¼Œä»¥æœŸå¾…åœ¨ä¸‹æ¬¡APPå¯åŠ¨çš„æ—¶å€™èƒ½ç”¨åˆ°è¿™äº›æ•°æ®ã€‚é‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°æ•°æ®æŒä¹…åŒ–æŠ€æœ¯äº†ã€‚</p>
<p>å…¶å®æ•°æ®æŒä¹…åŒ–å·²ç»è¢«å¹¿æ³›åº”ç”¨äºå„ç§ç¨‹åºè®¾è®¡çš„é¢†åŸŸäº†ï¼Œåå°å°±ä¸è¯´äº†ï¼ŒiOSæœ‰<code>plist</code>ã€<code>å½’æ¡£</code>ã€<code>æ•°æ®åº“</code>ç­‰ã€‚å½“ç„¶ï¼ŒAndroidä¹Ÿæœ‰ç±»ä¼¼ä¸iOSçš„å­˜å‚¨æ–¹å¼ï¼š<code>æ–‡ä»¶å­˜å‚¨</code>ã€<code>SharedPreference</code>ä»¥åŠ<code>æ•°æ®åº“</code>ç­‰ï¼Œå¯¹äº†ï¼ŒAndroidè¿˜æœ‰SDå¡ã€‚</p>
<a id="more"></a>
<h3 id="æ–‡ä»¶å­˜å‚¨"><a href="#æ–‡ä»¶å­˜å‚¨" class="headerlink" title="æ–‡ä»¶å­˜å‚¨"></a>æ–‡ä»¶å­˜å‚¨</h3><h5 id="å†™æ•°æ®"><a href="#å†™æ•°æ®" class="headerlink" title="å†™æ•°æ®"></a>å†™æ•°æ®</h5><p>æ–‡ä»¶å­˜å‚¨æ˜¯Androidä¸­æœ€åŸºæœ¬çš„å­˜å‚¨æ–¹å¼ï¼Œå®ƒä¸å¯¹å­˜å‚¨çš„å†…å®¹è¿›è¡Œæ ¼å¼åŒ–å¤„ç†ï¼Œæ‰€æœ‰çš„æ•°æ®åŸå°ä¸åŠ¨åœ°ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œå› è€Œå®ƒé€‚åˆå­˜å‚¨ä¸€äº›ç®€å•çš„æ–‡æœ¬æ•°æ®æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ã€‚å…¶å®é—®ä»·å­˜å‚¨æ˜¯æœ€ç®€å•çš„ï¼Œä½ åªéœ€è¦äº†è§£javaæµçš„ä½¿ç”¨å°±å¯ä»¥äº†ã€‚Androidæä¾›äº†ä¸€ä¸ª<code>openFileOutput()</code>æ–¹æ³•ï¼Œå¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶åï¼Œæ³¨æ„è¿™é‡Œçš„æ–‡ä»¶ä¸éœ€è¦åŒ…å«è·¯å¾„ï¼Œå› ä¸ºæ‰€æœ‰çš„æ–‡ä»¶éƒ½æ˜¯é»˜è®¤å­˜å‚¨åˆ°<code>/data/data/&lt;packagename&gt;/files</code>ç›®å½•ä¸‹çš„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–‡ä»¶çš„æ“ä½œæ¨¡å¼ï¼Œä¸»è¦æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯<code>MODE_PTIVATE</code>ï¼Œå®ƒä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼ï¼Œè¡¨ç¤ºå½“æˆ‘ä»¬å†™å…¥çš„æ•°æ®ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ã€‚å¦ä¸€ç§æ˜¯<code>MODE_APPEND</code>ï¼Œè¡¨ç¤ºä¼šè¿½åŠ æ•°æ®ã€‚è€Œä¸”<code>openFileOutput()</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>FileOutputStream</code>å¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥ä»¥javaæµçš„æ–¹å¼å†™æ•°æ®äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">saveData</span><span class="params">(String data)</span> </span>&#123;</div><div class="line">    <span class="comment">//ç›´æ¥ä½¿ç”¨æ–‡ä»¶å­˜å‚¨</span></div><div class="line">    FileOutputStream fileOutputStream = <span class="keyword">null</span>;</div><div class="line">    BufferedWriter bufferedWriter = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        fileOutputStream = openFileOutput(<span class="string">"str.txt"</span>,MODE_APPEND);</div><div class="line">        bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(fileOutputStream));</div><div class="line">        bufferedWriter.write(data);</div><div class="line">    &#125;<span class="keyword">catch</span> (IOException e)&#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;<span class="keyword">finally</span> &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (bufferedWriter != <span class="keyword">null</span>)&#123;</div><div class="line">                bufferedWriter.close();</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="è¯»æ•°æ®"><a href="#è¯»æ•°æ®" class="headerlink" title="è¯»æ•°æ®"></a>è¯»æ•°æ®</h5><p>æœ‰å†™å°±æœ‰è¯»ï¼Œ<code>Context</code>ç±»è¿˜æä¾›äº†ä¸€ä¸ª<code>openFileInput()</code>æ–¹æ³•ï¼Œç”¨äºè¯»å–æ•°æ®ï¼Œè¿™ä¸ªæ–¹æ³•åªæ¥æ”¶ä¸€ä¸ªå‚æ•°æ–‡ä»¶åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ°<code>/data/data/&lt;packagename&gt;/files</code>ç›®å½•ä¸‹è¯»å–è¿™ä¸ªæ–‡ä»¶çš„æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªFileInputStreamå¯¹è±¡ï¼Œç„¶åé€šè¿‡javaæµçš„æ–¹å¼è¯»å–æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    FileInputStream inputStream = <span class="keyword">null</span>;</div><div class="line">    BufferedReader bufferedReader = <span class="keyword">null</span>;</div><div class="line">    StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        inputStream = openFileInput(<span class="string">"str.txt"</span>);</div><div class="line">        bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</div><div class="line">        String line = <span class="string">""</span>;</div><div class="line">        <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>)&#123;</div><div class="line">            stringBuffer.append(line);</div><div class="line">        &#125;</div><div class="line">    &#125;<span class="keyword">catch</span> (IOException e)&#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;<span class="keyword">finally</span> &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (bufferedReader != <span class="keyword">null</span>)&#123;</div><div class="line">                bufferedReader.close();</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> bufferedReader.toString();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SharedPreferences"><a href="#SharedPreferences" class="headerlink" title="SharedPreferences"></a>SharedPreferences</h3><p>è¯´èµ·è¿™ä¸ªï¼Œæˆ‘æƒ³åˆ°äº†iOSçš„åå¥½è®¾ç½®ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œå’ŒiOSä¸åŒçš„æ˜¯ï¼ŒSharedPreferenceså´å¯ä»¥åˆ›å»ºä»»æ„çš„åå¥½è®¾ç½®ã€‚iOSä¸­çš„åå¥½è®¾ç½®æœ¬è´¨æ˜¯plistï¼ŒAndroidä¸­çš„åå¥½è®¾ç½®æœ¬è´¨æ˜¯XMLã€‚</p>
<h5 id="å†™æ•°æ®-1"><a href="#å†™æ•°æ®-1" class="headerlink" title="å†™æ•°æ®"></a>å†™æ•°æ®</h5><p>è¦æƒ³å†™æ•°æ®ï¼Œé¦–å…ˆéœ€è¦è·å–<code>SharedPreferences</code>å¯¹è±¡ï¼ŒAndroidæä¾›äº†ä¸‰ç§æ–¹å¼è·å–ã€‚</p>
<p><strong>Contextç±»ä¸­çš„getSharedPreferences()æ–¹æ³•</strong><br>æ­¤æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºæŒ‡å®š<code>SharedPreferences</code>æ–‡ä»¶çš„åç§°ï¼Œå¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºï¼Œ<code>SharedPreferences</code>æ–‡ä»¶éƒ½æ˜¯å­˜æ”¾åœ¨<code>/data/data/&lt;package name&gt;/shared</code>ç›®å½•ä¸‹çš„ã€‚ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šæ“ä½œæ¨¡å¼ï¼Œç›®å‰åªæœ‰MODE_PRIVATEè¿™ä¸€ç§æ¨¡å¼å¯é€‰ï¼Œè¡¨ç¤ºåªæœ‰æœ¬åº”ç”¨ç¨‹åºæ‰å¯ä»¥å¯¹è¿™ä¸ª<code>SharedPreferences</code>æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚</p>
<p><strong>Activityç±»ä¸­çš„getPreferences()æ–¹æ³•</strong><br>è¿™ä¸ªæ–¹æ³•ç›´æ¥æ”¶ä¸€ä¸ªæ“ä½œå‚æ•°ï¼Œå› ä¸ºä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ä¼šè‡ªåŠ¨å°†å½“å‰æ´»åŠ¨çš„ç±»åä½œä¸ºæ–‡ä»¶åã€‚</p>
<p><strong>PreferenceManagerç±»ä¸­çš„getDefaultSharedPreferences()æ–¹æ³•</strong><br>è¿™æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªContextå‚æ•°ï¼Œå¹¶è‡ªåŠ¨ä½¿ç”¨å½“å‰åº”ç”¨ç¨‹åºçš„åŒ…åä½œä¸ºå‰ç¼€æ¥å‘½å<code>SharedPreferences</code>æ–‡ä»¶ï¼Œå¾—åˆ°<code>SharedPreferences</code>å¯¹è±¡åï¼Œå°±å¯ä»¥å®ç°æ•°æ®çš„å­˜å‚¨äº†ï¼Œä¸»è¦æœ‰3æ­¥ï¼š</p>
<ul>
<li>è°ƒç”¨<code>SharedPreferences</code>å¯¹è±¡çš„edit()æ–¹æ³•è·å–ä¸€ä¸ª<code>SharedPreferences.Editor</code>å¯¹è±¡</li>
<li>å‘<code>SharedPreferences.Editor</code>å¯¹è±¡ä¸­æ·»åŠ æ•°æ®</li>
<li>è°ƒç”¨<code>apply()</code>æ–¹æ³•å°†æ•°æ®æäº¤</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ä½¿ç”¨SharedPreferences å­˜å‚¨æ•°æ®</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">saveData</span><span class="params">(String data)</span> </span>&#123;</div><div class="line">	SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(<span class="keyword">this</span>);</div><div class="line">	<span class="comment">//sharedPreferences = getSharedPreferences("share",MODE_PRIVATE);</span></div><div class="line">	<span class="comment">//sharedPreferences = getPreferences(MODE_PRIVATE);</span></div><div class="line">	SharedPreferences.Editor editor = sharedPreferences.edit();</div><div class="line">	editor.putString(data,<span class="string">"aaa"</span>);<span class="comment">//ä»¥key-valueçš„å½¢å¼å­˜å‚¨</span></div><div class="line">	editor.apply();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="è¯»æ•°æ®-1"><a href="#è¯»æ•°æ®-1" class="headerlink" title="è¯»æ•°æ®"></a>è¯»æ•°æ®</h5><p>ä½¿ç”¨<code>SharedPreferences</code>è¯»æ•°æ®æ›´åŠ çš„ç®€å•ï¼Œ<code>SharedPreferences</code>æœ‰ä¸€ç³»åˆ—çš„getæ–¹æ³•æ¥è¯»å–ä¸åŒç±»å‹çš„æ•°æ®ã€‚getæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯keyï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦‚æœå–ä¸åˆ°è¿™ä¸ªkeyå¯¹åº”çš„å€¼ï¼Œè¿”å›çš„é»˜è®¤å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">read</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">	SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(<span class="keyword">this</span>);</div><div class="line">	<span class="comment">//sharedPreferences = getSharedPreferences("share",MODE_PRIVATE);</span></div><div class="line">	<span class="comment">//sharedPreferences = getPreferences(MODE_PRIVATE);</span></div><div class="line">	String string = sharedPreferences.getString(key, <span class="string">"default"</span>);</div><div class="line">	Toast.makeText(<span class="keyword">this</span>,string,Toast.LENGTH_SHORT).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ•°æ®åº“å­˜å‚¨"><a href="#æ•°æ®åº“å­˜å‚¨" class="headerlink" title="æ•°æ®åº“å­˜å‚¨"></a>æ•°æ®åº“å­˜å‚¨</h3><p>è¯´åˆ°æ•°æ®åº“å­˜å‚¨ï¼Œä¸å¾—ä¸äº†è§£çš„å°±æ˜¯SQLè¯­å¥ï¼Œå…¶å®æˆ‘çš„æ•°æ®åº“äº†è§£çš„å¾ˆå°‘ï¼ŒSQLè¯­å¥ä¹Ÿåªä¼šä¸€äº›ç®€å•çš„ï¼Œå¦‚æœæƒ³å­˜å‚¨ä¸€äº›æœ‰å¤æ‚ä¾èµ–å…³ç³»çš„æ•°æ®æ˜¯éœ€è¦æ•°æ®åº“åŠŸåº•çš„ã€‚</p>
<p>æ— è®ºAndroidè¿˜æ˜¯iOSï¼Œç³»ç»Ÿéƒ½å†…ç½®äº†åä¸ºsqliteæ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„SQLè¯­å¥æ¥æ“ä½œå®ƒã€‚</p>
<h5 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h5><p>Androidä¸“é—¨æä¾›ä¸€ä¸ªå«<code>SQLiteOpenHelper</code>çš„æŠ½è±¡ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•<code>onCreate</code>å’Œ<code>onUpgrade</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€ä¸ªåˆ›å»ºï¼Œä¸€ä¸ªæ›´æ–°ã€‚</p>
<p><code>SQLiteOpenHelper</code>ä¸­è¿˜æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>getReadableDatabase()</code>å’Œ<code>getWritableDatabase()</code>ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥åˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•°æ®åº“æ“ä½œå¯¹è±¡ã€‚ä¸åŒçš„æ˜¯å½“æ•°æ®åº“ä¸å¯å†™å…¥æ—¶ï¼ˆå¦‚ç£ç›˜ç©ºé—´å·²æ»¡ï¼‰ï¼Œ<code>getReadableDatabase()</code>æ–¹æ³•è¿”å›çš„å¯¹è±¡å°†ä»¥åªè¯»çš„æ–¹å¼å»æ‰“å¼€æ•°æ®åº“ï¼Œè€Œ<code>getWritableDatabase()</code>æ–¹æ³•åˆ™æŠ›å¼‚å¸¸ã€‚</p>
<p><code>SQLiteOpenHelper</code>ä¸­æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•å¯ä¾›é‡å†™ï¼Œä¸€èˆ¬ä½¿ç”¨å‚æ•°å°‘çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Contextï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°æ®åº“åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å…è®¸æˆ‘ä»¬åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„Cursorï¼Œä¸€èˆ¬éƒ½ä¼ nullï¼Œç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºå½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬å·ï¼Œå¯ç”¨äºå¯¹æ•°æ®åº“å‡çº§æ“ä½œã€‚æ•°æ®åº“å­˜æ”¾çš„ä½ç½®åœ¨<code>/data/data/&lt;package name&gt;/database/</code>ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataBaseHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CREATE_BOOK = <span class="string">"create table Book ("</span></div><div class="line">            +<span class="string">"id integer primary key autoincrement,"</span></div><div class="line">            +<span class="string">"author text,"</span></div><div class="line">            +<span class="string">"price real,"</span></div><div class="line">            +<span class="string">"pages integer,"</span></div><div class="line">            +<span class="string">"name text)"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CREATE_CATEGORY = <span class="string">"create table Category ("</span></div><div class="line">            +<span class="string">"id integer primary key autoincrement,"</span></div><div class="line">            +<span class="string">"author text,"</span></div><div class="line">            +<span class="string">"price real,"</span></div><div class="line">            +<span class="string">"pages integer,"</span></div><div class="line">            +<span class="string">"name text)"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span>  Context mContext;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDataBaseHelper</span><span class="params">(Context context, String name, SQLiteDatabase.CursorFactory factory, <span class="keyword">int</span> version)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, name, factory, version);</div><div class="line">        mContext = context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</div><div class="line">        <span class="comment">//åœ¨æ­¤æ–¹æ³•ä¸­åˆ›å»ºæ•°æ®åº“</span></div><div class="line">        db.execSQL(CREATE_BOOK);</div><div class="line">        Toast.makeText(mContext,<span class="string">"åˆ›å»ºæ•°æ®åº“"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</div><div class="line">        <span class="comment">//å¦‚æœç‰ˆæœ¬å·å‡çº§ åˆ™åœ¨æ­¤æ–¹æ³•ä¸­å¯¹æ•°æ®åº“è¿›è¡Œå‡çº§</span></div><div class="line">        Toast.makeText(mContext,<span class="string">"æ›´æ–°æ•°æ®åº“"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">        <span class="keyword">if</span> (newVersion == <span class="number">2</span>)&#123;</div><div class="line">            db.execSQL(CREATE_CATEGORY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBaseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> MyDataBaseHelper mMyDataBaseHelper;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_data_base);</div><div class="line">        </div><div class="line">        <span class="comment">//ç­‰åˆ°ä¸‹æ¬¡éœ€è¦å‡çº§æ•°æ®åº“æ—¶ï¼Œéœ€è¦ä¿®æ”¹è¿™é‡Œçš„ç‰ˆæœ¬å·</span></div><div class="line">        mMyDataBaseHelper = <span class="keyword">new</span> MyDataBaseHelper(<span class="keyword">this</span>,<span class="string">"BookStore.db"</span>,<span class="keyword">null</span>,<span class="number">1</span>);</div><div class="line"></div><div class="line">        Button button = (Button) findViewById(R.id.button2);</div><div class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                <span class="comment">//ä¼šåˆ›å»ºæ•°æ®åº“</span></div><div class="line">                mMyDataBaseHelper.getWritableDatabase();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ‰æ•°æ®åº“çš„åœ°æ–¹å°±æœ‰å¢åˆ æ”¹æŸ¥</p>
<h5 id="å¢"><a href="#å¢" class="headerlink" title="å¢"></a>å¢</h5><p><code>SQLiteOpenHelper</code>æä¾›äº†ä¸€ä¸ª<code>insert()</code>æ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯è¡¨åï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºåœ¨æœªæŒ‡å®šæ·»åŠ æ•°æ®çš„æƒ…å†µä¸‹ç»™æŸäº›å¯ä¸ºç©ºçš„åˆ—è‡ªåŠ¨èµ‹å€¼ä¸ºNULLï¼Œä¸€èˆ¬æˆ‘ä»¬ç›´æ¥ä¼ nullï¼Œç¬¬ä¸‰ä¸ªæ˜¯ContentValueså¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—çš„putï¼ˆï¼‰æ–¹æ³•ï¼Œç”¨äºæ·»åŠ æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</div><div class="line">	Button addButton = (Button) findViewById(R.id.addButton);</div><div class="line">	addButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">	    <span class="meta">@Override</span></div><div class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">	        SQLiteDatabase database = mMyDataBaseHelper.getWritableDatabase();</div><div class="line">	        ContentValues contentValues = <span class="keyword">new</span> ContentValues();</div><div class="line">	        contentValues.put(<span class="string">"name"</span>,<span class="string">"android"</span>);</div><div class="line">	        contentValues.put(<span class="string">"author"</span>,<span class="string">"125"</span>);</div><div class="line">	        contentValues.put(<span class="string">"pages"</span>,<span class="number">40</span>);</div><div class="line">	        contentValues.put(<span class="string">"price"</span>,<span class="number">16.50</span>);</div><div class="line">	        database.insert(<span class="string">"Book"</span>,<span class="keyword">null</span>,contentValues);</div><div class="line">	    &#125;</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="åˆ "><a href="#åˆ " class="headerlink" title="åˆ "></a>åˆ </h5><p><code>SQLiteOpenHelper</code>æä¾›ä¸€ä¸ª<code>delete()</code>æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨åï¼Œç¬¬äºŒï¼Œä¸‰ä¸ªå‚ç”¨äºçº¦æŸåˆ é™¤æŸä¸€è¡Œæˆ–æŸå‡ è¡Œçš„æ•°æ®ï¼Œä¸æŒ‡å®šçš„è¯é»˜è®¤åˆ é™¤æ‰€æœ‰è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</div><div class="line">	Button deleteButton = (Button) findViewById(R.id.deleteButton);</div><div class="line">	deleteButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">	    <span class="meta">@Override</span></div><div class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">	        SQLiteDatabase database = mMyDataBaseHelper.getWritableDatabase();</div><div class="line">	        database.delete(<span class="string">"Book"</span>,<span class="string">"name = ?"</span>,<span class="keyword">new</span> String[]&#123;<span class="string">"android"</span>&#125;);</div><div class="line">	    &#125;</div><div class="line">	&#125;);	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="æ”¹"><a href="#æ”¹" class="headerlink" title="æ”¹"></a>æ”¹</h5><p><code>SQLiteOpenHelper</code>æä¾›äº†ä¸€ä¸ª<code>update()</code>æ–¹æ³•ï¼Œç”¨äºå¯¹æ•°æ®çš„æ›´æ–°ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶4ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºè¡¨åï¼Œç¬¬äºŒä¸ªä¸ºContentValueså¯¹è±¡ï¼ŒæŠŠè¦æ›´æ–°æ•°æ®åœ¨è¿™é‡Œç»„è£…ï¼Œç¬¬ä¸‰ï¼Œå››ä¸ªç”¨äºçº¦æŸæ›´æ–°æŸä¸€è¡Œæˆ–æŸå‡ è¡Œä¸­çš„æ•°æ®ï¼Œä¸æŒ‡å®šçš„è¯æ›´æ–°æ‰€æœ‰è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</div><div class="line">	Button updateButton = (Button) findViewById(R.id.updateButton);</div><div class="line">    updateButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">            SQLiteDatabase database = mMyDataBaseHelper.getWritableDatabase();</div><div class="line">            ContentValues contentValues = <span class="keyword">new</span> ContentValues();</div><div class="line">            contentValues.put(<span class="string">"price"</span>,<span class="number">4545.9</span>);</div><div class="line">            database.update(<span class="string">"Book"</span>,contentValues,<span class="string">"name = ?"</span>,<span class="keyword">new</span> String[]&#123;<span class="string">"android"</span>&#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h5><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ•°æ®åº“ä¸­çš„æŸ¥æ˜¯æœ€å¤æ‚çš„ã€‚<code>SQLiteOpenHelper</code>æä¾›äº†ä¸€ç³»åˆ—<code>query()</code>æ–¹æ³•ï¼Œæœ€çŸ­çš„æ–¹æ³•ä¹Ÿæœ‰7ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨åã€‚ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šå»æŸ¥è¯¢å“ªå‡ è¡Œï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤æŸ¥è¯¢æ‰€æœ‰è¡Œã€‚ç¬¬ä¸‰ï¼Œå››ä¸ªç”¨äºçº¦æŸæŸ¥è¯¢æŸä¸€è¡Œæˆ–æŸå‡ è¡Œçš„æ•°æ®ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤æŸ¥è¯¢æ‰€æœ‰è¡Œã€‚ç¬¬äº”ä¸ªå‚æ•°å‚æ•°è¡¨ç¤ºæŒ‡å®šéœ€è¦group byçš„åˆ—ï¼Œä¸æŒ‡å®šåˆ™è¡¨ç¤ºä¸å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œgroup byæ“ä½œã€‚ç¬¬å…­ä¸ªå‚æ•°ç”¨äºå¯¹group byçš„è¿›ä¸€æ­¥è¿‡æ»¤ã€‚ç¬¬ä¸ƒä¸ªå‚æ•°ç”¨äºå¯¹æŸ¥è¯¢çš„ç»“æœæ’åºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function">pubic <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</div><div class="line">	Button checkButton = (Button) findViewById(R.id.checkButton);</div><div class="line">	checkButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">	    <span class="meta">@Override</span></div><div class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">	        SQLiteDatabase database = mMyDataBaseHelper.getWritableDatabase();</div><div class="line">	        Cursor cursor = database.query(<span class="string">"Book"</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</div><div class="line">	        <span class="keyword">if</span> (cursor.moveToFirst())&#123;</div><div class="line">	            do &#123;</div><div class="line">	                String name = cursor.getString(cursor.getColumnIndex(<span class="string">"name"</span>));</div><div class="line">                        <span class="keyword">double</span> price = cursor.getDouble(cursor.getColumnIndex(<span class="string">"price"</span>))</div><div class="line">                        Toast.makeText(DataBaseActivity.<span class="keyword">this</span>,name+price,Toast.LENGTH_SHORT).show();</div><div class="line">	        &#125;</div><div class="line">	        cursor.close();</div><div class="line">	    &#125;</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œè°ƒç”¨<code>query()</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>Cursor</code>å¯¹è±¡ï¼Œè°ƒç”¨<code>moveToFirst()</code>å¯å°†æŸ¥è¯¢æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€è¡Œçš„ä½ç½®ï¼Œè°ƒç”¨<code>moveToNext()</code>å¯å°†æŸ¥è¯¢æŒ‡é’ˆå‘ä¸‹ä¸€è¡Œç§»åŠ¨ï¼Œå¦‚æœæ²¡æœ‰ä¸‹ä¸€è¡Œè¿”å›falseï¼Œç»“æŸæŸ¥è¯¢ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¾ªç¯éå†æŸ¥è¯¢æ•°æ®ã€‚é€šè¿‡<code>Cursor</code>çš„<code>getColumnIndex()</code>æ–¹æ³•è·å–åˆ°æŸä¸€åˆ—åœ¨è¡¨ä¸­å¯¹åº”çš„ä½ç½®ç´¢å¼•ï¼Œé€šè¿‡è¿™ä¸ªç´¢å¼•å°±å¯ä»¥å¾—åˆ°ç´¢å¼•å¯¹åº”çš„æ•°æ®ï¼Œ</p>
<p>å½“ç„¶ï¼Œå…³äºæ•°æ®åº“çš„æ“ä½œä½ å®Œå…¨å¯ä»¥ä¸é€‚ç”¨ä»¥ä¸Šæ–¹æ³•ï¼Œå¦‚æœä½ å¯¹SQLè¯­å¥è¶³å¤Ÿæ•°é‡ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨SQLè¯­å¥è¿›è¡Œæ“ä½œï¼Œæ·»åŠ ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨<code>SQLiteDatabase</code>çš„<code>execSQL()</code>æ–¹æ³•æ“ä½œï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºSQLè¯­å¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå€¼ã€‚æŸ¥è¯¢æ“ä½œå¯ä»¥ä½¿ç”¨<code>SQLiteDatabase</code>çš„<code>rawQuery()</code>æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºSQLè¯­å¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå€¼ã€‚</p>
<p>è¿™é‡Œæ¨èä¸€ä¸ªåº“ï¼Œ<strong>LitePal</strong>ï¼Œç®€åŒ–äº†æ•°æ®åº“çš„æ“ä½œï¼Œå¯ä»¥ç›´æ¥å¯¹JavaBeanè¿›è¡Œæ“ä½œã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»»ä½•ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯´ç™½äº†éƒ½æ˜¯åœ¨ä¸åœçš„å’Œæ•°æ®æ‰“äº¤é“ï¼Œé€šè¿‡ç½‘ç»œè·å–çš„æ•°æ®ï¼Œä¸€èˆ¬ä¸ºç¬æ—¶æ•°æ®ï¼Œå½“æˆ‘ä»¬å…³é—­APPçš„æ—¶å€™ï¼Œè¿™äº›æ•°æ®å°±ä¼šæ¶ˆå¤±ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬å´å¸Œæœ›åœ¨APPå…³é—­çš„æ—¶å€™ï¼Œä¿å­˜è¿™äº›æ•°æ®ï¼Œä»¥æœŸå¾…åœ¨ä¸‹æ¬¡APPå¯åŠ¨çš„æ—¶å€™èƒ½ç”¨åˆ°è¿™äº›æ•°æ®ã€‚é‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°æ•°æ®æŒä¹…åŒ–æŠ€æœ¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®æ•°æ®æŒä¹…åŒ–å·²ç»è¢«å¹¿æ³›åº”ç”¨äºå„ç§ç¨‹åºè®¾è®¡çš„é¢†åŸŸäº†ï¼Œåå°å°±ä¸è¯´äº†ï¼ŒiOSæœ‰&lt;code&gt;plist&lt;/code&gt;ã€&lt;code&gt;å½’æ¡£&lt;/code&gt;ã€&lt;code&gt;æ•°æ®åº“&lt;/code&gt;ç­‰ã€‚å½“ç„¶ï¼ŒAndroidä¹Ÿæœ‰ç±»ä¼¼ä¸iOSçš„å­˜å‚¨æ–¹å¼ï¼š&lt;code&gt;æ–‡ä»¶å­˜å‚¨&lt;/code&gt;ã€&lt;code&gt;SharedPreference&lt;/code&gt;ä»¥åŠ&lt;code&gt;æ•°æ®åº“&lt;/code&gt;ç­‰ï¼Œå¯¹äº†ï¼ŒAndroidè¿˜æœ‰SDå¡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://www.guiyongdong.com/categories/Android/"/>
    
    
      <category term="android" scheme="http://www.guiyongdong.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å¤©ä¸€Androidä¹‹å¹¿æ’­</title>
    <link href="http://www.guiyongdong.com/2017/03/23/%E4%B8%80%E5%A4%A9%E4%B8%80Android%E4%B9%8B%E5%B9%BF%E6%92%AD/"/>
    <id>http://www.guiyongdong.com/2017/03/23/ä¸€å¤©ä¸€Androidä¹‹å¹¿æ’­/</id>
    <published>2017-03-23T06:06:15.000Z</published>
    <updated>2017-03-23T09:08:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>æåˆ°å¹¿æ’­ï¼Œå› ä¸ºæˆ‘æ˜¯å†œæ‘çš„ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æˆ‘ä»¬æ‘å¤§é˜Ÿçš„å–‡å­ï¼Œå¦‚æœå¹³å¸¸æœ‰äº¤ç”µè´¹ï¼Œæˆ–è€…é‡è¦çš„äº‹æƒ…ï¼Œè¿™ä¸ªå–‡å­å°±ä¼šå“èµ·ï¼Œå…¨æ‘çš„éƒ½èƒ½å¬è§ï¼Œå¯èƒ½æœ‰æ—¶å€™é‚»æ‘çš„ä¹Ÿèƒ½å¬è§ï¼Œè¶³è§å¹¿æ’­çš„æ¨é€é¢ç§¯ä¹‹å¤§ã€‚</p>
<p>æåˆ°å¹¿æ’­è¿™ç§æœºåˆ¶ï¼Œå­¦è¿‡iOSçš„éƒ½çŸ¥é“é€šçŸ¥ï¼Œæˆ‘æƒ³è¿™ä¸¤ç§æœºåˆ¶åº”è¯¥éƒ½æ˜¯ç±»ä¼¼çš„ã€‚åœ¨iOSä¸­ï¼Œæˆ‘ä»¬å¦‚æœæƒ³ç›‘å¬ç³»ç»Ÿçš„æŸäº›äº‹ä»¶ï¼Œæ¯”å¦‚APPé€€åˆ°åå°ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æŠŠç›‘å¬å¯¹è±¡æ·»åŠ åˆ°ç³»ç»Ÿçš„é€šçŸ¥ä¸­å¿ƒä¸­ï¼Œå¹¶ä¸”å…³æ³¨APPé€€åˆ°åå°çš„äº‹ä»¶ï¼Œå°±å¯ä»¥éšæ—¶ç›‘å¬äº†ã€‚é€šçŸ¥è¿˜æœ‰ä¸ªå¥½å¤„å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¤¸çº¿ç¨‹ï¼Œå¤¸ç•Œé¢çš„å¤„ç†äº‹ä»¶ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨Androidä¸­ï¼Œå¹¿æ’­åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥è¯¦ç»†åˆ†æä¸€ä¸‹å¹¿æ’­åœ¨Androidä¸­çš„åº”ç”¨ã€‚(ps:å¹¿æ’­è¿˜æœ‰å¦å¤–ä¸€ä¸ªåå­—â€”â€”å…¨å±€å¤§å–‡å­~~)</p>
<a id="more"></a>
<h3 id="å¹¿æ’­æœºåˆ¶ç®€ä»‹"><a href="#å¹¿æ’­æœºåˆ¶ç®€ä»‹" class="headerlink" title="å¹¿æ’­æœºåˆ¶ç®€ä»‹"></a>å¹¿æ’­æœºåˆ¶ç®€ä»‹</h3><p>åœ¨å¹¿æ’­æœºåˆ¶ä¸­ï¼Œå­˜åœ¨ä¸¤ç§è§’è‰²ï¼š<strong>å¹¿æ’­å‘é€è€…</strong>å’Œ<strong>å¹¿æ’­æ¥æ”¶è€…</strong>ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¹¿æ’­çš„ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>åŒä¸€APPå†…éƒ¨çš„åŒä¸€ç»„ä»¶å†…éƒ¨çš„æ¶ˆæ¯é€šä¿¡ï¼ˆå•ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼‰</li>
<li>åŒä¸€APPå†…éƒ¨çš„ä¸åŒç»„ä»¶ä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡ï¼ˆå•ä¸ªè¿›ç¨‹ï¼‰</li>
<li>åŒä¸€APPå…·æœ‰å¤šä¸ªè¿›ç¨‹çš„ä¸åŒç»„ä»¶ä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡</li>
<li>ä¸åŒAPPä¹‹é—´çš„ç»„ä»¶ä¹‹é—´æ¶ˆæ¯é€šä¿¡</li>
<li>Androidç³»ç»Ÿåœ¨ç‰¹å®šæƒ…å†µä¸‹ä¸APPä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡</li>
</ul>
<p>å¦å¤–ï¼ŒAndroidä¸­çš„å¹¿æ’­ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š<strong>æ ‡å‡†å¹¿æ’­</strong>å’Œ<strong>æœ‰åºå¹¿æ’­</strong>ã€‚</p>
<h5 id="æ ‡å‡†å¹¿æ’­"><a href="#æ ‡å‡†å¹¿æ’­" class="headerlink" title="æ ‡å‡†å¹¿æ’­"></a>æ ‡å‡†å¹¿æ’­</h5><p>æ ‡å‡†å¹¿æ’­æ˜¯ä¸€ç§å®Œå…¨å¼‚æ­¥æ‰§è¡Œçš„å¹¿æ’­ï¼Œåœ¨å¹¿æ’­å‘å‡ºä¹‹åï¼Œæ‰€æœ‰çš„å¹¿æ’­æ¥æ”¶å™¨å‡ ä¹ä¼šåœ¨åŒä¸€æ—¶åˆ»æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­æ¶ˆæ¯ï¼Œå› æ­¤å®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•å…ˆåé¡ºåºå¯è¨€ã€‚è¿™ç§å¹¿æ’­çš„æ•ˆç‡ä¼šæ¯”è¾ƒé«˜ï¼Œä½†æ˜¯å´ä¸èƒ½è¢«æˆªæ–­ã€‚æ ‡å‡†å¹¿æ’­çš„å·¥ä½œæµç¨‹æ˜¯ï¼š</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/1917079-00a6b9ddd0a874a8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>


<h5 id="æœ‰åºå¹¿æ’­"><a href="#æœ‰åºå¹¿æ’­" class="headerlink" title="æœ‰åºå¹¿æ’­"></a>æœ‰åºå¹¿æ’­</h5><p>æœ‰åºå¹¿æ’­æ˜¯ä¸€ç§åŒæ­¥æ‰§è¡Œçš„å¹¿æ’­ï¼Œåœ¨å¹¿æ’­å‘å‡ºä¹‹åï¼ŒåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨èƒ½å¤Ÿæ”¶åˆ°è¿™æ¡å¹¿æ’­æ¶ˆæ¯ï¼Œå½“è¿™ä¸ªå¹¿æ’­æ¥æ”¶å™¨ä¸­çš„é€»è¾‘å¤„ç†æ‰§è¡Œå®Œæ¯•åï¼Œå¹¿æ’­æ‰ä¼šç»§ç»­ä¼ æ’­ï¼Œè€Œä¸”ä¼˜å…ˆçº§é«˜çš„å¹¿æ’­æ¥æ”¶å™¨å¯ä»¥ä¼˜å…ˆæ¥æ”¶åˆ°å¹¿æ’­ã€‚å¹¶ä¸”å‰é¢çš„å¹¿æ’­æ¥æ”¶å™¨è¿˜å¯ä»¥æˆªæ–­æ­£åœ¨ä¼ é€’çš„å¹¿æ’­ï¼Œè¿™æ ·åé¢çš„å¹¿æ’­æ¥æ”¶å™¨å°±æ— æ³•æ”¶åˆ°å¹¿æ’­æ¶ˆæ¯äº†ã€‚æœ‰åºå¹¿æ’­çš„å·¥ä½œæµç¨‹æ˜¯ï¼š</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/1917079-31f3a8f2a27d905f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<h3 id="æ¥æ”¶ç³»ç»Ÿå¹¿æ’­"><a href="#æ¥æ”¶ç³»ç»Ÿå¹¿æ’­" class="headerlink" title="æ¥æ”¶ç³»ç»Ÿå¹¿æ’­"></a>æ¥æ”¶ç³»ç»Ÿå¹¿æ’­</h3><p>Androidå†…ç½®äº†å¾ˆå¤šç³»ç»Ÿçº§åˆ«çš„å¹¿æ’­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ç›‘å¬ç³»ç»Ÿçš„è¿™äº›å¹¿æ’­ï¼Œå°±éœ€è¦ç”¨åˆ°å¹¿æ’­æ¥æ”¶å™¨ï¼ˆBroadcastReceiverï¼‰ã€‚æ³¨å†Œå¹¿æ’­çš„æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§ï¼Œåœ¨ä»£ç ä¸­æ³¨å†Œå’Œåœ¨AndroidManifest.xmlä¸­æ³¨å†Œï¼Œå…¶ä¸­å‰è€…ä¹Ÿè¢«ç§°ä¸ºåŠ¨æ€æ³¨å†Œï¼Œåè€…ä¹Ÿè¢«ç§°ä¸ºé™æ€æ³¨å†Œã€‚</p>
<h5 id="åŠ¨æ€æ³¨å†Œç›‘å¬ç½‘ç»œå˜åŒ–"><a href="#åŠ¨æ€æ³¨å†Œç›‘å¬ç½‘ç»œå˜åŒ–" class="headerlink" title="åŠ¨æ€æ³¨å†Œç›‘å¬ç½‘ç»œå˜åŒ–"></a>åŠ¨æ€æ³¨å†Œç›‘å¬ç½‘ç»œå˜åŒ–</h5><p>å‡¡æ˜¯å¹¿æ’­æ¥æ”¶è€…éƒ½å¿…é¡»ç»§æ‰¿è‡ª<code>BroadcastReceiver</code>ï¼Œå¹¶é‡å†™æŠ½è±¡æ–¹æ³•<code>onReceive()</code>ï¼Œå½“æœ‰å¹¿æ’­åˆ°æ¥æ—¶ï¼Œ<code>onReceive()</code>æ–¹æ³•å°±ä¼šå¾—åˆ°æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨åŠ¨æ€æ³¨å†Œçš„æ–¹å¼å»ç›‘å¬ç½‘ç»œçš„å˜åŒ–ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> NetworkChangeReceiver mNetworkChangeReceiver;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        <span class="comment">//æ·»åŠ ç½‘ç»œçŠ¶æ€çš„ç›‘å¬</span></div><div class="line">        IntentFilter intentFilter = <span class="keyword">new</span> IntentFilter();</div><div class="line">        intentFilter.addAction(<span class="string">"android.net.conn.CONNECTIVITY_CHANGE"</span>);</div><div class="line">        mNetworkChangeReceiver = <span class="keyword">new</span> NetworkChangeReceiver();</div><div class="line">        registerReceiver(mNetworkChangeReceiver,intentFilter);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        unregisterReceiver(mNetworkChangeReceiver);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">NetworkChangeReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</div><div class="line">        <span class="comment">//å®ç°æ¥æ”¶çš„æ–¹æ³•</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">            ConnectivityManager connectivityManager = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);</div><div class="line">            NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();</div><div class="line">            <span class="keyword">if</span> (networkInfo != <span class="keyword">null</span> &amp;&amp; networkInfo.isAvailable())&#123;</div><div class="line">                Toast.makeText(context,<span class="string">"æœ‰ç½‘äº†ï¼"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                Toast.makeText(context,<span class="string">"æ²¡ç½‘äº†ï¼"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸è¦å¿˜äº†ï¼Œè¦åœ¨AndroidManifest.xmlä¸­æ·»åŠ ç½‘ç»œæƒé™<br><code>&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;</code></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨MainActivityä¸­å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±»<code>NetworkChangeReceiver</code>å¹¶ç»§æ‰¿<code>BroadcastReceiver</code>ï¼Œé‡å†™äº†çˆ¶ç±»çš„<code>onReceive()</code>æ–¹æ³•ã€‚æ¯å½“ç½‘ç»œå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œ<code>onReceive()</code>æ–¹æ³•å°±ä¼šå¾—åˆ°æ‰§è¡Œã€‚</p>
<p>åœ¨<code>onCreate()</code>æ–¹æ³•ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªIntentFilterçš„å®ä¾‹ï¼Œå¹¶ç»™å®ƒæ·»åŠ äº†ä¸€ä¸ªå€¼ä¸º<code>android.net.conn.CONNECTIVITY_CHANGE</code>çš„actionï¼Œå› å¤–å½“ç½‘ç»œçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç³»ç»Ÿä¼šå‘å‡ºä¸€æ¡å€¼ä¸º<code>android.net.conn.CONNECTIVITY_CHANGE</code>çš„å¹¿æ’­ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯åŠ¨æ€æ³¨å†Œå¹¿æ’­ï¼Œæ‰€ä»¥ä¸€å®šè¦åœ¨<code>onDestroy()</code>æ–¹æ³•ä¸­è°ƒç”¨<code>unregisterReceiver()</code>æ³¨é”€å¹¿æ’­çš„ç›‘å¬ã€‚</p>
<h5 id="é™æ€æ³¨å†Œå®ç°å¼€æœºå¯åŠ¨"><a href="#é™æ€æ³¨å†Œå®ç°å¼€æœºå¯åŠ¨" class="headerlink" title="é™æ€æ³¨å†Œå®ç°å¼€æœºå¯åŠ¨"></a>é™æ€æ³¨å†Œå®ç°å¼€æœºå¯åŠ¨</h5><p>åŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æ¥æ”¶å™¨å¯ä»¥è‡ªç”±çš„æ§åˆ¶æ³¨å†Œä¸æ³¨é”€ï¼Œåœ¨çµæ´»æ€§æ–¹é¢æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ç€ä¸€ä¸ªç¼ºç‚¹ï¼Œå³å¿…é¡»è¦åœ¨ç¨‹åºå¯åŠ¨ä¹‹åæ‰èƒ½æ¥æ”¶åˆ°å¹¿æ’­ï¼Œå› ä¸ºæ³¨å†Œçš„é€»è¾‘æ˜¯å†™åœ¨<code>onCreate()</code>æ–¹æ³•é‡Œçš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨ç¨‹åºæœªå¯åŠ¨çš„æ—¶å€™ï¼Œå°±èƒ½æ¥æ”¶åˆ°å¹¿æ’­ï¼Œé‚£å°±è¦ç”¨åˆ°é™æ€æ³¨å†Œäº†ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨ç±»ï¼Œåˆ›å»ºæ–¹å¼ä¸ºï¼šé€‰æ‹©æ–°å»º-&gt;Other-&gt;Broadcast Receiverã€‚Android Studioä¼šè®©æˆ‘ä»¬é€‰æ‹©è°¢è°¢ä¸œè¥¿ï¼Œ<code>Exported</code>è¡¨ç¤ºæ˜¯å¦å…è®¸è¿™ä¸ªå¹¿æ’­æ¥æ”¶å™¨æ¥æ”¶æœ¬ç¨‹åºä»¥å¤–çš„å¹¿æ’­ï¼Œ<code>Enabled</code>è¡¨ç¤ºæ˜¯å¦å¯ç”¨è¿™ä¸ªå¹¿æ’­æ¥æ”¶å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬éƒ½å‹¾é€‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BootCompleteReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">        Toast.makeText(context,<span class="string">"æ‰‹æœºå¼€æœºäº†"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>BootCompleteReceiver</code>ç±»é‡Œé¢çš„ä»£ç å¾ˆç®€å•ã€‚</p>
<p>å¦å¤–ï¼Œé™æ€çš„å¹¿æ’­æ¥æ”¶å™¨ä¸€å®šè¦åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­æ³¨å†Œæ‰å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æ³¨å†Œè¿™ä¸€æ­¥å·²ç»è¢«Android Studioè‡ªåŠ¨å®Œæˆäº†ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">          <span class="attr">package</span>=<span class="string">"com.guiyongdong.broadreceiverdemo"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></div><div class="line">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span></div><div class="line"></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--å¹¿æ’­æ¥æ”¶è€…--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">receiver</span></span></div><div class="line">            <span class="attr">android:name</span>=<span class="string">".BootCompleteReceiver"</span></div><div class="line">            <span class="attr">android:enabled</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</div><div class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>ç›®å‰ï¼Œæˆ‘ä»¬è¿˜ä¸èƒ½æ¥æ”¶åˆ°å¼€æœºå¹¿æ’­ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºå®ƒæ·»åŠ å“åº”çš„actionã€‚æ·»åŠ ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">          <span class="attr">package</span>=<span class="string">"com.guiyongdong.broadreceiverdemo"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!--æ·»åŠ æƒé™--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.RECEIVE_BOOT_COMPLETED"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></div><div class="line">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span></div><div class="line"></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--å¹¿æ’­æ¥æ”¶è€…--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">receiver</span></span></div><div class="line">            <span class="attr">android:name</span>=<span class="string">".BootCompleteReceiver"</span></div><div class="line">            <span class="attr">android:enabled</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--æ·»åŠ å¼€æœºå¹¿æ’­çš„ç›‘å¬--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.BOOT_COMPLETED"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>ç”±äºAndroidç³»ç»Ÿè‡ªåŠ¨å®Œæˆåä¼šå‘é€ä¸€æ¡å€¼ä¸º<code>android.intent.action.BOOT_COMPLETED</code>çš„å¹¿æ’­ï¼Œå› æ­¤éœ€è¦åœ¨<code>&lt;intent-filter&gt;</code>æ ‡ç­¾ä¸­æ·»åŠ ç›¸åº”çš„actionï¼Œå½“ç„¶ï¼Œç›‘å¬ç³»ç»Ÿå¼€æœºå¹¿æ’­çš„æƒé™ä¹Ÿæ˜¯éœ€è¦å£°æ˜çš„ã€‚å¦‚æ­¤ï¼Œæˆ‘ä»¬çš„APPä¾¿å¯ç›‘å¬æ‰‹æœºçš„å¼€æœºäº†ã€‚</p>
<h3 id="å‘é€è‡ªå®šä¹‰å¹¿æ’­"><a href="#å‘é€è‡ªå®šä¹‰å¹¿æ’­" class="headerlink" title="å‘é€è‡ªå®šä¹‰å¹¿æ’­"></a>å‘é€è‡ªå®šä¹‰å¹¿æ’­</h3><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œä¸€ç›´éƒ½æ˜¯ç³»ç»Ÿåœ¨å‘å¹¿æ’­ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¦æƒ³å‘é€è‡ªå·±çš„å¹¿æ’­è¯¥è¿™ä¹ˆåŠå‘¢ï¼Ÿå‰é¢è¯´äº†ï¼Œå‘å¹¿æ’­çš„å½¢å¼æœ‰ä¸¤ç§ï¼Œæ ‡å‡†å¹¿æ’­å’Œæœ‰åºå¹¿æ’­ï¼Œé‚£å°±æ¥çœ‹çœ‹è¿™ä¸¤ç§å¹¿æ’­å¦‚ä½•å‘é€ã€‚</p>
<h5 id="å‘é€æ ‡å‡†å¹¿æ’­"><a href="#å‘é€æ ‡å‡†å¹¿æ’­" class="headerlink" title="å‘é€æ ‡å‡†å¹¿æ’­"></a>å‘é€æ ‡å‡†å¹¿æ’­</h5><p>åœ¨å‘é€å¹¿æ’­ä¹‹å‰ï¼Œæˆ‘å…ˆå®šä¹‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨ï¼Œè¿™é‡Œçº¦å®šactionä¸º<code>com.guiyongdong.MY_BROADCAST</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">          <span class="attr">package</span>=<span class="string">"com.guiyongdong.broadreceiverdemo"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- æ·»åŠ æƒé™ --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.RECEIVE_BOOT_COMPLETED"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></div><div class="line">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">        ...</div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">receiver</span></span></div><div class="line">            <span class="attr">android:name</span>=<span class="string">".MyBroadcastReceiver"</span></div><div class="line">            <span class="attr">android:enabled</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--æ·»åŠ è‡ªå®šä¹‰çš„å¹¿æ’­æ¥æ”¶å™¨--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.guiyongdong.MY_BROADCAST"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>MyBroadcastReceiver</code>å¹¿æ’­æ¥æ”¶å™¨çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">        Toast.makeText(context,<span class="string">"æ¥æ”¶åˆ°è‡ªå®šä¹‰çš„å¹¿æ’­"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘åœ¨MainActivityä¸­æ·»åŠ äº†ä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œä¼šå‘é€åä¸º<code>com.guiyongdong.MY_BROADCAST</code>çš„å¹¿æ’­ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> NetworkChangeReceiver mNetworkChangeReceiver;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        Button button = (Button) findViewById(R.id.sendButton);</div><div class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(<span class="string">"com.guiyongdong.MY_BROADCAST"</span>);</div><div class="line">                sendBroadcast(intent);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é‡æ–°è¿è¡Œï¼Œå¹¶ç‚¹å‡»æŒ‰é’®ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android15.png?raw=true" width="375"><br></div>

<h5 id="å‘é€æœ‰åºå¹¿æ’­"><a href="#å‘é€æœ‰åºå¹¿æ’­" class="headerlink" title="å‘é€æœ‰åºå¹¿æ’­"></a>å‘é€æœ‰åºå¹¿æ’­</h5><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> NetworkChangeReceiver mNetworkChangeReceiver;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        Button button = (Button) findViewById(R.id.sendButton);</div><div class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(<span class="string">"com.guiyongdong.MY_BROADCAST"</span>);</div><div class="line">                sendOrderedBroadcast(intent,<span class="keyword">null</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‘é€æœ‰åºå¹¿æ’­åªéœ€è¦æ”¹åŠ¨ä¸€è¡Œä»£ç ï¼Œå³<code>sendBroadcast()</code>æ–¹æ³•æ”¹æˆ<code>sendOrderedBroadcast()</code>æ–¹æ³•ã€‚<code>sendOrderedBroadcast()</code>æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä»»ç„¶æ˜¯Intentï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªä¸æƒé™ç›¸å…³çš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œä¼ nullå°±è¡Œäº†ã€‚</p>
<p>å¦‚ä½•å®šä¹‰æœ‰åºå¹¿æ’­çš„æ¥æ”¶è€…çš„ä¼˜å…ˆçº§å‘¢ï¼Ÿé€šè¿‡<code>android:priority</code>å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§ã€‚éœ€è¦ä¿®æ”¹AndroidManifest.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">          <span class="attr">package</span>=<span class="string">"com.guiyongdong.broadreceiverdemo"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- æ·»åŠ æƒé™ --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.RECEIVE_BOOT_COMPLETED"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></div><div class="line">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">        ...</div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">receiver</span></span></div><div class="line">            <span class="attr">android:name</span>=<span class="string">".MyBroadcastReceiver"</span></div><div class="line">            <span class="attr">android:enabled</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</div><div class="line">            <span class="comment">&lt;!--ä¿®æ”¹ä¼˜å…ˆçº§--&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"100"</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!--æ·»åŠ è‡ªå®šä¹‰çš„å¹¿æ’­æ¥æ”¶å™¨--&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.guiyongdong.MY_BROADCAST"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œå½“æ¥æ”¶è€…æ¥åˆ°å¹¿æ’­ï¼Œä¹Ÿå·²ç»å¤„ç†å¥½é€»è¾‘åï¼Œå¦‚æœæ¥æ”¶è€…ä¸æƒ³è®©å¹¿æ’­ç»§ç»­ä¼ é€’äº†å‘¢ï¼Ÿè¿™æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨<code>abdortBroadcast()</code>æ–¹æ³•ï¼Œæ¥ä¸­æ–­ä¼ æ’­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">        Toast.makeText(context,<span class="string">"æ¥æ”¶åˆ°è‡ªå®šä¹‰çš„å¹¿æ’­"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">        <span class="comment">//ä¸­æ–­ä¼ è¾“</span></div><div class="line">        abortBroadcast();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æœ¬åœ°å¹¿æ’­"><a href="#æœ¬åœ°å¹¿æ’­" class="headerlink" title="æœ¬åœ°å¹¿æ’­"></a>æœ¬åœ°å¹¿æ’­</h3><p>å‰é¢æˆ‘æ‰€è¯´çš„å‘é€çš„å¹¿æ’­éƒ½æ˜¯å…¨å±€å¹¿æ’­ï¼Œè¿™äº›å¹¿æ’­å¯ä»¥è¢«å…¶ä»–ä»»ä½•åº”ç”¨ç¨‹åºæ¥æ”¶åˆ°ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»–åº”ç”¨çš„å¹¿æ’­ï¼Œè¿™æ ·å®¹æ˜“å¼•èµ·å®‰å…¨é—®é¢˜ã€‚</p>
<p>å½“ç„¶ï¼ŒAndroidå·²ç»ä¸ºæˆ‘ä»¬æƒ³åˆ°äº†è¿™ç‚¹ï¼Œåˆ©ç”¨æœ¬åœ°å¹¿æ’­å°±å¯ä»¥è§£å†³å¹¿æ’­çš„å®‰å…¨é—®é¢˜ï¼Œè€Œä¸”è¿™ç±»å¹¿æ’­åªèƒ½åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨è¿›è¡Œä¼ é€’ï¼Œå¹¶ä¸”å¹¿æ’­æ¥æ”¶è€…åªèƒ½æ¥æ”¶æ¥è‡ªæœ¬åº”ç”¨ç¨‹åºå‘å‡ºçš„å¹¿æ’­ã€‚</p>
<p>æœ¬åœ°å¹¿æ’­å¹¶ä¸å¤æ‚ï¼Œå®ƒä¸»è¦ä½¿ç”¨<code>LocalBroadcastManager</code>æ¥ç®¡ç†å¹¿æ’­ï¼Œå¹¶ä¸”æä¾›äº†å‘é€å¹¿æ’­å’Œæ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹å¦‚ä½•ä½¿ç”¨:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> LocalBroadcastManager mLocalBroadcastManager;</div><div class="line">    <span class="keyword">private</span> LocalReceiver mLocalReceiver;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        <span class="comment">//åˆ›å»ºæœ¬åœ°å¹¿æ’­ç®¡ç†å®ä¾‹</span></div><div class="line">        mLocalBroadcastManager = LocalBroadcastManager.getInstance(<span class="keyword">this</span>);</div><div class="line">        Button sendLocalButton = (Button) findViewById(R.id.sendLocalButton);</div><div class="line">        sendLocalButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(<span class="string">"com.guiyongdong.LOCAL_BROADCAST"</span>);</div><div class="line">                <span class="comment">//å‘é€æœ¬åœ°å¹¿æ’­</span></div><div class="line">                mLocalBroadcastManager.sendBroadcast(intent);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">//æ³¨å†Œå¹¿æ’­</span></div><div class="line">        IntentFilter intentFilter1 = <span class="keyword">new</span> IntentFilter();</div><div class="line">        intentFilter.addAction(<span class="string">"com.guiyongdong.LOCAL_BROADCAST"</span>);</div><div class="line">        mLocalReceiver = <span class="keyword">new</span> LocalReceiver();</div><div class="line">        mLocalBroadcastManager.registerReceiver(mLocalReceiver,intentFilter);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">LocalReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">            Toast.makeText(context,<span class="string">"æ¥æ”¶åˆ°æœ¬åœ°å¹¿æ’­"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        mLocalBroadcastManager.unregisterReceiver(mLocalReceiver);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šæœ¬åœ°å¹¿æ’­æ˜¯æ— æ³•é€šè¿‡é™æ€æ³¨å†Œçš„æ–¹å¼æ¥æ¥æ”¶çš„ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹æœ¬åœ°å¹¿æ’­çš„å‡ ç‚¹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å¯ä»¥æ˜ç¡®çŸ¥é“æ­£åœ¨å‘é€çš„å¹¿æ’­ä¸ä¼šç¦»å¼€æˆ‘ä»¬çš„ç¨‹åºï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒæ•°æ®æ³„éœ²ã€‚</li>
<li>å…¶ä»–çš„ç¨‹åºæ— æ³•å°†å¹¿æ’­å‘é€åˆ°æˆ‘ä»¬ç¨‹åºå†…éƒ¨ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒä¼šæœ‰å®‰å…¨æ¼æ´çš„éšæ‚£ã€‚</li>
<li>å‘é€æœ¬åœ°å¹¿æ’­æ¯”å…¨å±€å¹¿æ’­æ›´åŠ é«˜æ•ˆã€‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æåˆ°å¹¿æ’­ï¼Œå› ä¸ºæˆ‘æ˜¯å†œæ‘çš„ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æˆ‘ä»¬æ‘å¤§é˜Ÿçš„å–‡å­ï¼Œå¦‚æœå¹³å¸¸æœ‰äº¤ç”µè´¹ï¼Œæˆ–è€…é‡è¦çš„äº‹æƒ…ï¼Œè¿™ä¸ªå–‡å­å°±ä¼šå“èµ·ï¼Œå…¨æ‘çš„éƒ½èƒ½å¬è§ï¼Œå¯èƒ½æœ‰æ—¶å€™é‚»æ‘çš„ä¹Ÿèƒ½å¬è§ï¼Œè¶³è§å¹¿æ’­çš„æ¨é€é¢ç§¯ä¹‹å¤§ã€‚&lt;/p&gt;
&lt;p&gt;æåˆ°å¹¿æ’­è¿™ç§æœºåˆ¶ï¼Œå­¦è¿‡iOSçš„éƒ½çŸ¥é“é€šçŸ¥ï¼Œæˆ‘æƒ³è¿™ä¸¤ç§æœºåˆ¶åº”è¯¥éƒ½æ˜¯ç±»ä¼¼çš„ã€‚åœ¨iOSä¸­ï¼Œæˆ‘ä»¬å¦‚æœæƒ³ç›‘å¬ç³»ç»Ÿçš„æŸäº›äº‹ä»¶ï¼Œæ¯”å¦‚APPé€€åˆ°åå°ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æŠŠç›‘å¬å¯¹è±¡æ·»åŠ åˆ°ç³»ç»Ÿçš„é€šçŸ¥ä¸­å¿ƒä¸­ï¼Œå¹¶ä¸”å…³æ³¨APPé€€åˆ°åå°çš„äº‹ä»¶ï¼Œå°±å¯ä»¥éšæ—¶ç›‘å¬äº†ã€‚é€šçŸ¥è¿˜æœ‰ä¸ªå¥½å¤„å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¤¸çº¿ç¨‹ï¼Œå¤¸ç•Œé¢çš„å¤„ç†äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œåœ¨Androidä¸­ï¼Œå¹¿æ’­åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥è¯¦ç»†åˆ†æä¸€ä¸‹å¹¿æ’­åœ¨Androidä¸­çš„åº”ç”¨ã€‚(ps:å¹¿æ’­è¿˜æœ‰å¦å¤–ä¸€ä¸ªåå­—â€”â€”å…¨å±€å¤§å–‡å­~~)&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://www.guiyongdong.com/categories/Android/"/>
    
    
      <category term="android" scheme="http://www.guiyongdong.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å¤©ä¸€Androidä¹‹RecyclerView</title>
    <link href="http://www.guiyongdong.com/2017/03/22/%E4%B8%80%E5%A4%A9%E4%B8%80Android%E4%B9%8BRecyclerView/"/>
    <id>http://www.guiyongdong.com/2017/03/22/ä¸€å¤©ä¸€Androidä¹‹RecyclerView/</id>
    <published>2017-03-22T09:29:15.000Z</published>
    <updated>2017-03-23T03:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>ListViewç”±äºå…¶å¼ºå¤§çš„åŠŸèƒ½ï¼Œå·²ç»èƒ½æ»¡è¶³æˆ‘ä»¬ç»å¤§åŠŸèƒ½çš„å¼€å‘ï¼Œä½†æ˜¯ï¼Œå½“æˆ‘ä»¬çš„æ•°æ®æ¯”è¾ƒå¤æ‚ï¼Œæ¡ç›®ä¹Ÿæ¯”è¾ƒå¤æ‚çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ä¼˜åŒ–çš„ä¸å¥½ï¼Œé‚£ä¹ˆListViewçš„æ€§èƒ½å°±ä¼šéå¸¸å·®ã€‚è¿˜æœ‰ï¼ŒListViewåªèƒ½å®ç°æ•°æ®çºµå‘æ»šåŠ¨çš„æ•ˆæœï¼Œå¦‚æœæˆ‘ä»¬æƒ³å®ç°æ¨ªå‘æ»šåŠ¨çš„è¯ï¼ŒListViewåšä¸åˆ°ã€‚</p>
<p>ä¸ºæ­¤ï¼ŒAndroidæä¾›äº†ä¸€ä¸ªæ›´å¼ºå¤§çš„æ»šåŠ¨æ§ä»¶â€”â€”RecyclerViewã€‚å®ƒå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¢å¼ºç‰ˆçš„ListViewï¼Œä¸ä»…å¯ä»¥è½»æ¾å®ç°å’ŒListViewåŒæ ·çš„æ•ˆæœï¼Œè¿˜ä¼˜åŒ–äº†ListViewä¸­å­˜åœ¨çš„å„ç§ä¸è¶³ä¹‹å¤„ï¼Œç›®å‰Androidå®˜æ–¹æ›´åŠ æ¨èæˆ‘ä»¬ä½¿ç”¨RecyclerViewã€‚</p>
<a id="more"></a>
<h3 id="RecyclerViewçš„åŸºæœ¬ç”¨æ³•"><a href="#RecyclerViewçš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="RecyclerViewçš„åŸºæœ¬ç”¨æ³•"></a>RecyclerViewçš„åŸºæœ¬ç”¨æ³•</h3><p>å’Œçº¦æŸå¸ƒå±€ä¸€æ ·ï¼ŒRecyclerViewä¹Ÿå±äºæ–°å¢çš„æ§ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ åœ¨build.gradleä¸­ç›¸åº”çš„ä¾èµ–åº“ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    ...</div><div class="line">    compile <span class="string">'com.android.support:recyclerview-v7:25.3.0'</span></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="çºµå‘æ»šåŠ¨"><a href="#çºµå‘æ»šåŠ¨" class="headerlink" title="çºµå‘æ»šåŠ¨"></a>çºµå‘æ»šåŠ¨</h5><p>æˆ‘ä»¬å…ˆæ¥æ¨¡æ‹Ÿä¸€ä¸‹ListViewçš„çºµå‘æ»šåŠ¨</p>
<p>åˆ›å»ºRecyclerViewçš„å¸ƒå±€ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.guiyongdong.recyclerviewdemo.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_marginRight</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">android:layout_marginTop</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/recyclerView"</span>/&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬åˆ›å»ºå’Œä¸Šä¸€ç¯‡ListViewä¸€æ ·çš„dog_itemå¸ƒå±€å’ŒDogå®ä½“ç±»ï¼Œè¿™é‡Œå°±ä¸å†è´´å‡ºä»£ç ã€‚</p>
<p>åˆ›å»ºé€‚é…å™¨DogAdapter:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DogAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">DogAdapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;Dog&gt; mDogList;</div><div class="line">    </div><div class="line">    <span class="comment">//å®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±»ViewHolderï¼Œå®ƒç»§æ‰¿äºRecyclerView.ViewHolder</span></div><div class="line">    <span class="keyword">static</span>  <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line">        ImageView dogImage;</div><div class="line">        TextView dogName;</div><div class="line">        <span class="comment">//æ„é€ å‡½æ•°ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªView</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(view);</div><div class="line">            dogImage = (ImageView) view.findViewById(R.id.dogImage);</div><div class="line">            dogName = (TextView) view.findViewById(R.id.dogName);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ„é€ å‡½æ•°ï¼Œéœ€è¦çŸ¥é“æ•°æ®æº</span></div><div class="line">    <span class="function"><span class="keyword">public</span>  <span class="title">DogAdapter</span><span class="params">(List&lt;Dog&gt; dogList)</span></span>&#123;</div><div class="line">        mDogList = dogList;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//é‡å†™çˆ¶ç±»æ–¹æ³•</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.dog_item,parent,<span class="keyword">false</span>);</div><div class="line">        ViewHolder viewHolder = <span class="keyword">new</span> ViewHolder(view);</div><div class="line">        <span class="keyword">return</span> viewHolder;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//é‡å†™çˆ¶ç±»æ–¹æ³•</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mDogList.size();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//é‡å†™çˆ¶ç±»æ–¹æ³•</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        Dog dog = mDogList.get(position);</div><div class="line">        holder.dogName.setText(dog.getName());</div><div class="line">        holder.dogImage.setImageResource(dog.getImage());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯çœ‹ä¸Šå»å’Œæˆ‘ä»¬ä¹‹å‰å†™çš„ListViewçš„é€‚é…å™¨ä¸ä¸€æ ·ï¼Œæ„Ÿè§‰å¥½å¤æ‚å•Šã€‚</p>
<ul>
<li>é¦–å…ˆæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±»ViewHolderï¼ŒViewHolderç»§æ‰¿äºRecyclerView.ViewHolderã€‚ç„¶åViewHolderçš„æ„é€ å‡½æ•°ä¸­éœ€è¦ä¼ å…¥ä¸€ä¸ªViewå‚æ•°ï¼Œé€šå¸¸è¿™ä¸ªViewå°±æ˜¯æˆ‘ä»¬çš„itemæ¡ç›®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>findViewById()</code>æ–¹æ³•æ¥è·å–å¸ƒå±€ä¸­çš„ImageViewå’ŒTextViewçš„å®ä¾‹äº†ã€‚</li>
<li>åœ¨DogAdapterä¸­ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªDogçš„listé›†åˆï¼Œå› ä¸ºAdapteréœ€è¦çŸ¥é“ç°å®å“ªäº›æ•°æ®ã€‚</li>
<li>ç”±äºDogAdapteræ˜¯ç»§æ‰¿äºRecyclerView.ViewHolderï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡æ–°çˆ¶ç±»çš„ä¸‰ä¸ªæ–¹æ³•ï¼š<code>onCreateViewHolder()</code>ã€<code>OnBindViewHolder()</code>å’Œ<code>getItemCount()</code>ã€‚</li>
<li><code>onCreateViewHolder()</code> è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºåˆ›å»ºViewHolderå®ä¾‹ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šåŠ è½½itemæ¡ç›®å¸ƒå±€ï¼Œå¹¶åˆ›å»ºViewHolderå®ä¾‹å¯¹è±¡ï¼Œå¹¶å°†æ¡ç›®Viewä¼ å…¥åˆ°ViewHolderçš„æ„é€ å‡½æ•°ä¸­ï¼Œæœ€åè¿”å›ViewHolderã€‚</li>
<li><code>OnBindViewHolder()</code> è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºå¯¹itemæ¡ç›®çš„æ•°æ®è¿›è¡Œèµ‹å€¼ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ¯ä¸ªæ¡ç›®æ»šåŠ¨åˆ°å±å¹•å†…çš„æ—¶å€™æ‰§è¡Œï¼Œè¿™é‡Œæˆ‘ä»¬æ ¹æ®positionè·å–åˆ°Dogå®ä¾‹ï¼Œå¹¶å°†æ•°æ®è®¾ç½®ç»™ViewHolderçš„dogImageå’ŒdogNameã€‚</li>
<li><code>getItemCount()</code> è¿™ä¸ªæ–¹æ³•æ˜¯å‘Šè¯‰RecyclerViewä¸€å…±æœ‰å¤šå°‘è¡Œçš„itemï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥è¿”å›<code>mDogList</code>çš„é•¿åº¦ã€‚</li>
</ul>
<p>æˆ‘ä»¬çœ‹çœ‹åœ¨<code>MainActivity</code>ä¸­å¦‚ä½•ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> RecyclerView mRecyclerView;</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;Dog&gt; mDogArrayList;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        initDogList();</div><div class="line">        mRecyclerView = (RecyclerView) findViewById(R.id.recyclerView);</div><div class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªå¸ƒå±€ç®¡ç†ç±»</span></div><div class="line">        LinearLayoutManager linearLayoutManager = <span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>);</div><div class="line">        mRecyclerView.setLayoutManager(linearLayoutManager);</div><div class="line">        <span class="comment">//åˆ›å»ºAdapter</span></div><div class="line">        DogAdapter dogAdapter = <span class="keyword">new</span> DogAdapter(mDogArrayList);</div><div class="line">        mRecyclerView.setAdapter(dogAdapter);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initDogList</span><span class="params">()</span> </span>&#123;</div><div class="line">        mDogArrayList = <span class="keyword">new</span> ArrayList&lt;Dog&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">30</span>; i++)&#123;</div><div class="line">            Dog dog = <span class="keyword">new</span> Dog();</div><div class="line">            dog.setName(<span class="string">"å°ç‹—"</span>+i);</div><div class="line">            dog.setImage(R.drawable.dog);</div><div class="line">            mDogArrayList.add(dog);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå’ŒListViewæœ‰äº›ä¸åŒï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª<code>LinearLayoutManager</code>å®ä¾‹å¯¹è±¡ï¼Œ<code>LinearLayoutManager</code>æ˜¯çº¿æ€§å¸ƒå±€çš„æ„æ€ï¼Œå¯ä»¥å®ç°å’ŒListViewç±»ä¼¼çš„æ•ˆæœã€‚</p>
<p>æœ€ç»ˆè¿è¡Œæ•ˆæœï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android12.png?raw=true" width="375"><br></div>


<h5 id="æ¨ªå‘æ»šåŠ¨"><a href="#æ¨ªå‘æ»šåŠ¨" class="headerlink" title="æ¨ªå‘æ»šåŠ¨"></a>æ¨ªå‘æ»šåŠ¨</h5><p>æˆ‘ä»¬çŸ¥é“ListViewä¸èƒ½å®ç°æ¨ªå‘æ»šåŠ¨ï¼Œé‚£ä¹ˆRecyclerViewå¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å…ˆä¿®æ”¹ä¸€ä¸‹dog_itemä¸­çš„å¸ƒå±€:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/dogImage"</span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@drawable/dog"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/dogName"</span></div><div class="line">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"center_vertical"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span>/&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æŠŠå¸ƒå±€æ–¹å¼æ”¹ä¸ºå‚ç›´æ–¹å‘ï¼Œå¹¶æŠŠå®½åº¦è®¾ç½®ä¸ºæ ¹æ®å†…å®¹çš„å®½åº¦è°ƒæ•´ï¼Œç”±äºæˆ‘æŠŠTextViewçš„å®½åº¦è®¾ç½®ä¸ºmatch_parentï¼Œæ‰€ä»¥itemçš„å®½åº¦ä¼šæ ¹æ®å›¾ç‰‡çš„å®½åº¦ç¼©æ”¾ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åªåœ¨<code>MainActivity</code>ä¸­åŠ å…¥ä¸€è¡Œä»£ç <code>linearLayoutManager.setOrientation(LinearLayoutManager.HORIZONTAL)</code>å°±å¯å®ç°æ¨ªå‘æ»šåŠ¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> RecyclerView mRecyclerView;</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;Dog&gt; mDogArrayList;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        initDogList();</div><div class="line">        mRecyclerView = (RecyclerView) findViewById(R.id.recyclerView);</div><div class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªå¸ƒå±€ç®¡ç†ç±»</span></div><div class="line">        LinearLayoutManager linearLayoutManager = <span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>);</div><div class="line">        linearLayoutManager.setOrientation(LinearLayoutManager.HORIZONTAL);</div><div class="line">        mRecyclerView.setLayoutManager(linearLayoutManager);</div><div class="line">        <span class="comment">//åˆ›å»ºAdapter</span></div><div class="line">        DogAdapter dogAdapter = <span class="keyword">new</span> DogAdapter(mDogArrayList);</div><div class="line">        mRecyclerView.setAdapter(dogAdapter);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initDogList</span><span class="params">()</span> </span>&#123;</div><div class="line">        mDogArrayList = <span class="keyword">new</span> ArrayList&lt;Dog&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">30</span>; i++)&#123;</div><div class="line">            Dog dog = <span class="keyword">new</span> Dog();</div><div class="line">            dog.setName(<span class="string">"å°ç‹—"</span>+i);</div><div class="line">            dog.setImage(R.drawable.dog);</div><div class="line">            mDogArrayList.add(dog);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>LinearLayoutManager</code>çš„æ»šåŠ¨æ–¹å‘é»˜è®¤æ˜¯å‚ç›´æ–¹å‘ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨å®ƒçš„<code>setOrientation</code>æ–¹æ³•æ¥è®¾ç½®å¸ƒå±€çš„æ’åˆ—æ–¹å‘å³å¯ï¼Œ<code>LinearLayoutManager.HORIZONTAL</code>è¡¨ç¤ºæ¨ªå‘æ’åˆ—ï¼Œ<code>LinearLayoutManager.VERTICAL</code>è¡¨ç¤ºçºµå‘æ’åˆ—ã€‚</p>
<p>æ•ˆæœå›¾ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android13.png?raw=true" width="375"><br></div>


<p>é™¤äº†<code>LinearLayoutManager</code>å¤–ï¼ŒRecyclerViewè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†<code>GridLayoutManager</code>å’Œ<code>StaggeredGridLayoutManager</code>è¿™ä¸¤ç§å†…ç½®çš„å¸ƒå±€æ’åˆ—æ–¹å¼ã€‚<code>GridLayoutManager</code>å¯ä»¥ç”¨äºå®ç°ç½‘æ ¼å¸ƒå±€ï¼Œ<code>StaggeredGridLayoutManager</code>å¯ä»¥ç”¨äºå®ç°ç€‘å¸ƒæµå¸ƒå±€ã€‚</p>
<h3 id="ç€‘å¸ƒæµ"><a href="#ç€‘å¸ƒæµ" class="headerlink" title="ç€‘å¸ƒæµ"></a>ç€‘å¸ƒæµ</h3><p>è¯´èµ·ç€‘å¸ƒæµï¼Œå­¦è¿‡iOSçš„éƒ½çŸ¥é“ï¼Œå®ç°ç€‘å¸ƒæµæ˜¯å¤šä¹ˆå¤æ‚çš„äº‹ï¼Œéœ€è¦è‡ªå·±å®ç°å¸ƒå±€ç±»ï¼Œå¹¶è®¡ç®—åæ ‡ã€‚å¥½åœ¨Androidä¸ä¸€æ ·ï¼Œå®ƒæ—©å°±ç»™æˆ‘ä»¬æä¾›äº†ç€‘å¸ƒæµå¸ƒå±€ç±»<code>StaggeredGridLayoutManager</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p>
<p>æˆ‘ä»¬åœ¨åˆ›é€ æ•°æ®æºçš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ–‡å­—çš„å¤šå°‘è®¾ç½®ä¸º5-50çš„éšæœºæ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> RecyclerView mRecyclerView;</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;Dog&gt; mDogArrayList;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        initDogList();</div><div class="line">        mRecyclerView = (RecyclerView) findViewById(R.id.recyclerView);</div><div class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªå¸ƒå±€ç®¡ç†ç±»</span></div><div class="line">        StaggeredGridLayoutManager staggeredGridLayoutManager = <span class="keyword">new</span> StaggeredGridLayoutManager(<span class="number">3</span>,StaggeredGridLayoutManager.VERTICAL);</div><div class="line">        mRecyclerView.setLayoutManager(staggeredGridLayoutManager);</div><div class="line">        <span class="comment">//åˆ›å»ºAdapter</span></div><div class="line">        DogAdapter dogAdapter = <span class="keyword">new</span> DogAdapter(mDogArrayList);</div><div class="line">        mRecyclerView.setAdapter(dogAdapter);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initDogList</span><span class="params">()</span> </span>&#123;</div><div class="line">        mDogArrayList = <span class="keyword">new</span> ArrayList&lt;Dog&gt;();</div><div class="line">        Random random = <span class="keyword">new</span> Random();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">30</span>; i++)&#123;</div><div class="line">            Dog dog = <span class="keyword">new</span> Dog();</div><div class="line">            StringBuffer name = <span class="keyword">new</span> StringBuffer(<span class="string">"å°ç‹—"</span>);</div><div class="line">            <span class="keyword">int</span> len = random.nextInt(<span class="number">50</span>)+<span class="number">5</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;len; j++)&#123;</div><div class="line">                name.append(<span class="string">"å°ç‹—"</span>);</div><div class="line">            &#125;</div><div class="line">            dog.setName(name.toString());</div><div class="line">            dog.setImage(R.drawable.dog);</div><div class="line">            mDogArrayList.add(dog);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘åˆ›å»ºäº†ä¸€ä¸ª<code>StaggeredGridLayoutManager</code>çš„å®ä¾‹ï¼Œ<code>StaggeredGridLayoutManager</code>çš„æ„é€ å‡½æ•°éœ€è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºæŒ‡å®šå¸ƒå±€çš„åˆ—æ•°ï¼Œä¼ å…¥3è¡¨ç¤ºä¼šæŠŠå¸ƒå±€åˆ†ä¸º3åˆ—ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šå¸ƒå±€çš„æ’åˆ—æ–¹å¼ï¼Œ<code>StaggeredGridLayoutManager.VERTICAL</code>è¡¨ç¤ºçºµå‘æ’åˆ—ï¼Œ<code>StaggeredGridLayoutManager.HORIZONTAL</code>è¡¨ç¤ºæ¨ªå‘æ’åˆ—ã€‚</p>
<p>æ•ˆæœå›¾ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android14.png?raw=true" width="375"><br></div>


<p>æƒ³ä¸åˆ°ï¼ŒAndroidçš„ç€‘å¸ƒæµå®ç°å¦‚æ­¤çš„ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ”¹å¸ƒå±€ç±»å°±èƒ½å®ç°ï¼Œå¥½æ–¹ä¾¿å•Šï¼ŒçœŸçš„å¸Œæœ›iOSä¹Ÿèƒ½å€Ÿé‰´Androidçš„è¿™ç§æ–¹å¼ã€‚</p>
<h3 id="ç‚¹å‡»äº‹ä»¶"><a href="#ç‚¹å‡»äº‹ä»¶" class="headerlink" title="ç‚¹å‡»äº‹ä»¶"></a>ç‚¹å‡»äº‹ä»¶</h3><p>RecyclerViewå¹¶æ²¡æœ‰æä¾›ç±»ä¼¼äº<code>setOnItemClickListener()</code>è¿™æ ·çš„æ³¨å†Œç›‘å¬å™¨æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±åŠ¨æ‰‹å®ç°ç‚¹å‡»äº‹ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DogAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">DogAdapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;Dog&gt; mDogList;</div><div class="line"></div><div class="line">    <span class="comment">//å®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±»ViewHolderï¼Œå®ƒç»§æ‰¿äºRecyclerView.ViewHolder</span></div><div class="line">    <span class="keyword">static</span>  <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line">        ImageView dogImage;</div><div class="line">        TextView dogName;</div><div class="line">        <span class="comment">//æ–°å¢ä¸€ä¸ªæˆå‘˜å˜é‡ æ¥ä¿å­˜å½“å‰item</span></div><div class="line">        View dogView;</div><div class="line">        <span class="comment">//æ„é€ å‡½æ•°ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªView</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(view);</div><div class="line">            dogView = view;</div><div class="line">            dogImage = (ImageView) view.findViewById(R.id.dogImage);</div><div class="line">            dogName = (TextView) view.findViewById(R.id.dogName);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ„é€ å‡½æ•°ï¼Œéœ€è¦çŸ¥é“æ•°æ®æº</span></div><div class="line">    <span class="function"><span class="keyword">public</span>  <span class="title">DogAdapter</span><span class="params">(List&lt;Dog&gt; dogList)</span></span>&#123;</div><div class="line">        mDogList = dogList;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//é‡å†™çˆ¶ç±»æ–¹æ³•</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.dog_item,parent,<span class="keyword">false</span>);</div><div class="line">        <span class="keyword">final</span> ViewHolder viewHolder = <span class="keyword">new</span> ViewHolder(view);</div><div class="line">        <span class="comment">//æ³¨å†Œitemç‚¹å‡»äº‹ä»¶</span></div><div class="line">        viewHolder.dogView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> position = viewHolder.getAdapterPosition();</div><div class="line">                Dog dog = mDogList.get(position);</div><div class="line">                Toast.makeText(v.getContext(),dog.getName(),Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">//æ³¨å†Œå›¾ç‰‡ç‚¹å‡»äº‹ä»¶</span></div><div class="line">        viewHolder.dogImage.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> position = viewHolder.getAdapterPosition();</div><div class="line">                Dog dog = mDogList.get(position);</div><div class="line">                Toast.makeText(v.getContext(),<span class="string">"ç¬¬"</span>+position+<span class="string">"ä¸ªç‹—çš„å¤´åƒè¢«ç‚¹å‡»"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> viewHolder;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//é‡å†™çˆ¶ç±»æ–¹æ³•</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mDogList.size();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//é‡å†™çˆ¶ç±»æ–¹æ³•</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        Dog dog = mDogList.get(position);</div><div class="line">        holder.dogName.setText(dog.getName());</div><div class="line">        holder.dogImage.setImageResource(dog.getImage());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘å…ˆæ˜¯åœ¨ViewHolderä¸­å¿ƒå¢ä¸€ä¸ªæˆå‘˜å˜é‡<code>dogView</code>æ¥ä¿å­˜å½“å‰çš„itemï¼Œç„¶ååœ¨<code>onCreateViewHolder</code>æ–¹æ³•ä¸­æ·»åŠ äº‹ä»¶ç›‘å¬ã€‚é€šè¿‡<code>ViewHolder</code>æ‹¿åˆ°ç‚¹å‡»çš„positionï¼Œç„¶åå°±å¯ä»¥è·å–Dogå®ä¾‹ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ›´åŠ ä¸šåŠ¡æ¥å¤„ç†äº†ï¼Œæˆ‘ä»¬è¿™é‡Œåªæ˜¯ç®€å•çš„åå¸ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œä¹Ÿåªæ˜¯è¯´äº†RecyclerViewçš„åŸºæœ¬ç”¨æ³•ï¼Œå…³äºRecyclerViewçš„æ›´å¤šç”¨æ³•ï¼Œè¿˜æ˜¯å»æŸ¥çœ‹Android APIï¼Œå¥½äº†ï¼Œä»Šå¤©çš„æ€»ç»“å°±åˆ°è¿™é‡Œã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ListViewç”±äºå…¶å¼ºå¤§çš„åŠŸèƒ½ï¼Œå·²ç»èƒ½æ»¡è¶³æˆ‘ä»¬ç»å¤§åŠŸèƒ½çš„å¼€å‘ï¼Œä½†æ˜¯ï¼Œå½“æˆ‘ä»¬çš„æ•°æ®æ¯”è¾ƒå¤æ‚ï¼Œæ¡ç›®ä¹Ÿæ¯”è¾ƒå¤æ‚çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ä¼˜åŒ–çš„ä¸å¥½ï¼Œé‚£ä¹ˆListViewçš„æ€§èƒ½å°±ä¼šéå¸¸å·®ã€‚è¿˜æœ‰ï¼ŒListViewåªèƒ½å®ç°æ•°æ®çºµå‘æ»šåŠ¨çš„æ•ˆæœï¼Œå¦‚æœæˆ‘ä»¬æƒ³å®ç°æ¨ªå‘æ»šåŠ¨çš„è¯ï¼ŒListViewåšä¸åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼ŒAndroidæä¾›äº†ä¸€ä¸ªæ›´å¼ºå¤§çš„æ»šåŠ¨æ§ä»¶â€”â€”RecyclerViewã€‚å®ƒå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¢å¼ºç‰ˆçš„ListViewï¼Œä¸ä»…å¯ä»¥è½»æ¾å®ç°å’ŒListViewåŒæ ·çš„æ•ˆæœï¼Œè¿˜ä¼˜åŒ–äº†ListViewä¸­å­˜åœ¨çš„å„ç§ä¸è¶³ä¹‹å¤„ï¼Œç›®å‰Androidå®˜æ–¹æ›´åŠ æ¨èæˆ‘ä»¬ä½¿ç”¨RecyclerViewã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://www.guiyongdong.com/categories/Android/"/>
    
    
      <category term="android" scheme="http://www.guiyongdong.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å¤©ä¸€Androidä¹‹ListView</title>
    <link href="http://www.guiyongdong.com/2017/03/20/%E4%B8%80%E5%A4%A9%E4%B8%80Android%E4%B9%8BListView/"/>
    <id>http://www.guiyongdong.com/2017/03/20/ä¸€å¤©ä¸€Androidä¹‹ListView/</id>
    <published>2017-03-20T09:31:13.000Z</published>
    <updated>2017-03-22T09:28:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¯´èµ·<code>ListView</code>ï¼Œå°±ä¸å¾—ä¸è¯´iOSçš„<code>UITableView</code>ï¼Œæ¯«ä¸å¤¸å¼ çš„è¯´çš„ï¼Œæ”¾åœ¨3å¹´å‰ï¼Œå¦‚æœä½ å»é¢è¯•çš„æ—¶å€™ï¼Œä½ è¯´ä½ ä¼šç”¨<code>UITableView</code>ï¼ŒçŸ¥é“<code>UITableView</code>çš„ä»£ç†æ–¹æ³•ï¼Œä¸ç”¨è¯´äº†ï¼Œä½ å¯ä»¥ç›´æ¥æ¥ä¸Šç­äº†ã€‚</p>
<p><code>ListView</code>åœ¨Androidä¸­å¼€å‘çš„é‡è¦æ€§ä¸è¨€è€Œå–»ï¼Œå­¦å¥½<code>ListView</code>ï¼Œæˆ‘æƒ³åœ¨ä»¥åçš„åˆ—è¡¨å¼€å‘ä¸­å°±ä¸ç”¨å‘æ„äº†ã€‚ä»€ä¹ˆæ˜¯åˆ—è¡¨å¼€å‘ï¼Ÿè¿™ä¹ˆè¯´å§ï¼Œåœ¨ä½ ä½¿ç”¨çš„APPä¸­ï¼Œ80%çš„éƒ½ä¼šç”¨åˆ°åˆ—è¡¨å¼€å‘ï¼Œæ¯”å¦‚å¾®ä¿¡çš„èŠå¤©é¡µï¼ŒQQçš„ä¸ªäººç©ºé—´é¡µã€‚ä¸ºä½•è¦ç”¨åˆ—è¡¨å¼€å‘ï¼Œåˆ—è¡¨å¼€å‘çš„ä¼˜è¶Šåœ¨å“ªé‡Œï¼Ÿæˆ‘ä»Šå¤©æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<a id="more"></a>
<h3 id="ListViewåˆä½“éªŒ"><a href="#ListViewåˆä½“éªŒ" class="headerlink" title="ListViewåˆä½“éªŒ"></a>ListViewåˆä½“éªŒ</h3><p>æˆ‘ä»¬å…ˆæ¥å†™ä¸ªå°ä¾‹å­ï¼Œæ ¹æ®è¿™ä¸ªå°ä¾‹å­æˆ‘ä»¬å†åšè¿›ä¸€æ­¥çš„ä»‹ç»ã€‚æˆ‘ä»¬å…ˆåœ¨xmlä¸­åˆ›å»ºä¸€ä¸ªListViewï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨<code>ConstraintLayout</code>çº¦æŸå¸ƒå±€ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"></div><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.guiyongdong.listviewdemo2.MainActivity"</span>&gt;</div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"368dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"495dp"</span></div><div class="line">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">android:layout_marginTop</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_marginRight</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/listView"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>MainActivityçš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ListView mListView;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mListView = (ListView) findViewById(R.id.listView);</div><div class="line">        String[] data = &#123;<span class="string">"A"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"A"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"A"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"A"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"A"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"A"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>&#125;;</div><div class="line"></div><div class="line">        ArrayAdapter&lt;String&gt; adapter = <span class="keyword">new</span> ArrayAdapter&lt;String&gt;(MainActivity.<span class="keyword">this</span>,android.R.layout.simple_list_item_1,data);</div><div class="line">        mListView.setAdapter(adapter);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œå¦‚ä¸‹ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android9.png?raw=true" width="375"><br></div>


<h3 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h3><p>åœ¨Androidæ‰€æœ‰å¸¸ç”¨çš„åŸç”Ÿæ§ä»¶å½“ä¸­ï¼Œç”¨æ³•æœ€å¤æ‚çš„åº”è¯¥å°±æ˜¯ListViewäº†ï¼Œå®ƒä¸“é—¨ç”¨äºå¤„ç†é‚£ç§å†…å®¹å…ƒç´ å¾ˆå¤šï¼Œæ‰‹æœºå±å¹•æ— æ³•å±•ç¤ºå‡ºæ‰€æœ‰å†…å®¹çš„æƒ…å†µã€‚ListViewå¯ä»¥ä½¿ç”¨åˆ—è¡¨çš„å½¢å¼æ¥å±•ç¤ºå†…å®¹ï¼Œè¶…å‡ºå±å¹•éƒ¨åˆ†çš„å†…å®¹åªéœ€è¦é€šè¿‡æ‰‹æŒ‡æ»‘åŠ¨å°±å¯ä»¥ç§»åŠ¨åˆ°å±å¹•å†…äº†ã€‚</p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹ListViewçš„ç»§æ‰¿ä½“ç³»ï¼š</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/3278692-0d4f5b5f237acbd6?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<h5 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h5><ul>
<li><code>android:divider</code> åœ¨åˆ—è¡¨æ¡ç›®ä¹‹é—´æ˜¾ç¤ºçš„å›¾ç‰‡æˆ–è€…é¢œè‰²(drawableæˆ–color)</li>
<li><code>android:dividerHeight</code> ç”¨æ¥æŒ‡å®šdividerçš„é«˜åº¦</li>
<li><code>android:scrollbars</code> è®¾ç½®æ»šåŠ¨æ¡çŠ¶æ€ï¼Œä¸éœ€è¦æ»šåŠ¨æ¡æ—¶ï¼Œè®¾ç½®ä¸ºnone</li>
<li><code>android:listSelector</code> è®¾ç½®æ¡ç›®é€‰ä¸­åçš„é¢œè‰²ï¼Œå¯è®¾ç½®ä¸º#00000000æˆ–è€…@android:color/transparent å–æ¶ˆé€‰ä¸­è‰²</li>
<li><code>android:footerDividersEnabled</code> å½“è®¾ç½®ä¸ºfalseæ—¶ï¼ŒListViewå°†ä¸ä¼šåœ¨å„ä¸ªfooterä¹‹é—´ç»˜åˆ¶dividerï¼Œé»˜è®¤ä¸ºtrue</li>
<li><code>android:headerDividersEnabled</code> å½“è®¾ä¸ºfalseæ—¶ï¼ŒListViewå°†ä¸ä¼šåœ¨å„ä¸ªheaderä¹‹é—´ç»˜åˆ¶dividerï¼Œé»˜è®¤ä¸ºtrue</li>
</ul>
<p>å…¶ä»–ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å°±ä¸è¯´äº†ã€‚</p>
<h5 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h5><ul>
<li><code>void addFooterView(View v)</code> æ·»åŠ ä¸€ä¸ªå›ºå®šåœ¨åˆ—è¡¨åº•éƒ¨çš„View</li>
<li><code>boolean removeFooterView(View v)</code> åˆ é™¤ä¸€ä¸ªä¹‹å‰æ·»åŠ çš„FooterViewï¼Œå‚æ•°ä¸ºæ¬²åˆ é™¤çš„è§†å›¾ï¼Œè¿”å›æ˜¯å¦åˆ é™¤æˆåŠŸ</li>
<li><code>void addHeaderView(View v)</code> æ·»åŠ ä¸€ä¸ªå›ºå®šåœ¨åˆ—è¡¨é¡¶éƒ¨çš„View</li>
<li><code>boolean removeHeaderView(View v)</code> åˆ é™¤ä¸€ä¸ªä¹‹å‰æ·»åŠ çš„HeaderViewï¼Œå‚æ•°ä¸ºæ¬²åˆ é™¤çš„è§†å›¾ï¼Œè¿”å›æ˜¯å¦åˆ é™¤æˆåŠŸ</li>
<li><code>void setAdapter(ListAdapter adapter)</code> ä¸ºListViewç»‘å®šAdapter</li>
<li><code>ListAdapter getAdapter()</code> è¿”å›ListViewæ­£åœ¨ä½¿ç”¨çš„Adapter</li>
<li><code>void setEmptyView(View emptyView)</code> å½“æ•°æ®çš„ä¸ªæ•°ä¸º0çš„æ—¶å€™æ˜¾ç¤ºä¸€ä¸ªæç¤ºè§†å›¾</li>
</ul>
<p>é€šè¿‡ä¸Šé¢ä¸€ä¸ªç®€å•çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒListViewå¦‚æœæƒ³è¦æ˜¾ç¤ºæ•°æ®ï¼Œå¿…é¡»éœ€è¦ä¸€ä¸ªAdapteræ¥é€‚é…ã€‚Androidä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿå¦‚æœå­¦ä¹ è¿‡iOSçš„åŒå­¦éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨UITableViewçš„æ—¶å€™ï¼Œä¸€å®šä¼šå®ç°å®ƒçš„æ•°æ®æºä»£ç†æ–¹æ³•ï¼Œåœ¨ä»£ç†æ–¹æ³•ä¸­æˆ‘ä»¬ä¼šè¿”å›æ¡ç›®æ•°å’Œæ¡ç›®Viewã€‚è¿™ç§è®¾è®¡æ–¹æ³•æœ‰æ•ˆçš„åˆ†ç¦»äº†UITableViewå’Œæ•°æ®æºçš„ç›´æ¥æ‰“äº¤é“ï¼Œè®©æ•°æ®æºçš„æ˜¾ç¤ºäº¤äºç”¨æˆ·æ¥é€‰æ‹©ã€‚Androidä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<p>ListViewåªæ‰¿æ‹…äº¤äº’å’Œå±•ç¤ºå·¥ä½œï¼Œè‡³äºè¿™äº›æ•°æ®æ¥æºäºå“ªé‡Œï¼ŒListViewå¹¶ä¸å…³å¿ƒã€‚äºæ˜¯å°±æœ‰äº†Adapterè¿™æ ·ä¸€ä¸ªæœºåˆ¶çš„å‡ºç°ã€‚Adapteræ˜¯é€‚é…å™¨çš„æ„æ€ï¼Œå®ƒåœ¨ListViewå’Œæ•°æ®æºä¹‹é—´èµ·åˆ°äº†ä¸€ä¸ªæ¡¥æ¢çš„ä½œç”¨ï¼ŒListViewä¼šå€ŸåŠ©Adapterè¿™ä¸ªæ¡¥æ¢å»è®¿é—®çœŸæ­£çš„æ•°æ®æºï¼Œå› ä¸ºAdapterçš„æ¥å£éƒ½æ˜¯ç»Ÿä¸€çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°æ¥å£æ¥å®šåˆ¶å„ç§ç±»å‹çš„Adapterã€‚å¦å¤–ç³»ç»Ÿä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†ä¸€äº›å¸¸ç”¨çš„Adapterï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ç”¨åˆ°çš„ArrayAdapterç­‰ã€‚</p>
<h3 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç»§æ‰¿ä½“ç³»ï¼š</p>
<div align="center"><br><img src="http://img.blog.csdn.net/20150626100341626?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGl0Z2FveGluZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><br></div>

<p>Adapterå®šä¹‰çš„æŠ½è±¡å‡½æ•°ä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>void registerDataSetObserver(DataSetObserver observer)</code> æ·»åŠ æ•°æ®æºå˜åŒ–çš„observerï¼Œå¦‚å¢åŠ ã€åˆ é™¤ç­‰å°†ä¼šæ‰§è¡Œ</li>
<li><code>void unregisterDataSetObserver(DataSetObserver observer)</code>  å–æ¶ˆæ³¨å†Œçš„observer</li>
<li><code>int getCount()</code> æ˜¾ç¤ºæœ‰å¤šå°‘ä¸ªæ•°æ®é¡¹ å³adapteræœ‰å¤šå°‘ä¸ªæ¡ç›®</li>
<li><code>Object getItem(int position)</code> è¿”å›æ•°æ®é›†ä¸­positionä½ç½®æ‰€å¯¹åº”çš„æ•°æ®é¡¹</li>
<li><code>long getItemId(int position)</code> è¿”å›positionä½ç½®æ‰€å¯¹åº”çš„IDå·ï¼Œé€šå¸¸å³ä¸ºposition</li>
<li><code>View getView(int position, View convertView, ViewGroup parent)</code> æ ¸å¿ƒå‡½æ•°ï¼Œè¿”å›positionæ•°æ®é¡¹å¯¹åº”çš„æ¡ç›®View</li>
</ul>
<p>ä¸Šä¸ªç¤ºä¾‹æˆ‘ä»¬ä½¿ç”¨çš„ArrayAdapterï¼Œä»–åªèƒ½ç”¨æ¥æ˜¾ç¤ºTextViewï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ˜¾ç¤ºæ›´å¤šçš„ä¸åŒç§ç±»çš„æ¡ç›®ï¼Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿<code>BaseAdapter</code>ï¼Œå¹¶é‡å†™ç›¸å…³æ–¹æ³•ï¼Œæˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹å¦‚ä½•é‡å†™ã€‚</p>
<p>å…ˆä¸Šç¤ºä¾‹å›¾ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android10.png?raw=true"><br></div>


<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªDogç±»ï¼Œæœ‰<code>name</code>å’Œ<code>imageId</code>ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œåˆ†åˆ«è¡¨ç¤ºç‹—çš„åå­—å’Œå›¾ç‰‡èµ„æºï¼ˆè¿™é‡Œä½¿ç”¨æœ¬åœ°å›¾ç‰‡ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Object</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> imageId;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">(String name, <span class="keyword">int</span> imageId)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.imageId = imageId;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">int</span> <span class="title">getImageId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> imageId;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨æ–°å»ºä¸€ä¸ªDogAdapterç»§æ‰¿äºArrayAdapter<dog>ï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œçš„æ•°æ®ä¸å¤æ‚ï¼Œç›´æ¥ç»§æ‰¿ArrayAdapterï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°æ®æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„åµŒå¥—å¾ˆæ·±çš„æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»§æ‰¿BaseAdapterã€‚</dog></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DogAdapter</span> <span class="keyword">extends</span> <span class="title">ArrayAdapter</span>&lt;<span class="title">Dog</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> resourceId;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DogAdapter</span><span class="params">(Context context, <span class="keyword">int</span> resourceId, List&lt;Dog&gt; dogList)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, resourceId, dogList);</div><div class="line">        <span class="comment">// è®°å½•å½“å‰å¸ƒå±€èµ„æº</span></div><div class="line">        <span class="keyword">this</span>.resourceId = resourceId;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, @Nullable View convertView, @NonNull ViewGroup parent)</span> </span>&#123;</div><div class="line">        Dog dog = getItem(position);<span class="comment">//è·å–å½“å‰Dogå®ä¾‹</span></div><div class="line">        View view;</div><div class="line">        ViewHolder viewHolder;<span class="comment">//tagç¼“å­˜</span></div><div class="line">        <span class="keyword">if</span> (convertView == <span class="keyword">null</span>)&#123;</div><div class="line">            view = LayoutInflater.from(getContext()).inflate(resourceId,parent,<span class="keyword">false</span>);</div><div class="line">            viewHolder = <span class="keyword">new</span> ViewHolder();</div><div class="line">            viewHolder.mImageView = (ImageView) view.findViewById(R.id.dogImage);</div><div class="line">            viewHolder.mTextView = (TextView) view.findViewById(R.id.dogName);</div><div class="line">            view.setTag(viewHolder);<span class="comment">//è®¾ç½®tagç»‘å®š</span></div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            view = convertView;</div><div class="line">            viewHolder = (ViewHolder) view.getTag();</div><div class="line">        &#125;</div><div class="line">        ImageView imageView = viewHolder.mImageView;</div><div class="line">        TextView textView = viewHolder.mTextView;</div><div class="line">        imageView.setImageResource(dog.getImageId());</div><div class="line">        textView.setText(dog.getName());</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</div><div class="line">        ImageView mImageView;</div><div class="line">        TextView mTextView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šæˆ‘ä»¬éƒ½çŸ¥é“ListViewçš„å¼ºå¤§ï¼Œå®ƒå¼ºå¤§å°±å¼ºå¤§åœ¨æ— è®ºæˆ‘ä»¬è®¾ç½®å¤šå°‘æ¡æ•°æ®æºï¼ŒListViewéƒ½ä¸ä¼šå®Œå…¨çš„æŠŠè¿™äº›æ¡ç›®éƒ½åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡å¤ç”¨å·²ç»æ¶ˆå¤±åœ¨å±å¹•çš„æ¡ç›®æ¥å±•ç¤ºæ–°çš„æ¡ç›®ã€‚<br>åœ¨<code>getView</code>å‡½æ•°ä¸­ï¼Œæœ‰ä¸ª<code>convertView</code>å‚æ•°ï¼Œå¦‚æœå®ƒä¸ä¸ºç©ºï¼Œå°±è¡¨ç¤ºListViewçš„ç¼“å­˜æ± ä¸­æœ‰å¯å¤ç”¨çš„æ¡ç›®ï¼Œæˆ‘ä»¬ç›´æ¥å–æ¥ç”¨å°±è¡Œã€‚è€Œä¸”æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªå†…éƒ¨ç±»<code>ViewHolder</code>ï¼Œå£°æ˜äº†ä¸¤ä¸ªå±æ€§<code>mImageView</code>å’Œ<code>mTextView</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç»™Viewè®¾ç½®tagï¼Œæ–¹ä¾¿ä¸‹æ¬¡ç»™Viewèµ‹å€¼çš„æ—¶å€™ï¼Œä¸éœ€è¦å†æ¬¡è°ƒç”¨<code>findViewById</code>æ–¹æ³•æ¥é‡æ–°æŸ¥æ‰¾å±æ€§ã€‚</p>
<p>å†æ¥çœ‹æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨DogAdapter:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ListView mListView;</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;Dog&gt; mDogArrayList;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        <span class="comment">//åˆå§‹åŒ–æ•°æ®æº</span></div><div class="line">        initDogArrayList();</div><div class="line">        mListView = (ListView) findViewById(R.id.listView);</div><div class="line">        DogAdapter dogAdapter = <span class="keyword">new</span> DogAdapter(<span class="keyword">this</span>,R.layout.dog_item,mDogArrayList);</div><div class="line">        mListView.setAdapter(dogAdapter);</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    <span class="comment">//æ¨¡æ‹Ÿæ•°æ® </span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initDogArrayList</span><span class="params">()</span> </span>&#123;</div><div class="line">        mDogArrayList = <span class="keyword">new</span> ArrayList&lt;Dog&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">30</span>; i++)&#123;</div><div class="line">            Dog dog = <span class="keyword">new</span> Dog(<span class="string">"å°ç‹—"</span>+i,R.drawable.dog);</div><div class="line">            mDogArrayList.add(dog);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å…¶ä»–æ–¹æ³•"><a href="#å…¶ä»–æ–¹æ³•" class="headerlink" title="å…¶ä»–æ–¹æ³•"></a>å…¶ä»–æ–¹æ³•</h3><h5 id="è§¦æ‘¸ç›‘å¬-OnTouchListener"><a href="#è§¦æ‘¸ç›‘å¬-OnTouchListener" class="headerlink" title="è§¦æ‘¸ç›‘å¬ OnTouchListener"></a>è§¦æ‘¸ç›‘å¬ OnTouchListener</h5><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line">mListView.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (event.getAction())&#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                <span class="comment">//è§¦æ‘¸æ—¶æ“ä½œ</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="comment">//ç§»åŠ¨æ˜¯æ“ä½œ</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                <span class="comment">//æ‰‹æŒ‡ç¦»å¼€æ—¶æ“ä½œ</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h5 id="æ»‘åŠ¨ç›‘å¬-OnScrollListener"><a href="#æ»‘åŠ¨ç›‘å¬-OnScrollListener" class="headerlink" title="æ»‘åŠ¨ç›‘å¬ OnScrollListener"></a>æ»‘åŠ¨ç›‘å¬ OnScrollListener</h5><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//æ»‘åŠ¨ç›‘å¬</span></div><div class="line">mListView.setOnScrollListener(<span class="keyword">new</span> AbsListView.OnScrollListener() &#123;</div><div class="line">    <span class="comment">//æ»šåŠ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(AbsListView view, <span class="keyword">int</span> scrollState)</span> </span>&#123;</div><div class="line">       <span class="keyword">switch</span> (scrollState)&#123;</div><div class="line">           <span class="keyword">case</span> SCROLL_STATE_IDLE:</div><div class="line">               <span class="comment">//åœæ­¢æ»‘åŠ¨</span></div><div class="line">               Log.d(<span class="string">"gg"</span>,<span class="string">"åœæ­¢æ»‘åŠ¨äº†"</span>);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">case</span> SCROLL_STATE_TOUCH_SCROLL:</div><div class="line">               <span class="comment">//æ­£åœ¨æ»šåŠ¨</span></div><div class="line">               Log.d(<span class="string">"gg"</span>,<span class="string">"æ­£åœ¨æ»‘åŠ¨äº†"</span>);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">case</span> SCROLL_STATE_FLING:</div><div class="line">               <span class="comment">//æ‰‹æŒ‡å¿«é€Ÿæ»‘åŠ¨ï¼Œæ‰‹æŒ‡ç¦»å¼€å±å¹•åç”±äºæƒ¯æ€§ç»§ç»­æ»‘åŠ¨</span></div><div class="line">               Log.d(<span class="string">"gg"</span>,<span class="string">"æƒ¯æ€§æ»‘åŠ¨äº†"</span>);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">default</span>:</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">       &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ»šåŠ¨æ—¶ä¸€ç›´è°ƒç”¨</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScroll</span><span class="params">(AbsListView view, <span class="keyword">int</span> firstVisibleItem, <span class="keyword">int</span> visibleItemCount, <span class="keyword">int</span> totalItemCount)</span> </span>&#123;</div><div class="line">        Log.d(<span class="string">"gg"</span>,<span class="string">"æ··åŠ¨äº†"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h5 id="æ¡ç›®ç‚¹å‡»-OnItemClickListener"><a href="#æ¡ç›®ç‚¹å‡»-OnItemClickListener" class="headerlink" title="æ¡ç›®ç‚¹å‡» OnItemClickListener"></a>æ¡ç›®ç‚¹å‡» OnItemClickListener</h5><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line">mListView.setOnItemClickListener(<span class="keyword">new</span> AdapterView.OnItemClickListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">        Log.d(<span class="string">"gg"</span>,<span class="string">"ç‚¹å‡»äº†ç¬¬"</span>+position+<span class="string">"æ¡ç›®"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="ä»¿å¾®ä¿¡èŠå¤©ç•Œé¢"><a href="#ä»¿å¾®ä¿¡èŠå¤©ç•Œé¢" class="headerlink" title="ä»¿å¾®ä¿¡èŠå¤©ç•Œé¢"></a>ä»¿å¾®ä¿¡èŠå¤©ç•Œé¢</h3><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œå†æ¥åšä¸€ä¸ªä¾‹å­ï¼Œä»¿ä¸€ä¸‹å¾®ä¿¡çš„èŠå¤©ç•Œé¢ã€‚</p>
<p>å…ˆçœ‹å¸ƒå±€ï¼Œè¿™é‡Œä¾æ—§ä½¿ç”¨çº¦æŸå¸ƒå±€ï¼š</p>
<h5 id="ListViewå¸ƒå±€"><a href="#ListViewå¸ƒå±€" class="headerlink" title="ListViewå¸ƒå±€"></a>ListViewå¸ƒå±€</h5><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.guiyongdong.listviewdemo2.WXChatActivity"</span>&gt;</div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/wx_listView"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">"@+id/wx_send"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/wx_send"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"44dp"</span></div><div class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_marginRight</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"å‘é€"</span></div><div class="line">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">"parent"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/wx_editText"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"44dp"</span></div><div class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_marginRight</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">"0.501"</span></div><div class="line">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintRight_toLeftOf</span>=<span class="string">"@+id/wx_send"</span></div><div class="line">        <span class="attr">android:hint</span>=<span class="string">"è¯´äº›ä»€ä¹ˆå§"</span></div><div class="line">        <span class="attr">android:maxLines</span>=<span class="string">"1"</span>/&gt;</div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="itemå¸ƒå±€"><a href="#itemå¸ƒå±€" class="headerlink" title="itemå¸ƒå±€"></a>itemå¸ƒå±€</h5><p>è¿™é‡Œæˆ‘ä»¬æŠŠä¸¤ç§å¸ƒå±€éƒ½å®šä¹‰åœ¨ä¸€ä¸ªxmlæ–‡ä»¶ä¸­ï¼Œç¨åä¼šæ ¹æ®ä»£ç æ¥å†³å®šéšè—å“ªç§ç±»å‹ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">              <span class="attr">android:padding</span>=<span class="string">"10dp"</span>&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!--å¥½å‹çš„ä¿¡æ¯--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/wx_item_left"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"60dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"60dp"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/left_item_image"</span>/&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"ä½ æ‰“æˆ‘è¯•è¯•"</span></div><div class="line">            <span class="attr">android:background</span>=<span class="string">"@drawable/message_left"</span></div><div class="line">            <span class="attr">android:layout_marginLeft</span>=<span class="string">"5dp"</span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"left|center"</span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/wx_item_left_textView"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--æˆ‘çš„æ¶ˆæ¯--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/wx_item_right"</span></div><div class="line">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"60dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"60dp"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/right_item_imgae"</span></div><div class="line">            <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/wx_item_right_image"</span>/&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/wx_item_right_textView"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"æ‰“ä½ å°±æ‰“ä½ "</span></div><div class="line">            <span class="attr">android:background</span>=<span class="string">"@drawable/message_right"</span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"center|left"</span></div><div class="line">            <span class="attr">android:paddingLeft</span>=<span class="string">"8dp"</span></div><div class="line">            <span class="attr">android:paddingRight</span>=<span class="string">"25dp"</span></div><div class="line">            <span class="attr">android:layout_toLeftOf</span>=<span class="string">"@+id/wx_item_right_image"</span></div><div class="line">            /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="æ¶ˆæ¯å®ä½“-MSGç±»"><a href="#æ¶ˆæ¯å®ä½“-MSGç±»" class="headerlink" title="æ¶ˆæ¯å®ä½“ MSGç±»"></a>æ¶ˆæ¯å®ä½“ MSGç±»</h5><p>æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å®ä½“ï¼Œæ¥å­˜å‚¨æ¶ˆæ¯ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ç§æ¶ˆæ¯ç±»å‹ï¼Œ<code>TYPE_RECEIVED</code>è¡¨ç¤ºæ¥æ”¶çš„æ¶ˆæ¯ï¼Œ<code>TYPE_SENT</code>è¡¨ç¤ºå‘é€çš„æ¶ˆæ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WXMsg</span> <span class="keyword">extends</span> <span class="title">Object</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_RECEIVED = <span class="number">0</span>; <span class="comment">//æ¥æ”¶ç±»å‹</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_SENT = <span class="number">1</span>; <span class="comment">//å‘é€ç±»å‹</span></div><div class="line">    <span class="keyword">private</span> String content;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WXMsg</span><span class="params">(String content, <span class="keyword">int</span> type)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.content = content;</div><div class="line">        <span class="keyword">this</span>.type = type;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> content;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> type;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="æ¶ˆæ¯é€‚é…å™¨-WXMsgAdapter"><a href="#æ¶ˆæ¯é€‚é…å™¨-WXMsgAdapter" class="headerlink" title="æ¶ˆæ¯é€‚é…å™¨ WXMsgAdapter"></a>æ¶ˆæ¯é€‚é…å™¨ WXMsgAdapter</h5><p>é‡ç‚¹æ¥äº†ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®æ¶ˆæ¯çš„ç±»å‹æ¥å†³å®šæ˜¾ç¤ºå“ªç§å¸ƒå±€æ–¹å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WXAdapter</span> <span class="keyword">extends</span> <span class="title">ArrayAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> resourceId;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WXAdapter</span><span class="params">(Context context, <span class="keyword">int</span> resourceId, List&lt;WXMsg&gt; msgArrayList)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, resourceId, msgArrayList);</div><div class="line">        <span class="keyword">this</span>.resourceId = resourceId;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, @Nullable View convertView, @NonNull ViewGroup parent)</span> </span>&#123;</div><div class="line">        View view;</div><div class="line">        WXViewHolder wxViewHolder;</div><div class="line">        WXMsg msg = (WXMsg) getItem(position);</div><div class="line">        <span class="keyword">if</span> (convertView == <span class="keyword">null</span>)&#123;</div><div class="line">            view = LayoutInflater.from(getContext()).inflate(resourceId,<span class="keyword">null</span>);</div><div class="line">            wxViewHolder = <span class="keyword">new</span> WXViewHolder(view);</div><div class="line">            view.setTag(wxViewHolder);</div><div class="line">        &#125;<span class="keyword">else</span>  &#123;</div><div class="line">            view = convertView;</div><div class="line">            wxViewHolder = (WXViewHolder) view.getTag();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (msg.getType() == WXMsg.TYPE_RECEIVED) &#123;</div><div class="line">            <span class="comment">//å¦‚æœæ˜¯æ”¶åˆ°çš„æ¶ˆæ¯  æ˜¾ç¤ºå·¦è¾¹çš„æ¶ˆæ¯å¸ƒå±€ï¼Œéšè—å³è¾¹çš„æ¶ˆæ¯å¸ƒå±€</span></div><div class="line">            wxViewHolder.rightLinearLayout.setVisibility(View.GONE);</div><div class="line">            wxViewHolder.leftLinearLayout.setVisibility(View.VISIBLE);</div><div class="line">            wxViewHolder.leftMsg.setText(msg.getContent());</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (msg.getType() == WXMsg.TYPE_SENT) &#123;</div><div class="line">            <span class="comment">//å¦‚æœæ˜¯å‘é€çš„æ¶ˆæ¯  æ˜¾ç¤ºå³è¾¹çš„æ¶ˆæ¯å¸ƒå±€ï¼Œéšè—å·¦è¾¹çš„æ¶ˆæ¯å¸ƒå±€</span></div><div class="line">            wxViewHolder.rightLinearLayout.setVisibility(View.VISIBLE);</div><div class="line">            wxViewHolder.leftLinearLayout.setVisibility(View.GONE);</div><div class="line">            wxViewHolder.rightMsg.setText(msg.getContent());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WXViewHolder</span> </span>&#123;</div><div class="line">        LinearLayout leftLinearLayout;</div><div class="line">        RelativeLayout rightLinearLayout;</div><div class="line">        TextView leftMsg;</div><div class="line">        TextView rightMsg;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">WXViewHolder</span><span class="params">(View view)</span></span>&#123;</div><div class="line">            leftLinearLayout = (LinearLayout) view.findViewById(R.id.wx_item_left);</div><div class="line">            rightLinearLayout = (RelativeLayout) view.findViewById(R.id.wx_item_right);</div><div class="line">            leftMsg = (TextView) view.findViewById(R.id.wx_item_left_textView);</div><div class="line">            rightMsg = (TextView) view.findViewById(R.id.wx_item_right_textView);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨WXChatActivityä¸­è¿™æ ·ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WXChatActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ListView mListView;</div><div class="line">    <span class="keyword">private</span> Button mSendButton;</div><div class="line">    <span class="keyword">private</span> EditText mEditText;</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;WXMsg&gt; mWXMsgArrayList;</div><div class="line">    <span class="keyword">private</span> WXAdapter mWXAdapter;</div><div class="line">    </div><div class="line">    <span class="comment">//æ¨¡æ‹Ÿä¸€ä¸ªå›å¤æ¶ˆæ¯æ± </span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span>  String[] allmsgArray = &#123;<span class="string">"ä½ ä¿¡ä¸ä¿¡æˆ‘æ‰“ä½ ï¼"</span>,<span class="string">"ç°åœ¨çš„å¹´è½»äººä¸€è¨€ä¸åˆå°±æ–—å›¾~"</span>,<span class="string">"çœ‹è¿‡ä¸€åƒå¤šéƒ¨å²›å›½æˆäººç‰‡ï¼Œä»äººåˆ°åŠ¨ç‰©ï¼Œå¤§å¦ˆåˆ°ç†Ÿå¦‡ï¼Œå¾¡å§åˆ°èè‰ï¼Œä¼šä¸€åƒå¤šç§å§¿åŠ¿ï¼Œä¸Šç™¾ç§æ’æ³•ï¼Œå‘Šè¯‰ä½ ï¼Œä¸è¦æƒ¹æˆ‘ï¼Œä¸ç„¶ä½ æ€ä¹ˆæ€€å­•çš„éƒ½ä¸çŸ¥é“"</span></div><div class="line">                                            ,<span class="string">"ä½ æ”¾å­¦åˆ«èµ°ï¼"</span>,<span class="string">"ä¸æœæ˜¯ä¸æ˜¯ ä¸æœæ¥æ‰“æˆ‘å•Š!"</span>&#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_wxchat);</div><div class="line"></div><div class="line">        mListView = (ListView) findViewById(R.id.wx_listView);</div><div class="line">        mSendButton = (Button) findViewById(R.id.wx_send);</div><div class="line">        mEditText = (EditText) findViewById(R.id.wx_editText);</div><div class="line"></div><div class="line">        mWXMsgArrayList = <span class="keyword">new</span> ArrayList&lt;WXMsg&gt;();</div><div class="line">        <span class="comment">//å…ˆéšæœºæ·»åŠ ä¸€æ¡æ¥æ”¶çš„æ¶ˆæ¯</span></div><div class="line">        addReceivedMsg();</div><div class="line">        mWXAdapter = <span class="keyword">new</span> WXAdapter(<span class="keyword">this</span>,R.layout.wx_item,mWXMsgArrayList);</div><div class="line">        mListView.setAdapter(mWXAdapter);</div><div class="line"></div><div class="line">        <span class="comment">//ç›‘å¬æŒ‰é’®ç‚¹å‡»</span></div><div class="line">        mSendButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                String content = mEditText.getText().toString();</div><div class="line">                <span class="keyword">if</span> (!<span class="string">""</span>.equals(content))&#123;</div><div class="line">                    <span class="comment">//æ·»åŠ å‘é€ä¿¡æ¯</span></div><div class="line">                    WXMsg msg = <span class="keyword">new</span> WXMsg(content,WXMsg.TYPE_SENT);</div><div class="line">                    mWXMsgArrayList.add(msg);</div><div class="line">                    <span class="comment">//æ·»åŠ æ¥æ”¶ä¿¡æ¯</span></div><div class="line">                    addReceivedMsg();</div><div class="line">                    <span class="comment">//æœ‰æ¶ˆæ¯æ›´æ–° åˆ·æ–°ç•Œé¢</span></div><div class="line">                    mWXAdapter.notifyDataSetChanged();</div><div class="line">                    <span class="comment">//ListViewæ»šåŠ¨åˆ°æœ€åä¸€è¡Œ</span></div><div class="line">                    mListView.smoothScrollToPosition(mWXMsgArrayList.size()-<span class="number">1</span>);</div><div class="line">                    <span class="comment">//æ¸…ç©ºè¾“å…¥æ¡†</span></div><div class="line">                    mEditText.setText(<span class="string">""</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//éšæœºæ·»åŠ æ¥æ”¶æ¶ˆæ¯</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addReceivedMsg</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> index = <span class="keyword">new</span> Random().nextInt(allmsgArray.length);</div><div class="line">        String content = allmsgArray[index];</div><div class="line">        WXMsg msg = <span class="keyword">new</span> WXMsg(content,WXMsg.TYPE_RECEIVED);</div><div class="line">        mWXMsgArrayList.add(msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android11.png?raw=true"><br></div>

<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å†™å®Œå¾®ä¿¡çš„å°ä¾‹å­ï¼Œå¿ƒé‡Œçš„æˆå°±æ„Ÿè¿˜æ˜¯å¾ˆå¼ºçš„ï¼ŒListViewçš„å¼ºå¤§è¿˜è¿œä¸æ­¢å¦‚æ­¤ï¼Œå› ä¸ºæˆ‘çŸ¥é“iOSçš„UITableViewçš„é‡è¦æ€§ï¼Œç›¸ä¿¡åœ¨ä»¥åçš„å¼€å‘ä¸­æˆ‘ä¼šç»å¸¸å’ŒListViewæ‰“äº¤é“çš„ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¯´èµ·&lt;code&gt;ListView&lt;/code&gt;ï¼Œå°±ä¸å¾—ä¸è¯´iOSçš„&lt;code&gt;UITableView&lt;/code&gt;ï¼Œæ¯«ä¸å¤¸å¼ çš„è¯´çš„ï¼Œæ”¾åœ¨3å¹´å‰ï¼Œå¦‚æœä½ å»é¢è¯•çš„æ—¶å€™ï¼Œä½ è¯´ä½ ä¼šç”¨&lt;code&gt;UITableView&lt;/code&gt;ï¼ŒçŸ¥é“&lt;code&gt;UITableView&lt;/code&gt;çš„ä»£ç†æ–¹æ³•ï¼Œä¸ç”¨è¯´äº†ï¼Œä½ å¯ä»¥ç›´æ¥æ¥ä¸Šç­äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ListView&lt;/code&gt;åœ¨Androidä¸­å¼€å‘çš„é‡è¦æ€§ä¸è¨€è€Œå–»ï¼Œå­¦å¥½&lt;code&gt;ListView&lt;/code&gt;ï¼Œæˆ‘æƒ³åœ¨ä»¥åçš„åˆ—è¡¨å¼€å‘ä¸­å°±ä¸ç”¨å‘æ„äº†ã€‚ä»€ä¹ˆæ˜¯åˆ—è¡¨å¼€å‘ï¼Ÿè¿™ä¹ˆè¯´å§ï¼Œåœ¨ä½ ä½¿ç”¨çš„APPä¸­ï¼Œ80%çš„éƒ½ä¼šç”¨åˆ°åˆ—è¡¨å¼€å‘ï¼Œæ¯”å¦‚å¾®ä¿¡çš„èŠå¤©é¡µï¼ŒQQçš„ä¸ªäººç©ºé—´é¡µã€‚ä¸ºä½•è¦ç”¨åˆ—è¡¨å¼€å‘ï¼Œåˆ—è¡¨å¼€å‘çš„ä¼˜è¶Šåœ¨å“ªé‡Œï¼Ÿæˆ‘ä»Šå¤©æ¥ä¸€æ¢ç©¶ç«Ÿã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://www.guiyongdong.com/categories/Android/"/>
    
    
      <category term="android" scheme="http://www.guiyongdong.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å¤©ä¸€Androidä¹‹å¸ƒå±€</title>
    <link href="http://www.guiyongdong.com/2017/03/18/%E4%B8%80%E5%A4%A9%E4%B8%80Android%E4%B9%8B%E5%B8%83%E5%B1%80/"/>
    <id>http://www.guiyongdong.com/2017/03/18/ä¸€å¤©ä¸€Androidä¹‹å¸ƒå±€/</id>
    <published>2017-03-18T07:40:40.000Z</published>
    <updated>2017-03-20T10:36:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©ä¸»è¦è¯´è¯´å¸ƒå±€ã€‚æˆ‘åœ¨çœ‹Androidçš„ä»»ä½•å†…å®¹çš„æ—¶å€™ï¼Œå¿ƒä¸­æ€»è¦å’ŒiOSè¿›è¡Œä¸€ç•ªæ¯”è¾ƒï¼Œå°±è¯´å¸ƒå±€å§ï¼Œåœ¨iOSä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç›´æ¥ä½¿ç”¨<code>frame</code>è®¡ç®—ã€AutoLayoutçº¦æŸå¸ƒå±€ã€‚åœ¨Androidçš„ä¸–ç•Œä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨xmlå¸ƒå±€æ–‡ä»¶æ¥è¿›è¡Œå¸ƒå±€ï¼Œç”¨åˆ°çš„å¸ƒå±€æ–¹å¼æœ‰å››ç§ï¼šçº¿æ€§å¸ƒå±€ã€ç›¸å¯¹å¸ƒå±€ã€å¸§å¸ƒå±€ã€ç™¾åˆ†æ¯”å¸ƒå±€ã€‚è¿˜æœ‰ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨å›¾å½¢åŒ–æ·»åŠ çº¦æŸï¼šConstraintLayoutã€‚ä¸ºä½•Androidçš„å¸ƒå±€æ–¹å¼å¦‚æ­¤çš„å¤šï¼Œä¸»è¦æ˜¯å› ä¸ºAndroidå±å¹•çš„ç¢ç‰‡åŒ–ï¼Œä¸åƒè‹¹æœå°±é‚£å‡ æ¬¾æ‰‹æœºã€‚</p>
<a id="more"></a>
<h3 id="çº¿æ€§å¸ƒå±€-LinearLayout"><a href="#çº¿æ€§å¸ƒå±€-LinearLayout" class="headerlink" title="çº¿æ€§å¸ƒå±€-LinearLayout"></a>çº¿æ€§å¸ƒå±€-LinearLayout</h3><p>LinearLayoutåˆç§°ä½œçº¿æ€§å¸ƒå±€ï¼Œæ­£å¦‚å®ƒçš„åå­—æ‰€æè¿°çš„ä¸€æ ·ï¼Œè¿™ä¸ªå¸ƒå±€ä¼šå°†å®ƒæ‰€åŒ…å«çš„æ§ä»¶åœ¨çº¿æ€§æ–¹å‘ä¸Šä¾æ¬¡æ’åˆ—ã€‚çº¿æ€§å¸ƒå±€çš„ä¸¤ç§æ’æ³•:</p>
<ul>
<li><p>ä»å·¦åˆ°å³ <code>android:orientation=&quot;horizontal&quot;</code></p>
</li>
<li><p>ä»ä¸Šåˆ°ä¸‹ <code>android:orientation=&quot;vertical&quot;</code></p>
</li>
</ul>
<p>é»˜è®¤çš„å¸ƒå±€æ–¹å‘ä¸ºï¼šhorizontalï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœLinearLayoutçš„æ’åˆ—æ–¹å‘æ˜¯<code>horizontal</code>ï¼Œå†…éƒ¨çš„æ§ä»¶å°±ç»ä¸èƒ½å°†å®½åº¦æŒ‡å®šä¸º<code>match_parent</code>ï¼Œå› ä¸ºè¿™ä¸ªæ§ä»¶ä¼šæŠŠæ•´ä¸ªæ°´å¹³æ–¹å‘å æ»¡ã€‚åŒç†ï¼Œå¦‚æœæ’åˆ—æ–¹å‘ä¸º<code>vertical</code>ï¼Œå°±ä¸èƒ½å°†æ§ä»¶çš„é«˜åº¦è®¾ç½®ä¸º<code>match_parent</code>ã€‚</p>
<p><strong>layout_gravity</strong></p>
<p><code>layout_gravity</code>ç”¨äºæŒ‡å®šæ§ä»¶åœ¨å¸ƒå±€ä¸­çš„å¯¹é½æ–¹å¼ï¼Œå½“LinearLayoutçš„æ’åˆ—æ–¹å‘æ˜¯<code>vertical</code>æ—¶ï¼Œåªæœ‰æ°´å¹³æ–¹å‘ä¸Š(center_horizontal)çš„å¯¹å…¶æ–¹å¼æ‰ä¼šç”Ÿæ•ˆï¼ŒåŒç†ï¼Œå½“LinearLayoutçš„æ’åˆ—æ–¹å‘æ˜¯<code>horizontal</code>æ—¶ï¼Œåªæœ‰å‚ç›´æ–¹å‘ä¸Š(center_vertical)çš„å¯¹å…¶æ–¹å¼æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<p><strong>layout_weight</strong></p>
<p>layout_weightè¿™ä¸ªå±æ€§å…è®¸æˆ‘ä»¬ä½¿ç”¨æ¯”ä¾‹çš„æ–¹å¼æ¥æŒ‡å®šæ§ä»¶çš„å¤§å°ï¼Œä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"hahahaha"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"heihei"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>å®ç°çš„æ•ˆæœï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android6.png?raw=true" width="375"><br></div>

<p>æˆ‘ä»¬çœ‹åˆ°ä¸¤ä¸ªæŒ‰é’®å¹³åˆ†äº†å±å¹•çš„æ°´å¹³ç©ºé—´ï¼Œå½“ç„¶åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»çš„ä½¿ç”¨æ­¤å±æ€§ã€‚</p>
<h3 id="ç›¸å¯¹å¸ƒå±€-RelativeLayout"><a href="#ç›¸å¯¹å¸ƒå±€-RelativeLayout" class="headerlink" title="ç›¸å¯¹å¸ƒå±€-RelativeLayout"></a>ç›¸å¯¹å¸ƒå±€-RelativeLayout</h3><p>RelativeLayoutåˆç§°ä¸ºç›¸å¯¹å¸ƒå±€ï¼Œä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„å¸ƒå±€ï¼Œèƒ½é€šè¿‡ç›¸å¯¹å®šä½çš„æ–¹å¼è®©æ§ä»¶å‡ºç°åœ¨å¸ƒå±€çš„ä»»ä½•ä½ç½®ï¼Œæ‰€ä»¥ç›¸å¯¹å¸ƒå±€çš„å±æ€§éå¸¸çš„å¤šï¼Œæˆ‘ä»¬çœ‹çœ‹ï¼š</p>
<ul>
<li><p>å±æ€§å€¼æ˜¯trueæˆ–false</p>
<ul>
<li><code>android:layout_centerHrizontal</code> æ°´å¹³å±…ä¸­</li>
<li><code>android:layout_centerVertical</code> å‚ç›´å±…ä¸­</li>
<li><code>android:layout_centerInparent</code> ç›¸å¯¹äºçˆ¶å…ƒç´ å®Œå…¨å±…ä¸­</li>
<li><code>android:layout_alignParentBottom</code> ä½äºçˆ¶å…ƒç´ çš„ä¸‹è¾¹ç¼˜</li>
<li><code>android:layout_alignParentTop</code> ä½äºçˆ¶å…ƒç´ çš„ä¸Šè¾¹ç¼˜</li>
<li><code>android:layout_alignParentLeft</code> ä½äºçˆ¶å…ƒç´ çš„å·¦è¾¹ç¼˜</li>
<li><code>android:layout_alignParentRight</code> ä½äºçˆ¶å…ƒç´ çš„å³è¾¹ç¼˜</li>
</ul>
</li>
<li><p>å±æ€§å€¼æ˜¯<code>@id/*</code></p>
<ul>
<li><code>android:layout_below</code> åœ¨æŸå…ƒç´ çš„ä¸‹æ–¹</li>
<li><code>android:layout_above</code> åœ¨æŸå…ƒç´ çš„ä¸Šæ–¹</li>
<li><code>andorid:layout_toRightOf</code> åœ¨æŸå…ƒç´ çš„å³æ–¹</li>
<li><code>android:layout_toLeftOf</code> åœ¨æŸå…ƒç´ çš„å·¦æ–¹</li>
<li><code>android:layout_alignBottom</code> å’ŒæŸå…ƒç´ ä¸‹æ–¹å¯¹é½</li>
<li><code>android:layout_alignTop</code> å’ŒæŸå…ƒç´ ä¸Šæ–¹å¯¹é½</li>
<li><code>android:layout_alignRight</code> å’ŒæŸå…ƒç´ å³æ–¹å¯¹é½</li>
<li><code>android:layout_alignLeft</code> å’ŒæŸå…ƒç´ å·¦æ–¹å¯¹é½</li>
</ul>
</li>
<li><p>å±æ€§å€¼æ˜¯æ•°å€¼</p>
<ul>
<li><code>android:layout_marginLeft</code> ç¦»æŸå…ƒç´ å·¦è¾¹ç¼˜çš„è·ç¦»</li>
<li><code>android:layout_marginRight</code> ç¦»æŸå…ƒç´ å³è¾¹ç¼˜çš„è·ç¦»</li>
<li><code>android:layout_marginTop</code> ç¦»æŸå…ƒç´ ä¸Šè¾¹ç¼˜çš„è·ç¦»</li>
<li><code>android:layout_marginBottom</code> ç¦»æŸå…ƒç´ ä¸‹è¾¹ç¼˜çš„è·ç¦»</li>
</ul>
</li>
</ul>
<p>æˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„å°ä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"1"</span></div><div class="line">        /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"2"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"3"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/button3"</span></div><div class="line">        <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"4"</span></div><div class="line">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"5"</span></div><div class="line">        <span class="attr">android:layout_below</span>=<span class="string">"@id/button3"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"6"</span></div><div class="line">        <span class="attr">android:layout_alignBottom</span>=<span class="string">"@id/button3"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"7"</span></div><div class="line">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"150dp"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"8"</span></div><div class="line">        <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"100dp"</span></div><div class="line">        <span class="attr">android:layout_toRightOf</span>=<span class="string">"@id/button3"</span>/&gt;</div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>è¿è¡Œå®ä¾‹å¦‚ä¸‹ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android7.png?raw=true" width="375"><br></div>

<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>å¦‚æœæ²¡æœ‰å®šä¹‰å·¦å³ï¼Œé‚£ä¹ˆé»˜è®¤åœ¨å·¦è¾¹ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ä¸Šä¸‹ï¼Œé»˜è®¤åœ¨ä¸Šè¾¹ã€‚</li>
<li>ç›¸åŒä½ç½®ï¼Œæ–°å®šä¹‰çš„å…ƒç´ ä¼šè¦†ç›–æ—§çš„å…ƒç´ ã€‚ä¾‹ï¼š1è¢«2è¦†ç›–äº†ã€‚</li>
<li>4åªå®šä¹‰äº†åœ¨çˆ¶å…ƒç´ çš„ä¸‹éƒ¨ï¼Œå·¦å³æ²¡å®šä¹‰ï¼Œäºæ˜¯é»˜è®¤å°±åœ¨å·¦è¾¹äº†ã€‚</li>
<li><code>android:layout_below</code>ï¼Œåœ¨æŸå…ƒç´ çš„ä¸‹éƒ¨å¹¶ä¸æ„å‘³ç€å°±ä¸€å®šæ˜¯ç´§éšæŸå…ƒç´ ï¼Œåªæ˜¯åœ¨ä¸‹éƒ¨é»˜ä½ç½®ã€‚ä¾‹å¦‚ï¼š5æ˜¯åœ¨3çš„ä¸‹éƒ¨ï¼Œä½†æ˜¯æ˜¯åœ¨ä¸‹éƒ¨çš„é»˜è®¤å·¦è¾¹ã€‚</li>
<li>6ä¸ºä¸‹è¾¹ç¼˜å¯¹å…¶3ï¼Œ7ä½marginLeft=150dpã€‚</li>
<li>8ä¸ºå¤šä¸ªå±æ€§å…±åŒå®šä¹‰çš„ç»“æœã€‚é¦–å…ˆæ˜¯åœ¨3çš„å³éƒ¨ï¼Œç„¶åæ˜¯å‚ç›´å±…ä¸­ï¼Œç„¶åmarginLeft=100dpå¾—åˆ°æœ€åä½ç½®ã€‚</li>
</ul>
<h3 id="å¸§å¸ƒå±€-FrameLayout"><a href="#å¸§å¸ƒå±€-FrameLayout" class="headerlink" title="å¸§å¸ƒå±€-FrameLayout"></a>å¸§å¸ƒå±€-FrameLayout</h3><p>FrameLayoutç§°ä¸ºå¸§å¸ƒå±€ï¼Œå®ƒç›¸è¾ƒäºå‰é¢ä¸¤ç§å¸ƒå±€å°±ç®€å•å¤šäº†ï¼Œè¿™ç§å¸ƒå±€æ²¡æœ‰æ–¹ä¾¿çš„å®šä½æ–¹å¼ï¼Œæ‰€æœ‰çš„æ§ä»¶éƒ½ä¼šé»˜è®¤æ‘†æ”¾åœ¨å¸ƒå±€çš„å·¦ä¸Šè§’ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>layout_gravity</code>å±æ€§æ¥æŒ‡å®šæ§ä»¶åœ¨å¸ƒå±€ä¸­çš„å¯¹é½æ–¹å¼ï¼Œå’ŒLinearLayoutä¸­çš„ç”¨æ³•æ˜¯ç›¸ä¼¼çš„ï¼Œç”±äºè¿™ç§å¸ƒå±€ç”¨åˆ°çš„å¾ˆå°‘ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ã€‚</p>
<h3 id="ç™¾åˆ†æ¯”å¸ƒå±€"><a href="#ç™¾åˆ†æ¯”å¸ƒå±€" class="headerlink" title="ç™¾åˆ†æ¯”å¸ƒå±€"></a>ç™¾åˆ†æ¯”å¸ƒå±€</h3><p>é€šè¿‡å­¦ä¹ ä¸Šé¢çš„ä¸‰ç§å¸ƒå±€ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œåªæœ‰LinearLayoutæ”¯æŒä½¿ç”¨<code>layout_weight</code>å±æ€§æ¥å®ç°æŒ‰æ¯”ä¾‹æŒ‡å®šæ§å¤§å°çš„åŠŸèƒ½ï¼Œå…¶ä»–ä¸¤ç§å¸ƒå±€éƒ½ä¸æ”¯æŒã€‚ä¸ºæ­¤ï¼ŒAndroidå¼•å…¥äº†ä¸€ç§å…¨æ–°çš„å¸ƒå±€æ–¹å¼â€”â€”ç™¾åˆ†æ¯”å¸ƒå±€ã€‚</p>
<p>ç”±äºLinearLayoutæœ¬èº«å·²ç»æ”¯æŒæŒ‰æ¯”ä¾‹æŒ‡å®šæ§ä»¶çš„å¤§å°äº†ï¼Œå› æ­¤ç™¾åˆ†æ¯”å¸ƒå±€åªä¸ºFrameLayoutå’ŒRelativeLayoutè¿›è¡Œäº†åŠŸèƒ½çš„æ‰©å±•ï¼Œæä¾›äº†<strong>PercentFrameLayout</strong>å’Œ<strong>PercentRelativeLayout</strong>ã€‚</p>
<p>ä¸åŒäºä¸Šé¢çš„ä¸‰ç§å¸ƒå±€ï¼ŒAndroidå›¢é˜Ÿå°†ç™¾åˆ†æ¯”å¸ƒå±€å®šä¹‰åœ¨äº†supportåº“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨build.gradleä¸­æ·»åŠ ç™¾åˆ†æ¯”å¸ƒå±€åº“çš„ä¾èµ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    compile <span class="string">'com.android.support:percent:25.0.1'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨å¯¼å…¥ç™¾åˆ†æ¯”å¸ƒå±€çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®Œæ•´çš„åŒ…åè·¯å¾„å†™å‡ºæ¥ï¼Œç„¶åè¿˜å¿…é¡»å®šä¹‰ä¸€ä¸ªappçš„å‘½åç©ºé—´ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨ç™¾åˆ†æ¯”å¸ƒå±€çš„è‡ªå®šä¹‰å±æ€§ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.percent.PercentFrameLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.guiyongdong.layoutdemo.SecondActivity"</span>&gt;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button1"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"left|right"</span></div><div class="line">        <span class="attr">app:layout_widthPercent</span>=<span class="string">"50%"</span></div><div class="line">        <span class="attr">app:layout_heightPercent</span>=<span class="string">"50%"</span></div><div class="line">        /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button2"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"right|top"</span></div><div class="line">        <span class="attr">app:layout_widthPercent</span>=<span class="string">"50%"</span></div><div class="line">        <span class="attr">app:layout_heightPercent</span>=<span class="string">"50%"</span></div><div class="line">        /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button3"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"left|bottom"</span></div><div class="line">        <span class="attr">app:layout_widthPercent</span>=<span class="string">"50%"</span></div><div class="line">        <span class="attr">app:layout_heightPercent</span>=<span class="string">"50%"</span></div><div class="line">        /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button4"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"right|bottom"</span></div><div class="line">        <span class="attr">app:layout_widthPercent</span>=<span class="string">"50%"</span></div><div class="line">        <span class="attr">app:layout_heightPercent</span>=<span class="string">"50%"</span></div><div class="line">        /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">android.support.percent.PercentFrameLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œæˆ‘åœ¨å†™è¿™æ®µä»£ç çš„æ—¶å€™ï¼ŒIDEä¸ä¼šè‡ªåŠ¨æç¤º~</p>
<p>æ•ˆæœå›¾ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android8.png?raw=true" width="375"><br></div>



<hr>
<h3 id="çº¦æŸå¸ƒå±€-ConstraintLayout"><a href="#çº¦æŸå¸ƒå±€-ConstraintLayout" class="headerlink" title="çº¦æŸå¸ƒå±€-ConstraintLayout"></a>çº¦æŸå¸ƒå±€-ConstraintLayout</h3><p>çœ‹åˆ°è¿™ä¸ªå¸ƒå±€æˆ‘å°±æƒ³åˆ°äº†iOSçš„AutoLayoutï¼Œä»–çš„ç”¨æ³•å’ŒiOSçš„xibæ·»åŠ çº¦æŸä¸€æ ·ï¼Œç”¨ç€ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚</p>
<p>ConstraintLayoutæ˜¯Android Studio2.2æ–°æ·»åŠ çš„åŠŸèƒ½ï¼Œè™½ç„¶ä¼ ç»Ÿå¸ƒå±€ä¹Ÿå¯ä»¥ä½¿ç”¨å¯è§†åŒ–ç•Œé¢æ‹–åŠ¨ç©ºé—´å¸ƒå±€ï¼Œä½†æ˜¯å› ä¸ºä¸å¤Ÿçµæ´»ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šé€‰æ‹©xmlä»£ç æ¥å¸ƒå±€ã€‚è€ŒConstraintLayoutçš„å‡ºç°å°†æˆ‘ä»¬å¸¦å…¥å¯è§†åŒ–å¸ƒå±€ç¼–ç¨‹çš„æ–°çºªå…ƒï¼Œé€šè¿‡å»ºç«‹ç©ºé—´ä¹‹é—´çš„çº¦æŸï¼Œå®ç°å¸ƒå±€çš„æ„å»ºã€‚è¿™æ ·åšæœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯å‡å°‘äº†å¸ƒå±€çš„åµŒå¥—ï¼Œå‡å°‘äº†å¸ƒå±€æ¸²æŸ“çš„å±‚æ•°ï¼Œé™ä½äº†CPUçš„æ¶ˆè€—ï¼Œæé«˜äº†ç¨‹åºçš„æ€§èƒ½ã€‚æ€»ä¹‹å°±æ˜¯ä¼˜ç‚¹å¾ˆå¤šã€‚</p>
<h5 id="å»ºç«‹ä¾èµ–"><a href="#å»ºç«‹ä¾èµ–" class="headerlink" title="å»ºç«‹ä¾èµ–"></a>å»ºç«‹ä¾èµ–</h5><p>åœ¨ä½¿ç”¨ConstraintLayoutå¸ƒå±€ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨build.gradleæ·»åŠ ä¾èµ–ï¼Œä½†æ˜¯ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ ï¼ŒIDEå·²ç»ä¸ºæˆ‘ä»¬è‡ªåŠ¨æ·»åŠ å¥½äº†ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    compile <span class="string">'com.android.support.constraint:constraint-layout:1.0.0-beta4'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="åˆ‡æ¢è§†å›¾"><a href="#åˆ‡æ¢è§†å›¾" class="headerlink" title="åˆ‡æ¢è§†å›¾"></a>åˆ‡æ¢è§†å›¾</h5><p>ç‚¹å‡»èœå•æ çš„ä¸­çš„<code>Show Design</code>ã€<code>Show Blueprint</code>å’Œ<code>Show Design + Blueprint</code>æŒ‰é’®å¯ä»¥å¯¹æ“ä½œè§†å›¾è¿›è¡Œåˆ‡æ¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-bef33c37ccb1d63f.gif?imageMogr2/auto-orient/strip" width="375"><br></div>


<h5 id="æ·»åŠ çº¦æŸ"><a href="#æ·»åŠ çº¦æŸ" class="headerlink" title="æ·»åŠ çº¦æŸ"></a>æ·»åŠ çº¦æŸ</h5><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œå¹¶ä¸ºå®ƒæ·»åŠ çº¦æŸï¼š</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-de183f8df27f879d.gif?imageMogr2/auto-orient/strip" width="375"><br></div>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒæŒ‰é’®æ§ä»¶æœ‰å››ä¸ªæ–¹å‘çš„çº¦æŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæŒ‰é’®çš„ä¸Šã€ä¸‹ã€å·¦ã€å³è¾¹ä¸Šå„æœ‰ä¸€ä¸ªå°åœ†åœˆï¼Œé¼ æ ‡å¯æ‹–åŠ¨å°åœ†åœˆåˆ°<code>ConstraintLayout</code>ï¼Œä¸å…¶æ·»åŠ çº¦æŸã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-85ab8f622faca3a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<p>å¦‚å°†æŒ‰é’®ä¸‹è¾¹åœ†åœˆæ‹–è‡³<code>ConstraintLayout</code>åº•éƒ¨ï¼Œåˆ™æŒ‰é’®ç§»åŠ¨è‡³åº•éƒ¨ï¼›å†å°†æŒ‰é’®ä¸Šè¾¹åœ†åœˆæ‹–åŠ¨è‡³<code>ConstraintLayout</code>é¡¶éƒ¨ï¼Œå‚ç›´æ–¹å‘ä¸Šæœ‰ä¸¤ä¸ªçº¦æŸçš„æŒ‰é’®æ§ä»¶å°±ä¼šå®ç°å‚ç›´å±…ä¸­ã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-4de51c14488859f3.gif?imageMogr2/auto-orient/strip"><br></div>

<h5 id="çº¦æŸä½ç½®æ¯”ä¾‹è°ƒæ•´"><a href="#çº¦æŸä½ç½®æ¯”ä¾‹è°ƒæ•´" class="headerlink" title="çº¦æŸä½ç½®æ¯”ä¾‹è°ƒæ•´"></a>çº¦æŸä½ç½®æ¯”ä¾‹è°ƒæ•´</h5><p>å½“ç„¶å¦‚æœ<code>ConstraintLayout</code>æ·»åŠ çº¦æŸä»…ä»…èƒ½å®ç°æ°´å¹³ã€å‚ç›´å±…ä¸­ï¼Œé‚£ä¹ˆå®ƒåœ¨åŠŸèƒ½ä¸Šä¸RelativeLayoutå°±æ²¡æœ‰å·®åˆ«äº†ã€‚é™¤äº†å±…ä¸­ï¼Œçº¦æŸè¿˜å¯ä»¥è®¾ç½®æ§ä»¶ä¸¤è¾¹åˆ°è¾¹ç•Œä¹‹é—´çš„è·ç¦»æ¯”ä¾‹ï¼Œé€šè¿‡åœ¨å³ä¾§å±æ€§é¢æ¿ä¸­ï¼Œæ‹–åŠ¨æ°´å¹³å’Œå‚ç›´æ–¹å‘çš„è¿›åº¦æ¡æ¥è°ƒæ•´ä¸¤è¾¹è·ç¦»çš„æ¯”ä¾‹ã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-5d4d3177e87d6c22.gif?imageMogr2/auto-orient/strip" width="375"><br></div>

<h5 id="æ§ä»¶ä¹‹é—´æ·»åŠ çº¦æŸ"><a href="#æ§ä»¶ä¹‹é—´æ·»åŠ çº¦æŸ" class="headerlink" title="æ§ä»¶ä¹‹é—´æ·»åŠ çº¦æŸ"></a>æ§ä»¶ä¹‹é—´æ·»åŠ çº¦æŸ</h5><p>é™¤äº†ä¸<code>ConstraintLayout</code>æ·»åŠ çº¦æŸï¼Œæ§ä»¶ä¸æ§ä»¶ä¹‹é—´åŒæ ·å¯ä»¥æ·»åŠ çº¦æŸã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨è°ƒæ•´æŒ‰é’®å®½åº¦åï¼Œå°†ä¸¤ä¸ªæŒ‰é’®çš„å·¦å³ä¸¤è¾¹æ·»åŠ çº¦æŸï¼Œç„¶åå°†ä¸‹æ–¹æŒ‰é’®çš„ä¸Šè¾¹ä¸ä¸Šæ–¹æŒ‰é’®çš„ä¸‹è¾¹æ·»åŠ çº¦æŸï¼Œæ‹–åŠ¨ä¸‹æ–¹çš„æŒ‰é’®ï¼Œå¯è®¾ç½®ä¸¤ä¸ªæŒ‰é’®ä¹‹é—´çš„å¤–è¾¹è·ã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-e814c547622d896e.gif?imageMogr2/auto-orient/strip" width="375"><br></div>

<p>é€šè¿‡æ§ä»¶ä¹‹é—´æ·»åŠ çº¦æŸå’Œè°ƒæ•´çº¦æŸè·ç¦»æ¯”ä¾‹ï¼Œå¼€å‘è€…å¯å®ç°è¾ƒä¸ºå¤æ‚çš„çº¦æŸã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-506a4d7ea3a560b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>


<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-02e85c6fcedd4a17.gif?imageMogr2/auto-orient/strip" width="375"><br></div>


<h5 id="è°ƒæ•´æ§ä»¶å¤–è¾¹è·åŠå°ºå¯¸"><a href="#è°ƒæ•´æ§ä»¶å¤–è¾¹è·åŠå°ºå¯¸" class="headerlink" title="è°ƒæ•´æ§ä»¶å¤–è¾¹è·åŠå°ºå¯¸"></a>è°ƒæ•´æ§ä»¶å¤–è¾¹è·åŠå°ºå¯¸</h5><p>ä½ å¯èƒ½ä¼šå‘ç°ï¼Œåœ¨è°ƒæ•´æ§ä»¶ä½ç½®çš„æ¯”ä¾‹çš„æ—¶å€™ï¼Œå½“è¿›åº¦æ¡æ»‘åŠ¨è‡³100æ—¶ï¼Œæ§ä»¶æœªèƒ½å®Œå…¨è´´ä¸Šå¸ƒå±€çš„å³è¾¹ç•Œï¼Œè¿™æ˜¯å› ä¸ºæ§ä»¶å­˜åœ¨å¤–è¾¹è·ã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-6b0c81f425c3360f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600"><br></div>

<p>è¿™æ—¶å€™å¯ä»¥ä¿®æ”¹å±æ€§é¢æ¿ä¸­çš„æ•°å€¼æ¥è°ƒæ•´æ§ä»¶çš„å¤–è¾¹è·å¤§å°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-c32ddd5ce43f0ed1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<p>åœ¨æ§ä»¶å°ºå¯¸è°ƒæ•´ä¸Šï¼ŒConstraintLayoutæä¾›äº†ä¸‰ç§æ¨¡å¼ï¼Œåœ¨å±æ€§é¢æ¿ä¸­ç‚¹å‡»ä¸‹å›¾çº¢è‰²æ¡†æ¡†åŒºåŸŸå®ç°æ¨¡å¼çš„åˆ‡æ¢ã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-e1c6a34a875c7d14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<p>è¿™ä¸‰ç§åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li><strong>wrap content</strong></li>
</ul>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-b3b5528ebb36940b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<p>wrap contentæ¨¡å¼å°±æ˜¯å¹³æ—¶å¸¸ç”¨çš„æ ¹æ®å†…å®¹æ¥è®¾å®šæ§ä»¶å°ºå¯¸ã€‚</p>
<ul>
<li><strong>å›ºå®šå€¼</strong></li>
</ul>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-4314b554f154e21b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<p>å›ºå®šå€¼æ¨¡å¼ä¹Ÿæ˜¯å¹³æ—¶å¸¸ç”¨çš„ï¼Œé€šè¿‡è®¾å®šå…·ä½“æ•°å€¼æ¥ç¡®å®šæ§ä»¶çš„å¤§å°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåˆ‡æ¢ä¸ºå›ºå®šæ¨¡å¼åï¼Œåœ¨ä¸‹æ–¹çš„layout_widthä¸€æ å¡«å†™å…·ä½“çš„å®½åº¦æ•°å€¼ã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-cac0c176f4f4f49f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<ul>
<li><strong>any size</strong></li>
</ul>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-94472c2f856e43c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>

<p>any sizeä¸match parentç±»ä¼¼ï¼Œéƒ½æ˜¯å……æ»¡æ•´ä¸ªèŒƒå›´ï¼Œä½†æ˜¯ä¸åŒç‚¹åœ¨äºmatch parentå……æ»¡ç›¸å¯¹äºçˆ¶å®¹å™¨ï¼Œè€Œany sizeæ˜¯ç›¸å¯¹äºçº¦æŸæ¡ä»¶ï¼Œå³åœ¨çº¦æŸæ¡ä»¶ä¸‹ï¼Œèƒ½å¡«å……çš„èŒƒå›´å…¨éƒ¨å……æ»¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-38cc760addcdd58b.gif?imageMogr2/auto-orient/strip"><br></div>

<p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼ŒConstraintLayoutå…¶å®ä¹Ÿæœ‰match parentæ¨¡å¼ï¼Œä½†æ˜¯å› ä¸ºConstraintLayoutä¸å­˜åœ¨å¤šå±‚åµŒå¥—å…³ç³»ï¼Œæ‰€ä»¥match parentè¿™ç§ç›¸å¯¹äºçˆ¶å®¹å™¨çš„æ¨¡å¼åœ¨ConstraintLayoutä¸­å¾ˆå°‘ä¼šä½¿ç”¨ã€‚</p>
<h5 id="åˆ é™¤çº¦æŸ"><a href="#åˆ é™¤çº¦æŸ" class="headerlink" title="åˆ é™¤çº¦æŸ"></a>åˆ é™¤çº¦æŸ</h5><p>åˆ é™¤çº¦æŸæœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li><strong>åˆ é™¤å•ä¸ªçº¦æŸ</strong></li>
</ul>
<p>å°†é¼ æ ‡ç§»åŠ¨åˆ°è¦åˆ é™¤çš„çº¦æŸå¯¹åº”çš„å°åœ†åœˆï¼Œå¾…å°åœ†åœˆå‡ºç°é—ªçƒçš„çº¢è‰²åœˆåœˆæ—¶ï¼Œç‚¹å‡»å°åœ†åœˆå³å¯åˆ é™¤çº¦æŸã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-fdd60ed653b1dbaa.gif?imageMogr2/auto-orient/strip"><br></div>

<p>é™¤äº†ä¸Šé¢è¿™ç§åˆ é™¤æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åœ¨å±æ€§é¢æ¿ä¸­ï¼Œå°†é¼ æ ‡ç§»åŠ¨åˆ°ä¸‹å›¾çº¢è‰²æ¡†æ¡†æ ‡è®°çš„ä½ç½®ï¼Œå¾…å‡ºç°å‰å‰å›¾æ ‡ï¼Œç‚¹å‡»å¯åˆ é™¤è¯¥çº¦æŸã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-d604aedaef646425.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>


<ul>
<li><strong>åˆ é™¤å•ä¸ªæ§ä»¶çš„æ‰€æœ‰çº¦æŸ</strong></li>
</ul>
<p>ç”¨é¼ æ ‡ç‚¹å‡»æ§ä»¶ï¼Œåœ¨å…¶å·¦ä¸‹æ–¹ä¼šå‡ºç°ä¸€ä¸ªå°å‰å‰å›¾æ ‡ï¼Œç‚¹å‡»å°å›¾æ ‡å³å¯åˆ é™¤å½“å‰æ§ä»¶çš„æ‰€æœ‰çº¦æŸã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-914f40e162960b10.gif?imageMogr2/auto-orient/strip"><br></div>

<ul>
<li><strong>åˆ é™¤å½“å‰ç•Œé¢çš„æ‰€æœ‰çº¦æŸ</strong></li>
</ul>
<p>ç‚¹å‡»å·¥å…·æ ä¸­<code>åˆ é™¤æ‰€æœ‰çº¦æŸ</code>å›¾æ ‡çš„æŒ‰é’®ï¼Œå³å¯åˆ é™¤å½“å‰ç•Œé¢æ‰€æœ‰çš„çº¦æŸã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-99411797db6acd15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br></div>


<h5 id="Guidelines"><a href="#Guidelines" class="headerlink" title="Guidelines"></a>Guidelines</h5><p>å­¦å®ŒåŸºæœ¬çš„ä¾èµ–æ“ä½œï¼Œæ¥çœ‹ä¸€ä¸‹ConstraintLayoutçš„è¿›é˜¶ç”¨æ³•ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œè¦æ±‚å°†ä¸¤ä¸ªæ§ä»¶åˆåœ¨ä¸€èµ·ï¼Œå®ç°æ°´å¹³å±…ä¸­ã€‚å¦‚æœä¸ä½¿ç”¨ConstraintLayoutï¼Œæˆ‘ä»¬æˆ–è®¸ä¼šæƒ³åˆ°ç”¨RelativeLayoutåµŒå¥—LinearLayoutæ¥å®ç°ã€‚é‚£ä¹ˆåœ¨ConstraintLayoutè¿™æ ·ä¸å­˜åœ¨å¤šå¸ƒå±€åµŒå¥—çš„æƒ…å†µä¸‹è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p>
<p>è¿™æ—¶å€™å°±æå‡ºäº†Guidelinesï¼ŒGuideLineså°±å¦‚åŒPhotoshopä¸­å‚è€ƒçº¿çš„æ¦‚å¿µä¸€æ ·ã€‚å¦‚ä¸‹å›¾ï¼Œåˆ›å»ºä¸€ä¸ªå‚ç›´æ–¹å‘çš„å‚è€ƒçº¿ï¼Œå°†å…¶åˆ‡æ¢è‡³ç™¾åˆ†æ¯”æ¨¡å¼ï¼Œæ‹–åŠ¨åˆ°50%çš„ä½ç½®ï¼Œå†å°†ä¸¤ä¸ªæ§ä»¶åœ¨å·¦å³ä¸¤ä¾§åˆ†åˆ«ä¸Guidelinesæ·»åŠ çº¦æŸï¼Œç„¶åä¸¤ä¸ªæ§ä»¶çš„åº•è¾¹ç›¸äº’æ·»åŠ çº¦æŸå³å¯å®ç°åˆå¹¶å±…ä¸­çš„æ•ˆæœã€‚æ­¤æ—¶ConstraintLayoutå±•ç°äº†å…¶å¼ºå¤§çš„ä¼˜åŠ¿ï¼Œé€šè¿‡å…¶ç‰¹æ€§ä¼˜é›…åœ°å®Œæˆéœ€æ±‚ã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-a6737f34ac5ad74d.gif?imageMogr2/auto-orient/strip"><br></div>

<p>æˆ‘ä»¬ä¸ä»…å¯ä»¥åˆ›å»ºå‚ç›´æ–¹å‘çš„å¼•å¯¼çº¿ï¼Œè¿˜å¯ä»¥åˆ›å»ºæ°´å¹³æ–¹å‘ä¸Šçš„å¼•å¯¼çº¿ã€‚</p>
<h5 id="Autoconnect"><a href="#Autoconnect" class="headerlink" title="Autoconnect"></a>Autoconnect</h5><p>æˆ–è®¸å› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ConstraintLayoutï¼Œæ‰€ä»¥æ„Ÿè§‰æ·»åŠ çº¦æŸçš„æ“ä½œå¾ˆæœ‰è¶£ï¼Œä½†æ˜¯åœ¨é¡¹ç›®ä¸­ï¼Œå½“æ§ä»¶æ•°é‡æ¯”è¾ƒå¤šæ—¶ï¼Œæ¯ä¸ªæ§ä»¶çš„æ¯æ¡è¾¹éƒ½è¦ä¸€ä¸ªä¸€ä¸ªæ·»åŠ çº¦æŸï¼Œè¿™æ ·å°±ä¼šæ‹–æ…¢å¼€å‘æ•ˆç‡ï¼Œæ‰€ä»¥ConstraintLayoutæå‡ºäº†Autoconnectçš„ç”¨æ³•ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå•å‡»æ‰“å¼€å·¥å…·æ ä¸­AutoconnectåŠŸèƒ½æŒ‰é’®ï¼Œå°†æ§ä»¶æ‹–è‡³å±å¹•ä¸­å¿ƒï¼Œç„¶åçº¦æŸå°±ä¼šè‡ªåŠ¨æ·»åŠ äº†ã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-1ced9132a90a8aa3.gif?imageMogr2/auto-orient/strip"><br></div>


<p>Autoconnectä¼šæ ¹æ®æˆ‘ä»¬çš„æ„å›¾æ¥åˆ¤æ–­æ˜¯å¦æ·»åŠ ç›¸åº”çš„çº¦æŸï¼Œå½“ç„¶è‡ªåŠ¨æ·»åŠ çš„çº¦æŸä¸ä¸€å®šå…¨æ˜¯æƒ³è¦çš„æ•ˆæœï¼Œè¿™æ—¶å€™å¯ä»¥å…³é—­Autoconnectï¼Œç„¶åæ‰‹åŠ¨ä¿®æ”¹çº¦æŸã€‚</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-f73b47f9987ff980.gif?imageMogr2/auto-orient/strip"><br></div>


<h5 id="Inference"><a href="#Inference" class="headerlink" title="Inference"></a>Inference</h5><p>Inferenceä¸AutoconnectåŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯ç”¨äºè‡ªåŠ¨æ·»åŠ çº¦æŸçš„ï¼Œä½†æ˜¯Inferenceæ›´åŠ å¼ºå¤§ã€‚Inferenceæ˜¯æ‰‹åŠ¨æ·»åŠ çº¦æŸåï¼Œå¯¹å½“å‰ç•Œé¢æ‰€æœ‰æ§ä»¶çš„ä½ç½®å…³ç³»æ·»åŠ æ•´ä½“çº¦æŸå…³ç³»ï¼Œæ„Ÿè§‰å’ŒPhotoshopé‡Œé¢ä¸åŒå¸ƒå±€ä¸­çš„å›¾åƒè°ƒæ•´å¥½ä½ç½®ååˆå¹¶å¯è§å›¾å±‚å¾ˆåƒã€‚Inferenceæ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<div align="center"><br><img src="http://upload-images.jianshu.io/upload_images/291600-72db88ec184210fa.gif?imageMogr2/auto-orient/strip"><br></div>



<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>Androidçš„å¸ƒå±€å·®ä¸å¤šå°±è¿™ä¹ˆå¤šï¼Œå­¦ä¼šè¿™äº›å¸ƒå±€ï¼Œæˆ‘æƒ³è¶³å¤Ÿèƒ½è®©æˆ‘åœ¨ä»¥åçš„å¼€å‘ä¸­é¡ºåˆ©çš„è¿›è¡Œã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©ä¸»è¦è¯´è¯´å¸ƒå±€ã€‚æˆ‘åœ¨çœ‹Androidçš„ä»»ä½•å†…å®¹çš„æ—¶å€™ï¼Œå¿ƒä¸­æ€»è¦å’ŒiOSè¿›è¡Œä¸€ç•ªæ¯”è¾ƒï¼Œå°±è¯´å¸ƒå±€å§ï¼Œåœ¨iOSä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç›´æ¥ä½¿ç”¨&lt;code&gt;frame&lt;/code&gt;è®¡ç®—ã€AutoLayoutçº¦æŸå¸ƒå±€ã€‚åœ¨Androidçš„ä¸–ç•Œä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨xmlå¸ƒå±€æ–‡ä»¶æ¥è¿›è¡Œå¸ƒå±€ï¼Œç”¨åˆ°çš„å¸ƒå±€æ–¹å¼æœ‰å››ç§ï¼šçº¿æ€§å¸ƒå±€ã€ç›¸å¯¹å¸ƒå±€ã€å¸§å¸ƒå±€ã€ç™¾åˆ†æ¯”å¸ƒå±€ã€‚è¿˜æœ‰ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨å›¾å½¢åŒ–æ·»åŠ çº¦æŸï¼šConstraintLayoutã€‚ä¸ºä½•Androidçš„å¸ƒå±€æ–¹å¼å¦‚æ­¤çš„å¤šï¼Œä¸»è¦æ˜¯å› ä¸ºAndroidå±å¹•çš„ç¢ç‰‡åŒ–ï¼Œä¸åƒè‹¹æœå°±é‚£å‡ æ¬¾æ‰‹æœºã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://www.guiyongdong.com/categories/Android/"/>
    
    
      <category term="android" scheme="http://www.guiyongdong.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å¤©ä¸€Androidä¹‹Activity</title>
    <link href="http://www.guiyongdong.com/2017/03/17/%E4%B8%80%E5%A4%A9%E4%B8%80Android%E4%B9%8BActivity/"/>
    <id>http://www.guiyongdong.com/2017/03/17/ä¸€å¤©ä¸€Androidä¹‹Activity/</id>
    <published>2017-03-17T09:30:01.000Z</published>
    <updated>2017-03-18T07:37:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ¥è¯´ä¸€è¯´Androidå››å¤§ç»„ä»¶ä¹‹ä¸€çš„<code>Activity</code>ï¼Œç±»ä¼¼äºiOSçš„<code>UIViewController</code>ã€‚å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªAndroidé¡¹ç›®æ—¶ï¼ŒAndroid Studioé»˜è®¤ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸»æ´»åŠ¨:<code>MainActivity</code>å’Œä¸€ä¸ªé»˜è®¤çš„ä¸»å¸ƒå±€:<code>activity_main.xml</code>ã€‚ä¸€ä¸ªæ´»åŠ¨æƒ³è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå°±å¿…é¡»åœ¨<code>AndroidManifest.xml</code>ä¸­æ³¨å†Œã€‚ä½†æ˜¯è¿™äº›å·¥ä½œéƒ½æœ‰IDEå¸®æˆ‘ä»¬è‡ªåŠ¨å®Œæˆäº†ã€‚æˆ‘ä»¬æ¥çœ‹<code>AndroidManifest.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">          <span class="attr">package</span>=<span class="string">"com.guiyongdong.activitydemo"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></div><div class="line">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">        </div><div class="line">        <span class="comment">&lt;!--MainActivity--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="Activityå£°æ˜"><a href="#Activityå£°æ˜" class="headerlink" title="Activityå£°æ˜"></a>Activityå£°æ˜</h3><p>æˆ‘ä»¬é¦–å…ˆå£°æ˜äº†ç¨‹åºçš„åŒ…å<code>package=&quot;com.guiyongdong.listviewdemo&quot;</code>ã€‚</p>
<h5 id="lt-application-gt"><a href="#lt-application-gt" class="headerlink" title="&lt;application&gt;"></a><code>&lt;application&gt;</code></h5><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆå£°æ˜äº†<code>&lt;application&gt;</code>æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾æ ‡ç¤ºå½“å‰ç¨‹åºçš„é…ç½®ï¼Œä¾‹å¦‚æˆ‘ä»¬é…ç½®äº†iconï¼ˆç¨‹åºçš„å›¾æ ‡ï¼‰ã€labelï¼ˆç¨‹åºçš„åç§°ï¼‰ç­‰ã€‚</p>
<h5 id="lt-activity-gt"><a href="#lt-activity-gt" class="headerlink" title="&lt;activity&gt;"></a><code>&lt;activity&gt;</code></h5><p>ç„¶åæˆ‘ä»¬åˆåœ¨<code>&lt;application&gt;</code>æ ‡ç­¾å†…æ·»åŠ äº†ä¸€ä¸ª<code>&lt;activity&gt;</code>æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾å°±æ˜¯å£°æ˜ä¸€ä¸ªæ´»åŠ¨ï¼ˆAvtivityï¼‰ã€‚è®°ä½ï¼Œæ‰€æœ‰çš„æ´»åŠ¨éƒ½å¿…é¡»å£°æ˜åœ¨<code>&lt;application&gt;</code>æ ‡ç­¾å†…ã€‚<code>name</code>å±æ€§è¡¨ç¤ºå£°æ˜çš„æ˜¯å“ªä¸ªActivityï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰å·²ç»å£°æ˜è¿‡äº†å½“å‰çš„åŒ…åï¼Œ æ‰€æœ‰ä»¥åå£°æ˜çš„Activityåªè¦åœ¨è¿™ä¸ªåŒ…ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜<code>.MainActivity</code>å°±å¯ä»¥äº†ã€‚å…¶å®å®ƒçš„å…¨ç§°è¿˜æ˜¯<code>com.guiyongdong.listviewdemo. MainActivity</code>ã€‚ æˆ‘ä»¬åˆçœ‹åˆ°åœ¨<code>&lt;activity&gt;</code>æ ‡ç­¾å†…ï¼Œæˆ‘ä»¬æœ‰å£°æ˜äº†ä¸€ä¸ªæ ‡ç­¾<code>&lt;intent-filter&gt;</code>ï¼Œæ¥çœ‹çœ‹å®ƒä»¬æ˜¯ä»€ä¹ˆã€‚</p>
<h5 id="lt-intent-filter-gt"><a href="#lt-intent-filter-gt" class="headerlink" title="&lt;intent-filter&gt;"></a><code>&lt;intent-filter&gt;</code></h5><p><code>&lt;intent-filter&gt;</code>è¿™ä¸ªæ ‡ç­¾è¡¨ç¤ºintentè¿‡æ»¤å™¨ï¼Œè‡³äºintentæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¾…ä¼šå†è¯´ã€‚å…ˆæ¥çœ‹çœ‹å®ƒå£°æ˜äº†ä»€ä¹ˆç±»å‹çš„è¿‡æ»¤å™¨ã€‚<br>åœ¨<code>&lt;intent-filter&gt;</code>æ ‡ç­¾å†…ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜ä¸‰ç§æ ‡ç­¾ï¼Œåˆ†åˆ«æ˜¯:<code>&lt;action&gt;</code>ã€<code>&lt;category&gt;</code>å’Œ<code>&lt;data&gt;</code>ï¼Œè¿™ä¸‰ä¸ªæ ‡ç­¾éƒ½æ˜¯å¯ä»¥ä½œä¸ºæ´»åŠ¨çš„è¿‡æ»¤å™¨ã€‚è¿™é‡Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª<code>&lt;action&gt;</code>ï¼š<code>android.intent.action.MAIN</code>å’Œä¸€ä¸ª<code>&lt;category&gt;</code>ï¼š<code>android.intent.category.LAUNCHER</code>ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯Android SDKæä¾›ç»™æˆ‘ä»¬çš„ï¼Œå®ƒè¡¨ç¤ºå½“å‰æ´»åŠ¨ä¸ºä¸»æ´»åŠ¨ï¼Œå¦ä¸€ä¸ªè¡¨ç¤ºå½“å‰æ´»åŠ¨ä¸ºå¯åŠ¨æ´»åŠ¨ï¼Œæ³¨æ„ç€ä¸¤ç§ç±»å‹çš„è¿‡æ»¤å™¨å¿…é¡»æ”¾åœ¨ä¸€èµ·ï¼Œä¸è®©è¿è¡Œä¸èµ·æ¥~ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å…¶ä»–è¿‡æ»¤å™¨çš„å€¼ï¼Œè¿™ä¸ªåœ¨æˆ‘ä»¬è¯´åˆ°éšå¼Intentæ—¶ä¼šè‡ªå®šä¹‰ã€‚</p>
<h3 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h3><p>Intentæ˜¯Androidç¨‹åºä¸­å„ç»„ä»¶ä¹‹é—´è¿›è¡Œäº¤äº’çš„ä¸€ç§é‡è¦æ–¹å¼ï¼Œå®ƒä¸ä»…å¯ä»¥æŒ‡æ˜å½“å‰ç»„ä»¶æƒ³è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œè¿˜å¯ä»¥åœ¨ä¸åŒç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®ã€‚Intentä¸€èˆ¬å¯è¢«ç”¨äºå¯åŠ¨æ´»åŠ¨ï¼Œå¯åŠ¨æœåŠ¡ä»¥åŠå‘é€å¹¿æ’­ç­‰åœºæ™¯ï¼Œå½“å‰æˆ‘ä»¬ä¸»è¦è®²è§£Activity,æ‰€ä»¥æˆ‘ä»¬ä¸»è¦çœ‹Intentåœ¨æ´»åŠ¨ä¸­çš„åº”ç”¨ã€‚</p>
<p>Intentå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š<strong>æ˜¾å¼Intent</strong>å’Œ<strong>éšå¼Intent</strong>ã€‚</p>
<p>ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº†ï¼Œå¦‚æœä¸€ä¸ªActivityæƒ³è¦ä½œä¸ºç¨‹åºå¯åŠ¨æ—¶çš„ä¸»Activityï¼Œå¿…é¡»å£°æ˜å£°æ˜<code>&lt;intent-filter&gt;</code>æ ‡ç­¾ï¼Œè€Œä¸”å¿…é¡»åœ¨æ­¤æ ‡ç­¾ä¸‹å£°æ˜ä¸¤ä¸ªå€¼ä¸ºå›ºå®šå€¼çš„<code>&lt;action&gt;</code>å’Œ<code>&lt;category&gt;</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„ç¨‹åºä¸å¯èƒ½åªæœ‰ä¸€ä¸ªæ´»åŠ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å†å¼€å¯ä¸€ä¸ªæ´»åŠ¨æ—¶ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<h5 id="æ˜¾å¼Intent"><a href="#æ˜¾å¼Intent" class="headerlink" title="æ˜¾å¼Intent"></a>æ˜¾å¼Intent</h5><p>å¼€å¯å¦ä¸€ä¸ªActivityçš„æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨æ˜¾å¼Intentï¼Œæˆ‘æœ¬äººæ²¡æœ‰å¼€å‘è¿‡Androidï¼Œä¹Ÿä¸çŸ¥é“è¿™ç§æ–¹å¼åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨ç‡ï¼Œä½†æˆ‘æ„Ÿè§‰å®ƒçš„ä½¿ç”¨ç‡åº”è¯¥ä¸ä½ï¼Œå› ä¸ºå®ƒå¤ªç®€å•äº†ã€‚</p>
<p>ä¾‹å¦‚æˆ‘åˆæ–°å»ºäº†ä¸€ä¸ªAvtivity(SecondActivity)ï¼Œç³»ç»Ÿé»˜è®¤ä¸ºæˆ‘ä»¬åœ¨<code>AndroidManifest.xml</code>ä¸­æ³¨å†Œï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">          <span class="attr">package</span>=<span class="string">"com.guiyongdong.activitydemo"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></div><div class="line">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">        </div><div class="line">        <span class="comment">&lt;!--MainActivity--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">        </div><div class="line">        <span class="comment">&lt;!--SecondActivity--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".SecondActivity"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œè¿™æ—¶å€™æˆ‘å¯ä»¥åœ¨<code>SecondActivity</code>çš„æ ‡ç­¾ä¸‹å£°æ˜ä»»ä½•çš„filteræ ‡ç­¾ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä¸éœ€è¦å£°æ˜ï¼Œå› ä¸ºæˆ‘ç°åœ¨ä½¿ç”¨çš„æ˜¯æ˜¾å¼Intentã€‚æˆ‘ä»¬åœ¨<code>MainActivity</code>çš„å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œå¹¶ä¸”æ·»åŠ æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œäº‹ä»¶æ˜¯å»æ‰“å¼€<code>SecondActivity</code>æ´»åŠ¨ï¼Œè‡³äºå¦‚ä½•å¸ƒå±€ï¼Œä»¥åå†è¯´ã€‚ ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        </div><div class="line">        Button button = (Button) findViewById(R.id.button);</div><div class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()&#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">            		<span class="comment">//æ˜¾å¼å¯åŠ¨SecondActivity</span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,SecondActivity.class);</div><div class="line">                startActivity(intent);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è‡³äºä¸ºä½•è¿™ä¹ˆå†™ï¼Œåˆšå¼€å§‹æˆ‘ä¹Ÿä¸æ˜ç™½ï¼Œå¥½åœ¨æˆ‘æœ‰ä¸€ç‚¹javaåŸºç¡€ï¼Œè¿™é‡Œå¥‰åŠæƒ³å­¦ä¹ Androidçš„åŒå­¦ï¼Œå¿…é¡»æ‰“å¥½javaåŸºç¡€ã€‚</p>
<p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨Intentçš„æ„é€ å‡½æ•°ä¸­ä¼ äº†ä¸¤ä¸ªå€¼ï¼Œä¸€ä¸ªæ˜¯<code>MainActivity.this</code>ï¼Œä¸€ä¸ªæ˜¯<code>SecondActivity.class</code>ï¼Œå®ƒçš„æ„é€ å‡½æ•°ä¸º:<code>Intent(Context context, Class&lt;?&gt; cls)</code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨ç¤ºå¯åŠ¨æ´»åŠ¨çš„ä¸Šä¸‹æ–‡ï¼Œç¬¬äºŒä¸ªå‚æ•°Classè¡¨ç¤ºæŒ‡å®šæƒ³è¦å¯åŠ¨çš„ç›®æ ‡æ´»åŠ¨ï¼Œé€šè¿‡è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½æ„å»ºå‡ºIntentçš„<code>æ„å›¾</code>ï¼ˆå°±æ˜¯æˆ‘è¦å»å¹²ä»€ä¹ˆï¼‰ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨<code>startActivity</code>æ–¹æ³•ï¼ŒæŠŠè¿™ä¸ªæ˜æ˜¾çš„æ„å›¾ä¼ é€’è¿‡å»å°±è¡Œäº†ã€‚</p>
<h5 id="éšå¼Intent"><a href="#éšå¼Intent" class="headerlink" title="éšå¼Intent"></a>éšå¼Intent</h5><p>ç›¸æ¯”äºæ˜¾å¼Intentï¼Œéšå¼Intentåˆ™å«è“„å¾ˆå¤šäº†ï¼Œå®ƒå¹¶ä¸æ˜ç¡®æŒ‡å‡ºæˆ‘ä»¬æƒ³è¦å¯åŠ¨å“ªä¸€ä¸ªæ´»åŠ¨ï¼Œè€Œæ˜¯æŒ‡å®šäº†ä¸€ç³»åˆ—æ›´ä¸ºæŠ½è±¡çš„<code>action</code>å’Œ<code>category</code>ç­‰ä¿¡æ¯ï¼Œè®©ç³»ç»Ÿå»åˆ†æè¿™ä¸ªIntentï¼Œå¹¶æ‰¾å‡ºåˆé€‚çš„æ´»åŠ¨å»å¯åŠ¨ã€‚</p>
<p>ä»€ä¹ˆå«åˆé€‚çš„æ´»åŠ¨ï¼Ÿæˆ‘ä»¬æ¥æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œç³»ç»Ÿä¸ºä»€ä¹ˆä¼šå¯åŠ¨<code>MainActivity</code>ä½œä¸ºç¨‹åºçš„ä¸»ç•Œé¢ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å£°æ˜äº†å¦‚ä¸‹ä»£ç :<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>åœ¨<code>&lt;action&gt;</code>æ ‡ç­¾ä¸­æˆ‘ä»¬æŒ‡æ˜äº†å½“å‰æ´»åŠ¨å¯ä»¥å“åº”<code>android.intent.action.MAIN</code>è¿™ä¸ªaction,è€Œ<code>&lt;category&gt;</code>æ ‡ç­¾åˆ™åŒ…å«äº†ä¸€äº›é™„åŠ ä¿¡æ¯ï¼ŒæŒ‡æ˜å½“å‰æ´»åŠ¨å¯ä»¥å“åº”<code>android.intent.category.LAUNCHER</code>è¿™ä¸ªcategoryï¼Œåªæœ‰è¿™ä¸¤ä¸ªé…ç½®åŒæ—¶åŒ¹é…ï¼Œè¿™ä¸ªæ´»åŠ¨æ‰æ˜¯åˆé€‚çš„æ´»åŠ¨ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬ä¸º<code>SecondActivity</code>æ·»åŠ å¦‚ä¸‹filterï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".SecondActivity"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.guiyongdong.activitydemo.second"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ç„¶åæˆ‘ä¿®æ”¹MainActivityä¸­æŒ‰é’®çš„ç‚¹å‡»æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Button button = (Button) findViewById(R.id.button);</div><div class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">    		<span class="comment">//éšå¼å¯åŠ¨Intent</span></div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="string">"com.guiyongdong.activitydemo.second"</span>);</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ç›´æ¥å°†actionçš„å­—ç¬¦ä¸²ä¼ äº†è¿‡å»ï¼Œè¡¨æ˜æƒ³è¦å¯åŠ¨èƒ½å“åº”<code>com.guiyongdong.activitydemo.second</code>è¿™ä¸ªactionçš„æ´»åŠ¨ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œåªæœ‰actionå’ŒcategoryåŒæ—¶åŒ¹é…æ‰èƒ½å“åº”ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šcategoryï¼Œé‚£æ˜¯å› ä¸º<code>android.intent.category.DEFAULT</code>æ˜¯ä¸€ç§é»˜è®¤çš„categoryï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨<code>startActivity</code>æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨çš„æ·»åŠ è¿™ä¸ªé»˜è®¤çš„categoryåˆ°Intentä¸­ã€‚</p>
<p>å½“ç„¶ï¼Œç°åœ¨æˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ ä»»æ„è‡ªå®šä¹‰çš„categoryï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".SecondActivity"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.guiyongdong.activitydemo.second"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"com.guiyongdong.category.my_second"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨MainActivityä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Button button = (Button) findViewById(R.id.button);</div><div class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="string">"com.guiyongdong.activitydemo.second"</span>);</div><div class="line">        intent.addCategory(<span class="string">"com.guiyongdong.category.my_second"</span>);</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä¾ç„¶èƒ½å¤Ÿå¯åŠ¨<code>SecondActivity</code>ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿè¯´åˆ°äº†<code>&lt;data&gt;</code>è¿™ä¸ªæ ‡ç­¾ï¼Œå®ƒç”¨äºæ›´ç²¾ç¡®åœ°æŒ‡å®šå½“å‰æ´»åŠ¨èƒ½å“åº”ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œ<code>&lt;data&gt;</code>æ ‡ç­¾ä¸­ä¸»è¦å¯ä»¥åŒ¹é…ä¸€ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>android:scheme ç”¨äºæŒ‡å®šæ•°æ®åè®®éƒ¨åˆ†ï¼Œå¦‚http</li>
<li>android:host ç”¨äºæŒ‡å®šæ•°æ®çš„ä¸»æœºåéƒ¨åˆ†ï¼Œå¦‚www.baidu.com</li>
<li>android:port ç”¨äºæŒ‡å®šæ•°æ®çš„ç«¯å£éƒ¨åˆ†</li>
<li>android:path ç”¨äºæŒ‡å®šä¸»æœºåå’Œç«¯å£ä¹‹åçš„éƒ¨åˆ†</li>
<li>android:mimeType ç”¨äºæŒ‡å®šå¯ä»¥å¤„ç†çš„æ•°æ®ç±»å‹</li>
</ul>
<p>è‡³äºè¯¦ç»†çš„è¯¥æ€ä¹ˆç”¨ï¼Œå¤§å®¶å¯ä»¥å»è¯•è¯•ã€‚è¿™é‡Œåˆ—ä¸€ä¸‹æ‰“ç”µè¯çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Button button = (Button) findViewById(R.id.button);</div><div class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_CALL);</div><div class="line">        intent.setData(Uri.parse(<span class="string">"tel:10086"</span>));</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œå‰ææ˜¯æˆ‘ä»¬åœ¨<code>AndroidManifest.xml</code>æ·»åŠ æ‰“ç”µè¯çš„æƒé™<br><code>&lt;uses-permission android:name=&quot;android.permission.CALL_PHONE&quot;/&gt;</code></p>
<h3 id="Activityç”Ÿå‘½å‘¨æœŸ"><a href="#Activityç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Activityç”Ÿå‘½å‘¨æœŸ"></a>Activityç”Ÿå‘½å‘¨æœŸ</h3><p>å½“æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæ–°çš„Activityçš„æ—¶å€™ï¼Œå®ƒè¦†ç›–åœ¨äº†åŸæ¥çš„Activityä¸Šï¼Œæˆ‘ä»¬æƒ³ä¸€æƒ³ï¼ŒAndroidæ˜¯é€šè¿‡ä¸Šé¢æ¥ç®¡ç†è¿™äº›Activityçš„å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œè¦è¯´æ˜ä¸€ç§æ•°æ®ç»“æ„ï¼šæ ˆï¼Œæ ˆæ˜¯ä¸€ç§å…ˆè¿›åå‡ºçš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å‘ç°ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»è¿”å›é”®æ—¶ï¼Œæœ€å…ˆæ¶ˆå¤±çš„æ´»åŠ¨æ˜¯æˆ‘ä»¬æœ€æ–°æ·»åŠ æ˜¾ç¤ºçš„æ´»åŠ¨ã€‚</p>
<p>Androidæ˜¯ä½¿ç”¨ä»»åŠ¡ï¼ˆTaskï¼‰æ¥ç®¡ç†æ´»åŠ¨çš„ï¼Œä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ç»„å­˜æ”¾åœ¨æ ˆé‡Œçš„æ´»åŠ¨çš„é›†åˆï¼Œè¿™ä¸ªæ ˆä¹Ÿè¢«ç§°ä¸ºè¿”å›æ ˆ(Back Stack)ã€‚</p>
<h5 id="æ´»åŠ¨çŠ¶æ€"><a href="#æ´»åŠ¨çŠ¶æ€" class="headerlink" title="æ´»åŠ¨çŠ¶æ€"></a>æ´»åŠ¨çŠ¶æ€</h5><ul>
<li><p>è¿è¡ŒçŠ¶æ€<br>  å½“ä¸€ä¸ªæ´»åŠ¨ä½äºè¿”å›æ ˆçš„æ ˆé¡¶æ—¶ï¼Œè¿™æ—¶æ´»åŠ¨å°±å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ç³»ç»Ÿæœ€ä¸æ„¿æ„å›æ”¶çš„å°±æ˜¯å¤„äºè¿è¡ŒçŠ¶æ€çš„æ´»åŠ¨ã€‚</p>
</li>
<li><p>æš‚åœçŠ¶æ€<br>  å½“ä¸€ä¸ªæ´»åŠ¨ä¸å†å¤„äºæ ˆé¡¶ä½ç½®ï¼Œä½†ä»æ˜¯å¯è§çš„ï¼Œè¿™æ—¶æ´»åŠ¨å°±è¿›å…¥äº†æš‚åœçŠ¶æ€ï¼Œå› ä¸ºæœ‰æ—¶å€™å¼€å¯ä¸€ä¸ªæ–°çš„æ´»åŠ¨ï¼Œè¿™ä¸ªæ´»åŠ¨å¹¶ä¸æ˜¯å æ»¡æ•´ä¸ªå±å¹•çš„ã€‚å¤„äºæš‚åœçŠ¶æ€çš„æ´»åŠ¨ä»ç„¶æ˜¯å®Œå…¨æ´»ç€çš„ï¼Œç³»ç»Ÿä¹Ÿä¸æ„¿æ„å»å›æ”¶è¿™ç§æ´»åŠ¨ï¼Œåªæœ‰åœ¨å†…å­˜æä½çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ‰ä¼šå»è€ƒè™‘å›æ”¶è¿™ç§æ´»åŠ¨ã€‚</p>
</li>
<li><p>åœæ­¢çŠ¶æ€<br>  å½“ä¸€ä¸ªæ´»åŠ¨ä¸å†å¤„äºæ ˆé¡¶ä½ç½®ï¼Œå¹¶ä¸”å®Œå…¨ä¸å¯è§æ—¶ï¼Œæ´»åŠ¨å°±è¿›å…¥äº†æš‚åœçŠ¶æ€ï¼Œç³»ç»Ÿä»ç„¶ä¼šä¸ºæ­¤æ´»åŠ¨ä¿å­˜ç›¸åº”çš„çŠ¶æ€å’Œæˆå‘˜å˜é‡ï¼Œä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯å®Œå…¨å¯é ï¼Œå½“å†…å­˜ä¸è¶³ï¼Œå¤„äºåœæ­¢çŠ¶æ€çš„æ´»åŠ¨æœ‰å¯èƒ½è¢«ç³»ç»Ÿå›æ”¶ã€‚</p>
</li>
<li><p>é”€æ¯çŠ¶æ€<br>  å½“ä¸€ä¸ªæ´»åŠ¨ä»è¿”å›æ ˆä¸­ç§»é™¤åå°±æˆäº†é”€æ¯çŠ¶æ€ã€‚ç³»ç»Ÿæœ€å€¾å‘äºå›æ”¶å¤„äºè¿™ç§çŠ¶æ€çš„æ´»åŠ¨ã€‚</p>
</li>
</ul>
<h5 id="æ´»åŠ¨çš„ç”Ÿå­˜æœŸ"><a href="#æ´»åŠ¨çš„ç”Ÿå­˜æœŸ" class="headerlink" title="æ´»åŠ¨çš„ç”Ÿå­˜æœŸ"></a>æ´»åŠ¨çš„ç”Ÿå­˜æœŸ</h5><p>Activityç±»ä¸­å®šä¹‰äº†7ä¸ªå›è°ƒæ–¹æ³•ï¼Œè¦†ç›–äº†æ´»åŠ¨ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸€ä¸ªç¯èŠ‚ã€‚</p>
<ul>
<li><p>onCreate()<br>  è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å·²ç»è§è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œæ¯ä¸ªæ´»åŠ¨ä¸­æˆ‘ä»¬éƒ½é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒä¼šåœ¨æ´»åŠ¨ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ã€‚æˆ‘ä»¬åº”è¯¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å®Œæˆæ´»åŠ¨çš„åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚åŠ è½½å¸ƒå±€ï¼Œç»‘å®šäº‹ä»¶ç­‰ã€‚</p>
</li>
<li><p>onStart()<br>  è¿™ä¸ªæ–¹æ³•åœ¨æ´»åŠ¨ç”±ä¸å¯è§å˜ä¸ºå¯è§çš„æ—¶å€™è°ƒç”¨ã€‚</p>
</li>
<li><p>onResume()<br>  è¿™ä¸ªæ–¹æ³•åœ¨æ´»åŠ¨å‡†å¤‡å¥½å–ç”¨æˆ·äº¤äº’çš„æ—¶å€™è°ƒç”¨ã€‚æ­¤æ—¶æ´»åŠ¨ä¸€å®šä½äºè¿”å›æ ˆçš„æ ˆé¡¶ï¼Œå¹¶ä¸”å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</p>
</li>
<li><p>onPause()<br>  è¿™ä¸ªæ–¹æ³•åœ¨ç³»ç»Ÿå‡†å¤‡å»å¯åŠ¨æˆ–è€…æ¢å¤å¦å¤–ä¸€ä¸ªæ´»åŠ¨çš„æ—¶å€™è°ƒç”¨ã€‚é€šå¸¸ä¼šåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¥–ä¸€äº›æ¶ˆè€—CPUçš„èµ„æºé‡Šæ”¾æ‰ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œé€Ÿåº¦ä¸€å®šè¦å¿«ï¼Œä¸ç„¶ä¼šå½±å“åˆ°æ–°çš„æ´»åŠ¨çš„ä½¿ç”¨ã€‚</p>
</li>
<li><p>onStop()<br>  è¿™ä¸ªæ–¹æ³•åœ¨æ´»åŠ¨å®Œå…¨ä¸å¯è§çš„æ—¶å€™è°ƒç”¨ã€‚å®ƒå’ŒonPause()æ–¹æ³•çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼Œå¦‚æœå¯åŠ¨çš„æ–°æ´»åŠ¨æ˜¯ä¸€ä¸ªå¯¹è¯æ¡†å¼çš„æ´»åŠ¨ï¼Œé‚£ä¹ˆOnPause()æ–¹æ³•ä¼šå¾—åˆ°æ‰§è¡Œï¼Œè€ŒonStop()æ–¹æ³•å¹¶ä¸ä¼šæ‰§è¡Œã€‚</p>
</li>
<li><p>onDestory()<br>  è¿™ä¸ªæ–¹æ³•åœ¨æ´»åŠ¨è¢«é”€æ¯ä¹‹å‰è°ƒç”¨ï¼Œä¹‹åæ´»åŠ¨çš„çŠ¶æ€å°†å˜ä¸ºé”€æ¯çŠ¶æ€ã€‚</p>
</li>
<li><p>onRestart()<br>  è¿™ä¸ªæ–¹æ³•åœ¨æ´»åŠ¨ç”±åœæ­¢çŠ¶æ€å˜ä¸ºè¿è¡ŒçŠ¶æ€ä¹‹å‰è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯æ´»åŠ¨è¢«é‡æ–°å¯åŠ¨äº†ã€‚</p>
</li>
</ul>
<p>çœ‹å®Œä»¥ä¸Šçš„7ä¸ªæ–¹æ³•ï¼ˆå‘ç°è¿™äº›æ–¹æ³•å’ŒiOSå¥½ç›¸ä¼¼å•Šï¼‰ï¼Œå¯ä»¥å°†æ´»åŠ¨åˆ†ä¸º3ç§ç”Ÿå­˜æœŸã€‚</p>
<ul>
<li><p>å®Œæ•´ç”Ÿå­˜æœŸã€‚æ´»åŠ¨åœ¨onCreate()æ–¹æ³•å’ŒonDestroy()æ–¹æ³•ä¹‹é—´æ‰€ç»å†çš„ï¼Œå°±æ˜¯å®Œæ•´ç”Ÿå­˜æœŸã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯åœ¨onCreate()ä¸­å®Œæˆå„ç§åˆå§‹åŒ–ï¼Œåœ¨onDestroy()ä¸­å®Œæˆé‡Šæ”¾å†…å­˜çš„æ“ä½œã€‚</p>
</li>
<li><p>å¯è§ç”Ÿå­˜æœŸã€‚æ´»åŠ¨åœ¨onStart()æ–¹æ³•å’ŒonStop()æ–¹æ³•ä¹‹é—´æ‰€ç»å†çš„ï¼Œå°±æ˜¯å¯è§ç”Ÿå­˜æœŸã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆç†çš„ç®¡ç†é‚£äº›å¯¹ç”¨æˆ·å¯è§çš„èµ„æºã€‚</p>
</li>
<li><p>å‰å°ç”Ÿå­˜æœŸã€‚æ´»åŠ¨åœ¨onResume()æ–¹æ³•å’ŒonPause()æ–¹æ³•ä¹‹é—´æ‰€ç»å†çš„å°±æ˜¯å‰å°ç”Ÿå­˜æœŸã€‚</p>
</li>
</ul>
<p>å¦‚å›¾ï¼Œå®Œæ•´çš„æè¿°äº†Activityçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android5.jpg?raw=true"><br></div>

<h3 id="æ´»åŠ¨çš„å¯åŠ¨æ¨¡å¼"><a href="#æ´»åŠ¨çš„å¯åŠ¨æ¨¡å¼" class="headerlink" title="æ´»åŠ¨çš„å¯åŠ¨æ¨¡å¼"></a>æ´»åŠ¨çš„å¯åŠ¨æ¨¡å¼</h3><p>æ´»åŠ¨çš„å¯åŠ¨æ¨¡å¼ä¸€å…±æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯standardã€singleTopã€singleTaskå’ŒsingleInstanceã€‚å¯ä»¥åœ¨<code>AndroidManifest.xml</code>é€šè¿‡ç»™<code>&lt;activity&gt;</code>æ ‡ç­¾æŒ‡å®š<code>android:launchMode</code>å±æ€§æ¥é€‰æ‹©å¯åŠ¨æ¨¡å¼ã€‚</p>
<h5 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h5><p>standardæ˜¯æ´»åŠ¨çš„é»˜è®¤å¯åŠ¨æ¨¡å¼ï¼Œæ¯å½“å¯åŠ¨ä¸€ä¸ªæ–°çš„æ´»åŠ¨ï¼Œå®ƒéƒ½ä¼šåœ¨è¿”å›æ ˆä¸­å¦‚æ ˆï¼Œæ¯æ¬¡å¯åŠ¨éƒ½ä¼šåˆ›å»ºè¯¥æ´»åŠ¨çš„ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</p>
<h5 id="singleTop"><a href="#singleTop" class="headerlink" title="singleTop"></a>singleTop</h5><p>åŠ å…¥æˆ‘ä»¬åœ¨<code>SecondActivity</code>æ´»åŠ¨ä¸­å†å¯åŠ¨ä¸€ä¸ª<code>SecondActivity</code>ï¼Œè¿™æ—¶å€™ç³»ç»Ÿæ˜¯ä¸ä¼šå†å»åˆ›å»ºä¸€ä¸ªæ–°çš„<code>SecondActivity</code>æ´»åŠ¨çš„ã€‚singleTopæ¨¡å¼ä¸‹ï¼Œå½“å¯åŠ¨æ´»åŠ¨æ—¶å¦‚æœå‘ç°è¿”å›æ ˆçš„æ ˆé¡¶å·²ç»æ˜¯è¯¥ç±»å‹çš„æ´»åŠ¨ï¼Œåˆ™è®¤ä¸ºå¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒï¼Œä¸ä¼šå†å»åˆ›å»ºæ–°çš„æ´»åŠ¨å®ä¾‹ã€‚</p>
<h5 id="singleTask"><a href="#singleTask" class="headerlink" title="singleTask"></a>singleTask</h5><p>ä½¿ç”¨singleTaskå¯ä»¥å¾ˆå¥½çš„è§£å†³é‡å¤åˆ›å»ºæ ˆé¡¶æ´»åŠ¨çš„é—®é¢˜ï¼Œæ¯æ¬¡å¯åŠ¨è¯¥æ´»åŠ¨æ—¶ç³»ç»Ÿé¦–å…ˆä¼šåœ¨è¿”å›æ ˆä¸­æ£€æŸ¥æ˜¯å¦æœ‰å­˜åœ¨è¯¥æ´»åŠ¨çš„å®ä¾‹ï¼Œå¦‚æœå‘ç°å·²ç»å­˜åœ¨åˆ™ç›´æ¥ä½¿ç”¨è¯¥å®ä¾‹ï¼Œå¹¶æŠŠè¿™ä¸ªæ´»åŠ¨ä¹‹ä¸Šçš„æ‰€æœ‰æ´»åŠ¨ç»Ÿç»Ÿå‡ºæ ˆï¼Œå¦‚æœæ²¡æœ‰å‘ç°ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ´»åŠ¨å®ä¾‹ã€‚</p>
<h5 id="singleInstance"><a href="#singleInstance" class="headerlink" title="singleInstance"></a>singleInstance</h5><p>singleInstanceä¸åŒäºä¸Šé¢çš„ä¸‰ç§æ¨¡å¼ï¼Œå®ƒè¡¨ç¤ºæ´»åŠ¨ä¼šå¯ç”¨ä¸€ä¸ªæ–°çš„è¿”å›æ ˆæ¥ç®¡ç†è¿™ä¸ªæ´»åŠ¨ï¼Œå› ä¸ºç¨‹åºä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªè¿”å›æ ˆã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å‡ ä¸ªç¨‹åºå…±äº«æŸä¸ªæ´»åŠ¨æ—¶ä¼šä½¿ç”¨åˆ°æ­¤æ¨¡å¼ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å…³äºActivityçš„çŸ¥è¯†è¿˜æœ‰å¾ˆå¤šï¼Œåªæœ‰åœ¨å¼€å‘ä¸­æ‰èƒ½é‡åˆ°å„ç§é—®é¢˜ï¼Œç»§ç»­å§ï¼Œéªšå¹´~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ¥è¯´ä¸€è¯´Androidå››å¤§ç»„ä»¶ä¹‹ä¸€çš„&lt;code&gt;Activity&lt;/code&gt;ï¼Œç±»ä¼¼äºiOSçš„&lt;code&gt;UIViewController&lt;/code&gt;ã€‚å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªAndroidé¡¹ç›®æ—¶ï¼ŒAndroid Studioé»˜è®¤ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸»æ´»åŠ¨:&lt;code&gt;MainActivity&lt;/code&gt;å’Œä¸€ä¸ªé»˜è®¤çš„ä¸»å¸ƒå±€:&lt;code&gt;activity_main.xml&lt;/code&gt;ã€‚ä¸€ä¸ªæ´»åŠ¨æƒ³è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå°±å¿…é¡»åœ¨&lt;code&gt;AndroidManifest.xml&lt;/code&gt;ä¸­æ³¨å†Œã€‚ä½†æ˜¯è¿™äº›å·¥ä½œéƒ½æœ‰IDEå¸®æˆ‘ä»¬è‡ªåŠ¨å®Œæˆäº†ã€‚æˆ‘ä»¬æ¥çœ‹&lt;code&gt;AndroidManifest.xml&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;manifest&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xmlns:android&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res/android&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;package&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;com.guiyongdong.activitydemo&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;application&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:allowBackup&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:label&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/app_name&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:roundIcon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher_round&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:supportsRtl&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:theme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@style/AppTheme&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;&amp;lt;!--MainActivity--&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;activity&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;.MainActivity&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;intent-filter&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.intent.action.MAIN&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;category&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.intent.category.LAUNCHER&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;intent-filter&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;activity&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;application&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;manifest&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Android" scheme="http://www.guiyongdong.com/categories/Android/"/>
    
    
      <category term="android" scheme="http://www.guiyongdong.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å¤©ä¸€Androidä¹‹Androidç³»ç»Ÿåˆçª¥</title>
    <link href="http://www.guiyongdong.com/2017/03/15/%E4%B8%80%E5%A4%A9%E4%B8%80Android%E4%B9%8BAndroid%E7%B3%BB%E7%BB%9F%E5%88%9D%E7%AA%A5/"/>
    <id>http://www.guiyongdong.com/2017/03/15/ä¸€å¤©ä¸€Androidä¹‹Androidç³»ç»Ÿåˆçª¥/</id>
    <published>2017-03-15T09:08:17.000Z</published>
    <updated>2017-03-17T09:35:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºå‰æ®µæ—¶é—´ä½¿ç”¨ReactNativeå¼€å‘è¿‡ä¸€ä¸ªé¡¹ç›®ï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨åˆ°å¤§é‡çš„éReactNativeæä¾›çš„ç»„ä»¶å’ŒåŠŸèƒ½ã€‚è¿™æ—¶å€™å°±å¿…é¡»å†™åŸç”Ÿæ¡¥æ¥ï¼ŒiOSè¿˜å¥½è¯´ï¼Œæ¯•ç«Ÿæ˜¯é è¿™ä¸ªåƒé¥­çš„ï¼Œå¯æ˜¯androidå°±æ‰è¥Ÿè§è‚˜äº†ã€‚ä¸ºäº†å‘å¤§å‰ç«¯çš„ç›®æ ‡æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘è®¡åˆ’å¼€å§‹å­¦ä¹ androidï¼Œä¸ºæœŸ6ä¸ªæœˆï¼Œæˆ‘çš„ç›®æ ‡æ˜¯6ä¸ªæœˆå†…èµ·ç è‡ªå·±å…¬å¸çš„androidé¡¹ç›®å¯ä»¥ä¸Šæ‰‹ï¼Œå½“ç„¶ï¼Œå¦‚æœæƒ³æˆä¸ºçœŸæ­£çš„androidå¼€å‘è€…ï¼Œå…‰é è¿™6ä¸ªæœˆæ˜¯ä¸è¡Œã€‚è¿˜éœ€è¦å¤§é‡çš„å®é™…é¡¹ç›®æ‰èƒ½é”»ç‚¼ã€‚</p>
<p>å€¼å¾—åº†å¹¸çš„æ˜¯æˆ‘åœ¨å¤§å­¦ä¸»æ”»çš„å°±æ˜¯java(å“ˆå“ˆï¼Œç°åœ¨ä¹ŸåŸºæœ¬ä¸Šå¿˜çš„å·®ä¸å¤šäº†)ã€‚ä¸ºäº†æ‰“å¥½åŸºç¡€ï¼Œæˆ‘ä¹°äº†ä¸¤æœ¬ä¹¦ï¼Œä¸€æœ¬æ˜¯ã€Šjavaç¼–ç¨‹æ€æƒ³ã€‹ï¼Œä¸€æœ¬æ˜¯äº¬ä¸œä¸Šé”€é‡å¾ˆå¥½çš„ã€Šç¬¬äºŒè¡Œä»£ç Androidã€‹ï¼Œå¸Œæœ›è¿™ä¸¤æœ¬ä¹¦èƒ½å¤Ÿå¸®åˆ°æˆ‘ã€‚å¦å¤–æˆ‘ä¹Ÿä¼šä¸“é—¨å¼€ä¸€ä¸ªä¸“æ ï¼Œè®²è§£æˆ‘å­¦ä¹ javaçš„è¿‡ç¨‹ã€‚å¯èƒ½åœ¨æ¥ä¸‹æ¥çš„åšå®¢ä¸­ï¼Œæˆ‘æ€»ç»“çš„éƒ½æ˜¯åŸºç¡€çŸ¥è¯†ï¼Œå¤§ç¥è«å˜²ç¬‘ã€‚</p>
<a id="more"></a>
<h3 id="Androidç³»ç»Ÿæ¶æ„"><a href="#Androidç³»ç»Ÿæ¶æ„" class="headerlink" title="Androidç³»ç»Ÿæ¶æ„"></a>Androidç³»ç»Ÿæ¶æ„</h3><p>Androidå¤§æ¦‚å¯ä»¥åˆ†ä¸ºå››å±‚æ¶æ„ï¼šLinuxå†…æ ¸å±‚ã€ç³»ç»Ÿè¿è¡Œåº“å±‚ã€åº”ç”¨æ¡†æ¶å±‚å’Œåº”ç”¨å±‚ã€‚</p>
<p><strong>Linuxå†…æ ¸å±‚</strong></p>
<p>Androidç³»ç»Ÿæ˜¯åŸºäºLinuxå†…æ ¸çš„ï¼Œè¿™ä¸€å±‚ä¸ºAndroidè®¾å¤‡çš„å„ç§ç¡¬ä»¶æä¾›äº†åº•å±‚çš„é©±åŠ¨ï¼Œå¦‚æ˜¾ç¤ºé©±åŠ¨ã€éŸ³é¢‘é©±åŠ¨ã€ç…§ç›¸æœºé©±åŠ¨ã€è“ç‰™é©±åŠ¨ã€Wi-Fié©±åŠ¨ã€ç”µæºç®¡ç†ç­‰ã€‚</p>
<p><strong>ç³»ç»Ÿè¿è¡Œæ—¶åº“å±‚</strong></p>
<p>è¿™ä¸€å±‚é€šè¿‡ä¸€äº›C/C++åº“æ¥ä¸ºAndroidç³»ç»Ÿæä¾›äº†ä¸»è¦çš„ç‰¹æ€§æ”¯æŒã€‚å¦‚SQLiteåº“æä¾›äº†æ•°æ®åº“çš„æ”¯æŒï¼ŒOpenGL|ESåº“æä¾›äº†3Dç»˜å›¾çš„æ”¯æŒï¼ŒWebkitåº“æä¾›äº†æµè§ˆå™¨å†…æ ¸çš„æ”¯æŒç­‰ã€‚</p>
<p>åŒæ ·åœ¨è¿™ä¸€å±‚è¿˜è¦Androidè¿è¡Œæ—¶åº“ï¼Œä¸»è¦æä¾›äº†ä¸€äº›æ ¸å¿ƒåº“ï¼Œèƒ½æ˜¯å¼€å‘è€…å¯ä»¥ä½¿ç”¨javaæ¥ç¼–å†™Androidåº”ç”¨ã€‚å¦å¤–ï¼ŒAndroidè¿è¡Œæ—¶åº“è¿˜åŒ…å«äº†Dalvikè™šæ‹Ÿæœºï¼ˆ5.0ç³»ç»Ÿä¹‹åæ”¹ä¸ºARTè¿è¡Œç¯å¢ƒï¼‰ï¼Œå®ƒèƒ½è®©æ¯ä¸€ä¸ªAndroidåº”ç”¨éƒ½èƒ½è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„Dalvikè™šæ‹Ÿæœºå®ä¾‹ã€‚</p>
<p><strong>åº”ç”¨æ¡†æ¶å±‚</strong></p>
<p>è¿™ä¸€å±‚ä¸»è¦æä¾›äº†æ„å»ºåº”ç”¨ç¨‹åºæ—¶å¯èƒ½ç”¨åˆ°çš„å„ç§APIï¼ŒAndroidè‡ªå¸¦çš„ä¸€äº›æ ¸å¿ƒåº”ç”¨å°±æ˜¯ä½¿ç”¨è¿™äº›APIå®Œæˆçš„ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯é€šè¿‡è¿™äº›APIæ¥å®Œæˆæˆ‘ä»¬çš„åº”ç”¨ã€‚</p>
<p><strong>åº”ç”¨å±‚</strong></p>
<p>æ™®é€šç”¨æˆ·ä¸»è¦å°±æ˜¯å’Œè¿™ä¸€å±‚æ‰“äº¤é“ï¼Œæˆ‘ä»¬è‡ªå·±å¼€å‘çš„åº”ç”¨éƒ½æ˜¯å±äºè¿™ä¸€å±‚çš„ï¼Œå½“ç„¶ï¼Œç³»ç»Ÿè‡ªå¸¦çš„åº”ç”¨ä¹Ÿæ˜¯è¿™ä¸€å±‚çš„ã€‚</p>
<p>ç³»ç»Ÿæ¶æ„å›¾ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android1.jpg?raw=true"><br></div>


<h3 id="Androidç‰ˆæœ¬"><a href="#Androidç‰ˆæœ¬" class="headerlink" title="Androidç‰ˆæœ¬"></a>Androidç‰ˆæœ¬</h3><p>å¯èƒ½ç°åœ¨åº”ç”¨æœ€ä½çš„é€‚é…éƒ½æ˜¯ä»4.0ç‰ˆæœ¬å¼€å§‹ï¼Œç›®å‰æœ€é«˜ç‰ˆæœ¬æ˜¯7.1.1ï¼Œè€Œä¸”è°·æ­Œå¯¹Androidç‰ˆæœ¬çš„å‘½åéƒ½æ˜¯ä»¥ç”œç‚¹å‘½åçš„ã€‚ä»€ä¹ˆç‰›è½§ç³–ã€æ£’æ£’ç³–ã€‚</p>
<h3 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h3><p>åœ¨æˆ‘æ²¡æ¥è§¦Androidä¹‹å‰ï¼Œæˆ‘çš„åŒå­¦éƒ½æ˜¯ä½¿ç”¨MyEclipseå¼€å‘çš„ï¼Œè‡³äºæ˜¯å¦‚ä½•å¼€å‘çš„ï¼Œæˆ‘ä¸çŸ¥é“ï¼Œå› ä¸ºå½“æˆ‘å¼€å§‹å­¦Androidçš„æ—¶å€™ï¼Œå·²ç»æ™®åŠäº†å¦ä¸€ä¸ªå¼€å‘å·¥å…·ï¼š<strong>Android Studio</strong>ã€‚å½“ç„¶ï¼Œåªæœ‰IDEæ˜¯ä¸è¡Œçš„ï¼Œè¿˜å¾—æœ‰<strong>JDK</strong>ã€<strong>Android SDK</strong>ã€‚</p>
<p>å¦‚æœä½¿ç”¨Android Studioï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨studioè‡ªå¸¦çš„å·¥å…·è¿›è¡Œä¸‹è½½å„ä¸ªç‰ˆæœ¬çš„SDKã€‚å¦‚å›¾ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android2.png?raw=true"><br></div>

<p>å½“ç„¶ï¼ŒSDKçš„ç›®å½•ä½ å¯ä»¥éšä¾¿é€‰ã€‚</p>
<h3 id="é¡¹ç›®ç›®å½•"><a href="#é¡¹ç›®ç›®å½•" class="headerlink" title="é¡¹ç›®ç›®å½•"></a>é¡¹ç›®ç›®å½•</h3><p>è‡³äºè¯¥å¦‚ä½•åˆ›å»ºé¡¹ç›®ï¼Œæˆ‘å°±ä¸è¯´äº†ã€‚åˆ›å»ºå®Œé¡¹ç›®ä»¥ååˆ‡æ¢åˆ°Projectæ¨¡å¼ä¸‹ï¼Œå°±æ˜¯é¡¹ç›®çš„çœŸå®ç›®å½•äº†ã€‚</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android3.png?raw=true"><br></div>

<p>ä¸‹é¢æ¥çœ‹çœ‹è¿™äº›ç›®å½•æˆ–è€…æ–‡ä»¶éƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼š</p>
<p><strong>.gradleå’Œ.idea</strong> </p>
<p>è¿™ä¸¤ä¸ªç›®å½•ä¸‹æ”¾ç½®çš„éƒ½æ˜¯Android Studioè‡ªåŠ¨ç”Ÿæˆçš„ä¸€äº›æ–‡ä»¶ï¼Œæˆ‘ä»¬æ— é¡»å…³å¿ƒï¼Œä¹Ÿä¸è¦å»ç¼–è¾‘ã€‚</p>
<p><strong>app</strong></p>
<p>è¿™ä¸ªç›®å½•æ‰æ˜¯æˆ‘ä»¬ä»¥åç»å¸¸ä½¿ç”¨å’Œç¼–è¾‘çš„ï¼Œä¸€ä¼šå†è¯´å®ƒã€‚</p>
<p><strong>build</strong></p>
<p>è¿™ä¸ªç›®å½•ä¹Ÿä¸éœ€è¦å…³å¿ƒï¼Œå®ƒä¸»è¦åŒ…å«äº†ä¸€äº›åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ã€‚</p>
<p><strong>gradle</strong></p>
<p>è¿™ä¸ªç›®å½•ä¸‹åŒ…å«äº†gradle wrapperçš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨gradle wrapperçš„æ–¹å¼ä¸éœ€è¦æå‰å°†gradleä¸‹è½½å¥½ï¼Œè€Œæ˜¯ä¼šè‡ªåŠ¨æ ¹æ®æœ¬åœ°çš„ç¼“å­˜æƒ…å†µå†³å®šæ˜¯å¦éœ€è¦è”ç½‘ä¸‹è½½gradleã€‚Android Studioé»˜è®¤æ²¡æœ‰å¯åŠ¨gradle wrapperçš„æ–¹å¼ï¼Œå¦‚æœéœ€è¦æ‰“å¼€ï¼Œå¯ä»¥ç‚¹å‡» File-&gt;Other Settings-&gt;Build,Execution,Deployment-&gt;Build Tools-&gt;Gradle è¿›è¡Œé…ç½®ã€‚</p>
<p><strong>.gitignore</strong></p>
<p>è®¾ç½®gitå¿½ç•¥å“ªäº›æ–‡ä»¶</p>
<p><strong>build.gradle</strong></p>
<p>è¿™ä¸ªæ–‡ä»¶æ—¶å…¨å±€çš„gradleæ„å»ºè„šæœ¬ï¼Œé€šå¸¸è¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯ä¸éœ€è¦ä¿®æ”¹çš„ï¼Œæˆ‘åªçŸ¥é“gradleæ˜¯æ„å»ºå·¥å…·ï¼Œè‡³äºgradleæ›´å¤šçš„ä¿¡æ¯ï¼Œæˆ‘è¿˜å¾—å†ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<p><strong>gradle.properties</strong></p>
<p>è¿™ä¸ªæ–‡ä»¶æ—¶å…¨å±€çš„gradleé…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œé…ç½®çš„å±æ€§å°†ä¼šå½±å“åˆ°é¡¹ç›®ä¸­æ‰€æœ‰çš„gradleç¼–è¯‘è„šæœ¬ã€‚</p>
<p><strong>gradlewå’Œgradlew.bat</strong></p>
<p>è¿™ä¸¤ä¸ªæ–‡ä»¶æ—¶ç”¨æ¥åœ¨å‘½ä»¤è¡Œç•Œé¢ä¸­æ‰§è¡Œgradleå‘½ä»¤çš„ï¼Œå…¶ä¸­gradlewæ˜¯åœ¨Linuxæˆ–Macç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œgradlew.batæ˜¯åœ¨Windowsç³»ç»Ÿä¸­ä½¿ç”¨çš„ã€‚</p>
<p><strong>ListViewDemo.iml</strong></p>
<p>è¿™ä¸ªæ–‡ä»¶çš„åå­—å’Œæˆ‘ä»¬çš„é¡¹ç›®åå­—æ˜¯ä¸€æ ·çš„ï¼Œä¸å›ºå®šã€‚ä¸€èˆ¬ä¸ç”¨åŠ¨ã€‚</p>
<p><strong>local.properties</strong></p>
<p>è¿™ä¸ªæ–‡ä»¶ç”¨äºæŒ‡å®šAndroid SDKè·¯å¾„ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸åŠ¨ï¼Œé™¤éä½ çš„SDKæœ¬åœ°è·¯å¾„æ”¹å˜äº†ã€‚</p>
<p><strong>settings.gradle</strong></p>
<p>è¿™ä¸ªæ–‡ä»¶ç”¨äºæŒ‡å®šé¡¹ç›®ä¸­æ‰€å¼•å…¥çš„æ¨¡å—ï¼Œå› ä¸ºå½“å‰é¡¹ç›®å°±ä¸€ä¸ªæ¨¡å—ï¼šappï¼Œåœ¨ä»¥åå¯èƒ½æˆ‘ä»¬è¿˜ä¼šå¼•å…¥å…¶ä»–æ¨¡å—ï¼Œä¸€èˆ¬IDEå¸®æˆ‘ä»¬è‡ªåŠ¨å¯¼å…¥ã€‚</p>
<h4 id="app"><a href="#app" class="headerlink" title="app"></a>app</h4><p>çœ‹äº†æ•´ä¸ªå·¥ç¨‹çš„ç›®å½•ï¼Œæ„Ÿè§‰æœ‰ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œå¥½å¤šéƒ½æ˜¯å’Œgradleæˆ–è€…é…ç½®æœ‰å…³ã€‚å…¶å®ï¼ŒçœŸæ­£éœ€è¦æˆ‘ä»¬å…³å¿ƒçš„åªæœ‰appè¿™ä¸ªç›®å½•ã€‚</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/android/android4.png?raw=true"><br></div>

<p><strong>build</strong></p>
<p>è¿™ä¸ªç›®å½•å’Œå¤–å±‚çš„buildç›®å½•ç±»ä¼¼ï¼Œä¸»è¦ä¹Ÿæ˜¯åŒ…å«äº†ä¸€äº›åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸è¿‡å®ƒé‡Œé¢çš„å†…å®¹æ›´å¤æ‚ï¼Œä¹Ÿä¸éœ€è¦ç®¡ã€‚</p>
<p><strong>libs</strong></p>
<p>å¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†ç¬¬ä¸‰æ–¹çš„jaråŒ…ï¼Œå°±éœ€è¦æŠŠè¿™äº›jaråŒ…éƒ½æ”¾åœ¨libså½•ä¸‹ï¼Œæ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹çš„jaråŒ…éƒ½ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æ„å»ºè·¯å¾„ä¸­å»ã€‚</p>
<p><strong>androidTest</strong></p>
<p>è¿™ä¸ªä¸€çœ‹å°±æ˜¯ç”¨æ¥ç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„ï¼Œä¸€äº›å°å…¬å¸å¯èƒ½ä¹Ÿä¸å†™æµ‹è¯•ä»£ç çš„ã€‚</p>
<p><strong>java</strong></p>
<p>æ¯«æ— ç–‘é—®ï¼Œjavaç›®å½•æ˜¯æ”¾ç½®æˆ‘ä»¬æ‰€æœ‰javaä»£ç çš„åœ°æ–¹ï¼Œä»¥åæ‰€æœ‰çš„ä»£ç éƒ½åœ¨é‡Œé¢ã€‚</p>
<p><strong>res</strong></p>
<p>è¿™ä¸ªç›®å½•ä¸‹çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œç®€å•æ‰€ï¼Œå°±æ˜¯æ”¾å„ç§èµ„æºçš„ï¼Œå›¾ç‰‡ï¼Œå¸ƒå±€ï¼Œå­—ç¬¦ä¸²ç­‰èµ„æºã€‚å›¾ç‰‡æ”¾åˆ°drawableæ–‡ä»¶ä¸‹ï¼Œå¸ƒå±€æ”¾ç½®layoutä¸‹ï¼Œå­—ç¬¦ä¸²æ”¾åœ¨valuesä¸‹ã€‚</p>
<p><strong>AndroidMainfest.xml</strong></p>
<p>è¿™ä¸ªæ–‡ä»¶å¾ˆé‡è¦ï¼Œæ˜¯æ•´ä¸ªAndroidçš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç¨‹åºä¸­ä½¿ç”¨åˆ°çš„æ‰€æœ‰å››å¤§ç»„ä»¶éƒ½éœ€è¦åœ¨è¿™ä¸ªæ–‡ä»¶æ³¨å†Œï¼Œå¦å¤–è¿˜æœ‰æƒé™å£°æ˜ç­‰ã€‚</p>
<p><strong>test</strong></p>
<p>å®ƒæ˜¯ç”¨æ¥ç¼–å†™Unit Testæµ‹è¯•ç”¨ä¾‹çš„ï¼Œæ˜¯å¯¹é¡¹ç›®è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¦ä¸€ç§æ–¹å¼ã€‚</p>
<p><strong>.gitignore</strong></p>
<p>å¿½ç•¥æ–‡ä»¶</p>
<p><strong>app.iml</strong></p>
<p>ä¸éœ€è¦å…³å¿ƒ</p>
<p><strong>build.gradle</strong></p>
<p>è¿™ä¸ªæ–‡ä»¶ä¹Ÿå¾ˆé‡è¦ï¼Œæ˜¯appæ¨¡å—çš„gradleæ„å»ºè„šæœ¬ï¼Œé‡Œé¢ä¼šæœ‰å¥½å¤šçš„é…ç½®ï¼Œä»¥åç ”ç©¶åˆ°äº†å†è¯´ã€‚</p>
<p><strong>proguard-rules.pro</strong></p>
<p>ä»£ç æ··æ·†è§„åˆ™ï¼Œä¸»è¦æ··æ·†ä»£ç ï¼Œæ”¾åœ¨äººå®¶ç ´è§£ä½ çš„é¡¹ç›®ã€‚</p>
<p>å¥½äº†ï¼Œ androidé¡¹ç›®çš„å¤§æ¦‚å·¥ç¨‹ç›®å½•å°±æ˜¯è¿™æ ·ï¼Œå…¶å®æˆ‘ä»¬ä¼šå‘ç°ï¼Œé‡è¦çš„æ²¡å‡ ä¸ªï¼Œè€Œä¸”é‡è¦çš„å¥½å¤šéƒ½å’Œgradleæœ‰å…³ï¼Œçœ‹æ¥çœŸå¾—å¥½å¥½ç ”ç©¶ä¸‹gradleæ˜¯ä»€ä¹ˆäº†ã€‚</p>
<h3 id="build-gradleæ–‡ä»¶"><a href="#build-gradleæ–‡ä»¶" class="headerlink" title="build.gradleæ–‡ä»¶"></a>build.gradleæ–‡ä»¶</h3><p>åœ¨æ•´ä¸ªé¡¹ç›®ä¸­ï¼Œä¸€å…±æœ‰è¿ä¸ªbuild.gradleæ–‡ä»¶ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æœ€å¤–å±‚çš„build.gradleæ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath <span class="string">'com.android.tools.build:gradle:2.3.0'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™äº›ä»£ç éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬å‘ç°åœ¨ä¸¤ä¸ªé—­åŒ…ä¸­éƒ½å£°æ˜äº†<code>jcenter()</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»£ç æ‰˜ç®¡ä»“åº“ï¼Œå¾ˆå¤šandroidå¼€æºé¡¹ç›®éƒ½ä¼šæ‰˜ç®¡åˆ°jcenterä¸Šã€‚åªè¦å£°æ˜å®ƒï¼Œå°±å¯ä»¥å¼•ç”¨jcenterä¸Šçš„æ‰˜ç®¡çš„é¡¹ç›®ã€‚</p>
<p>åœ¨<code>dependencies</code>é—­åŒ…ä¸­ï¼Œè¿˜å£°æ˜äº†<code>classpath</code>ï¼Œè¿™ä¸ªä¸»è¦æ˜¯å£°æ˜gradleæ’ä»¶çš„ï¼Œå› ä¸ºgradleä¸ä»…ä»…ä¸ºandroidå·¥ä½œï¼Œè¿˜ä¸ºjavaç­‰é¡¹ç›®å·¥ä½œï¼Œæ‰€æœ‰æˆ‘ä»¬è¦å£°æ˜ä½¿ç”¨å“ªä¸ªåŒ…ä¸­çš„gradleå·¥å…·ã€‚ä¾‹å¦‚æˆ‘ä»¬å£°æ˜äº†<code>com.android.tools.build:gradle:2.3.0</code>ï¼Œ2.3.0æ˜¯æ­¤æ’ä»¶çš„ç‰ˆæœ¬å·ã€‚</p>
<p>å†æ¥çœ‹çœ‹appä¸‹çš„<code>build.gradle</code>æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">25</span></div><div class="line">    buildToolsVersion <span class="string">"25.0.1"</span></div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId <span class="string">"com.guiyongdong.listviewdemo"</span></div><div class="line">        minSdkVersion <span class="number">15</span></div><div class="line">        targetSdkVersion <span class="number">25</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            <span class="function">minifyEnabled <span class="keyword">false</span></span></div><div class="line">            proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span>, 'proguard-rules.pro'</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    <span class="function">compile <span class="title">fileTree</span><span class="params">(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span></span></div><div class="line">    <span class="title">androidTestCompile</span><span class="params">(<span class="string">'com.android.support.test.espresso:espresso-core:2.2.2'</span>, &#123;</span></div><div class="line">        exclude group: <span class="string">'com.android.support'</span>, <span class="keyword">module</span>: <span class="string">'support-annotations'</span></div><div class="line">    &#125;)</div><div class="line">    compile 'com.android.support:appcompat-v7:25.0.1'</div><div class="line">    compile 'com.android.support.constraint:constraint-layout:1.0.0-beta4'</div><div class="line">    compile 'com.android.support:recyclerview-v7:25.0.1'</div><div class="line">    testCompile 'junit:junit:4.12'</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å’‹ä¸€çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶å¥½å¤æ‚å•Šï¼Œåˆ«æ€¥ï¼Œæˆ‘ä»¬ä¸€è¡Œä¸€è¡Œçš„çœ‹ã€‚</p>
<p><code>com.android.application</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¨¡å—ï¼Œ<code>com.android.library</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåº“æ¨¡å—ï¼Œä»–ä¿©æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼Œä¸€ä¸ªå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸€ä¸ªåªèƒ½ä½œä¸ºä»£ç åº“ä¾é™„äºåˆ«çš„åº”ç”¨ç¨‹åºæ¨¡å—æ¥è¿è¡Œã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªå¤§çš„androidé—­åŒ…ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒéƒ½ä»£è¡¨ä»€ä¹ˆã€‚</p>
<p><code>compileSdkVersion</code>: ç”¨äºæŒ‡å®šé¡¹ç›®çš„ç¼–è¯‘ç‰ˆæœ¬ï¼Œæˆ‘ä»¬è¿™é‡ŒæŒ‡å®š25ï¼Œè¡¨ç¤ºä½¿ç”¨Android 7.1.1æ¥ç¼–è¯‘ï¼Œå¦‚æœä½ ä¸çŸ¥é“å…·ä½“ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬æ¥ç¼–è¯‘ï¼Œä½ å¯ä»¥ç›´æ¥çœ‹æ­¤æ–‡ç« çš„ç¬¬ä¸€å¼ å›¾ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥åœ¨Android Studio-&gt;Preferences ç›´æ¥æœç´¢Android SDK æ¥æŸ¥çœ‹ç‰ˆæœ¬æƒ…å†µã€‚</p>
<p><code>buildToolsVersion</code>: ç”¨æ¥æŒ‡å®šé¡¹ç›®æ„å»ºå·¥å…·çš„ç‰ˆæœ¬ï¼Œå¦‚æœæœ‰æ–°ç‰ˆæœ¬æ—¶ï¼ŒAndroid Studioä¼šè¿›è¡Œæå‡ã€‚</p>
<p><code>applicationId</code>: å½“å‰é¡¹ç›®çš„åŒ…å</p>
<p><code>minSdkVersion</code>: æœ€ä½æ”¯æŒçš„Androidç³»ç»Ÿç‰ˆæœ¬</p>
<p><code>targetSdkVersion</code>: è¿™ä¸ªè¡¨ç¤ºä½ åœ¨è¯¥ç›®æ ‡ç‰ˆæœ¬ä¸Šå·²ç»åšè¿‡å……åˆ†çš„æµ‹è¯•ï¼Œç³»ç»Ÿå°†ä¼šä¸ºä½ çš„åº”ç”¨ç¨‹åºå¯ç”¨ä¸€äº›æœ€æ–°çš„åŠŸèƒ½å’Œç‰¹æ€§ï¼Œæ¯”å¦‚ä½ è®¾ç½®æˆ23æˆ–è€…æ›´é«˜ï¼Œç³»ç»Ÿä¼šä¸ºä½ çš„åº”ç”¨ç¨‹åºå¯ç”¨è¿è¡Œæ—¶æƒé™ï¼Œå¦‚æœä½ è®¾ç½®æˆ22ï¼Œé‚£ä¹ˆAndroid 6.0çš„åŠŸèƒ½ä½ å°±ç”¨ä¸äº†ã€‚</p>
<p><code>versionCode</code>: å½“å‰ç‰ˆæœ¬å·</p>
<p><code>versionName</code>: å½“å‰é¡¹ç›®çš„ç‰ˆæœ¬å </p>
<p><code>testInstrumentationRunner</code>: æµ‹è¯•çš„ä¸€äº›ä¸œè¥¿</p>
<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹<code>buildTypes</code>é—­åŒ…ï¼ŒbuildTypesé—­åŒ…ç”¨äºæŒ‡å®šç”Ÿæˆå®‰è£…æ–‡ä»¶çš„ç›¸å…³é…ç½®ï¼Œé€šå¸¸ä»–åŒ…å«ä¸¤ä¸ªå­åŒ…ï¼š<code>release</code>å’Œ<code>debug</code>ã€‚ä¸€ä¸ªè¡¨ç¤ºç”Ÿæˆç¯å¢ƒï¼Œä¸€ä¸ªè¡¨ç¤ºæµ‹è¯•ç¯å¢ƒï¼Œdebugé»˜è®¤å¯ä»¥ä¸å†™ã€‚æˆ‘ä»¬çœ‹çœ‹<code>release</code>åŒ…ä¸‹çš„å…·ä½“å†…å®¹</p>
<p><code>minifyEnabled</code>: ç”¨äºæŒ‡å®šæ˜¯å¦å¯¹ä»£ç è¿›è¡Œæ··æ·†<br><code>proguardFiles</code>: æ··æ·†æ—¶ä½¿ç”¨çš„æ–‡ä»¶</p>
<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹<code>dependencies</code>åŒ…ï¼Œå®ƒè¡¨ç¤ºå½“å‰é¡¹ç›®æ‰€æœ‰çš„ä¾èµ–å…³ç³»ï¼Œé€šå¸¸Android Studioé¡¹ç›®ä¸€å…±æœ‰3ç§ä¾èµ–æ–¹å¼ï¼š<strong>æœ¬åœ°ä¾èµ–</strong>ã€<strong>åº“ä¾èµ–</strong>ã€<strong>è¿œç¨‹ä¾èµ–</strong>ã€‚æœ¬åœ°ä¾èµ–å°±æ˜¯jaråŒ…ä¾èµ–ï¼Œåº“ä¾èµ–æ˜¯åœ¨é¡¹ç›®ä¸­æ·»åŠ æ¨¡å—ï¼Œè¿œç¨‹ä¾èµ–æ˜¯å¯¹jcenteråº“ä¸Šå¼€æºé¡¹ç›®çš„ä¾èµ–ã€‚</p>
<p><code>compile fileTree</code>: å®ƒå°±æ˜¯ä¸€ä¸ªæœ¬åœ°ä¾èµ–å£°æ˜ï¼Œè¡¨ç¤ºå°†libsç›®å½•ä¸‹çš„æ‰€æœ‰çš„.jaråç¼€çš„æ–‡ä»¶éƒ½æ·»åŠ åˆ°æ„å»ºè·¯å¾„ä¸­å»ã€‚</p>
<p><code>compile</code>: è¿™ä¸ªåˆ™æ˜¯è¿œç¨‹ä¾èµ–ï¼Œ</p>
<p>è¿˜æœ‰ä¸€ç§åº“ä¾èµ–ï¼Œå†™æ³•ä¸º<code>compile project(&#39;:helper&#39;)</code>ï¼Œå®ƒè¡¨ç¤ºæ·»åŠ ä¸€ä¸ªåå«helperåº“çš„ä¾èµ–ï¼Œå½“ç„¶ï¼Œå‰ææ˜¯è¿™ä¸ªåº“å·²ç»æ·»åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚</p>
<p>å…³äºbuild.gradleçš„é…ç½®è¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘æƒ³åœ¨ä»¥åé¡¹ç›®å¤æ‚äº†ï¼Œä¼šé‡åˆ°çš„ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”±äºå‰æ®µæ—¶é—´ä½¿ç”¨ReactNativeå¼€å‘è¿‡ä¸€ä¸ªé¡¹ç›®ï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨åˆ°å¤§é‡çš„éReactNativeæä¾›çš„ç»„ä»¶å’ŒåŠŸèƒ½ã€‚è¿™æ—¶å€™å°±å¿…é¡»å†™åŸç”Ÿæ¡¥æ¥ï¼ŒiOSè¿˜å¥½è¯´ï¼Œæ¯•ç«Ÿæ˜¯é è¿™ä¸ªåƒé¥­çš„ï¼Œå¯æ˜¯androidå°±æ‰è¥Ÿè§è‚˜äº†ã€‚ä¸ºäº†å‘å¤§å‰ç«¯çš„ç›®æ ‡æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘è®¡åˆ’å¼€å§‹å­¦ä¹ androidï¼Œä¸ºæœŸ6ä¸ªæœˆï¼Œæˆ‘çš„ç›®æ ‡æ˜¯6ä¸ªæœˆå†…èµ·ç è‡ªå·±å…¬å¸çš„androidé¡¹ç›®å¯ä»¥ä¸Šæ‰‹ï¼Œå½“ç„¶ï¼Œå¦‚æœæƒ³æˆä¸ºçœŸæ­£çš„androidå¼€å‘è€…ï¼Œå…‰é è¿™6ä¸ªæœˆæ˜¯ä¸è¡Œã€‚è¿˜éœ€è¦å¤§é‡çš„å®é™…é¡¹ç›®æ‰èƒ½é”»ç‚¼ã€‚&lt;/p&gt;
&lt;p&gt;å€¼å¾—åº†å¹¸çš„æ˜¯æˆ‘åœ¨å¤§å­¦ä¸»æ”»çš„å°±æ˜¯java(å“ˆå“ˆï¼Œç°åœ¨ä¹ŸåŸºæœ¬ä¸Šå¿˜çš„å·®ä¸å¤šäº†)ã€‚ä¸ºäº†æ‰“å¥½åŸºç¡€ï¼Œæˆ‘ä¹°äº†ä¸¤æœ¬ä¹¦ï¼Œä¸€æœ¬æ˜¯ã€Šjavaç¼–ç¨‹æ€æƒ³ã€‹ï¼Œä¸€æœ¬æ˜¯äº¬ä¸œä¸Šé”€é‡å¾ˆå¥½çš„ã€Šç¬¬äºŒè¡Œä»£ç Androidã€‹ï¼Œå¸Œæœ›è¿™ä¸¤æœ¬ä¹¦èƒ½å¤Ÿå¸®åˆ°æˆ‘ã€‚å¦å¤–æˆ‘ä¹Ÿä¼šä¸“é—¨å¼€ä¸€ä¸ªä¸“æ ï¼Œè®²è§£æˆ‘å­¦ä¹ javaçš„è¿‡ç¨‹ã€‚å¯èƒ½åœ¨æ¥ä¸‹æ¥çš„åšå®¢ä¸­ï¼Œæˆ‘æ€»ç»“çš„éƒ½æ˜¯åŸºç¡€çŸ¥è¯†ï¼Œå¤§ç¥è«å˜²ç¬‘ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://www.guiyongdong.com/categories/Android/"/>
    
    
      <category term="android" scheme="http://www.guiyongdong.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>è½¬åœºåŠ¨ç”»è¯¦è§£</title>
    <link href="http://www.guiyongdong.com/2017/03/06/%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB%E8%AF%A6%E8%A7%A3/"/>
    <id>http://www.guiyongdong.com/2017/03/06/è½¬åœºåŠ¨ç”»è¯¦è§£/</id>
    <published>2017-03-06T02:02:31.000Z</published>
    <updated>2017-03-09T07:02:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>iOSå¼€å‘ä¸­ï¼Œé¡µé¢ä¹‹é—´çš„è·³è½¬æ— å¤–ä¹ç”±<code>UINavigationController</code>ç®¡ç†çš„<code>push</code>æˆ–è€…<code>pop</code>æ“ä½œã€ä»¥åŠç”±<code>UIViewController</code>ç®¡ç†çš„<code>present</code>å’Œ<code>dismiss</code>æ“ä½œï¼Œæ— è®ºä½•ç§æ“ä½œï¼ŒiOSåŸç”Ÿç³»ç»Ÿéƒ½ä¸ºæˆ‘ä»¬æä¾›äº†é¡µé¢ä¹‹é—´çš„åŸºç¡€è·³è½¬åŠ¨ç”»ã€‚ä½†æ˜¯å¾€å¾€åœ¨å¼€å‘ä¸­ï¼Œç”±äºå„ç§åŠŸèƒ½éœ€æ±‚ï¼ŒiOSåŸç”Ÿç³»ç»Ÿæä¾›çš„è·³è½¬åŠ¨ç”»å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¥½åœ¨iOSæ—©å°±ç»™æˆ‘ä»¬æä¾›äº†ä¸€å¥—è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹è½¬åœºåŠ¨ç”»ã€‚åœ¨äº†è§£è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹iOSæä¾›çš„æ•´ä¸ªè½¬åœºæ¡†æ¶</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/transition.png?raw=true"><br></div>

<a id="more"></a>
<h2 id="present-dismiss"><a href="#present-dismiss" class="headerlink" title="present/dismiss"></a>present/dismiss</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹<code>æ¨¡æ€è·³è½¬</code>ã€‚å¼€å‘ä¸­ï¼Œå‡å¦‚åœ¨Aç•Œé¢éœ€è¦æ¨¡æ€è·³è½¬åˆ°Bç•Œé¢ï¼Œé€šå¸¸ä¼šè¿™ä¹ˆå†™ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    PresentBViewController *bVC = [[PresentBViewController alloc] init];</div><div class="line">    [<span class="keyword">self</span> presentViewController:bVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ¨¡æ€æ¶ˆå¤±å½“å‰ç•Œé¢åˆ™æ˜¯è¿™ä¹ˆå†™ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="UIViewControllerTransitioningDelegate"><a href="#UIViewControllerTransitioningDelegate" class="headerlink" title="UIViewControllerTransitioningDelegate"></a>UIViewControllerTransitioningDelegate</h4><p>ä½¿ç”¨æ¨¡æ€è·³è½¬æ—¶ï¼Œç³»ç»Ÿå·²ç»ä¸ºæˆ‘ä»¬å†™å¥½çš„è·³è½¬çš„åŠ¨ç”»ï¼Œè€Œè¦æƒ³è‡ªå®šä¹‰æ¨¡æ€è·³è½¬åŠ¨ç”»ï¼Œåˆ™éœ€è¦ä¸€ä¸ªå®ç°<code>UIViewControllerTransitioningDelegate</code>åè®®ã€å¹¶å®ç°åè®®éƒ¨åˆ†æ–¹æ³•çš„å¯¹è±¡ã€‚åœ¨<code>UIViewController.h</code>å¤´æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¦‚ä¸‹å®šä¹‰ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">UIViewControllerTransitioningDelegate</span>;</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIViewController</span>(<span class="title">UIViewControllerTransitioning</span>)</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerTransitioningDelegate</span>&gt; transitioningDelegate <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0);</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>å¦‚æ­¤ï¼Œæˆ‘ä»¬åˆ™éœ€è¦å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å®ç°<code>UIViewControllerTransitioningDelegate</code>åè®®æ–¹æ³•ï¼Œèµ‹å€¼ç»™å°†è¦æ¨¡æ€è·³è½¬çš„æ§åˆ¶å™¨(<code>PresentBViewController</code>)ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PresentAViewController</span> ()</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) PresentManager *presentManager;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PresentAViewController</span></span></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blueColor];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    PresentBViewController *bVC = [[PresentBViewController alloc] init];</div><div class="line">    <span class="keyword">self</span>.presentManager = [[PresentManager alloc] init];</div><div class="line">    bVC.transitioningDelegate = <span class="keyword">self</span>.presentManager;</div><div class="line">    [<span class="keyword">self</span> presentViewController:bVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>UIViewControllerTransitioningDelegate</code>æœ‰å“ªäº›åè®®æ–¹æ³•:<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//å½“ä½¿ç”¨æ¨¡æ€å¼¹å‡ºæ—¶ ä¼šè°ƒç”¨æ­¤æ–¹æ³• è¿”å›ä¸€ä¸ªå®ç° UIViewControllerAnimatedTransitioning åè®®çš„å¯¹è±¡ </span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForPresentedController:(<span class="built_in">UIViewController</span> *)presented</div><div class="line">                                                                            presentingController:(<span class="built_in">UIViewController</span> *)presenting</div><div class="line">                                                                                sourceController:(<span class="built_in">UIViewController</span> *)source;</div><div class="line"><span class="comment">//å½“ä½¿ç”¨æ¨¡æ€æ¶ˆå¤±æ—¶ ä¼šè°ƒç”¨æ­¤æ–¹æ³• è¿”å›ä¸€ä¸ªå®ç° UIViewControllerAnimatedTransitioning åè®®çš„å¯¹è±¡</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForDismissedController:(<span class="built_in">UIViewController</span> *)dismissed;</div><div class="line"><span class="comment">// å½“ä½¿ç”¨æ¨¡æ€å¼¹å‡ºæ—¶ ä¼šè°ƒç”¨æ­¤æ–¹æ³• è¿”å›ä¸€ä¸ªå®ç° UIViewControllerInteractiveTransitioningåè®®çš„å¯¹è±¡</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerInteractiveTransitioning</span>&gt;)interactionControllerForPresentation:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animator;</div><div class="line"><span class="comment">// å½“ä½¿ç”¨æ¨¡æ€æ¶ˆå¤±æ—¶ ä¼šè°ƒç”¨æ­¤æ–¹æ³• è¿”å›ä¸€ä¸ªå®ç° UIViewControllerInteractiveTransitioningåè®®çš„å¯¹è±¡</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerInteractiveTransitioning</span>&gt;)interactionControllerForDismissal:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animator;</div><div class="line"></div><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIPresentationController</span> *)presentationControllerForPresentedViewController:(<span class="built_in">UIViewController</span> *)presented</div><div class="line">                                                               presentingViewController:(<span class="keyword">nullable</span> <span class="built_in">UIViewController</span> *)presenting</div><div class="line">                                                                   sourceViewController:(<span class="built_in">UIViewController</span> *)source;</div></pre></td></tr></table></figure></p>
<p>å…ˆæ¥çœ‹è¿™ä¸¤ä¸ªä»£ç†æ–¹æ³•ï¼š<code>animationControllerForPresentedController:presentingController:sourceController:(UIViewController *)source</code>å’Œ<code>animationControllerForDismissedController:(UIViewController *)dismissed</code>ä»–ä»¬éƒ½è¿”å›äº†ä¸€ä¸ªå®ç°<code>UIViewControllerAnimatedTransitioning</code>åè®®çš„å¯¹è±¡ã€‚<code>UIViewControllerAnimatedTransitioning</code>åè®®çš„æ–¹æ³•å°±æ˜¯æˆ‘ä»¬å®ç°åŠ¨ç”»çš„åœ°æ–¹ã€‚å…³äºæ­¤åè®®æˆ‘ä»¬ç­‰ä¼šå†è¯´ã€‚</p>
<p>å†æ¥çœ‹å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•:<br><code>interactionControllerForPresentation:(id &lt;UIViewControllerAnimatedTransitioning&gt;)animator</code>å’Œ<code>interactionControllerForDismissal:(id &lt;UIViewControllerAnimatedTransitioning&gt;)animator</code>ï¼Œä»–ä»¬éƒ½è¿”å›äº†ä¸€ä¸ªå®ç°<code>UIViewControllerInteractiveTransitioning</code>åè®®çš„å¯¹è±¡ï¼Œè€Œæ­¤åè®®ä¸»è¦ç”¨äºäº¤äº’å¼è½¬åœºåŠ¨ç”»ã€‚å…³äºæ­¤åè®®æˆ‘ä»¬ç­‰ä¼šå†è¯´ã€‚</p>
<h2 id="push-pop"><a href="#push-pop" class="headerlink" title="push/pop"></a>push/pop</h2><p>åœ¨ä½¿ç”¨<code>UINavigationController</code>è¿›è¡Œé¡µé¢ä¹‹é—´çš„å¯¼èˆªç®¡ç†æ—¶ï¼Œç³»ç»Ÿä¹Ÿæ˜¯é»˜è®¤ä¸ºæˆ‘ä»¬å®ç°äº†<code>push</code>å’Œ<code>pop</code>åŠ¨ç”»çš„ï¼Œè€Œå¦‚æœæƒ³è‡ªå®šä¹‰<code>push/pop</code>åŠ¨ç”»ï¼Œåˆ™éœ€è¦ä¸€ä¸ªå®ç°<code>UINavigationControllerDelegate</code>åè®®çš„å¯¹è±¡ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PushAViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) PushManager *pushManager;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PushAViewController</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    PushBViewController *bVC = [[PushBViewController alloc] init];</div><div class="line">    <span class="keyword">self</span>.pushManager = [[PushManager alloc] init];</div><div class="line">    bVC.navigationController.delegate = <span class="keyword">self</span>.pushManager;</div><div class="line">    [<span class="keyword">self</span>.navigationController pushViewController:bVC animated:<span class="literal">YES</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<h4 id="UINavigationControllerDelegate"><a href="#UINavigationControllerDelegate" class="headerlink" title="UINavigationControllerDelegate"></a>UINavigationControllerDelegate</h4><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹<code>UINavigationControllerDelegate</code>åè®®çš„ç›¸å…³æ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//è¿”å›çœŸæ­£æ‰§è¡Œäº¤äº’å¼åŠ¨ç”»çš„å¯¹è±¡</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerInteractiveTransitioning</span>&gt;)navigationController:(<span class="built_in">UINavigationController</span> *)navigationController</div><div class="line">                                   interactionControllerForAnimationController:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;) animationController;</div><div class="line"></div><div class="line"><span class="comment">//è¿”å›ç”±è°å»æ‰§è¡ŒåŠ¨ç”»çš„å¯¹è±¡</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)navigationController:(<span class="built_in">UINavigationController</span> *)navigationController</div><div class="line">                                            animationControllerForOperation:(<span class="built_in">UINavigationControllerOperation</span>)operation</div><div class="line">                                                         fromViewController:(<span class="built_in">UIViewController</span> *)fromVC</div><div class="line">                                                           toViewController:(<span class="built_in">UIViewController</span> *)toVC;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä¼šå‘ç° æ­¤ä¸¤ç§æ–¹æ³•åˆ†åˆ«è¿”å›äº†å®ç°äº†<code>UIViewControllerInteractiveTransitioning</code>åè®®çš„å¯¹è±¡å’Œå®ç°äº†<code>UIViewControllerAnimatedTransitioning</code>åè®®çš„å¯¹è±¡ã€‚æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œæ— è®ºæ˜¯<code>push/pop</code>è¿˜æ˜¯<code>present/dismiss</code>çœŸæ­£çš„æ‰§è¡ŒåŠ¨ç”»éƒ½æ˜¯ä¸€ä¸ªå®ç°äº†<code>UIViewControllerAnimatedTransitioning</code>åè®®çš„å¯¹è±¡ï¼Œè€ŒçœŸæ­£æ‰§è¡Œäº¤äº’å¼åŠ¨ç”»çš„éƒ½æ˜¯ä¸€ä¸ªå®ç°äº†<code>UIViewControllerInteractiveTransitioning</code>åè®®çš„å¯¹è±¡ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘ä»¬å°±æ¥ç ”ç©¶ä¸€ä¸‹<code>UIViewControllerAnimatedTransitioning</code>å’Œ<code>UIViewControllerInteractiveTransitioning</code>åè®®</p>
<h2 id="UIViewControllerAnimatedTransitioning"><a href="#UIViewControllerAnimatedTransitioning" class="headerlink" title="UIViewControllerAnimatedTransitioning"></a>UIViewControllerAnimatedTransitioning</h2><p>å…ˆæ¥çœ‹æ­¤åè®®çš„æ–¹æ³•:<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//åŠ¨ç”»æ‰§è¡Œçš„æ—¶é—´</span></div><div class="line">- (<span class="built_in">NSTimeInterval</span>)transitionDuration:(<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext;</div><div class="line"><span class="comment">//æ‰§è¡ŒåŠ¨ç”»</span></div><div class="line">- (<span class="keyword">void</span>)animateTransition:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext;</div></pre></td></tr></table></figure></p>
<p>æ­¤åè®®çš„ä¸¤ä¸ªæ–¹æ³•å¿…é¡»å®ç°ã€‚<code>transitionDuration:</code>æ–¹æ³•è¿”å›åŠ¨ç”»æ‰§è¡Œçš„æ—¶é—´ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ‰§è¡Œ<code>present/dismiss</code>å’Œ<code>push/pop</code>åŠ¨ç”»çš„æ—¶é—´ä¸º0.5ç§’å·¦å³ã€‚<code>animateTransition</code>æ–¹æ³•å°±æ˜¯çœŸæ­£æ‰§è¡ŒåŠ¨ç”»çš„åœ°æ–¹ã€‚è¿™ä¸ªæ–¹æ³•ç³»ç»Ÿä¼šç»™æˆ‘ä»¬ä¼ è¿‡æ¥ä¸€ä¸ªå®ç°äº†<code>UIViewControllerContextTransitioning</code>åè®®çš„å¯¹è±¡ï¼ˆè½¬åœºä¸Šä¸‹æ–‡ï¼‰ï¼Œåœ¨æ‰§è¡ŒåŠ¨ç”»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹<code>UIViewControllerContextTransitioning</code>åè®®ã€‚</p>
<p>å…ˆæ¥çœ‹<code>UIViewControllerContextTransitioning</code>åè®®çš„å®šä¹‰<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ä¸Šä¸‹æ–‡çš„view å¯¹åšåŠ¨ç”»çš„viewéœ€è¦æ·»åŠ åˆ°æ­¤ä¸Šä¸‹æ–‡çš„viewä¸­</span></div><div class="line">- (<span class="built_in">UIView</span> *)containerView;</div><div class="line"><span class="comment">//æ˜¯å¦åŠ¨ç”»æ­£åœ¨è¿›è¡Œ</span></div><div class="line">- (<span class="built_in">BOOL</span>)isAnimated;</div><div class="line"><span class="comment">//æ˜¯å¦æ˜¯äº¤äº’å¼åŠ¨ç”»</span></div><div class="line">- (<span class="built_in">BOOL</span>)isInteractive; </div><div class="line"><span class="comment">//æ˜¯å¦å–æ¶ˆ</span></div><div class="line">- (<span class="built_in">BOOL</span>)transitionWasCancelled;</div><div class="line"><span class="comment">//è·å–å½“å‰æ¨¡æ€è·³è½¬çš„æ–¹å¼</span></div><div class="line">- (<span class="built_in">UIModalPresentationStyle</span>)presentationStyle;</div><div class="line"><span class="comment">//æ ¹æ®ç³»æ•°æ¥æ›´æ–°äº¤äº’å¼åŠ¨ç”» 0~1</span></div><div class="line">- (<span class="keyword">void</span>)updateInteractiveTransition:(<span class="built_in">CGFloat</span>)percentComplete;</div><div class="line"><span class="comment">//å®Œæˆäº¤äº’å¼åŠ¨ç”»</span></div><div class="line">- (<span class="keyword">void</span>)finishInteractiveTransition;</div><div class="line"><span class="comment">//å–æ¶ˆäº¤äº’å¼åŠ¨ç”»</span></div><div class="line">- (<span class="keyword">void</span>)cancelInteractiveTransition;</div><div class="line"><span class="comment">//iOS10æ–°åŠ å…¥çš„æ–¹æ³• æš‚åœäº¤äº’å¼åŠ¨ç”»</span></div><div class="line">- (<span class="keyword">void</span>)pauseInteractiveTransition <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">10</span>_0);</div><div class="line"><span class="comment">//å½“åŠ¨ç”»ç»“æŸæ—¶ è¦è°ƒç”¨æ­¤æ–¹æ³•å‘Šè¯‰ä¸Šä¸‹æ–‡</span></div><div class="line">- (<span class="keyword">void</span>)completeTransition:(<span class="built_in">BOOL</span>)didComplete;</div><div class="line"><span class="comment">//è·å–å½“å‰ä¸Šä¸‹æ–‡çš„æ§åˆ¶å™¨ï¼Œä½¿ç”¨UITransitionContextFromViewControllerKeyè·å–fromVC ä½¿ç”¨UITransitionContextToViewControllerKeyè·å–toVC</span></div><div class="line">- (<span class="keyword">nullable</span> __kindof <span class="built_in">UIViewController</span> *)viewControllerForKey:(<span class="built_in">UITransitionContextViewControllerKey</span>)key;</div><div class="line"><span class="comment">//iOS8ä¹‹åçš„æ–¹æ³• è¿”å›æ­¤ä¸Šä¸‹æ–‡æ§åˆ¶å™¨çš„view ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½ä¸ç›´æ¥ä½¿ç”¨controllerçš„viewå±æ€§ï¼Œå› ä¸ºæœ‰æ—¶å€™æˆ‘ä»¬ç›´æ¥ä½¿ç”¨controllerçš„viewå¹¶ä¸æ˜¯æˆ‘ä»¬çœŸæ­£è¦åšåŠ¨ç”»çš„viewã€‚æˆ‘ä»¬åº”è¯¥ç›´æ¥ä½¿ç”¨UITransitionContextFromViewKeyæ¥è·å–fromViewï¼Œä½¿ç”¨UITransitionContextToViewKeyæ¥è·å–toViewã€‚</span></div><div class="line">- (<span class="keyword">nullable</span> __kindof <span class="built_in">UIView</span> *)viewForKey:(<span class="built_in">UITransitionContextViewKey</span>)key <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">8</span>_0);</div><div class="line"><span class="comment">//ç›®æ ‡viewçš„transform</span></div><div class="line">- (<span class="built_in">CGAffineTransform</span>)targetTransform <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">8</span>_0);</div><div class="line"><span class="comment">//è¿”å›åˆå§‹ä½ç½®çš„frame å³fromViewçš„frame</span></div><div class="line">- (<span class="built_in">CGRect</span>)initialFrameForViewController:(<span class="built_in">UIViewController</span> *)vc;</div><div class="line"><span class="comment">//è¿”å›åŠ¨ç”»ç»“æŸä½ç½®çš„frame å³toViewå¾—frame</span></div><div class="line">- (<span class="built_in">CGRect</span>)finalFrameForViewController:(<span class="built_in">UIViewController</span> *)vc;</div></pre></td></tr></table></figure></p>
<p>äº†è§£å®Œ<code>UIViewControllerContextTransitioning</code>åè®®åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»äº†ã€‚</p>
<p>ç¬¬ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ç±»<code>PresentManager</code>å¹¶å®ç°äº†<code>UIViewControllerAnimatedTransitioning</code>å’Œ<code>UIViewControllerTransitioningDelegate</code>,æˆ‘ä»¬å…ˆæ¥çœ‹<code>UIViewControllerTransitioningDelegate</code>åè®®çš„å…·ä½“å®ç°</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForPresentedController:(<span class="built_in">UIViewController</span> *)presented</div><div class="line">                                                                            presentingController:(<span class="built_in">UIViewController</span> *)presenting</div><div class="line">                                                                                sourceController:(<span class="built_in">UIViewController</span> *)source &#123;</div><div class="line">    <span class="comment">//æ ‡è®°æ­¤åŠ¨ç”»ä¸ºPresent å¹¶ä½¿ç”¨è‡ªèº«ä¸ºåŠ¨ç”»çš„æœ€ç»ˆæ‰§è¡Œè€…</span></div><div class="line">    <span class="keyword">self</span>.transitionStyle = TransitionStylePresent;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForDismissedController:(<span class="built_in">UIViewController</span> *)dismissed &#123;</div><div class="line">    <span class="comment">//æ ‡è®°æ­¤åŠ¨ç”»ä¸ºDismiss å¹¶ä½¿ç”¨è‡ªèº«ä¸ºåŠ¨ç”»çš„æœ€ç»ˆæ‰§è¡Œè€…</span></div><div class="line">    <span class="keyword">self</span>.transitionStyle = TransitionStyleDismiss;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å†æ¥çœ‹çœ‹<code>UIViewControllerAnimatedTransitioning</code>åè®®çš„å…·ä½“å®ç°ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="built_in">NSTimeInterval</span>)transitionDuration:(<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext &#123;</div><div class="line">	<span class="comment">//è¿”å›åŠ¨ç”»çš„æ‰§è¡Œæ—¶é—´</span></div><div class="line">    <span class="keyword">return</span> <span class="number">1.0</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)animateTransition:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext &#123;</div><div class="line">    <span class="comment">//1. é¦–å…ˆè·å–ä¸Šä¸‹æ–‡çš„view</span></div><div class="line">    <span class="built_in">UIView</span>  *containerView = [transitionContext containerView];</div><div class="line">    <span class="keyword">if</span> (!containerView) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.transitionStyle == TransitionStylePresent) &#123;</div><div class="line">        <span class="comment">//present åŠ¨ç”»</span></div><div class="line">        </div><div class="line">        <span class="comment">//2. è·å– fromViewController å’Œ toViewController</span></div><div class="line">        <span class="built_in">UIViewController</span> *fromViewController = [transitionContext viewControllerForKey:<span class="built_in">UITransitionContextFromViewControllerKey</span>];</div><div class="line">        <span class="built_in">UIViewController</span> *toViewController = [transitionContext viewControllerForKey:<span class="built_in">UITransitionContextToViewControllerKey</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//3. è·å–fromViewå’ŒtoView</span></div><div class="line">        <span class="built_in">UIView</span> *fromView, *toView;</div><div class="line">        <span class="keyword">if</span> ([transitionContext respondsToSelector:<span class="keyword">@selector</span>(viewForKey:)]) &#123;</div><div class="line">            fromView = [transitionContext viewForKey:<span class="built_in">UITransitionContextFromViewKey</span>];</div><div class="line">            toView = [transitionContext viewForKey:<span class="built_in">UITransitionContextToViewKey</span>];</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            fromView = fromViewController.view;</div><div class="line">            toView = toViewController.view;</div><div class="line">        &#125;</div><div class="line">        fromView.frame = [transitionContext initialFrameForViewController:fromViewController];</div><div class="line">        toView.frame = [transitionContext finalFrameForViewController:toViewController];</div><div class="line">        </div><div class="line">        <span class="comment">//4. è®¾ç½®toViewåŠ¨ç”»åˆå§‹frame è¿™é‡Œ æ¨¡ä»¿ä¸€ä¸‹ä»å±å¹•å·¦è¾¹æ¨¡æ€è·³è½¬</span></div><div class="line">        toView.frame = <span class="built_in">CGRectMake</span>(-toView.frame.size.width, toView.frame.origin.y, toView.frame.size.width, toView.frame.size.height);</div><div class="line">        </div><div class="line">        <span class="comment">//5. æ·»åŠ åˆ°ä¸Šä¸‹æ–‡çš„viewä¸Š</span></div><div class="line">        [containerView addSubview:fromView];</div><div class="line">        [containerView addSubview:toView];</div><div class="line">        </div><div class="line">        <span class="comment">//6. æ‰§è¡ŒåŠ¨ç”»</span></div><div class="line">        [<span class="built_in">UIView</span> animateWithDuration:[<span class="keyword">self</span> transitionDuration:transitionContext] animations:^&#123;</div><div class="line">            toView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, toView.frame.origin.y, toView.frame.size.width, toView.frame.size.height);</div><div class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</div><div class="line">            <span class="comment">//7. ä¸€å®šè¦å‘Šè¯‰ä¸Šä¸‹æ–‡ åŠ¨ç”»æ‰§è¡Œç»“æŸ</span></div><div class="line">            [transitionContext completeTransition:![transitionContext transitionWasCancelled]];</div><div class="line">        &#125;];</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// popåŠ¨ç”»</span></div><div class="line">        <span class="comment">//2. è·å– fromViewController å’Œ toViewController</span></div><div class="line">        <span class="built_in">UIViewController</span> *fromViewController = [transitionContext viewControllerForKey:<span class="built_in">UITransitionContextFromViewControllerKey</span>];</div><div class="line">        <span class="built_in">UIViewController</span> *toViewController = [transitionContext viewControllerForKey:<span class="built_in">UITransitionContextToViewControllerKey</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//3. è·å–fromViewå’ŒtoView</span></div><div class="line">        <span class="built_in">UIView</span> *fromView, *toView;</div><div class="line">        <span class="keyword">if</span> ([transitionContext respondsToSelector:<span class="keyword">@selector</span>(viewForKey:)]) &#123;</div><div class="line">            fromView = [transitionContext viewForKey:<span class="built_in">UITransitionContextFromViewKey</span>];</div><div class="line">            toView = [transitionContext viewForKey:<span class="built_in">UITransitionContextToViewKey</span>];</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            fromView = fromViewController.view;</div><div class="line">            toView = toViewController.view;</div><div class="line">        &#125;</div><div class="line">        fromView.frame = [transitionContext initialFrameForViewController:fromViewController];</div><div class="line">        toView.frame = [transitionContext finalFrameForViewController:toViewController];</div><div class="line">        </div><div class="line">        <span class="comment">//4. æ·»åŠ åˆ°ä¸Šä¸‹æ–‡çš„viewä¸Š</span></div><div class="line">        [containerView addSubview:toView];</div><div class="line">        [containerView addSubview:fromView];</div><div class="line">        </div><div class="line">        <span class="comment">//5. æ‰§è¡ŒåŠ¨ç”»</span></div><div class="line">        [<span class="built_in">UIView</span> animateWithDuration:[<span class="keyword">self</span> transitionDuration:transitionContext] animations:^&#123;</div><div class="line">            fromView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, -fromView.frame.size.height, fromView.frame.size.width, fromView.frame.size.height);</div><div class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</div><div class="line">            <span class="comment">//7. ä¸€å®šè¦å‘Šè¯‰ä¸Šä¸‹æ–‡ åŠ¨ç”»æ‰§è¡Œç»“æŸ</span></div><div class="line">            [transitionContext completeTransition:![transitionContext transitionWasCancelled]];</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘è¿™é‡Œåªæ˜¯åšä¸€ä¸ªç®€å•çš„åŠ¨ç”»ï¼Œè‡³äºè¯¥å¦‚ä½•åšæ›´å¤æ‚çš„åŠ¨ç”»ï¼Œé‚£å°±å¼€åŠ¨å¤§å®¶çš„å¤§è„‘å§ã€‚</p>
<p>åŒæ ·çš„ï¼Œè‡ªå®šä¹‰<code>push/pop</code>åŠ¨ç”»ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¿™é‡Œä¸å†è¯¦è§£ã€‚</p>
<h2 id="äº¤äº’å¼åŠ¨ç”»"><a href="#äº¤äº’å¼åŠ¨ç”»" class="headerlink" title="äº¤äº’å¼åŠ¨ç”»"></a>äº¤äº’å¼åŠ¨ç”»</h2><p>åœ¨å‰é¢ï¼Œæˆ‘ä»¬ä¸€ç›´æåˆ°ä¸€ä¸ªåè®®<code>UIViewControllerInteractiveTransitioning</code>ï¼Œå®ç°æ­¤åè®®ï¼Œæˆ‘ä»¬å°±èƒ½ä½¿ç”¨äº¤äº’å¼è½¬åœºåŠ¨ç”»ã€‚iOS7ä¸ºæˆ‘ä»¬æä¾›äº†å·²ç»å®ç°å¥½æ­¤åè®®çš„ç±»<code>UIPercentDrivenInteractiveTransition</code>ï¼Œæˆ‘ä»¬åªéœ€ç»§æ‰¿æ­¤ç±»ï¼Œä¾¿å¯å®ç°äº¤äº’å¼åŠ¨ç”»ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œä¸‹é¢çš„ä¾‹å­ä¾æ—§åœ¨<code>present/dismiss</code>è½¬åœºåŸºç¡€ä¸Šè®²è§£ï¼Œæˆ‘ä»¬è®©<code>PresentManager</code>ç»§æ‰¿<code>UIPercentDrivenInteractiveTransition</code>ï¼Œå¹¶ä¸”åœ¨<code>PresentBViewController</code>ä¸Šæ·»åŠ <code>pan</code>æ‰‹åŠ¿ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//è¿™é‡Œä¸ºäº†æ–¹ä¾¿  å½“Aæ§åˆ¶å™¨present Bæ§åˆ¶å™¨çš„æ—¶å€™ ç›´æ¥åœ¨Bæ§åˆ¶å™¨ä¸Šæ·»åŠ panæ‰‹åŠ¿ï¼Œå¹¶ä¸”å¼ºå¼•ç”¨Bæ§åˆ¶å™¨ã€‚</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForPresentedController:(<span class="built_in">UIViewController</span> *)presented</div><div class="line">                                                                            presentingController:(<span class="built_in">UIViewController</span> *)presenting</div><div class="line">                                                                                sourceController:(<span class="built_in">UIViewController</span> *)source &#123;</div><div class="line">    <span class="comment">//æ ‡è®°æ­¤åŠ¨ç”»ä¸ºPresent å¹¶ä½¿ç”¨è‡ªèº«ä¸ºåŠ¨ç”»çš„æœ€ç»ˆæ‰§è¡Œè€…</span></div><div class="line">    <span class="keyword">self</span>.transitionStyle = TransitionStylePresent;</div><div class="line">    <span class="comment">//æ·»åŠ æ‰‹åŠ¿</span></div><div class="line">    [<span class="keyword">self</span> addGesture:presented];</div><div class="line">    <span class="keyword">self</span>.presentingVC = presented;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//åœ¨ä»£ç†æ–¹æ³•ä¸­è¿”å›`PresentManager`è‡ªå·±ä½œä¸ºäº¤äº’å¼ä»£ç†</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerInteractiveTransitioning</span>&gt;)interactionControllerForDismissal:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animator &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.interacting) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//æ·»åŠ æ‰‹åŠ¿</span></div><div class="line">- (<span class="keyword">void</span>)addGesture:(<span class="built_in">UIViewController</span> *)viewController &#123;</div><div class="line">    <span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(panGesture:)];</div><div class="line">    [viewController.view addGestureRecognizer:pan];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//ç›‘å¬æ‰‹åŠ¿å˜åŒ–</span></div><div class="line">- (<span class="keyword">void</span>)panGesture:(<span class="built_in">UIPanGestureRecognizer</span> *)gesture &#123;</div><div class="line">    <span class="built_in">CGPoint</span> translation = [gesture translationInView:gesture.view];</div><div class="line">    <span class="keyword">switch</span> (gesture.state) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateBegan</span>:</div><div class="line">        		<span class="comment">//æ ‡è®°å½“å‰æ¨¡æ€æ¶ˆå¤±ä¸ºæ‰‹åŠ¿è°ƒç”¨</span></div><div class="line">            <span class="keyword">self</span>.interacting = <span class="literal">YES</span>;</div><div class="line">            [<span class="keyword">self</span>.presentingVC dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateChanged</span>: &#123;</div><div class="line">        		<span class="comment">//æ ¹æ®æ‰‹åŠ¿çš„æ»‘åŠ¨è·ç¦» æ›´æ–°çŠ¶æ€</span></div><div class="line">            <span class="built_in">CGFloat</span> fraction = translation.x / gesture.view.frame.size.width;</div><div class="line">            [<span class="keyword">self</span> updateInteractiveTransition:fraction];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateEnded</span>:</div><div class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateCancelled</span>: &#123;</div><div class="line">        		<span class="comment">//å¦‚æœåˆ’è¿‡50% dismissæ‰ å¦åˆ™æ¢å¤</span></div><div class="line">            <span class="keyword">self</span>.interacting = <span class="literal">NO</span>;</div><div class="line">            <span class="built_in">CGFloat</span> fraction = translation.x / gesture.view.frame.size.width;</div><div class="line">            <span class="keyword">if</span> (fraction&lt;<span class="number">0.5</span> || gesture.state == <span class="built_in">UIGestureRecognizerStateCancelled</span>) &#123;</div><div class="line">                [<span class="keyword">self</span> cancelInteractiveTransition];</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                [<span class="keyword">self</span> finishInteractiveTransition];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œ<code>push/pop</code>äº¦æ˜¯å¦‚æ­¤ã€‚</p>
<h2 id="UIPresentationController"><a href="#UIPresentationController" class="headerlink" title="UIPresentationController"></a>UIPresentationController</h2><p>åœ¨ç¬¬ä¸€èŠ‚ï¼Œæˆ‘ä»¬è¯´åˆ°<code>UIViewControllerTransitioningDelegate</code>åè®®çš„æ—¶å€™ï¼Œè¿˜æœ‰ä¸ªæ–¹æ³•æ²¡æœ‰è¯´ï¼Œå®ƒæ˜¯iOS8ä»¥åæ‰æœ‰çš„ï¼Œæ­¤æ–¹æ³•ä¸ºï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIPresentationController</span> *)presentationControllerForPresentedViewController:(<span class="built_in">UIViewController</span> *)presented</div><div class="line">                                                               presentingViewController:(<span class="keyword">nullable</span> <span class="built_in">UIViewController</span> *)presenting</div><div class="line">                                                                   sourceViewController:(<span class="built_in">UIViewController</span> *)source</div></pre></td></tr></table></figure></p>
<p>æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ª<code>UIPresentationController</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿ</p>
<p><code>UIViewController</code>æœ‰ä¸€ä¸ªå±æ€§<code>modalPresentationStyle</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæœ‰å“ªäº›å€¼ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">UIModalPresentationStyle</span>) &#123;</div><div class="line">        <span class="built_in">UIModalPresentationFullScreen</span> = <span class="number">0</span>,</div><div class="line">        <span class="built_in">UIModalPresentationPageSheet</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">3</span>_2) __TVOS_PROHIBITED,</div><div class="line">        <span class="built_in">UIModalPresentationFormSheet</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">3</span>_2) __TVOS_PROHIBITED,</div><div class="line">        <span class="built_in">UIModalPresentationCurrentContext</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">3</span>_2),</div><div class="line">        <span class="built_in">UIModalPresentationCustom</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">7</span>_0),</div><div class="line">        <span class="built_in">UIModalPresentationOverFullScreen</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">8</span>_0),</div><div class="line">        <span class="built_in">UIModalPresentationOverCurrentContext</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">8</span>_0),</div><div class="line">        <span class="built_in">UIModalPresentationPopover</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">8</span>_0) __TVOS_PROHIBITED,</div><div class="line">        <span class="built_in">UIModalPresentationNone</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">7</span>_0) = <span class="number">-1</span>,         </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å¹³å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯<code>UIModalPresentationCustom</code>ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨<code>UIModalPresentationCustom</code>ï¼Œé»˜è®¤çš„ç³»ç»Ÿä¼šåœ¨æˆ‘ä»¬è°ƒç”¨â€œä¸Šä¸‹æ–‡â€çš„<code>completeTransition</code>æ–¹æ³•åä¼šæŠŠfromVCç§»é™¤æ‰ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨<code>present/pop</code>æ‰§è¡ŒåŠ¨ç”»çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­ï¼Œä»»æ„çš„åœ¨ä¸Šä¸‹æ–‡ä¸­æ’å…¥è§†å›¾æˆ–è€…æ›´æ”¹æœ€ç»ˆè§†å›¾çš„å¤§å°ç­‰ï¼Œä½¿ç”¨<code>UIPresentationController</code>ä¾¿å¯å®ç°ã€‚æˆ‘ä»¬æ¥çœ‹<code>UIPresentationController</code>ç±»çš„å®šä¹‰ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ä¸Šä¸‹æ–‡çš„view</span></div><div class="line"><span class="keyword">@property</span>(<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *containerView;</div><div class="line"></div><div class="line"><span class="comment">//å³å°†å¸ƒå±€</span></div><div class="line">- (<span class="keyword">void</span>)containerViewWillLayoutSubviews;</div><div class="line"><span class="comment">//æ­£åœ¨å¸ƒå±€</span></div><div class="line">- (<span class="keyword">void</span>)containerViewDidLayoutSubviews;</div><div class="line"></div><div class="line"><span class="comment">//è¿”å›æ¨¡æ€è·³è½¬åçš„viewï¼ˆBæ§åˆ¶å™¨Viewï¼‰çš„æœ€ç»ˆframe  é€šå¸¸æƒ…å†µä¸‹è¦é‡å†™æ­¤æ–¹æ³•</span></div><div class="line">- (<span class="built_in">CGRect</span>)frameOfPresentedViewInContainerView;</div><div class="line"></div><div class="line"><span class="comment">//å‘¨æœŸæ–¹æ³•</span></div><div class="line">- (<span class="keyword">void</span>)presentationTransitionWillBegin;</div><div class="line">- (<span class="keyword">void</span>)presentationTransitionDidEnd:(<span class="built_in">BOOL</span>)completed;</div><div class="line">- (<span class="keyword">void</span>)dismissalTransitionWillBegin;</div><div class="line">- (<span class="keyword">void</span>)dismissalTransitionDidEnd:(<span class="built_in">BOOL</span>)completed;</div></pre></td></tr></table></figure></p>
<p>å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¾¿å¯åœ¨è§†å›¾å‘¨æœŸæ–¹æ³•ä¸­ä»»æ„çš„æ·»åŠ å’Œåˆ é™¤è§†å›¾ï¼Œä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä¹Ÿå¯ä»¥åœ¨å¸ƒå±€è¿‡ç¨‹ä¸­ï¼Œæ”¹å˜å¼¹å‡ºè§†å›¾çš„frameã€‚åˆ‡è®°ï¼Œè§†å›¾çš„æ·»åŠ å’Œåˆ é™¤éƒ½æ˜¯åœ¨ä¸Šä¸‹æ–‡çš„viewä¸­è¿›è¡Œçš„ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>äº†è§£å®Œæ•´ä¸ªè½¬åœºåŠ¨ç”»çš„æ¡†æ¶ï¼Œæˆ‘ä»¬åˆç†çš„ä½¿ç”¨æ¡†æ¶ä¸­çš„åè®®å’Œç±»ï¼Œä¾¿èƒ½å°½å¯èƒ½çš„æ»¡è¶³æˆ‘ä»¬çš„å¼€å‘éœ€æ±‚ã€‚è‡³äºè¯¥å¦‚ä½•å®ç°ï¼Œå¤§å®¶å¯ä»¥åŠ¨è„‘äº†~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;iOSå¼€å‘ä¸­ï¼Œé¡µé¢ä¹‹é—´çš„è·³è½¬æ— å¤–ä¹ç”±&lt;code&gt;UINavigationController&lt;/code&gt;ç®¡ç†çš„&lt;code&gt;push&lt;/code&gt;æˆ–è€…&lt;code&gt;pop&lt;/code&gt;æ“ä½œã€ä»¥åŠç”±&lt;code&gt;UIViewController&lt;/code&gt;ç®¡ç†çš„&lt;code&gt;present&lt;/code&gt;å’Œ&lt;code&gt;dismiss&lt;/code&gt;æ“ä½œï¼Œæ— è®ºä½•ç§æ“ä½œï¼ŒiOSåŸç”Ÿç³»ç»Ÿéƒ½ä¸ºæˆ‘ä»¬æä¾›äº†é¡µé¢ä¹‹é—´çš„åŸºç¡€è·³è½¬åŠ¨ç”»ã€‚ä½†æ˜¯å¾€å¾€åœ¨å¼€å‘ä¸­ï¼Œç”±äºå„ç§åŠŸèƒ½éœ€æ±‚ï¼ŒiOSåŸç”Ÿç³»ç»Ÿæä¾›çš„è·³è½¬åŠ¨ç”»å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¥½åœ¨iOSæ—©å°±ç»™æˆ‘ä»¬æä¾›äº†ä¸€å¥—è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹è½¬åœºåŠ¨ç”»ã€‚åœ¨äº†è§£è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹iOSæä¾›çš„æ•´ä¸ªè½¬åœºæ¡†æ¶&lt;/p&gt;
&lt;div align=center&gt;&lt;br&gt;&lt;img src=&quot;https://github.com/guiyongdong/Resource/blob/master/hexoImage/transition.png?raw=true&quot;/&gt;&lt;br&gt;&lt;/div&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="http://www.guiyongdong.com/categories/Objective-C/"/>
    
    
      <category term="åŠ¨ç”»" scheme="http://www.guiyongdong.com/tags/%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>AFNetworkingæºç è§£æ</title>
    <link href="http://www.guiyongdong.com/2017/02/15/AFNetworking%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>http://www.guiyongdong.com/2017/02/15/AFNetworkingæºç è§£æ/</id>
    <published>2017-02-15T06:15:04.000Z</published>
    <updated>2017-03-01T02:52:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘ç»œæ˜¯APPå¼€å‘ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé™¤éè¿™ä¸ªAPPæ˜¯æœ¬åœ°è‡ªç©ï¼Œå¦åˆ™å°±ç¦»ä¸å¼€ç½‘ç»œã€‚åœ¨iOSå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå»ä½¿ç”¨åˆ«äººé€ å¥½çš„è½®å­ï¼Œå…¶ä¸­æœ€æœ‰åä¹Ÿæœ€å¸¸ç”¨çš„é<code>AFNetworking</code>è«å±ã€‚è¿™ç¯‡æ–‡ç« å°±æ·±å…¥æ¢è®¨ä¸€ä¸‹<code>AFNetworking</code>æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><hr>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>AFNetworking</code>æ•´ä¸ªæ¶æ„ä½“ç³»ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/af2.png?raw=true"><br></div>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦äº†è§£ï¼š</p>
<ul>
<li>å¦‚ä½•ä½¿ç”¨NSURLSessionå‘å‡ºHTTPè¯·æ±‚</li>
<li>å¦‚ä½•ä½¿ç”¨AFNetworkingå‘å‡ºHTTPè¯·æ±‚</li>
</ul>
<a id="more"></a>
<h4 id="NSURLSession"><a href="#NSURLSession" class="headerlink" title="NSURLSession"></a>NSURLSession</h4><hr>
<p><code>NSURLSession</code>ä»¥åŠä¸å®ƒç›¸å…³çš„ç±»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸‹è½½å†…å®¹çš„APIï¼Œè¿™ä¸ªAPIæä¾›äº†ä¸€ç³»åˆ—çš„ä»£ç†æ–¹æ³•æ¥æ”¯æŒèº«ä»½è®¤è¯ï¼Œå¹¶ä¸”æ”¯æŒåå°ä¸‹è½½ã€‚</p>
<p>ä½¿ç”¨<code>NSURLSession</code>æ¥è¿è¡ŒHTTPè¯·æ±‚å¹¶ä¸”è·å¾—æ•°æ®æ€»å…±æœ‰äº”ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>å®ä¾‹åŒ–ä¸€ä¸ª<code>NSURLRequest/NSMutableURLRequest</code>,è®¾ç½®URL</li>
<li>é€šè¿‡<code>- shareSession</code>æ–¹æ³•è·å–<code>NSURLSession</code></li>
<li>åœ¨sessionä¸Šè°ƒç”¨<code>- dataTaskWithRequest:completionHandler:</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>NSURLSessionDataTask</code></li>
<li>è°ƒç”¨dataTaskçš„<code>- resume</code>,å¼€å§‹æ‰§è¡Œä»»åŠ¡</li>
<li>åœ¨completionHandlerä¸­å°†æ•°æ®ç¼–ç ï¼Œè¿”å›å­—ç¬¦ä¸²</li>
</ol>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSMutableURLRequest</span> *request = [[<span class="built_in">NSMutableURLRequest</span> alloc] initWithURL:[[<span class="built_in">NSURL</span> alloc] initWithString:<span class="string">@"https://github.com"</span>]];</div><div class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</div><div class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:request</div><div class="line">                                       completionHandler:^(<span class="built_in">NSData</span> * _Nullable data, <span class="built_in">NSURLResponse</span> * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</div><div class="line">                                           <span class="built_in">NSString</span> *dataStr = [[<span class="built_in">NSString</span> alloc] initWithData:data encoding:<span class="built_in">NSUTF8StringEncoding</span>];</div><div class="line">                                           <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, dataStr);</div><div class="line">                                       &#125;];</div><div class="line">[task resume];</div></pre></td></tr></table></figure>
<p>è¿™ä¸€æ®µä»£ç å¯ä»¥è¯´æ˜¯ä½¿ç”¨<code>NSURLSession</code>å‘é€è¯·æ±‚æœ€ç®€å•çš„ä¸€æ®µä»£ç äº†ï¼Œå½“ä½ è¿è¡Œè¿™æ®µä»£ç ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°githubé¦–é¡µçš„html</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang="en" class=""&gt;</div><div class="line">  &lt;head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"&gt;</div><div class="line">    &lt;meta charset='utf-8'&gt;</div><div class="line">        ...</div><div class="line">    &lt;/head&gt;</div><div class="line">    ...</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>æƒ³å¯¹<code>NSURLSession</code>æœ‰æ›´æ·±çš„äº†è§£ï¼Œ<a href="http://www.guiyongdong.com/2016/11/18/NSURLSession%E4%B8%8ENSURLConnection%E5%8C%BA%E5%88%AB/">è¯·ç‚¹è¿™é‡Œ</a></p>
<h4 id="AFNetworking"><a href="#AFNetworking" class="headerlink" title="AFNetworking"></a>AFNetworking</h4><hr>
<p>AFNetworkingçš„ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•çš„ï¼Œä½¿ç”¨å®ƒæ¥å‘é€HTTPè¯·æ±‚æœ‰ä¸¤ä¸ªæ­¥éª¤</p>
<ol>
<li>ä»¥æœåŠ¡å™¨çš„ä¸»æœºåœ°å€æˆ–è€…åŸŸåç”Ÿæˆä¸€ä¸ª<code>AFHTTPSessionManager</code>çš„å®ä¾‹</li>
<li>è°ƒç”¨<code>- GET:parameters:progress:success:failure:</code>æ–¹æ³•</li>
</ol>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">AFHTTPSessionManager *manager = [[AFHTTPSessionManager alloc] initWithBaseURL:[[<span class="built_in">NSURL</span> alloc] initWithString:<span class="string">@"hostname"</span>]];</div><div class="line">[manager GET:<span class="string">@"relative_url"</span> parameters:<span class="literal">nil</span> progress:<span class="literal">nil</span></div><div class="line">    success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span> ,responseObject);</div><div class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, error);</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨iOS9ä¸­ï¼Œè‹¹æœé»˜è®¤å…¨å±€HTTPSï¼Œå¦‚æœä½ è¦å‘é€ä¸å®‰å…¨çš„HTTPè¯·æ±‚ï¼Œéœ€è¦åœ¨info.plistä¸­åŠ å…¥å¦‚ä¸‹é”®å€¼å¯¹æ‰èƒ½å‘å‡ºä¸å®‰å…¨çš„HTTPè¯·æ±‚<br><span></span><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/af3.jpeg?raw=true"><br>è¿˜æœ‰ä¸€ä»¶äº‹æƒ…æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼ŒAFNetworkingé»˜è®¤æ¥æ”¶jsonæ ¼å¼çš„å“åº”ï¼ˆå› ä¸ºè¿™æ˜¯åœ¨iOSå¹³å°ä¸Šçš„æ¡†æ¶ï¼Œä¸€èˆ¬ä¸éœ€è¦text/htmlï¼‰,å¦‚æœæƒ³è¦è¿”å›html,éœ€è¦è®¾ç½®<code>acceptableContentTypes</code>ã€‚</p>
</blockquote>
<h4 id="AFNetworkingçš„è°ƒç”¨æ ˆ"><a href="#AFNetworkingçš„è°ƒç”¨æ ˆ" class="headerlink" title="AFNetworkingçš„è°ƒç”¨æ ˆ"></a>AFNetworkingçš„è°ƒç”¨æ ˆ</h4><hr>
<p>åˆšæ‰æˆ‘ä»¬å†™äº†ä¸€ä¸ªç®€å•çš„ç½‘ç»œè¯·æ±‚ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹<code>AFHTTPSessionManager</code>çš„åˆå§‹åŒ–æ–¹æ³•<code>- initWithBaseURL:</code>çš„è°ƒç”¨æ ˆï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- [AFHTTPSessionManager initWithBaseURL:]</div><div class="line">    - [AFHTTPSessionManager initWithBaseURL:sessionConfiguration:]</div><div class="line">        - [AFURLSessionManager initWithSessionConfiguration:]</div><div class="line">            - [<span class="built_in">NSURLSession</span> sessionWithConfiguration:delegate:delegateQueue:]</div><div class="line">            - [AFJSONResponseSerializer serializer] <span class="comment">// è´Ÿè´£åºåˆ—åŒ–å“åº”</span></div><div class="line">            - [AFSecurityPolicy defaultPolicy] <span class="comment">// è´Ÿè´£èº«ä»½è®¤è¯</span></div><div class="line">            - [AFNetworkReachabilityManager sharedManager] <span class="comment">// æŸ¥çœ‹ç½‘ç»œè¿æ¥æƒ…å†µ</span></div><div class="line">        - [AFHTTPRequestSerializer serializer] <span class="comment">// è´Ÿè´£åºåˆ—åŒ–è¯·æ±‚</span></div><div class="line">        - [AFJSONResponseSerializer serializer] <span class="comment">// è´Ÿè´£åºåˆ—åŒ–å“åº”</span></div></pre></td></tr></table></figure>
<p>ä»è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•çš„è°ƒç”¨æ ˆï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ¸…æ™°åœ°äº†è§£è¿™ä¸ªæ¶æ„çš„ç»“æ„ï¼š</p>
<ul>
<li>å…¶ä¸­<code>AFURLSessionManager</code>æ˜¯<code>AFHTTPSessionManager</code>çš„çˆ¶ç±»</li>
<li><code>AFURLSessionManager</code>è´Ÿè´£ç”Ÿæˆ<code>NSURLSession</code>çš„å®ä¾‹ï¼Œç®¡ç†<code>AFSecurityPolicy</code>å’Œ<code>AFNetworkReachabilityManager</code>,æ¥ä¿è¯è¯·æ±‚çš„å®‰å…¨å’ŒæŸ¥çœ‹ç½‘ç»œè¿æ¥æƒ…å†µï¼Œå®ƒæœ‰ä¸€ä¸ª<code>AFJSONResponseSerializer</code>çš„å®ä¾‹æ¥åºåˆ—åŒ–HTTPå“åº”</li>
<li><code>AFHTTPSessionManager</code>æœ‰ç€è‡ªå·±çš„<code>AFHTTPRequestSerialier</code>å’Œ<code>AFJSONResponseSerializer</code>æ¥ç®¡ç†è¯·æ±‚å’Œå“åº”çš„åºåˆ—åŒ–ï¼ŒåŒæ—¶ä¾èµ–çˆ¶ç±»æä¾›çš„æ¥å£ä¿è¯å®‰å…¨ã€ç›‘æ§ç½‘ç»œçŠ¶æ€ï¼Œå®ç°å‘å‡ºHTTPè¯·æ±‚è¿™ä¸€æ ¸å¿ƒåŠŸèƒ½</li>
</ul>
<p>åˆå§‹åŒ–æ–¹æ³•å¾ˆå¥½åœ°æ­ç¤ºäº†AFNetworkingæ•´ä¸ªæ¡†æ¶çš„æ¶æ„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦é€šè¿‡åˆ†æå¦ä¸€ä¸ªæ–¹æ³•<code>- GET:parameters:process:success:failure:</code>çš„è°ƒç”¨æ ˆï¼Œçœ‹ä¸€ä¸‹HTTPè¯·æ±‚æ˜¯å¦‚ä½•å‘å‡ºçš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- [AFHTTPSessionManager GET:parameters:process:success:failure:]</div><div class="line">    - [AFHTTPSessionManager dataTaskWithHTTPMethod:parameters:uploadProgress:downloadProgress:success:failure:] <span class="comment">// è¿”å› NSURLSessionDataTask #1</span></div><div class="line">        - [AFHTTPRequestSerializer requestWithMethod:URLString:parameters:error:] <span class="comment">// è¿”å› NSMutableURLRequest</span></div><div class="line">        - [AFURLSessionManager dataTaskWithRequest:uploadProgress:downloadProgress:completionHandler:] <span class="comment">// è¿”å› NSURLSessionDataTask #2</span></div><div class="line">            - [<span class="built_in">NSURLSession</span> dataTaskWithRequest:] <span class="comment">// è¿”å› NSURLSessionDataTask #3</span></div><div class="line">            - [AFURLSessionManager addDelegateForDataTask:uploadProgress:downloadProgress:completionHandler:]</div><div class="line">                - [AFURLSessionManagerTaskDelegate init]</div><div class="line">                - [AFURLSessionManager setDelegate:forTask:]</div><div class="line">    - [<span class="built_in">NSURLSessionDataTask</span> resume]</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œ <code>#1</code> <code>#2</code> <code>#3</code>å¤„è¿”å›çš„æ˜¯åŒä¸€ä¸ªdataTaskï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>#3</code>å‡ºè°ƒç”¨çš„æ–¹æ³•<code>- [NSURLSession dataTaskWithRequest:]</code>å’Œåªä½¿ç”¨<code>NSURLSession</code>å‘å‡ºHTTPè¯·æ±‚æ—¶è°ƒç”¨çš„æ–¹æ³•<code>- [NSURLSession dataTaskWithRequest:completionHandler:]</code>å·®ä¸å¤šã€‚åœ¨è¿™ä¸ªåœ°æ–¹è¿”å›dataTaskä¹‹åï¼Œæˆ‘ä»¬å†è°ƒç”¨<code>- resume</code>æ–¹æ³•æ‰§è¡Œè¯·æ±‚ï¼Œå¹¶åœ¨æŸäº›äº‹ä»¶æ‰§è¡Œæ—¶é€šçŸ¥ä»£ç†<code>AFURLSessionManagerTaskDelegate</code></p>
<h3 id="AFNetworkingçš„æ ¸å¿ƒAFURLSessionManager"><a href="#AFNetworkingçš„æ ¸å¿ƒAFURLSessionManager" class="headerlink" title="AFNetworkingçš„æ ¸å¿ƒAFURLSessionManager"></a>AFNetworkingçš„æ ¸å¿ƒAFURLSessionManager</h3><hr>
<p><code>AFURLSessionManager</code>ç»å¯¹å¯ä»¥ç§°å¾—ä¸Šæ˜¯AFNetworkingçš„æ ¸å¿ƒ</p>
<ul>
<li>è´Ÿè´£åˆ›å»ºå’Œç®¡ç†NSURLSession</li>
<li>ç®¡ç†NSURLSessionTask</li>
<li>å®ç°NSURLSessionDelegateç­‰åè®®ä¸­çš„ä»£ç†æ–¹æ³•</li>
<li>ä½¿ç”¨_AFURLSessionTaskSwizzlingè°ƒå‰‚æ–¹æ³•</li>
<li>å¼•å…¥AFSecurityPolicyä¿è¯è¯·æ±‚çš„å®‰å…¨</li>
<li>å¼•å…¥AFNetworkingReachabilityManagerç›‘æ§ç½‘ç»œçŠ¶æ€</li>
</ul>
<p>è¿™ä¸€èŠ‚å°†ä¼šç€é‡ä»‹ç»ä¸Šé¢ä¸ƒä¸ªåŠŸèƒ½ä¸­çš„å‰äº”ä¸ªï¼Œåˆ†æå®ƒæ˜¯å¦‚ä½•åŒ…è£…<code>NSURLSession</code>ä»¥åŠä¼—å¤šä»£ç†æ–¹æ³•çš„ã€‚</p>
<h4 id="åˆ›å»ºå’Œç®¡ç†NSURLSession"><a href="#åˆ›å»ºå’Œç®¡ç†NSURLSession" class="headerlink" title="åˆ›å»ºå’Œç®¡ç†NSURLSession"></a>åˆ›å»ºå’Œç®¡ç†NSURLSession</h4><hr>
<p>ä½¿ç”¨<code>AFURLSessionManager</code>æ—¶ï¼Œç¬¬ä¸€ä»¶è¦åšçš„äº‹æƒ…ä¸€å®šæ˜¯åˆå§‹åŒ–ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)initWithSessionConfiguration:(<span class="built_in">NSURLSessionConfiguration</span> *)configuration &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!configuration) &#123;</div><div class="line">        configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.sessionConfiguration = configuration;</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.operationQueue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line">    <span class="keyword">self</span>.operationQueue.maxConcurrentOperationCount = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:<span class="keyword">self</span>.sessionConfiguration delegate:<span class="keyword">self</span> delegateQueue:<span class="keyword">self</span>.operationQueue];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.responseSerializer = [AFJSONResponseSerializer serializer];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.securityPolicy = [AFSecurityPolicy defaultPolicy];</div><div class="line"></div><div class="line"><span class="meta">#if !TARGET_OS_WATCH</span></div><div class="line">    <span class="keyword">self</span>.reachabilityManager = [AFNetworkReachabilityManager sharedManager];</div><div class="line"><span class="meta">#endif</span></div><div class="line"></div><div class="line">    <span class="keyword">self</span>.mutableTaskDelegatesKeyedByTaskIdentifier = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.lock = [[<span class="built_in">NSLock</span> alloc] init];</div><div class="line">    <span class="keyword">self</span>.lock.name = AFURLSessionManagerLockName;</div><div class="line">    <span class="comment">//ä¸ºå·²æœ‰çš„taskè®¾ç½®ä»£ç†</span></div><div class="line">    [<span class="keyword">self</span>.session getTasksWithCompletionHandler:^(<span class="built_in">NSArray</span> *dataTasks, <span class="built_in">NSArray</span> *uploadTasks, <span class="built_in">NSArray</span> *downloadTasks) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSURLSessionDataTask</span> *task <span class="keyword">in</span> dataTasks) &#123;</div><div class="line">            [<span class="keyword">self</span> addDelegateForDataTask:task uploadProgress:<span class="literal">nil</span> downloadProgress:<span class="literal">nil</span> completionHandler:<span class="literal">nil</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSURLSessionUploadTask</span> *uploadTask <span class="keyword">in</span> uploadTasks) &#123;</div><div class="line">            [<span class="keyword">self</span> addDelegateForUploadTask:uploadTask progress:<span class="literal">nil</span> completionHandler:<span class="literal">nil</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSURLSessionDownloadTask</span> *downloadTask <span class="keyword">in</span> downloadTasks) &#123;</div><div class="line">            [<span class="keyword">self</span> addDelegateForDownloadTask:downloadTask progress:<span class="literal">nil</span> destination:<span class="literal">nil</span> completionHandler:<span class="literal">nil</span>];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œéœ€è¦å®Œæˆåˆå§‹åŒ–ä¸€äº›è‡ªå·±æŒæœ‰çš„ç‰¹ä¾‹ï¼š</p>
<ol>
<li>åˆå§‹åŒ– <strong>ä¼šè¯é…ç½®</strong> (NSURLSessionConfiguration)ï¼Œé»˜è®¤ä¸º<code>defaultSessionConfiguration</code></li>
<li>åˆå§‹åŒ– <strong>ä¼šè¯</strong> (session)ï¼Œå¹¶è®¾ç½®ä¼šè¯çš„ä»£ç†ä»¥åŠä»£ç†åˆ—é˜Ÿ</li>
<li>åˆå§‹åŒ–ç®¡ç† <strong>å“åº”åºåˆ—åŒ–</strong> (AFJSONResponseSerializer)ï¼Œ<strong>å®‰å…¨è®¤è¯</strong> (AFSecurityPolicy) ä»¥åŠ <strong>ç›‘æ§ç½‘ç»œçŠ¶æ€</strong> (AFNetworkReachabilityManager) çš„å®ä¾‹</li>
<li>åˆå§‹åŒ–ä¿å­˜data taskçš„å­—å…¸(mutableTaskDelegatesKeysByTaskIdentifier)</li>
</ol>
<h4 id="ç®¡ç†NSURLSessionTask"><a href="#ç®¡ç†NSURLSessionTask" class="headerlink" title="ç®¡ç†NSURLSessionTask"></a>ç®¡ç†NSURLSessionTask</h4><hr>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨è·å¾—äº†<code>AFURLSessionManager</code>çš„å®ä¾‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•åˆ›å»º<code>NSURLSessionDataTask</code>çš„å®ä¾‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="built_in">NSURLSessionDataTask</span> *)dataTaskWithRequest:(<span class="built_in">NSURLRequest</span> *)request</div><div class="line">                               uploadProgress:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSProgress</span> *uploadProgress)) uploadProgressBlock</div><div class="line">                             downloadProgress:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSProgress</span> *downloadProgress)) downloadProgressBlock</div><div class="line">                            completionHandler:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> _Nullable responseObject,  <span class="built_in">NSError</span> * _Nullable error))completionHandler;</div><div class="line"></div><div class="line">- (<span class="built_in">NSURLSessionUploadTask</span> *)uploadTaskWithRequest:(<span class="built_in">NSURLRequest</span> *)request</div><div class="line">                                         fromFile:(<span class="built_in">NSURL</span> *)fileURL</div><div class="line">                                         progress:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSProgress</span> *uploadProgress)) uploadProgressBlock</div><div class="line">                                completionHandler:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> _Nullable responseObject, <span class="built_in">NSError</span>  * _Nullable error))completionHandler;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">- (<span class="built_in">NSURLSessionDownloadTask</span> *)downloadTaskWithRequest:(<span class="built_in">NSURLRequest</span> *)request</div><div class="line">                                             progress:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSProgress</span> *downloadProgress)) downloadProgressBlock</div><div class="line">                                          destination:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> * (^)(<span class="built_in">NSURL</span> *targetPath, <span class="built_in">NSURLResponse</span> *response))destination</div><div class="line">                                    completionHandler:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSURL</span> * _Nullable filePath, <span class="built_in">NSError</span> * _Nullable error))completionHandler;</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçœç•¥äº†ä¸€äº›è¿”å›NSURLSessionTaskçš„æ–¹æ³•ï¼Œå› ä¸ºè¿™äº›æ¥å£çš„å½¢å¼éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚</p>
<p>æˆ‘ä»¬å°†ä»¥ <code>[AFURLSessionManager dataTaskWithRequest:uploadProgress:downloadProgress:completionHandler:]</code>æ–¹æ³•çš„å®ç°ä¸ºä¾‹ï¼Œåˆ†æå®ƒæ˜¯å¦‚ä½•å®ä¾‹åŒ–å¹¶è¿”å›ä¸€ä¸ª<code>NSURLSessionTask</code>çš„å®ä¾‹çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="built_in">NSURLSessionDataTask</span> *)dataTaskWithRequest:(<span class="built_in">NSURLRequest</span> *)request</div><div class="line">                               uploadProgress:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSProgress</span> *uploadProgress)) uploadProgressBlock</div><div class="line">                             downloadProgress:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSProgress</span> *downloadProgress)) downloadProgressBlock</div><div class="line">                            completionHandler:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> _Nullable responseObject,  <span class="built_in">NSError</span> * _Nullable error))completionHandler &#123;</div><div class="line"></div><div class="line">    __block <span class="built_in">NSURLSessionDataTask</span> *dataTask = <span class="literal">nil</span>;</div><div class="line">    url_session_manager_create_task_safely(^&#123;</div><div class="line">        dataTask = [<span class="keyword">self</span>.session dataTaskWithRequest:request];</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    [<span class="keyword">self</span> addDelegateForDataTask:dataTask uploadProgress:uploadProgressBlock downloadProgress:downloadProgressBlock completionHandler:completionHandler];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> dataTask;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>è°ƒç”¨<code>- [NSURLSession dataTaskWithRequest:]</code>æ–¹æ³•ä¼ å…¥<code>NSURLRequest</code></li>
<li>è°ƒç”¨<code>- [AFURLSessionManager addDelegateForDataTask:uploadProgress:downloadProgress:completionHandler:]</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>AFURLSessionManagerTaskDelegate</code>å¯¹è±¡</li>
<li>å°†<code>completionHandler</code> <code>uploadProgressBlock</code>å’Œ<code>downloadProgressBlock</code>ä¼ å…¥è¯¥å¯¹è±¡å¹¶åœ¨ç›¸åº”äº‹ä»¶å‘ç”Ÿæ—¶è¿›è¡Œå›è°ƒ</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)addDelegateForDataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</div><div class="line">                uploadProgress:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSProgress</span> *uploadProgress)) uploadProgressBlock</div><div class="line">              downloadProgress:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSProgress</span> *downloadProgress)) downloadProgressBlock</div><div class="line">             completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> responseObject, <span class="built_in">NSError</span> *error))completionHandler</div><div class="line">&#123;</div><div class="line">    AFURLSessionManagerTaskDelegate *delegate = [[AFURLSessionManagerTaskDelegate alloc] init];</div><div class="line">    delegate.manager = <span class="keyword">self</span>;</div><div class="line">    delegate.completionHandler = completionHandler;</div><div class="line"></div><div class="line">    dataTask.taskDescription = <span class="keyword">self</span>.taskDescriptionForSessionTasks;</div><div class="line">    [<span class="keyword">self</span> setDelegate:delegate forTask:dataTask];</div><div class="line"></div><div class="line">    delegate.uploadProgressBlock = uploadProgressBlock;</div><div class="line">    delegate.downloadProgressBlock = downloadProgressBlock;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åŒæ—¶è°ƒç”¨äº†å¦ä¸€ä¸ªæ–¹æ³•<code>- [AFURLSessionManager setDelegate:forTask:]</code>æ¥è®¾ç½®ä»£ç†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setDelegate:(AFURLSessionManagerTaskDelegate *)delegate</div><div class="line">            forTask:(<span class="built_in">NSURLSessionTask</span> *)task</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSParameterAssert</span>(task);</div><div class="line">    <span class="built_in">NSParameterAssert</span>(delegate);</div><div class="line"></div><div class="line">    [<span class="keyword">self</span>.lock lock];</div><div class="line">    <span class="keyword">self</span>.mutableTaskDelegatesKeyedByTaskIdentifier[@(task.taskIdentifier)] = delegate;</div><div class="line">    [delegate setupProgressForTask:task];</div><div class="line">    [<span class="keyword">self</span> addNotificationObserverForTask:task];</div><div class="line">    [<span class="keyword">self</span>.lock unlock];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ­£å¦‚ä¸Šé¢æ‰€æåˆ°çš„ï¼Œ<code>AFURLSessionManager</code>å°±æ˜¯é€šè¿‡å­—å…¸<code>mutableTaskDelegatesKeyedByTaskIdentifier</code>æ¥å­˜å‚¨å¹¶ç®¡ç†æ¯ä¸€ä¸ª<code>NSURLSessionTask</code>ï¼Œå®ƒä»¥<code>taskIdentifier</code>ä¸ºé”®å­˜å‚¨taskã€‚</p>
<p>è¯¥æ–¹æ³•ä½¿ç”¨<code>NSLock</code>æ¥ä¿è¯ä¸åŒçº¿ç¨‹ä½¿ç”¨<code>mutableTaskDelegatesKeyedByTaskIdentifier</code>æ—¶ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹ç«äº‰çš„é—®é¢˜ã€‚</p>
<p>åŒæ—¶è°ƒç”¨<code>-setupProgressForTask</code>ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹é¢å…·ä½“ä»‹ç»è¿™ä¸ªæ–¹æ³•ã€‚</p>
<h4 id="å®ç°NSURLSessionDelegateç­‰åè®®ä¸­çš„ä»£ç†æ–¹æ³•"><a href="#å®ç°NSURLSessionDelegateç­‰åè®®ä¸­çš„ä»£ç†æ–¹æ³•" class="headerlink" title="å®ç°NSURLSessionDelegateç­‰åè®®ä¸­çš„ä»£ç†æ–¹æ³•"></a>å®ç°NSURLSessionDelegateç­‰åè®®ä¸­çš„ä»£ç†æ–¹æ³•</h4><hr>
<p>åœ¨<code>AFURLSessionManager</code>çš„å¤´æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒéµå¾ªäº†å¤šä¸ªåè®®ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p>
<ul>
<li>NSURLSessionDelegate</li>
<li>NSURLSessionTaskDelegate</li>
<li>NSURLSessionDataDelegate</li>
<li>NSURLSessionDownloadDelegate</li>
</ul>
<p>å®ƒçš„åˆå§‹åŒ–æ–¹æ³•<code>- [AFURLSessionManager initWithSessionConfiguration:]</code>å°†<code>NSURLSession</code>çš„ä»£ç†æŒ‡å‘selfï¼Œç„¶åå®ç°è¿™äº›æ–¹æ³•ï¼Œæä¾›æ›´ç®€æ´çš„blockçš„æ¥å£ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setSessionDidBecomeInvalidBlock:(<span class="keyword">nullable</span> <span class="keyword">void</span> (^)(<span class="built_in">NSURLSession</span> *session, <span class="built_in">NSError</span> *error))block;</div><div class="line">- (<span class="keyword">void</span>)setSessionDidReceiveAuthenticationChallengeBlock:(<span class="keyword">nullable</span> <span class="built_in">NSURLSessionAuthChallengeDisposition</span> (^)(<span class="built_in">NSURLSession</span> *session, <span class="built_in">NSURLAuthenticationChallenge</span> *challenge, <span class="built_in">NSURLCredential</span> * _Nullable __autoreleasing * _Nullable credential))block;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>å®ƒä¸ºæ‰€æœ‰çš„ä»£ç†åè®®éƒ½æä¾›äº†å¯¹åº”çš„blockæ¥å£ï¼Œæ–¹æ³•å®ç°çš„æ€è·¯éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œæˆ‘ä»¬ä»¥<code>- [AFNRLSessionManager setSessionDidBecomeInvalidBlock:]</code>ä¸ºä¾‹ã€‚</p>
<p>é¦–å…ˆè°ƒç”¨setteræ–¹æ³•ï¼Œå°†blockå­˜å…¥<code>sessionDidBecomeInvalid</code>å±æ€§ä¸­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setSessionDidBecomeInvalidBlock:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSession</span> *session, <span class="built_in">NSError</span> *error))block &#123;</div><div class="line">    <span class="keyword">self</span>.sessionDidBecomeInvalid = block;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å½“ä»£ç†æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¦‚æœå­˜åœ¨å¯¹åº”çš„blockï¼Œä¼šæ‰§è¡Œå¯¹åº”çš„block:</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session</div><div class="line">didBecomeInvalidWithError:(<span class="built_in">NSError</span> *)error  </div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.sessionDidBecomeInvalid) &#123;</div><div class="line">        <span class="keyword">self</span>.sessionDidBecomeInvalid(session, error);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:AFURLSessionDidInvalidateNotification object:session];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶ä»–ç›¸ä¼¼çš„æ¥å£å®ç°ä¹Ÿéƒ½å·®ä¸å¤šï¼Œè¿™é‡Œç›´æ¥è·³è¿‡äº†ã€‚</p>
<h4 id="ä½¿ç”¨AFURLSessionManagerTaskDelegateç®¡ç†è¿›åº¦"><a href="#ä½¿ç”¨AFURLSessionManagerTaskDelegateç®¡ç†è¿›åº¦" class="headerlink" title="ä½¿ç”¨AFURLSessionManagerTaskDelegateç®¡ç†è¿›åº¦"></a>ä½¿ç”¨AFURLSessionManagerTaskDelegateç®¡ç†è¿›åº¦</h4><hr>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°è¿‡<code>AFURLSessionManagerTaskDelegate</code>ç±»ï¼Œå®ƒä¸»è¦ä¸ºtaskæä¾›è¿›åº¦ç®¡ç†åŠŸèƒ½ï¼Œå¹¶åœ¨taskç»“æŸæ—¶å›è°ƒï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨åœ¨<code>- [AFURLSessionManager dataTaskWithRequest:uploadProgress:downloadProgress:completionHandler:]</code>ç­‰æ–¹æ³•ä¸­ä¼ å…¥çš„<code>completionHandler</code>ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆåˆ†æä¸€ä¸‹<code>AFURLSessionManagerTaskDelegate</code>æ˜¯å¦‚ä½•å¯¹è¿›åº¦è¿›è¡Œè·Ÿè¸ªçš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setupProgressForTask:(<span class="built_in">NSURLSessionTask</span> *)task &#123;</div><div class="line"></div><div class="line">    <span class="meta">#1ï¼šè®¾ç½®åœ¨ä¸Šä¼ è¿›åº¦æˆ–è€…ä¸‹è½½è¿›åº¦çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒ</span></div><div class="line"></div><div class="line">    <span class="meta">#2ï¼šKVO</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•çš„å®ç°æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å¯¹ä»£ç†æŒæœ‰çš„ä¸¤ä¸ªå±æ€§<code>uploadProgress</code>å’Œ<code>downloadProgress</code>è®¾ç½®å›è°ƒ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">__<span class="keyword">weak</span> __typeof__(task) weakTask = task;</div><div class="line"></div><div class="line"><span class="keyword">self</span>.uploadProgress.totalUnitCount = task.countOfBytesExpectedToSend;  </div><div class="line">[<span class="keyword">self</span>.uploadProgress setCancellable:<span class="literal">YES</span>];</div><div class="line">[<span class="keyword">self</span>.uploadProgress setCancellationHandler:^&#123;</div><div class="line">   __typeof__(weakTask) strongTask = weakTask;</div><div class="line">   [strongTask cancel];</div><div class="line">&#125;];</div><div class="line">[<span class="keyword">self</span>.uploadProgress setPausable:<span class="literal">YES</span>];</div><div class="line">[<span class="keyword">self</span>.uploadProgress setPausingHandler:^&#123;</div><div class="line">   __typeof__(weakTask) strongTask = weakTask;</div><div class="line">   [strongTask suspend];</div><div class="line">&#125;];</div><div class="line"><span class="keyword">if</span> ([<span class="keyword">self</span>.uploadProgress respondsToSelector:<span class="keyword">@selector</span>(setResumingHandler:)]) &#123;  </div><div class="line">   [<span class="keyword">self</span>.uploadProgress setResumingHandler:^&#123;</div><div class="line">       __typeof__(weakTask) strongTask = weakTask;</div><div class="line">       [strongTask resume];</div><div class="line">   &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œåªæœ‰å¯¹<code>uploadProgress</code>è®¾ç½®å›è°ƒçš„ä»£ç ï¼Œè®¾ç½®<code>downloadProgress</code>ä¸è¿™é‡Œå®Œå…¨ç›¸åŒ</p>
<blockquote>
<p>ä¸»è¦ç›®çš„æ˜¯åœ¨å¯¹åº”<code>NSProgress</code>çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œè°ƒç”¨<code>resume</code> <code>suspend</code>ç­‰æ–¹æ³•æ”¹å˜taskçš„çŠ¶æ€ã€‚</p>
</blockquote>
<p>ç¬¬äºŒéƒ¨åˆ†æ˜¯å¯¹taskå’Œ<code>NSProgress</code>å±æ€§è¿›è¡Œé”®å€¼è§‚æµ‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">[task addObserver:<span class="keyword">self</span></div><div class="line">      forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesReceived))</div><div class="line">         options:<span class="built_in">NSKeyValueObservingOptionNew</span></div><div class="line">         context:<span class="literal">NULL</span>];</div><div class="line">[task addObserver:<span class="keyword">self</span></div><div class="line">      forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesExpectedToReceive))</div><div class="line">         options:<span class="built_in">NSKeyValueObservingOptionNew</span></div><div class="line">         context:<span class="literal">NULL</span>];</div><div class="line"></div><div class="line">[task addObserver:<span class="keyword">self</span></div><div class="line">      forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesSent))</div><div class="line">         options:<span class="built_in">NSKeyValueObservingOptionNew</span></div><div class="line">         context:<span class="literal">NULL</span>];</div><div class="line">[task addObserver:<span class="keyword">self</span></div><div class="line">      forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesExpectedToSend))</div><div class="line">         options:<span class="built_in">NSKeyValueObservingOptionNew</span></div><div class="line">         context:<span class="literal">NULL</span>];</div><div class="line"></div><div class="line">[<span class="keyword">self</span>.downloadProgress addObserver:<span class="keyword">self</span></div><div class="line">                       forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(fractionCompleted))</div><div class="line">                          options:<span class="built_in">NSKeyValueObservingOptionNew</span></div><div class="line">                          context:<span class="literal">NULL</span>];</div><div class="line">[<span class="keyword">self</span>.uploadProgress addObserver:<span class="keyword">self</span></div><div class="line">                     forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(fractionCompleted))</div><div class="line">                        options:<span class="built_in">NSKeyValueObservingOptionNew</span></div><div class="line">                        context:<span class="literal">NULL</span>];</div></pre></td></tr></table></figure>
<p>åœ¨<code>observeValueForKeypath:ofObject:change:context:</code>æ–¹æ³•ä¸­æ”¹å˜è¿›åº¦ï¼Œå¹¶è°ƒç”¨block</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</div><div class="line">    <span class="keyword">if</span> ([object isKindOfClass:[<span class="built_in">NSURLSessionTask</span> <span class="keyword">class</span>]]) &#123;</div><div class="line">        <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesReceived))]) &#123;</div><div class="line">            <span class="keyword">self</span>.downloadProgress.completedUnitCount = [change[<span class="string">@"new"</span>] longLongValue];</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesExpectedToReceive))]) &#123;</div><div class="line">            <span class="keyword">self</span>.downloadProgress.totalUnitCount = [change[<span class="string">@"new"</span>] longLongValue];</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesSent))]) &#123;</div><div class="line">            <span class="keyword">self</span>.uploadProgress.completedUnitCount = [change[<span class="string">@"new"</span>] longLongValue];</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesExpectedToSend))]) &#123;</div><div class="line">            <span class="keyword">self</span>.uploadProgress.totalUnitCount = [change[<span class="string">@"new"</span>] longLongValue];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([object isEqual:<span class="keyword">self</span>.downloadProgress]) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.downloadProgressBlock) &#123;</div><div class="line">            <span class="keyword">self</span>.downloadProgressBlock(object);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([object isEqual:<span class="keyword">self</span>.uploadProgress]) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.uploadProgressBlock) &#123;</div><div class="line">            <span class="keyword">self</span>.uploadProgressBlock(object);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹è±¡çš„æŸäº›å±æ€§æ”¹å˜æ—¶æ›´æ–°<code>NSProgress</code>å¯¹è±¡æˆ–ä½¿ç”¨blockä¼ é€’<code>NSProgress</code>å¯¹è±¡<br><code>self.uploadProgressBlock(object)</code>ã€‚</p>
<h4 id="ä»£ç†æ–¹æ³•-URLSession-task-didCompleteWithError"><a href="#ä»£ç†æ–¹æ³•-URLSession-task-didCompleteWithError" class="headerlink" title="ä»£ç†æ–¹æ³• URLSession:task:didCompleteWithError:"></a>ä»£ç†æ–¹æ³• URLSession:task:didCompleteWithError:</h4><hr>
<p>åœ¨æ¯ä¸€ä¸ª<code>NSURLSessionTask</code>ç»“æŸæ—¶ï¼Œéƒ½ä¼šåœ¨ä»£ç†æ–¹æ³•<code>URLSession:task:didCompleteWithError:</code>ä¸­ï¼š</p>
<ol>
<li>è°ƒç”¨ä¼ å…¥çš„<code>completionHander</code>block</li>
<li>å‘å‡º<code>AFNetworkingTaskDidCompleteNotification</code>é€šçŸ¥</li>
</ol>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)URLSession:(__unused <span class="built_in">NSURLSession</span> *)session</div><div class="line">              task:(<span class="built_in">NSURLSessionTask</span> *)task</div><div class="line">didCompleteWithError:(<span class="built_in">NSError</span> *)error  </div><div class="line">&#123;</div><div class="line">    <span class="meta">#1ï¼šè·å–æ•°æ®, å­˜å‚¨ `responseSerializer` å’Œ `downloadFileURL`</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (error) &#123;</div><div class="line">        <span class="meta">#2ï¼šåœ¨å­˜åœ¨é”™è¯¯æ—¶è°ƒç”¨ `completionHandler`</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="meta">#3ï¼šè°ƒç”¨ `completionHandler`</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯æ•´ä¸ªä»£ç†æ–¹æ³•çš„éª¨æ¶ï¼Œå…ˆçœ‹ä¸€ä¸‹æœ€ç®€å•çš„ç¬¬ä¸€éƒ¨åˆ†ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">__block <span class="built_in">NSMutableDictionary</span> *userInfo = [<span class="built_in">NSMutableDictionary</span> dictionary];  </div><div class="line">userInfo[AFNetworkingTaskDidCompleteResponseSerializerKey] = manager.responseSerializer;</div><div class="line"></div><div class="line"><span class="comment">//Performance Improvement from #2672</span></div><div class="line"><span class="built_in">NSData</span> *data = <span class="literal">nil</span>;  </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.mutableData) &#123;  </div><div class="line">   data = [<span class="keyword">self</span>.mutableData <span class="keyword">copy</span>];</div><div class="line">   <span class="comment">//We no longer need the reference, so nil it out to gain back some memory.</span></div><div class="line">   <span class="keyword">self</span>.mutableData = <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.downloadFileURL) &#123;  </div><div class="line">   userInfo[AFNetworkingTaskDidCompleteAssetPathKey] = <span class="keyword">self</span>.downloadFileURL;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (data) &#123;</div><div class="line">   userInfo[AFNetworkingTaskDidCompleteResponseDataKey] = data;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†ä»£ç ä»<code>mutableData</code>ä¸­å–å‡ºæ•°æ®ï¼Œè®¾ç½®äº†<code>userInfo</code>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">userInfo[AFNetworkingTaskDidCompleteErrorKey] = error;</div><div class="line"></div><div class="line">dispatch_group_async(manager.completionGroup ?: url_session_manager_completion_group(), manager.completionQueue ?: dispatch_get_main_queue(), ^&#123;  </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.completionHandler) &#123;</div><div class="line">        <span class="keyword">self</span>.completionHandler(task.response, responseObject, error);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:AFNetworkingTaskDidCompleteNotification object:task userInfo:userInfo];</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>å¦‚æœå½“å‰manageræŒæœ‰<code>completionGroup</code>æˆ–è€…<code>completionQueue</code>å°±æ˜¯ç”¨å®ƒä»¬ã€‚å¦åˆ™ä¼šåˆ›å»ºä¸€ä¸ª<code>dispatch_group_t</code>å¹¶åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨<code>completionHandler</code>å¹¶å‘é€é€šçŸ¥ï¼ˆåœ¨ä¸»çº¿ç¨‹ä¸­ï¼‰ã€‚</p>
<p>å¦‚æœåœ¨æ‰§è¡Œå½“å‰taskæ—¶æ²¡æœ‰é‡åˆ°é”™è¯¯ï¼Œé‚£ä¹ˆå…ˆå¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶ååŒæ ·è°ƒç”¨blockå¹¶å‘é€é€šçŸ¥ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">dispatch_async</span>(url_session_manager_processing_queue(), ^&#123;  </div><div class="line">    <span class="built_in">NSError</span> *serializationError = <span class="literal">nil</span>;</div><div class="line">    responseObject = [manager.responseSerializer responseObjectForResponse:task.response data:data error:&amp;serializationError];</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.downloadFileURL) &#123;</div><div class="line">        responseObject = <span class="keyword">self</span>.downloadFileURL;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (responseObject) &#123;</div><div class="line">        userInfo[AFNetworkingTaskDidCompleteSerializedResponseKey] = responseObject;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (serializationError) &#123;</div><div class="line">        userInfo[AFNetworkingTaskDidCompleteErrorKey] = serializationError;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    dispatch_group_async(manager.completionGroup ?: url_session_manager_completion_group(), manager.completionQueue ?: dispatch_get_main_queue(), ^&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.completionHandler) &#123;</div><div class="line">            <span class="keyword">self</span>.completionHandler(task.response, responseObject, serializationError);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:AFNetworkingTaskDidCompleteNotification object:task userInfo:userInfo];</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="ä»£ç†æ–¹æ³•URLSession-dataTask-didReceiveData-å’ŒURLSession-downloadTask-didFinishDownloadingToURL-è¿™ä¸¤ä¸ªä»£ç†æ–¹æ³•åˆ†åˆ«ä¼šåœ¨æ”¶åˆ°æ•°æ®æˆ–è€…å®Œæˆä¸‹è½½å¯¹åº”æ–‡ä»¶æ—¶è°ƒç”¨ï¼Œä½œç”¨åˆ†åˆ«æ˜¯ä¸ºmutableDataè¿½åŠ æ•°æ®å’Œå¤„ç†ä¸‹è½½çš„æ–‡ä»¶ï¼š"><a href="#ä»£ç†æ–¹æ³•URLSession-dataTask-didReceiveData-å’ŒURLSession-downloadTask-didFinishDownloadingToURL-è¿™ä¸¤ä¸ªä»£ç†æ–¹æ³•åˆ†åˆ«ä¼šåœ¨æ”¶åˆ°æ•°æ®æˆ–è€…å®Œæˆä¸‹è½½å¯¹åº”æ–‡ä»¶æ—¶è°ƒç”¨ï¼Œä½œç”¨åˆ†åˆ«æ˜¯ä¸ºmutableDataè¿½åŠ æ•°æ®å’Œå¤„ç†ä¸‹è½½çš„æ–‡ä»¶ï¼š" class="headerlink" title="ä»£ç†æ–¹æ³•URLSession:dataTask:didReceiveData:å’ŒURLSession:downloadTask:didFinishDownloadingToURL: è¿™ä¸¤ä¸ªä»£ç†æ–¹æ³•åˆ†åˆ«ä¼šåœ¨æ”¶åˆ°æ•°æ®æˆ–è€…å®Œæˆä¸‹è½½å¯¹åº”æ–‡ä»¶æ—¶è°ƒç”¨ï¼Œä½œç”¨åˆ†åˆ«æ˜¯ä¸ºmutableDataè¿½åŠ æ•°æ®å’Œå¤„ç†ä¸‹è½½çš„æ–‡ä»¶ï¼š"></a>ä»£ç†æ–¹æ³•URLSession:dataTask:didReceiveData:å’ŒURLSession:downloadTask:didFinishDownloadingToURL: è¿™ä¸¤ä¸ªä»£ç†æ–¹æ³•åˆ†åˆ«ä¼šåœ¨æ”¶åˆ°æ•°æ®æˆ–è€…å®Œæˆä¸‹è½½å¯¹åº”æ–‡ä»¶æ—¶è°ƒç”¨ï¼Œä½œç”¨åˆ†åˆ«æ˜¯ä¸ºmutableDataè¿½åŠ æ•°æ®å’Œå¤„ç†ä¸‹è½½çš„æ–‡ä»¶ï¼š</h4><hr>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)URLSession:(__unused <span class="built_in">NSURLSession</span> *)session</div><div class="line">          dataTask:(__unused <span class="built_in">NSURLSessionDataTask</span> *)dataTask</div><div class="line">    didReceiveData:(<span class="built_in">NSData</span> *)data</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span>.mutableData appendData:data];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session</div><div class="line">      downloadTask:(<span class="built_in">NSURLSessionDownloadTask</span> *)downloadTask</div><div class="line">didFinishDownloadingToURL:(<span class="built_in">NSURL</span> *)location  </div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSError</span> *fileManagerError = <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">self</span>.downloadFileURL = <span class="literal">nil</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.downloadTaskDidFinishDownloading) &#123;</div><div class="line">        <span class="keyword">self</span>.downloadFileURL = <span class="keyword">self</span>.downloadTaskDidFinishDownloading(session, downloadTask, location);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.downloadFileURL) &#123;</div><div class="line">            [[<span class="built_in">NSFileManager</span> defaultManager] moveItemAtURL:location toURL:<span class="keyword">self</span>.downloadFileURL error:&amp;fileManagerError];</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (fileManagerError) &#123;</div><div class="line">                [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:AFURLSessionDownloadTaskDidFailToMoveFileNotification object:downloadTask userInfo:fileManagerError.userInfo];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-AFURLSessionTaskSwizzling-è°ƒå‰‚æ–¹æ³•"><a href="#ä½¿ç”¨-AFURLSessionTaskSwizzling-è°ƒå‰‚æ–¹æ³•" class="headerlink" title="ä½¿ç”¨ _AFURLSessionTaskSwizzling è°ƒå‰‚æ–¹æ³•"></a>ä½¿ç”¨ _AFURLSessionTaskSwizzling è°ƒå‰‚æ–¹æ³•</h4><hr>
<p><code>_AFURLSessionTaskSwizzling</code>çš„å”¯ä¸€åŠŸèƒ½å°±æ˜¯ä¿®æ”¹<code>NSURLSessionTask</code>çš„<code>resume</code>å’Œ<code>suspend</code>æ–¹æ³•ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ›¿æ¢åŸæœ‰çš„å®ç°</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)af_resume &#123;</div><div class="line">    <span class="built_in">NSAssert</span>([<span class="keyword">self</span> respondsToSelector:<span class="keyword">@selector</span>(state)], <span class="string">@"Does not respond to state"</span>);</div><div class="line">    <span class="built_in">NSURLSessionTaskState</span> state = [<span class="keyword">self</span> state];</div><div class="line">    [<span class="keyword">self</span> af_resume];</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (state != <span class="built_in">NSURLSessionTaskStateRunning</span>) &#123;</div><div class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:AFNSURLSessionTaskDidResumeNotification object:<span class="keyword">self</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)af_suspend &#123;</div><div class="line">    <span class="built_in">NSAssert</span>([<span class="keyword">self</span> respondsToSelector:<span class="keyword">@selector</span>(state)], <span class="string">@"Does not respond to state"</span>);</div><div class="line">    <span class="built_in">NSURLSessionTaskState</span> state = [<span class="keyword">self</span> state];</div><div class="line">    [<span class="keyword">self</span> af_suspend];</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (state != <span class="built_in">NSURLSessionTaskStateSuspended</span>) &#123;</div><div class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:AFNSURLSessionTaskDidSuspendNotification object:<span class="keyword">self</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨æ–¹æ³•<code>resume</code>æˆ–è€…<code>suspend</code>è¢«è°ƒç”¨æ—¶å‘é€é€šçŸ¥ã€‚</p>
<p>å…·ä½“æ–¹æ³•è°ƒå‰‚çš„è¿‡ç¨‹æ˜¯åœ¨<code>+load</code>æ–¹æ³•ä¸­è¿›è¡Œçš„</p>
<p><code>load</code>æ–¹æ³•åªä¼šåœ¨æ•´ä¸ªæ–‡ä»¶è¢«å¼•å…¥æ—¶è°ƒç”¨ä¸€æ¬¡</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)load &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">NSClassFromString</span>(<span class="string">@"NSURLSessionTask"</span>)) &#123;</div><div class="line">        <span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> ephemeralSessionConfiguration];</div><div class="line">        <span class="built_in">NSURLSession</span> * session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:configuration];</div><div class="line"><span class="meta">#pragma GCC diagnostic push</span></div><div class="line"><span class="meta">#pragma GCC diagnostic ignored <span class="meta-string">"-Wnonnull"</span></span></div><div class="line">        <span class="built_in">NSURLSessionDataTask</span> *localDataTask = [session dataTaskWithURL:<span class="literal">nil</span>];</div><div class="line"><span class="meta">#pragma clang diagnostic pop</span></div><div class="line">        IMP originalAFResumeIMP = method_getImplementation(class_getInstanceMethod([<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(af_resume)));</div><div class="line">        Class currentClass = [localDataTask <span class="keyword">class</span>];</div><div class="line"></div><div class="line">        <span class="keyword">while</span> (class_getInstanceMethod(currentClass, <span class="keyword">@selector</span>(resume))) &#123;</div><div class="line">            Class superClass = [currentClass superclass];</div><div class="line">            IMP classResumeIMP = method_getImplementation(class_getInstanceMethod(currentClass, <span class="keyword">@selector</span>(resume)));</div><div class="line">            IMP superclassResumeIMP = method_getImplementation(class_getInstanceMethod(superClass, <span class="keyword">@selector</span>(resume)));</div><div class="line">            <span class="keyword">if</span> (classResumeIMP != superclassResumeIMP &amp;&amp;</div><div class="line">                originalAFResumeIMP != classResumeIMP) &#123;</div><div class="line">                [<span class="keyword">self</span> swizzleResumeAndSuspendMethodForClass:currentClass];</div><div class="line">            &#125;</div><div class="line">            currentClass = [currentClass superclass];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        [localDataTask cancel];</div><div class="line">        [session finishTasksAndInvalidate];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>é¦–å…ˆç”¨<code>NSClassFromString(@&quot;NSURLSessionTask&quot;)</code>åˆ¤æ–­å½“å‰éƒ¨ç½²çš„iOSç‰ˆæœ¬æ˜¯å¦å«æœ‰ç±»<code>NSURLSessionTask</code></li>
<li>å› ä¸ºiOS7å’ŒiOS8ä¸Šå¯¹äº<code>NSURLSesionTask</code>çš„å®ç°ä¸åŒï¼Œæ‰€ä»¥ä¼šé€šè¿‡<code>- [NSURLSession dataTaskWithURL:]</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>NSURLSessionTask</code>å®ä¾‹</li>
<li>å–å¾—å½“å‰ç±»<code>_AFURLSessionTaskSwizzling</code>ä¸­çš„å®ç°<code>af_resume</code></li>
<li>åˆ¤æ–­å½“å‰ç±»<code>currentClass</code>æœ‰<code>resume</code>æ–¹æ³•</li>
<li>ä½¿ç”¨<code>swizzleResumeAndSuspendMethodForClass:</code>è°ƒå‰‚è¯¥ç±»çš„<code>resume</code>å’Œ<code>suspend</code>æ–¹æ³•</li>
<li>currentClass = [currentClass superclass]</li>
</ol>
<h4 id="å¼•å…¥AFSecurityPolicyä¿è¯è¯·æ±‚çš„å®‰å…¨"><a href="#å¼•å…¥AFSecurityPolicyä¿è¯è¯·æ±‚çš„å®‰å…¨" class="headerlink" title="å¼•å…¥AFSecurityPolicyä¿è¯è¯·æ±‚çš„å®‰å…¨"></a>å¼•å…¥AFSecurityPolicyä¿è¯è¯·æ±‚çš„å®‰å…¨</h4><hr>
<p><code>AFSecurityPolicy</code>æ˜¯<code>AFNetworking</code>ç”¨æ¥ä¿è¯HTTPè¯·æ±‚å®‰å…¨çš„ç±»ï¼Œå®ƒè¢«<code>AFURLSessionManager</code>æŒæœ‰ï¼Œå¦‚æœä½ åœ¨<code>AFURLSessionManager</code>çš„å®ç°æ–‡ä»¶ä¸­æœç´¢self.securityPolicyï¼Œä½ åªä¼šå¾—åˆ°ä¸‰æ¡ç»“æœï¼š</p>
<ol>
<li>åˆå§‹åŒ–<code>self.securityPolicy = [AFSecurityPolicy defaultPolicy]</code></li>
<li>æ”¶åˆ°è¿æ¥å±‚çš„éªŒè¯è¯·æ±‚æ—¶</li>
<li>ä»»åŠ¡æ¥æ”¶åˆ°éªŒè¯è¯·æ±‚æ—¶</li>
</ol>
<p>åœ¨APIè°ƒç”¨ä¸Šï¼Œåä¸¤è€…éƒ½è°ƒç”¨äº†<code>- [AFSecurityPolicy evaluateServerTrust:forDomain:]</code>æ–¹æ³•æ¥åˆ¤æ–­å½“å‰æœåŠ¡å™¨æ˜¯å¦è¢«ä¿¡ä»»ï¼Œæˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­å…·ä½“ä»‹ç»è¿™ä¸ªæ–¹æ³•çš„å®ç°çš„ä½œç”¨ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session</div><div class="line">didReceiveChallenge:(<span class="built_in">NSURLAuthenticationChallenge</span> *)challenge</div><div class="line"> completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionAuthChallengeDisposition</span> disposition, <span class="built_in">NSURLCredential</span> *credential))completionHandler</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSURLSessionAuthChallengeDisposition</span> disposition = <span class="built_in">NSURLSessionAuthChallengePerformDefaultHandling</span>;</div><div class="line">    __block <span class="built_in">NSURLCredential</span> *credential = <span class="literal">nil</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.sessionDidReceiveAuthenticationChallenge) &#123;</div><div class="line">        disposition = <span class="keyword">self</span>.sessionDidReceiveAuthenticationChallenge(session, challenge, &amp;credential);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> ([challenge.protectionSpace.authenticationMethod isEqualToString:<span class="built_in">NSURLAuthenticationMethodServerTrust</span>]) &#123;</div><div class="line">            <span class="keyword">if</span> ([<span class="keyword">self</span>.securityPolicy evaluateServerTrust:challenge.protectionSpace.serverTrust forDomain:challenge.protectionSpace.host]) &#123;</div><div class="line">                credential = [<span class="built_in">NSURLCredential</span> credentialForTrust:challenge.protectionSpace.serverTrust];</div><div class="line">                <span class="keyword">if</span> (credential) &#123;</div><div class="line">                    disposition = <span class="built_in">NSURLSessionAuthChallengeUseCredential</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    disposition = <span class="built_in">NSURLSessionAuthChallengePerformDefaultHandling</span>;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                disposition = <span class="built_in">NSURLSessionAuthChallengeCancelAuthenticationChallenge</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            disposition = <span class="built_in">NSURLSessionAuthChallengePerformDefaultHandling</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (completionHandler) &#123;</div><div class="line">        completionHandler(disposition, credential);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æœ‰ä¼ å…¥<code>taskDidReceiveAuthenticationChallenge</code> blockï¼Œåªæœ‰åœ¨ä¸Šè¿°æ–¹æ³•è¿”å›YESæ—¶ï¼Œæ‰ä¼šè·å¾—è®¤è¯å‡­è¯<code>credential</code>ã€‚</p>
<h4 id="å¼•å…¥AFNetworkingReachabilityManagerç›‘æ§ç½‘ç»œçŠ¶æ€"><a href="#å¼•å…¥AFNetworkingReachabilityManagerç›‘æ§ç½‘ç»œçŠ¶æ€" class="headerlink" title="å¼•å…¥AFNetworkingReachabilityManagerç›‘æ§ç½‘ç»œçŠ¶æ€"></a>å¼•å…¥AFNetworkingReachabilityManagerç›‘æ§ç½‘ç»œçŠ¶æ€</h4><hr>
<p>ä¸<code>AFSecurityPolicy</code>ç›¸åŒï¼Œ<code>AFURLSessionManager</code>å¯¹ç½‘ç»œçŠ¶æ€çš„ç›‘æ§æ˜¯ç”±<code>AFNetworkReachabilityManager</code>æ¥è´Ÿè´£çš„ï¼Œå®ƒä»…ä»…æ˜¯æŒæœ‰ä¸€ä¸ª<code>AFNetworkReachabilityManager</code>çš„å¯¹è±¡ã€‚</p>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><hr>
<ul>
<li><code>AFURLSessionManager</code>æ˜¯å¯¹<code>NSURLSession</code>çš„å°è£…</li>
<li>å®ƒé€šè¿‡<code>- [AFURLSessionManager dataTaskWithRequest:completionHandler:]</code>ç­‰æ¥å£åˆ›å»º<code>NSURLSessionDataTask</code>çš„å®ä¾‹</li>
<li>æŒæœ‰ä¸€ä¸ªå­—å…¸<code>mutableTaskDelegatesKeyedByTaskIdentifier</code>ç®¡ç†è¿™äº›data task å®ä¾‹</li>
<li>å¼•å…¥<code>AFURLSessionManagerTaskDelegate</code>æ¥å¯¹ä¼ å…¥çš„<code>uploadProgressBlock</code>        <code>downloadProgressBlock</code> <code>completionHandler</code> åœ¨åˆé€‚çš„æ—¶é—´è¿›è¡Œè°ƒç”¨</li>
<li>å®ç°äº†å…¨éƒ¨çš„ä»£ç†æ–¹æ³•æ¥æä¾›blockæ¥å£</li>
<li>é€šè¿‡æ–¹æ³•è°ƒå‰‚åœ¨data task çŠ¶æ€æ”¹å˜æ—¶ï¼Œå‘å‡ºé€šçŸ¥</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç½‘ç»œæ˜¯APPå¼€å‘ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé™¤éè¿™ä¸ªAPPæ˜¯æœ¬åœ°è‡ªç©ï¼Œå¦åˆ™å°±ç¦»ä¸å¼€ç½‘ç»œã€‚åœ¨iOSå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå»ä½¿ç”¨åˆ«äººé€ å¥½çš„è½®å­ï¼Œå…¶ä¸­æœ€æœ‰åä¹Ÿæœ€å¸¸ç”¨çš„é&lt;code&gt;AFNetworking&lt;/code&gt;è«å±ã€‚è¿™ç¯‡æ–‡ç« å°±æ·±å…¥æ¢è®¨ä¸€ä¸‹&lt;code&gt;AFNetworking&lt;/code&gt;æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h3&gt;&lt;hr&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹&lt;code&gt;AFNetworking&lt;/code&gt;æ•´ä¸ªæ¶æ„ä½“ç³»ï¼š&lt;/p&gt;
&lt;div align=center&gt;&lt;br&gt;&lt;img src=&quot;https://github.com/guiyongdong/Resource/blob/master/hexoImage/af2.png?raw=true&quot;/&gt;&lt;br&gt;&lt;/div&gt;

&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦äº†è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•ä½¿ç”¨NSURLSessionå‘å‡ºHTTPè¯·æ±‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä½¿ç”¨AFNetworkingå‘å‡ºHTTPè¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æºç åˆ†æ" scheme="http://www.guiyongdong.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="æºç åˆ†æ" scheme="http://www.guiyongdong.com/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>SDWebImageæºç åˆ†æ</title>
    <link href="http://www.guiyongdong.com/2017/01/15/SDWebImage%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://www.guiyongdong.com/2017/01/15/SDWebImageæºç åˆ†æ/</id>
    <published>2017-01-15T07:14:25.000Z</published>
    <updated>2017-02-05T11:34:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>SDWebImageæ˜¯ä¸€ä¸ªå¼€æºçš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒæä¾›äº†UIImageViewçš„ä¸€ä¸ªåˆ†ç±»ï¼Œä»¥æ”¯æŒä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½å¹¶ç¼“å­˜å›¾ç‰‡çš„åŠŸèƒ½ã€‚å®ƒå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>æä¾›UIImageViewçš„ä¸€ä¸ªåˆ†ç±»ï¼Œä»¥æ”¯æŒç½‘ç»œå›¾ç‰‡çš„åŠ è½½ä¸ç¼“å­˜ç®¡ç†</li>
<li>ä¸€ä¸ªå¼‚æ­¥çš„å›¾ç‰‡åŠ è½½å™¨</li>
<li>ä¸€ä¸ªå¼‚æ­¥çš„å†…å­˜+ç£ç›˜å›¾ç‰‡ç¼“å­˜</li>
<li>æ”¯æŒGIFå›¾ç‰‡</li>
<li>æ”¯æŒWebPå›¾ç‰‡</li>
<li>åå°å›¾ç‰‡è§£å‹ç¼©å¤„ç†</li>
<li>ç¡®ä¿åŒä¸€ä¸ªURLä¸ä¼šè¢«åå¤åŠ è½½</li>
<li>ç¡®ä¿ä¸‹è½½åŠç¼“å­˜æ—¶ï¼Œä¸»çº¿ç¨‹ä¸è¢«å µå¡</li>
</ol>
<p>ä»githubä¸Šå¯¹SDWebImageä½¿ç”¨æƒ…å†µå¯ä»¥çœ‹å‡ºï¼ŒSDWebImageåœ¨å›¾ç‰‡ä¸‹è½½åŠç¼“å­˜çš„å¤„ç†è¿˜æ˜¯è¢«è®¤å¯çš„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä»æºç çš„è§’åº¦æ¥åˆ†æä¸€ä¸‹SDWebImageçš„å®ç°æœºåˆ¶ã€‚è®¨è®ºçš„å†…å®¹å°†ä¸»è¦é›†ä¸­åœ¨å›¾ç‰‡çš„ä¸‹è½½åŠç¼“å­˜ï¼Œè€Œä¸åŒ…å«å¯¹GIFå›¾ç‰‡åŠWebPå›¾ç‰‡çš„æ”¯æŒæ“ä½œã€‚ä¸è¿‡åœ¨3.8.2ç‰ˆæœ¬ä»¥åï¼ŒSDWebImageå°†ä¼šä½¿ç”¨NSURLSessionä»£æ›¿åŸæ¥çš„NSURLConnectionï¼Œä¸»è¦æ˜¯æ›´æ–°çš„æ˜¯ä¸‹è½½åŠŸèƒ½éƒ¨åˆ†ã€‚å…·ä½“å˜åŒ–å¯ä»¥çœ‹:<a href="https://github.com/rs/SDWebImage/blob/master/Docs/SDWebImage-4.0-Migration-guide.md" target="_blank" rel="external">ç‚¹è¿™é‡Œ</a>ã€‚ç›®å‰æˆªæ­¢åˆ°å½“å‰æ—¶é—´ï¼Œæœ€æ–°çš„ç‰ˆæœ¬ä¸º4.0.0-beta2,è¿™ç¯‡æ–‡ç« æ˜¯åœ¨4.0.0-beta2åŸºç¡€ä¸Šè¿›è¡Œå‰–æã€‚</p>
<a id="more"></a>
<h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p>åœ¨ä¸‹è½½çš„è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¼šæ ¹æ®è®¾ç½®çš„ä¸åŒçš„ä¸‹è½½é€‰é¡¹ï¼Œæ‰§è¡Œä¸åŒçš„æ“ä½œã€‚ä¸‹è½½é€‰é¡¹ç”±æšä¸¾<code>SDWebImageDownloaderOptions</code>å®šä¹‰ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, SDWebImageDownloaderOptions) &#123;</div><div class="line">    SDWebImageDownloaderLowPriority = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</div><div class="line">    SDWebImageDownloaderProgressiveDownload = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// é»˜è®¤æƒ…å†µä¸‹è¯·æ±‚ä¸ä½¿ç”¨NSURLCacheï¼Œå¦‚æœè®¾ç½®è¯¥é€‰é¡¹ï¼Œåˆ™ä»¥é»˜è®¤çš„ç¼“å­˜ç­–ç•¥æ¥ä½¿ç”¨NSURLCache</span></div><div class="line">    SDWebImageDownloaderUseNSURLCache = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// å¦‚æœä»NSURLCacheç¼“å­˜ä¸­è¯»å–å›¾ç‰‡ï¼Œåˆ™ä½¿ç”¨nilä½œä¸ºå‚æ•°æ¥è°ƒç”¨å®Œæˆblock</span></div><div class="line">    SDWebImageDownloaderIgnoreCachedResponse = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</div><div class="line">    </div><div class="line">	<span class="comment">// åœ¨iOS 4+ç³»ç»Ÿä¸Šï¼Œå…è®¸ç¨‹åºè¿›å…¥åå°åç»§ç»­ä¸‹è½½å›¾ç‰‡ã€‚è¯¥æ“ä½œé€šè¿‡å‘ç³»ç»Ÿç”³è¯·é¢å¤–çš„æ—¶é—´æ¥å®Œæˆåå°ä¸‹è½½ã€‚å¦‚æœåå°ä»»åŠ¡ç»ˆæ­¢ï¼Œåˆ™æ“ä½œä¼šè¢«å–æ¶ˆ</span></div><div class="line">    SDWebImageDownloaderContinueInBackground = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// é€šè¿‡è®¾ç½®NSMutableURLRequest.HTTPShouldHandleCookies = YESæ¥å¤„ç†å­˜å‚¨åœ¨NSHTTPCookieStoreä¸­çš„cookie</span></div><div class="line">    SDWebImageDownloaderHandleCookies = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// å…è®¸ä¸å—ä¿¡ä»»çš„SSLè¯ä¹¦ã€‚ä¸»è¦ç”¨äºæµ‹è¯•ç›®çš„ã€‚</span></div><div class="line">    SDWebImageDownloaderAllowInvalidSSLCertificates = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// å°†å›¾ç‰‡ä¸‹è½½æ”¾åˆ°é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­</span></div><div class="line">    SDWebImageDownloaderHighPriority = <span class="number">1</span> &lt;&lt; <span class="number">7</span>,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™äº›é€‰é¡¹ä¸»è¦æ¶‰åŠåˆ°ä¸‹è½½çš„ä¼˜å…ˆçº§ã€ç¼“å­˜ã€åå°ä»»åŠ¡æ‰§è¡Œã€cookieå¤„ç†ä»¥åŠè®¤è¯å‡ ä¸ªæ–¹é¢.</p>
<h4 id="ä¸‹è½½é¡ºåº"><a href="#ä¸‹è½½é¡ºåº" class="headerlink" title="ä¸‹è½½é¡ºåº"></a>ä¸‹è½½é¡ºåº</h4><p>SDWebImageçš„ä¸‹è½½æ“ä½œæ˜¯æŒ‰ä¸€å®šé¡ºåºæ¥å¤„ç†çš„ï¼Œå®ƒå®šä¹‰äº†ä¸¤ç§ä¸‹è½½é¡ºåºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, SDWebImageDownloaderExecutionOrder) &#123;</div><div class="line">    </div><div class="line">    <span class="comment">// ä»¥é˜Ÿåˆ—çš„æ–¹å¼ï¼ŒæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºä¸‹è½½ã€‚è¿™æ˜¯é»˜è®¤çš„ä¸‹è½½é¡ºåº</span></div><div class="line">    SDWebImageDownloaderFIFOExecutionOrder,</div><div class="line">    </div><div class="line">    <span class="comment">// ä»¥æ ˆçš„æ–¹å¼ï¼ŒæŒ‰ç…§åè¿›å…ˆå‡ºçš„é¡ºåºä¸‹è½½ã€‚</span></div><div class="line">    SDWebImageDownloaderLIFOExecutionOrder</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="ä¸‹è½½ç®¡ç†å™¨"><a href="#ä¸‹è½½ç®¡ç†å™¨" class="headerlink" title="ä¸‹è½½ç®¡ç†å™¨"></a>ä¸‹è½½ç®¡ç†å™¨</h4><p>SDWebImageDownloaderä¸‹è½½ç®¡ç†å™¨æ˜¯ä¸€ä¸ªå•ä¾‹5ç±»ï¼Œå®ƒä¸»è¦è´Ÿè´£å›¾ç‰‡çš„ä¸‹è½½æ“ä½œçš„ç®¡ç†ã€‚å›¾ç‰‡çš„ä¸‹è½½æ˜¯æ”¾åœ¨ä¸€ä¸ªNSOperationQueueæ“ä½œé˜Ÿåˆ—ä¸­æ¥å®Œæˆçš„ï¼Œå…¶å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSOperationQueue</span> *downloadQueue;</div></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—æœ€å¤§å¹¶å‘æ•°æ˜¯6.å¦‚æœéœ€è¦çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡SDWebImageDownloaderç±»çš„<code>maxConcurrentDownloads</code>å±æ€§æ¥ä¿®æ”¹ã€‚</p>
<p>æ‰€æœ‰ä¸‹è½½æ“ä½œçš„ç½‘ç»œå“åº”åºåˆ—åŒ–å¤„ç†æ˜¯æ”¾åœ¨ä¸€ä¸ªè‡ªå®šä¹‰çš„å¹¶è¡Œè°ƒåº¦é˜Ÿåˆ—ä¸­æ¥å¤„ç†çš„ï¼Œå…¶å£°æ˜åŠå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">@property</span> (SDDispatchQueueSetterSementics, <span class="keyword">nonatomic</span>) <span class="built_in">dispatch_queue_t</span> barrierQueue;</div><div class="line">- (<span class="keyword">id</span>)init &#123;</div><div class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">        ...</div><div class="line">        _barrierQueue = dispatch_queue_create(<span class="string">"com.hackemist.SDWebImageDownloaderBarrierQueue"</span>, DISPATCH_QUEUE_CONCURRENT);</div><div class="line">		...</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¯ä¸€ä¸ªå›¾ç‰‡çš„ä¸‹è½½éƒ½ä¼šå¯¹åº”ä¸€äº›å›è°ƒæ“ä½œï¼Œå¦‚ä¸‹è½½è¿›åº¦å›è°ƒï¼Œä¸‹è½½å®Œæˆå›è°ƒç­‰ï¼Œè¿™äº›å›è°ƒæ“ä½œæ˜¯ä»¥blockå½¢å¼æ¥å‘ˆç°ï¼Œä¸ºæ­¤åœ¨<code>SDWebImageDownloader.h</code>ä¸­å®šä¹‰äº†å‡ ä¸ªblockï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// ä¸‹è½½è¿›åº¦</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^SDWebImageDownloaderProgressBlock)(<span class="built_in">NSInteger</span> receivedSize, <span class="built_in">NSInteger</span> expectedSize);</div><div class="line"><span class="comment">// ä¸‹è½½å®Œæˆ</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^SDWebImageDownloaderCompletedBlock)(<span class="built_in">UIImage</span> *image, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error, <span class="built_in">BOOL</span> finished);</div><div class="line"><span class="comment">// Headerè¿‡æ»¤</span></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NSDictionary</span> *(^SDWebImageDownloaderHeadersFilterBlock)(<span class="built_in">NSURL</span> *url, <span class="built_in">NSDictionary</span> *headers);</div></pre></td></tr></table></figure>
<p>å›¾ç‰‡ä¸‹è½½çš„è¿™äº›å›è°ƒä¿¡æ¯å­˜å‚¨åœ¨SDWebImageDownloaderç±»çš„<code>URLOperations</code>å±æ€§ä¸­ï¼Œè¯¥å±æ€§æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œkeyæ˜¯å›¾ç‰‡çš„URLåœ°å€ï¼Œvalueåˆ™æ˜¯ä¸€ä¸ª<code>SDWebImageDownloaderOperation</code>å¯¹è±¡ï¼ŒåŒ…å«æ¯ä¸ªå›¾ç‰‡çš„å¤šç»„å›è°ƒä¿¡æ¯ã€‚ç”±äºæˆ‘ä»¬å…è®¸å¤šä¸ªå›¾ç‰‡åŒæ—¶ä¸‹è½½ï¼Œå› æ­¤å¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ<code>URLOperations</code>å±æ€§ã€‚ä¸ºäº†ä¿è¯<code>URLOperations</code>æ“ä½œï¼ˆæ·»åŠ ã€åˆ é™¤ï¼‰çš„çº¿ç¨‹å®‰å…¨æ€§ï¼ŒSDWebImageDownloaderå°†è¿™äº›æ“ä½œä½œä¸ºä¸€ä¸ªä¸ªä»»åŠ¡æ”¾åˆ°barrierQueueé˜Ÿåˆ—ä¸­ï¼Œå¹¶è®¾ç½®å±éšœæ¥ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œ<code>URLOperations</code>å±æ€§ï¼Œæˆ‘ä»¬ä»¥æ·»åŠ æ“ä½œä¸ºä¾‹ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> SDWebImageDownloadToken *)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                                           completedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock</div><div class="line">                                                   forURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                                           createCallback:(SDWebImageDownloaderOperation *(^)())createCallback &#123;</div><div class="line">    </div><div class="line">	...</div><div class="line">	</div><div class="line">    <span class="comment">// 1. ä»¥dispatch_barrier_syncæ“ä½œæ¥ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¯¹URLOperationsè¿›è¡Œæ“ä½œ</span></div><div class="line">    dispatch_barrier_sync(<span class="keyword">self</span>.barrierQueue, ^&#123;</div><div class="line">        SDWebImageDownloaderOperation *operation = <span class="keyword">self</span>.URLOperations[url];</div><div class="line">        <span class="keyword">if</span> (!operation) &#123;</div><div class="line">        	<span class="comment">//2. å¤„ç†ç¬¬ä¸€æ¬¡URLçš„ä¸‹è½½</span></div><div class="line">            operation = createCallback();</div><div class="line">            <span class="keyword">self</span>.URLOperations[url] = operation;</div><div class="line"></div><div class="line">            __<span class="keyword">weak</span> SDWebImageDownloaderOperation *woperation = operation;</div><div class="line">            operation.completionBlock = ^&#123;</div><div class="line">              SDWebImageDownloaderOperation *soperation = woperation;</div><div class="line">              <span class="keyword">if</span> (!soperation) <span class="keyword">return</span>;</div><div class="line">              <span class="keyword">if</span> (<span class="keyword">self</span>.URLOperations[url] == soperation) &#123;</div><div class="line">                  [<span class="keyword">self</span>.URLOperations removeObjectForKey:url];</div><div class="line">              &#125;;</div><div class="line">            &#125;;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 3. å¤„ç†åŒä¸€URLçš„åŒæ­¥ä¸‹è½½è¯·æ±‚çš„å•ä¸ªä¸‹è½½</span></div><div class="line">        <span class="keyword">id</span> downloadOperationCancelToken = [operation addHandlersForProgress:progressBlock completed:completedBlock];</div><div class="line"></div><div class="line">        token = [SDWebImageDownloadToken new];</div><div class="line">        token.url = url;</div><div class="line">        token.downloadOperationCancelToken = downloadOperationCancelToken;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> token;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ•´ä¸ªä¸‹è½½ç®¡ç†å™¨å¯¹äºä¸‹è½½è¯·æ±‚çš„ç®¡ç†éƒ½æ˜¯æ”¾åœ¨<code>downloadImageWithURL:options:progress:completed:</code>æ–¹æ³•é‡Œé¢æ¥å¤„ç†çš„ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº†ä¸Šé¢æ‰€æåˆ°çš„<code>addProgressCallback:andCompletedBlock:forURL:createCallback:</code>æ–¹æ³•æ¥å°†è¯·æ±‚çš„ä¿¡æ¯å­˜å…¥ç®¡ç†å™¨ä¸­ï¼ŒåŒæ—¶åœ¨åˆ›å»ºå›è°ƒçš„blockä¸­åˆ›å»ºæ–°çš„æ“ä½œï¼Œé…ç½®ä¹‹åå°†å…¶æ”¾å…¥<code>downloadQueue</code>æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œæœ€åæ–¹æ³•è¿”å›æ–°åˆ›å»ºçš„æ“ä½œã€‚å…¶å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> SDWebImageDownloadToken *)downloadImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                                                   options:(SDWebImageDownloaderOptions)options</div><div class="line">                                                  progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                                                 completed:(<span class="keyword">nullable</span> SDWebImageDownloaderCompletedBlock)completedBlock &#123;</div><div class="line">    __<span class="keyword">weak</span> SDWebImageDownloader *wself = <span class="keyword">self</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> addProgressCallback:progressBlock completedBlock:completedBlock forURL:url createCallback:^SDWebImageDownloaderOperation *&#123;</div><div class="line">        __<span class="keyword">strong</span> __<span class="keyword">typeof</span> (wself) sself = wself;</div><div class="line">        <span class="comment">//è¶…æ—¶æ—¶é—´</span></div><div class="line">        <span class="built_in">NSTimeInterval</span> timeoutInterval = sself.downloadTimeout;</div><div class="line">        <span class="keyword">if</span> (timeoutInterval == <span class="number">0.0</span>) &#123;</div><div class="line">            timeoutInterval = <span class="number">15.0</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">// 1. åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æ ¹æ®optionså‚æ•°è®¾ç½®å…¶å±æ€§</span></div><div class="line">        <span class="comment">// ä¸ºäº†é¿å…æ½œåœ¨çš„é‡å¤ç¼“å­˜(NSURLCache + SDImageCache)ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®å‘ŠçŸ¥éœ€è¦ç¼“å­˜ï¼Œåˆ™ç¦ç”¨å›¾ç‰‡è¯·æ±‚çš„ç¼“å­˜æ“ä½œ</span></div><div class="line">        <span class="built_in">NSMutableURLRequest</span> *request = [[<span class="built_in">NSMutableURLRequest</span> alloc] initWithURL:url cachePolicy:(options &amp; SDWebImageDownloaderUseNSURLCache ? <span class="built_in">NSURLRequestUseProtocolCachePolicy</span> : <span class="built_in">NSURLRequestReloadIgnoringLocalCacheData</span>) timeoutInterval:timeoutInterval];</div><div class="line">        request.HTTPShouldHandleCookies = (options &amp; SDWebImageDownloaderHandleCookies);</div><div class="line">        request.HTTPShouldUsePipelining = <span class="literal">YES</span>;</div><div class="line">        <span class="keyword">if</span> (sself.headersFilter) &#123;</div><div class="line">            request.allHTTPHeaderFields = sself.headersFilter(url, [sself.HTTPHeaders <span class="keyword">copy</span>]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            request.allHTTPHeaderFields = sself.HTTPHeaders;</div><div class="line">        &#125;</div><div class="line">        SDWebImageDownloaderOperation *operation = [[sself.operationClass alloc] initWithRequest:request inSession:sself.session options:options];</div><div class="line">        operation.shouldDecompressImages = sself.shouldDecompressImages;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (sself.urlCredential) &#123;</div><div class="line">            operation.credential = sself.urlCredential;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sself.username &amp;&amp; sself.password) &#123;</div><div class="line">            operation.credential = [<span class="built_in">NSURLCredential</span> credentialWithUser:sself.username password:sself.password persistence:<span class="built_in">NSURLCredentialPersistenceForSession</span>];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (options &amp; SDWebImageDownloaderHighPriority) &#123;</div><div class="line">            operation.queuePriority = <span class="built_in">NSOperationQueuePriorityHigh</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options &amp; SDWebImageDownloaderLowPriority) &#123;</div><div class="line">            operation.queuePriority = <span class="built_in">NSOperationQueuePriorityLow</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 2. å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—downloadQueueä¸­</span></div><div class="line">        <span class="comment">// å¦‚æœæ˜¯LIFOé¡ºåºï¼Œåˆ™å°†æ–°çš„æ“ä½œä½œä¸ºåŸé˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªæ“ä½œçš„ä¾èµ–ï¼Œç„¶åå°†æ–°æ“ä½œè®¾ç½®ä¸ºæœ€åä¸€ä¸ªæ“ä½œ</span></div><div class="line">        [sself.downloadQueue addOperation:operation];</div><div class="line">        <span class="keyword">if</span> (sself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) &#123;</div><div class="line">            <span class="comment">// Emulate LIFO execution order by systematically adding new operations as last operation's dependency</span></div><div class="line">            [sself.lastAddedOperation addDependency:operation];</div><div class="line">            sself.lastAddedOperation = operation;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> operation;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œæ¯ä¸ªä¸‹è½½æ“ä½œçš„è¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡downloadTimeoutå±æ€§æ¥è®¾ç½®ï¼Œé»˜è®¤å€¼ä¸º15ç§’ã€‚</p>
<h4 id="ä¸‹è½½æ“ä½œ"><a href="#ä¸‹è½½æ“ä½œ" class="headerlink" title="ä¸‹è½½æ“ä½œ"></a>ä¸‹è½½æ“ä½œ</h4><p>æ¯ä¸ªå›¾ç‰‡çš„ä¸‹è½½æ“ä½œéƒ½æ˜¯ä¸€ä¸ªOperationæ“ä½œã€‚ã€‚æˆ‘ä»¬åœ¨ä¸Šé¢åˆ†æè¿‡è¿™ä¸ªæ“ä½œçš„åˆ›å»ºåŠåŠ å…¥æ“ä½œé˜Ÿåˆ—çš„è¿‡ç¨‹ã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å•ä¸ªæ“ä½œçš„å…·ä½“å®ç°ã€‚</p>
<p>SDWebImageå®šä¹‰äº†ä¸€ä¸ªåè®®ï¼Œå³SDWebImageOperationä½œä¸ºå›¾ç‰‡ä¸‹è½½æ“ä½œçš„åŸºç¡€åè®®ã€‚å®ƒåªå£°æ˜äº†ä¸€ä¸ªcancelæ–¹æ³•ï¼Œç”¨äºå–æ¶ˆæ“ä½œã€‚åè®®çš„å…·ä½“å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SDWebImageOperation</span> &lt;<span class="title">NSObject</span>&gt;</span></div><div class="line">- (<span class="keyword">void</span>)cancel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>SDWebImageè¿˜å®šä¹‰äº†ä¸€ä¸ªä¸‹è½½åè®®ï¼Œå³SDWebImageDownloaderOperationInterfaceï¼Œå®ƒå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ä¸‹è½½æ“ä½œï¼Œå½“ç„¶ï¼ŒSDWebImageä¹Ÿæä¾›äº†è‡ªå·±çš„ä¸‹è½½ç±»ï¼Œå³<code>SDWebImageDownloaderOperation</code>ï¼Œå®ƒç»§æ‰¿è‡ªNSOperationï¼Œå¹¶é‡‡ç”¨äº†<code>SDWebImageOperation</code>å’Œ<code>SDWebImageDownloaderOperationInterface</code>åè®®ã€‚å¹¶ä¸”å®ç°ä»–ä»¬çš„ä»£ç†æ–¹æ³•ã€‚</p>
<p>å¯¹äºå›¾ç‰‡çš„ä¸‹è½½ï¼ŒSDWebImageDownloaderOperationå®Œå…¨ä¾èµ–äºURLåŠ è½½ç³»ç»Ÿä¸­çš„NSURLSessionç±»ã€‚æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹SDWebImageDownloaderOperationç±»ä¸­å¯¹äºå›¾ç‰‡å®é™…æ•°æ®çš„ä¸‹è½½å¤„ç†ï¼Œå³NSURLSessionDataDelegateå’ŒNSURLSessionDataDelegateå„ä¸ªä»£ç†æ–¹æ³•çš„å®ç°ã€‚(ps æœ‰å…³NSURLSessionç±»çš„å…·ä½“ä»‹ç»<a href="http://www.guiyongdong.com/2016/11/18/NSURLSession%E4%B8%8ENSURLConnection%E5%8C%BA%E5%88%AB/">è¯·æˆ³è¿™é‡Œ</a>)</p>
<p>æˆ‘ä»¬å‰é¢è¯´è¿‡SDWebImageDownloaderOperationç±»æ˜¯ç»§æ‰¿è‡ªNSOperationç±»ã€‚å®ƒæ²¡æœ‰ç®€å•çš„å®ç°mainæ–¹æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨æ›´åŠ çµæ´»çš„startæ–¹æ³•ï¼Œä»¥ä¾¿è‡ªå·±ç®¡ç†ä¸‹è½½çš„çŠ¶æ€ã€‚</p>
<p>åœ¨startæ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†æˆ‘ä»¬ä¸‹è½½æ‰€ä½¿ç”¨çš„NSURLSessionå¯¹è±¡ï¼Œå¼€å¯äº†å›¾ç‰‡çš„ä¸‹è½½ï¼ŒåŒæ—¶æŠ›å‡ºä¸€ä¸ªä¸‹è½½å¼€å§‹çš„é€šçŸ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æœŸæœ›ä¸‹è½½åœ¨åå°å¤„ç†ï¼Œåˆ™åªéœ€è¦é…ç½®æˆ‘ä»¬çš„ä¸‹è½½é€‰é¡¹ï¼Œä½¿å…¶åŒ…å«SDWebImageDownloaderContinueInBackgroundé€‰é¡¹ã€‚startæ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)start &#123;</div><div class="line">    <span class="keyword">@synchronized</span> (<span class="keyword">self</span>) &#123;</div><div class="line">    	<span class="comment">// ç®¡ç†ä¸‹è½½çŠ¶æ€ï¼Œå¦‚æœå·²å–æ¶ˆï¼Œåˆ™é‡ç½®å½“å‰ä¸‹è½½å¹¶è®¾ç½®å®ŒæˆçŠ¶æ€ä¸ºYES</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) &#123;</div><div class="line">            <span class="keyword">self</span>.finished = <span class="literal">YES</span>;</div><div class="line">            [<span class="keyword">self</span> reset];</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">		...</div><div class="line"></div><div class="line">        <span class="built_in">NSURLSession</span> *session = <span class="keyword">self</span>.unownedSession;</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">self</span>.unownedSession) &#123;</div><div class="line">        		<span class="comment">//å¦‚æœsessionä¸ºç©ºï¼Œåˆ›å»ºsession</span></div><div class="line">            <span class="built_in">NSURLSessionConfiguration</span> *sessionConfig = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</div><div class="line">            sessionConfig.timeoutIntervalForRequest = <span class="number">15</span>;</div><div class="line">            </div><div class="line">            <span class="keyword">self</span>.ownedSession = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:sessionConfig</div><div class="line">                                                              delegate:<span class="keyword">self</span></div><div class="line">                                                         delegateQueue:<span class="literal">nil</span>];</div><div class="line">            session = <span class="keyword">self</span>.ownedSession;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//åˆ›å»ºä¸‹è½½ä»»åŠ¡</span></div><div class="line">        <span class="keyword">self</span>.dataTask = [session dataTaskWithRequest:<span class="keyword">self</span>.request];</div><div class="line">        <span class="keyword">self</span>.executing = <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//å¼€å¯ä¸‹è½½ä»»åŠ¡</span></div><div class="line">    [<span class="keyword">self</span>.dataTask resume];</div><div class="line">	</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.dataTask) &#123;</div><div class="line">        <span class="keyword">for</span> (SDWebImageDownloaderProgressBlock progressBlock <span class="keyword">in</span> [<span class="keyword">self</span> callbacksForKey:kProgressCallbackKey]) &#123;</div><div class="line">            progressBlock(<span class="number">0</span>, <span class="built_in">NSURLResponseUnknownLength</span>, <span class="keyword">self</span>.request.URL);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 2. åœ¨ä¸»çº¿ç¨‹æŠ›å‡ºä¸‹è½½å¼€å§‹é€šçŸ¥</span></div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:SDWebImageDownloadStartNotification object:<span class="keyword">self</span>];</div><div class="line">        &#125;);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        [<span class="keyword">self</span> callCompletionBlocksWithError:[<span class="built_in">NSError</span> errorWithDomain:<span class="built_in">NSURLErrorDomain</span> code:<span class="number">0</span> userInfo:@&#123;<span class="built_in">NSLocalizedDescriptionKey</span> : <span class="string">@"Connection can't be initialized"</span>&#125;]];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹NSURLSessionDataDelegateä»£ç†çš„å…·ä½“å®ç°ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session</div><div class="line">          dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</div><div class="line">didReceiveResponse:(<span class="built_in">NSURLResponse</span> *)response</div><div class="line"> completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionResponseDisposition</span> disposition))completionHandler &#123;</div><div class="line">    <span class="comment">//æ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”</span></div><div class="line">    <span class="keyword">if</span> (![response respondsToSelector:<span class="keyword">@selector</span>(statusCode)] || (((<span class="built_in">NSHTTPURLResponse</span> *)response).statusCode &lt; <span class="number">400</span> &amp;&amp; ((<span class="built_in">NSHTTPURLResponse</span> *)response).statusCode != <span class="number">304</span>)) &#123;</div><div class="line">    	<span class="comment">//å¦‚æœæœåŠ¡å™¨çŠ¶æ€ç æ­£å¸¸ï¼Œå¹¶ä¸”ä¸æ˜¯304ï¼Œ(å› ä¸º304è¡¨ç¤ºè¿œç¨‹å›¾ç‰‡å¹¶æ²¡æœ‰æ”¹å˜ï¼Œå½“å‰ç¼“å­˜çš„å›¾ç‰‡å°±å¯ä»¥ä½¿ç”¨)æ‹¿åˆ°å›¾ç‰‡çš„å¤§å°ã€‚å¹¶è¿›åº¦å›è°ƒ</span></div><div class="line">        <span class="built_in">NSInteger</span> expected = response.expectedContentLength &gt; <span class="number">0</span> ? (<span class="built_in">NSInteger</span>)response.expectedContentLength : <span class="number">0</span>;</div><div class="line">        <span class="keyword">self</span>.expectedSize = expected;</div><div class="line">        <span class="keyword">for</span> (SDWebImageDownloaderProgressBlock progressBlock <span class="keyword">in</span> [<span class="keyword">self</span> callbacksForKey:kProgressCallbackKey]) &#123;</div><div class="line">            progressBlock(<span class="number">0</span>, expected, <span class="keyword">self</span>.request.URL);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//æ ¹æ®è¿”å›æ•°æ®å¤§å°åˆ›å»ºä¸€ä¸ªæ•°æ®Dataå®¹å™¨</span></div><div class="line">        <span class="keyword">self</span>.imageData = [[<span class="built_in">NSMutableData</span> alloc] initWithCapacity:expected];</div><div class="line">        <span class="keyword">self</span>.response = response;</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        		<span class="comment">//å‘é€æ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”é€šçŸ¥</span></div><div class="line">            [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:SDWebImageDownloadReceiveResponseNotification object:<span class="keyword">self</span>];</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">    	<span class="comment">//çŠ¶æ€ç é”™è¯¯</span></div><div class="line">        <span class="built_in">NSUInteger</span> code = ((<span class="built_in">NSHTTPURLResponse</span> *)response).statusCode;</div><div class="line">        </div><div class="line">        <span class="comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯304</span></div><div class="line">        <span class="keyword">if</span> (code == <span class="number">304</span>) &#123;</div><div class="line">            [<span class="keyword">self</span> cancelInternal];</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            [<span class="keyword">self</span>.dataTask cancel];</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        		<span class="comment">//å‘å‡ºåœæ­¢ä¸‹è½½é€šçŸ¥</span></div><div class="line">            [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:SDWebImageDownloadStopNotification object:<span class="keyword">self</span>];</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">//é”™è¯¯å›è°ƒ</span></div><div class="line">        [<span class="keyword">self</span> callCompletionBlocksWithError:[<span class="built_in">NSError</span> errorWithDomain:<span class="built_in">NSURLErrorDomain</span> code:((<span class="built_in">NSHTTPURLResponse</span> *)response).statusCode userInfo:<span class="literal">nil</span>]];</div><div class="line">			<span class="comment">//é‡ç½®</span></div><div class="line">        [<span class="keyword">self</span> done];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (completionHandler) &#123;</div><div class="line">        completionHandler(<span class="built_in">NSURLSessionResponseAllow</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</div><div class="line">    <span class="comment">//1. æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® å¾€å®¹å™¨ä¸­è¿½åŠ æ•°æ®</span></div><div class="line">    [<span class="keyword">self</span>.imageData appendData:data];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span>.options &amp; SDWebImageDownloaderProgressiveDownload) &amp;&amp; <span class="keyword">self</span>.expectedSize &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//2. è·å–å·²ä¸‹è½½æ•°æ®æ€»å¤§å°</span></div><div class="line">        <span class="keyword">const</span> <span class="built_in">NSInteger</span> totalSize = <span class="keyword">self</span>.imageData.length;</div><div class="line"></div><div class="line">        <span class="comment">// 3. æ›´æ–°æ•°æ®æºï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥æ‰€æœ‰æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ–°æ•°æ®</span></div><div class="line">        <span class="built_in">CGImageSourceRef</span> imageSource = <span class="built_in">CGImageSourceCreateWithData</span>((__bridge <span class="built_in">CFDataRef</span>)<span class="keyword">self</span>.imageData, <span class="literal">NULL</span>);</div><div class="line">        <span class="comment">// 4. é¦–æ¬¡è·å–åˆ°æ•°æ®æ—¶ï¼Œä»è¿™äº›æ•°æ®ä¸­è·å–å›¾ç‰‡çš„é•¿ã€å®½ã€æ–¹å‘å±æ€§å€¼</span></div><div class="line">        <span class="keyword">if</span> (width + height == <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">CFDictionaryRef</span> properties = <span class="built_in">CGImageSourceCopyPropertiesAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">            <span class="keyword">if</span> (properties) &#123;</div><div class="line">                <span class="built_in">NSInteger</span> orientationValue = <span class="number">-1</span>;</div><div class="line">                <span class="built_in">CFTypeRef</span> val = <span class="built_in">CFDictionaryGetValue</span>(properties, kCGImagePropertyPixelHeight);</div><div class="line">                <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, kCFNumberLongType, &amp;height);</div><div class="line">                val = <span class="built_in">CFDictionaryGetValue</span>(properties, kCGImagePropertyPixelWidth);</div><div class="line">                <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, kCFNumberLongType, &amp;width);</div><div class="line">                val = <span class="built_in">CFDictionaryGetValue</span>(properties, kCGImagePropertyOrientation);</div><div class="line">                <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, kCFNumberNSIntegerType, &amp;orientationValue);</div><div class="line">                <span class="built_in">CFRelease</span>(properties);</div><div class="line"></div><div class="line">                <span class="comment">// 5. å½“ç»˜åˆ¶åˆ°Core Graphicsæ—¶ï¼Œæˆ‘ä»¬ä¼šä¸¢å¤±æ–¹å‘ä¿¡æ¯ï¼Œè¿™æ„å‘³ç€æœ‰æ—¶å€™ç”±initWithCGIImageåˆ›å»ºçš„å›¾ç‰‡</span></div><div class="line">                <span class="comment">//    çš„æ–¹å‘ä¼šä¸å¯¹ï¼Œæ‰€ä»¥åœ¨è¿™è¾¹æˆ‘ä»¬å…ˆä¿å­˜è¿™ä¸ªä¿¡æ¯å¹¶åœ¨åé¢ä½¿ç”¨ã€‚</span></div><div class="line"><span class="meta">#if SD_UIKIT || SD_WATCH</span></div><div class="line">                orientation = [[<span class="keyword">self</span> <span class="keyword">class</span>] orientationFromPropertyValue:(orientationValue == <span class="number">-1</span> ? <span class="number">1</span> : orientationValue)];</div><div class="line"><span class="meta">#endif</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 6. å›¾ç‰‡è¿˜æœªä¸‹è½½å®Œæˆ</span></div><div class="line">        <span class="keyword">if</span> (width + height &gt; <span class="number">0</span> &amp;&amp; totalSize &lt; <span class="keyword">self</span>.expectedSize) &#123;</div><div class="line">            <span class="comment">// 7. ä½¿ç”¨ç°æœ‰çš„æ•°æ®åˆ›å»ºå›¾ç‰‡å¯¹è±¡ï¼Œå¦‚æœæ•°æ®ä¸­å­˜æœ‰å¤šå¼ å›¾ç‰‡ï¼Œåˆ™å–ç¬¬ä¸€å¼ </span></div><div class="line">            <span class="built_in">CGImageRef</span> partialImageRef = <span class="built_in">CGImageSourceCreateImageAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line"><span class="meta">#if SD_UIKIT || SD_WATCH</span></div><div class="line">            <span class="comment">// 8. é€‚ç”¨äºiOSå˜å½¢å›¾åƒçš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘çš„ç†è§£æ˜¯ç”±äºiOSåªæ”¯æŒRGBé¢œè‰²ç©ºé—´ï¼Œæ‰€ä»¥åœ¨æ­¤å¯¹ä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡åšä¸ªé¢œè‰²ç©ºé—´è½¬æ¢å¤„ç†ã€‚</span></div><div class="line">            <span class="keyword">if</span> (partialImageRef) &#123;</div><div class="line">                <span class="keyword">const</span> size_t partialHeight = <span class="built_in">CGImageGetHeight</span>(partialImageRef);</div><div class="line">                <span class="built_in">CGColorSpaceRef</span> colorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</div><div class="line">                <span class="built_in">CGContextRef</span> bmContext = <span class="built_in">CGBitmapContextCreate</span>(<span class="literal">NULL</span>, width, height, <span class="number">8</span>, width * <span class="number">4</span>, colorSpace, kCGBitmapByteOrderDefault | kCGImageAlphaPremultipliedFirst);</div><div class="line">                <span class="built_in">CGColorSpaceRelease</span>(colorSpace);</div><div class="line">                <span class="keyword">if</span> (bmContext) &#123;</div><div class="line">                    <span class="built_in">CGContextDrawImage</span>(bmContext, (<span class="built_in">CGRect</span>)&#123;.origin.x = <span class="number">0.0</span>f, .origin.y = <span class="number">0.0</span>f, .size.width = width, .size.height = partialHeight&#125;, partialImageRef);</div><div class="line">                    <span class="built_in">CGImageRelease</span>(partialImageRef);</div><div class="line">                    partialImageRef = <span class="built_in">CGBitmapContextCreateImage</span>(bmContext);</div><div class="line">                    <span class="built_in">CGContextRelease</span>(bmContext);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="built_in">CGImageRelease</span>(partialImageRef);</div><div class="line">                    partialImageRef = <span class="literal">nil</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"><span class="meta">#endif</span></div><div class="line">            <span class="comment">// 9. å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾ã€è§£ç æ“ä½œ</span></div><div class="line">            <span class="keyword">if</span> (partialImageRef) &#123;</div><div class="line"><span class="meta">#if SD_UIKIT || SD_WATCH</span></div><div class="line">                <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithCGImage:partialImageRef scale:<span class="number">1</span> orientation:orientation];</div><div class="line"><span class="meta">#elif SD_MAC</span></div><div class="line">                <span class="built_in">UIImage</span> *image = [[<span class="built_in">UIImage</span> alloc] initWithCGImage:partialImageRef size:<span class="built_in">NSZeroSize</span>];</div><div class="line"><span class="meta">#endif</span></div><div class="line">                <span class="built_in">NSString</span> *key = [[SDWebImageManager sharedManager] cacheKeyForURL:<span class="keyword">self</span>.request.URL];</div><div class="line">                <span class="built_in">UIImage</span> *scaledImage = [<span class="keyword">self</span> scaledImageForKey:key image:image];</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">self</span>.shouldDecompressImages) &#123;</div><div class="line">                    image = [<span class="built_in">UIImage</span> decodedImageWithImage:scaledImage];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span> &#123;</div><div class="line">                    image = scaledImage;</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">CGImageRelease</span>(partialImageRef);</div><div class="line">                </div><div class="line">                [<span class="keyword">self</span> callCompletionBlocksWithImage:image imageData:<span class="literal">nil</span> error:<span class="literal">nil</span> finished:<span class="literal">NO</span>];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="built_in">CFRelease</span>(imageSource);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (SDWebImageDownloaderProgressBlock progressBlock <span class="keyword">in</span> [<span class="keyword">self</span> callbacksForKey:kProgressCallbackKey]) &#123;</div><div class="line">        progressBlock(<span class="keyword">self</span>.imageData.length, <span class="keyword">self</span>.expectedSize, <span class="keyword">self</span>.request.URL);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å½“ç„¶ï¼Œåœ¨ä¸‹è½½å®Œæˆæˆ–ä¸‹è½½å¤±è´¥åï¼Œä¼šè°ƒç”¨NSURLSessionTaskDelegateçš„<code>- (void)URLSession: task: didCompleteWithError:</code>ä»£ç†æ–¹æ³•ï¼Œå¹¶æ¸…é™¤è¿æ¥ï¼Œå¹¶æŠ›å‡ºä¸‹è½½åœæ­¢çš„é€šçŸ¥ã€‚å¦‚æœä¸‹è½½æˆåŠŸï¼Œåˆ™ä¼šå¤„ç†å®Œæ•´çš„å›¾ç‰‡æ•°æ®ï¼Œå¯¹å…¶è¿›è¡Œé€‚å½“çš„ç¼©æ”¾ä¸è§£å‹ç¼©æ“ä½œï¼Œä»¥æä¾›ç»™å®Œæˆå›è°ƒä½¿ç”¨ã€‚</p>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>ä¸‹è½½çš„æ ¸å¿ƒå…¶å®å°±æ˜¯åˆ©ç”¨NSURLSessionå¯¹è±¡æ¥åŠ è½½æ•°æ®ã€‚æ¯ä¸ªå›¾ç‰‡çš„ä¸‹è½½éƒ½ç”±ä¸€ä¸ªOperationæ“ä½œæ¥å®Œæˆï¼Œå¹¶å°†è¿™äº›æ“ä½œæ”¾åˆ°ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä¸­ã€‚è¿™æ ·å¯ä»¥å®ç°å›¾ç‰‡çš„å¹¶å‘ä¸‹è½½ã€‚</p>
<h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p>ä¸ºäº†å‡å°‘ç½‘ç»œæµé‡çš„æ¶ˆè€—ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›ä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡ç¼“å­˜åˆ°æœ¬åœ°ï¼Œä¸‹æ¬¡å†å»è·å–åŒä¸€å¼ å›¾ç‰‡æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»æœ¬åœ°è·å–ï¼Œè€Œä¸å†ä»è¿œç¨‹æœåŠ¡å™¨è·å–ã€‚è¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„æ˜¯æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œç”¨æˆ·ç¬¬äºŒæ¬¡æŸ¥çœ‹åŒä¸€å¹…å›¾ç‰‡æ—¶ï¼Œèƒ½å¿«é€Ÿä»æœ¬åœ°è·å–å›¾ç‰‡ç›´æ¥å‘ˆç°ç»™ç”¨æˆ·ã€‚</p>
<p>SDWebImageæä¾›äº†å¯¹å›¾ç‰‡ç¼“å­˜çš„æ”¯æŒï¼Œè€Œè¯¥åŠŸèƒ½æ˜¯ç”±SDImageCacheç±»å®Œæˆçš„ã€‚è¯¥ç±»è´Ÿè´£å¤„ç†å†…å­˜ç¼“å­˜åŠä¸€ä¸ªå¯é€‰çš„ç£ç›˜ç¼“å­˜ã€‚å…¶ä¸­ç£ç›˜ç¼“å­˜çš„å†™æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¹UIæ“ä½œé€ æˆå½±å“ã€‚</p>
<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>å¦å¤–è¯´æ˜ï¼Œåœ¨4.0ä»¥åæ–°æ·»åŠ ä¸€ä¸ªç¼“å­˜é…ç½®ç±»<code>SDImageCacheConfig</code> ,ä¸»è¦æ˜¯ä¸€äº›ç¼“å­˜ç­–ç•¥çš„é…ç½®ã€‚å…¶å¤´æ–‡ä»¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">æ˜¯å¦åœ¨ç¼“å­˜çš„æ—¶å€™è§£å‹ç¼©ï¼Œé»˜è®¤æ˜¯YES å¯ä»¥æé«˜æ€§èƒ½ ä½†æ˜¯ä¼šè€—å†…å­˜ã€‚ å½“ä½¿ç”¨SDWebImage å› ä¸ºå†…å­˜è€Œå´©æºƒ å¯ä»¥å°†å…¶è®¾ç½®ä¸ºNO</div><div class="line"> */</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> shouldDecompressImages;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦ç¦ç”¨ iCloud å¤‡ä»½ é»˜è®¤YES</div><div class="line"> */</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> shouldDisableiCloud;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * å†…å­˜ç¼“å­˜  é»˜è®¤YES</div><div class="line"> */</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> shouldCacheImagesInMemory;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * æœ€å¤§ç£ç›˜ç¼“å­˜æ—¶é—´ é»˜è®¤ä¸€å‘¨ å•ä½ç§’</div><div class="line"> */</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> maxCacheAge;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * æœ€å¤§ç¼“å­˜å®¹é‡ 0 è¡¨ç¤ºæ— é™ç¼“å­˜  å•ä½å­—èŠ‚</div><div class="line"> */</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSUInteger</span> maxCacheSize;</div></pre></td></tr></table></figure>
<h4 id="å†…å­˜ç¼“å­˜åŠç£ç›˜ç¼“å­˜"><a href="#å†…å­˜ç¼“å­˜åŠç£ç›˜ç¼“å­˜" class="headerlink" title="å†…å­˜ç¼“å­˜åŠç£ç›˜ç¼“å­˜"></a>å†…å­˜ç¼“å­˜åŠç£ç›˜ç¼“å­˜</h4><p>å†…å­˜ç¼“å­˜çš„å¤„ç†ä½¿ç”¨NSCacheå¯¹è±¡æ¥å®ç°çš„ã€‚NSCacheæ˜¯ä¸€ä¸ªç±»ä¼¼ä¸é›†åˆçš„å®¹å™¨ã€‚å®ƒå­˜å‚¨key-valueå¯¹ï¼Œè¿™ä¸€ç‚¹ç±»ä¼¼äºNSDictionaryç±»ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ç¼“å­˜æ¥ä¸´æ—¶å­˜å‚¨çŸ­æ—¶é—´ä½¿ç”¨ä½†åˆ›å»ºæ˜‚è´µçš„å¯¹è±¡ã€‚é‡ç”¨è¿™äº›å¯¹è±¡å¯ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼ä¸éœ€è¦é‡æ–°è®¡ç®—ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œè¿™äº›å¯¹è±¡å¯¹äºç¨‹åºå‘˜æ¥è¯´ä¸æ˜¯ç´§è¦çš„ï¼Œåœ¨å†…å­˜ç´§å¼ æ—¶ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p>ç£ç›˜ç¼“å­˜çš„å¤„ç†åˆ™æ˜¯ä½¿ç”¨NSFileManagerå¯¹è±¡æ¥å®ç°çš„ã€‚å›¾ç‰‡å­˜å‚¨çš„ä½ç½®æ˜¯ä½äºCachesæ–‡ä»¶å¤¹ä¸­çš„defaultæ–‡ä»¶å¤¹ä¸‹ã€‚å¦å¤–ï¼ŒSDImageCacheè¿˜å®šä¹‰äº†ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œæ¥å¼‚æ­¥å­˜å‚¨å›¾ç‰‡ã€‚</p>
<p>å†…å­˜ç¼“å­˜ä¸ç£ç›˜ç¼“å­˜ç›¸å…³å˜é‡çš„å£°æ˜åŠå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SDImageCache</span> ()</span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Properties</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nonnull</span>) <span class="built_in">NSCache</span> *memCache;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nonnull</span>) <span class="built_in">NSString</span> *diskCachePath;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSString</span> *&gt; *customPaths;</div><div class="line"><span class="keyword">@property</span> (SDDispatchQueueSetterSementics, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">dispatch_queue_t</span> ioQueue;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SDImageCache</span> </span>&#123;</div><div class="line">    <span class="built_in">NSFileManager</span> *_fileManager;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">nonnull</span> <span class="keyword">instancetype</span>)initWithNamespace:(<span class="keyword">nonnull</span> <span class="built_in">NSString</span> *)ns</div><div class="line">                       diskCacheDirectory:(<span class="keyword">nonnull</span> <span class="built_in">NSString</span> *)directory &#123;</div><div class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">        <span class="built_in">NSString</span> *fullNamespace = [<span class="string">@"com.hackemist.SDWebImageCache."</span> stringByAppendingString:ns];</div><div class="line">        </div><div class="line">        <span class="comment">// é˜Ÿåˆ—</span></div><div class="line">        _ioQueue = dispatch_queue_create(<span class="string">"com.hackemist.SDWebImageCache"</span>, DISPATCH_QUEUE_SERIAL);</div><div class="line">        <span class="comment">//ç¼“å­˜é…ç½®</span></div><div class="line">        _config = [[SDImageCacheConfig alloc] init];</div><div class="line">        </div><div class="line">        <span class="comment">// å†…å­˜ç¼“å­˜</span></div><div class="line">        _memCache = [[AutoPurgeCache alloc] init];</div><div class="line">        _memCache.name = fullNamespace;</div><div class="line"></div><div class="line">        <span class="comment">// åˆå§‹åŒ–ç£ç›˜ç¼“å­˜è·¯å¾„</span></div><div class="line">        <span class="keyword">if</span> (directory != <span class="literal">nil</span>) &#123;</div><div class="line">            _diskCachePath = [directory stringByAppendingPathComponent:fullNamespace];</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> makeDiskCachePath:ns];</div><div class="line">            _diskCachePath = path;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="built_in">dispatch_sync</span>(_ioQueue, ^&#123;</div><div class="line">            _fileManager = [<span class="built_in">NSFileManager</span> new];</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>SDImageCacheæä¾›äº†å¤§é‡æ–¹æ³•æ¥ç¼“å­˜ã€è·å–ã€ç§»é™¤ã€åŠæ¸…ç©ºå›¾ç‰‡ã€‚è€Œå¯¹äºæ¯ä¸€ä¸ªå›¾ç‰‡ï¼Œä¸ºäº†æ–¹ä¾¿åœ°åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­å¯¹å®ƒè¿›è¡Œè¿™äº›æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªkeyå€¼æ¥ç´¢å¼•å®ƒã€‚åœ¨å†…å­˜ä¸­ï¼Œæˆ‘ä»¬å°†å…¶ä½œä¸ºNSCacheçš„keyå€¼ï¼Œè€Œåœ¨ç£ç›˜ä¸­ï¼Œæˆ‘ä»¬ç”¨ä½œè¿™ä¸ªkeyä½œä¸ºå›¾ç‰‡çš„æ–‡ä»¶åã€‚å¯¹äºä¸€ä¸ªè¿œç¨‹æœåŠ¡å™¨ä¸‹è½½çš„å›¾ç‰‡ï¼Œå…¶urlå®ä½œä¸ºè¿™ä¸ªkeyçš„æœ€ä½³é€‰æ‹©äº†ã€‚æˆ‘ä»¬åœ¨åé¢ä¼šçœ‹åˆ°è¿™ä¸ªkeyå€¼å¾—é‡è¦æ€§ã€‚</p>
<h4 id="å­˜å‚¨å›¾ç‰‡"><a href="#å­˜å‚¨å›¾ç‰‡" class="headerlink" title="å­˜å‚¨å›¾ç‰‡"></a>å­˜å‚¨å›¾ç‰‡</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å›¾ç‰‡çš„ç¼“å­˜æ“ä½œï¼Œè¯¥æ“ä½œä¼šåœ¨å†…å­˜ä¸­æ”¾ç½®ä¸€ä»½ç¼“å­˜ï¼Œè€Œå¦‚æœç¡®å®šéœ€è¦ç¼“å­˜åˆ°ç£ç›˜ï¼Œåˆ™å°†ç£ç›˜ç¼“å­˜æ“ä½œä½œä¸ºä¸€ä¸ªtaskæ”¾åˆ°ä¸²è¡Œé˜Ÿåˆ—ä¸­å¤„ç†ã€‚åœ¨iOSä¸­ï¼Œä¼šå…ˆæ£€æµ‹å›¾ç‰‡æ˜¯PNGè¿˜æ˜¯JPEGï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºç›¸åº”çš„å›¾ç‰‡æ•°æ®ï¼Œæœ€åå°†æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­(æ–‡ä»¶åæ˜¯å¯¹keyå€¼åšMD5æ‘˜è¦åçš„ä¸²)ã€‚ç¼“å­˜æ“ä½œçš„åŸºç¡€æ–¹æ³•æ˜¯ï¼š<code>-storeImage:imageData:forKey:toDisk:completion:</code>,å®ƒçš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)storeImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)image</div><div class="line">         imageData:(<span class="keyword">nullable</span> <span class="built_in">NSData</span> *)imageData</div><div class="line">            forKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key</div><div class="line">            toDisk:(<span class="built_in">BOOL</span>)toDisk</div><div class="line">        completion:(<span class="keyword">nullable</span> SDWebImageNoParamsBlock)completionBlock &#123;</div><div class="line">    <span class="keyword">if</span> (!image || !key) &#123;</div><div class="line">        <span class="keyword">if</span> (completionBlock) &#123;</div><div class="line">            completionBlock();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å†…å­˜ç¼“å­˜ å°†å…¶å­˜å…¥NSCacheä¸­ï¼ŒåŒæ—¶ä¼ å…¥å›¾ç‰‡çš„æ¶ˆè€—å€¼</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.config.shouldCacheImagesInMemory) &#123;</div><div class="line">        <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(image);</div><div class="line">        [<span class="keyword">self</span>.memCache setObject:image forKey:key cost:cost];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å¦‚æœç¡®å®šéœ€è¦ç£ç›˜ç¼“å­˜ï¼Œåˆ™å°†ç¼“å­˜æ“ä½œä½œä¸ºä¸€ä¸ªä»»åŠ¡æ”¾å…¥ioQueueä¸­</span></div><div class="line">    <span class="keyword">if</span> (toDisk) &#123;</div><div class="line">        <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</div><div class="line">            <span class="built_in">NSData</span> *data = imageData;</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> (!data &amp;&amp; image) &#123;</div><div class="line">            		<span class="comment">//å¦‚æœimageDataä¸ºnil éœ€è¦ç¡®å®šå›¾ç‰‡æ˜¯PNGè¿˜æ˜¯JPEGã€‚PNGå›¾ç‰‡å®¹æ˜“æ£€æµ‹ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå”¯ä¸€ç­¾åã€‚PNGå›¾åƒçš„å‰8ä¸ªå­—èŠ‚æ€»æ˜¯åŒ…å«ä»¥ä¸‹å€¼ï¼š137 80 78 71 13 10 26 10	</span></div><div class="line">            		<span class="comment">//åˆ¤æ–­ å›¾ç‰‡æ˜¯ä½•ç§ç±»å‹ ä½¿ç”¨ sd_imageFormatForImageData æ¥åˆ¤æ–­</span></div><div class="line">            		<span class="comment">// SDImageFormat æ˜¯ä¸€ä¸ªæšä¸¾  å…¶å®šä¹‰å¦‚ä¸‹ï¼š</span></div><div class="line"><span class="comment">//                typedef NS_ENUM(NSInteger, SDImageFormat) &#123;</span></div><div class="line"><span class="comment">//                    SDImageFormatUndefined = -1,</span></div><div class="line"><span class="comment">//                    SDImageFormatJPEG = 0,</span></div><div class="line"><span class="comment">//                    SDImageFormatPNG,</span></div><div class="line"><span class="comment">//                    SDImageFormatGIF,</span></div><div class="line"><span class="comment">//                    SDImageFormatTIFF,</span></div><div class="line"><span class="comment">//                    SDImageFormatWebP</span></div><div class="line"><span class="comment">//                &#125;;</span></div><div class="line">                SDImageFormat imageFormatFromData = [<span class="built_in">NSData</span> sd_imageFormatForImageData:data];</div><div class="line">                <span class="comment">//æ ¹æ®å›¾ç‰‡ç±»å‹ è½¬æˆdata</span></div><div class="line">                data = [image sd_imageDataAsFormat:imageFormatFromData];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 4. åˆ›å»ºç¼“å­˜æ–‡ä»¶å¹¶å­˜å‚¨å›¾ç‰‡</span></div><div class="line">            [<span class="keyword">self</span> storeImageDataToDisk:data forKey:key];</div><div class="line">            <span class="keyword">if</span> (completionBlock) &#123;</div><div class="line">                <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                    completionBlock();</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (completionBlock) &#123;</div><div class="line">            completionBlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æŸ¥è¯¢å›¾ç‰‡"><a href="#æŸ¥è¯¢å›¾ç‰‡" class="headerlink" title="æŸ¥è¯¢å›¾ç‰‡"></a>æŸ¥è¯¢å›¾ç‰‡</h4><p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­æŸ¥è¯¢æ˜¯å¦æœ‰keyæŒ‡å®šçš„å›¾ç‰‡ï¼Œåˆ™å¯ä»¥åˆ†åˆ«ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//å¿«é€ŸæŸ¥è¯¢å›¾ç‰‡æ˜¯å¦å·²ç»ç£ç›˜ç¼“å­˜ ä¸è¿”å›å›¾ç‰‡ åªåšå¿«é€ŸæŸ¥è¯¢ å¼‚æ­¥æ“ä½œ</span></div><div class="line">- (<span class="keyword">void</span>)diskImageExistsWithKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key completion:(<span class="keyword">nullable</span> SDWebImageCheckCacheCompletionBlock)completionBlock;</div><div class="line"><span class="comment">//å¼‚æ­¥æŸ¥è¯¢å›¾ç‰‡ ä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç£ç›˜ç¼“å­˜</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSOperation</span> *)queryCacheOperationForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key done:(<span class="keyword">nullable</span> SDCacheQueryCompletedBlock)doneBlock;</div><div class="line"><span class="comment">//ä»å†…å­˜ä¸­æŸ¥è¯¢å›¾ç‰‡</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)imageFromMemoryCacheForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key;</div><div class="line"><span class="comment">//ä»ç£ç›˜ä¸­æŸ¥è¯¢å›¾ç‰‡</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)imageFromDiskCacheForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key;</div><div class="line"><span class="comment">//åŒæ­¥æŸ¥è¯¢å›¾ç‰‡ï¼Œä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç£ç›˜ç¼“å­˜</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)imageFromCacheForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key;</div></pre></td></tr></table></figure>
<p>å…¶å®<code>- (nullable UIImage *)imageFromCacheForKey:(nullable NSString *)key</code>å†…éƒ¨å®ç°æ˜¯è°ƒç”¨äº†<code>- (nullable UIImage *)imageFromMemoryCacheForKey:(nullable NSString *)key</code>å’Œ<code>- (nullable UIImage *)imageFromDiskCacheForKey:(nullable NSString *)key</code>æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)imageFromCacheForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key &#123;</div><div class="line">    <span class="comment">// ä»ç¼“å­˜ä¸­æŸ¥æ‰¾å›¾ç‰‡</span></div><div class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageFromMemoryCacheForKey:key];</div><div class="line">    <span class="keyword">if</span> (image) &#123;</div><div class="line">        <span class="keyword">return</span> image;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// ä»ç£ç›˜ä¸­æŸ¥æ‰¾å›¾ç‰‡</span></div><div class="line">    image = [<span class="keyword">self</span> imageFromDiskCacheForKey:key];</div><div class="line">    <span class="keyword">return</span> image;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å¼‚æ­¥æŸ¥è¯¢å›¾ç‰‡çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSOperation</span> *)queryCacheOperationForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key done:(<span class="keyword">nullable</span> SDCacheQueryCompletedBlock)doneBlock &#123;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// 1. é¦–å…ˆæŸ¥çœ‹å†…å­˜ç¼“å­˜ï¼Œå¦‚æœæŸ¥æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥å›è°ƒdoneBlockå¹¶è¿”å›</span></div><div class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageFromMemoryCacheForKey:key];</div><div class="line">    <span class="keyword">if</span> (image) &#123;</div><div class="line">        <span class="built_in">NSData</span> *diskData = <span class="literal">nil</span>;</div><div class="line">        <span class="comment">//è¿›è¡Œäº†æ˜¯å¦æ˜¯GIFçš„åˆ¤æ–­</span></div><div class="line">        <span class="keyword">if</span> ([image isGIF]) &#123;</div><div class="line">            diskData = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (doneBlock) &#123;</div><div class="line">            doneBlock(image, diskData, SDImageCacheTypeMemory);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 2. å¦‚æœå†…å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™åœ¨ç£ç›˜ä¸­æŸ¥æ‰¾ã€‚å¦‚æœæ‰¾åˆ°ï¼Œåˆ™å°†å…¶æ”¾åˆ°å†…å­˜ç¼“å­˜ï¼Œå¹¶è°ƒç”¨doneBlockå›è°ƒ</span></div><div class="line">    <span class="built_in">NSOperation</span> *operation = [<span class="built_in">NSOperation</span> new];</div><div class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</div><div class="line">        <span class="keyword">if</span> (operation.isCancelled) &#123;</div><div class="line">            <span class="comment">// do not call the completion if cancelled</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">            <span class="built_in">NSData</span> *diskData = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</div><div class="line">            <span class="built_in">UIImage</span> *diskImage = [<span class="keyword">self</span> diskImageForKey:key];</div><div class="line">            <span class="keyword">if</span> (diskImage &amp;&amp; <span class="keyword">self</span>.config.shouldCacheImagesInMemory) &#123;</div><div class="line">                <span class="comment">//è¿›è¡Œå†…å­˜ç¼“å­˜</span></div><div class="line">                <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(diskImage);</div><div class="line">                [<span class="keyword">self</span>.memCache setObject:diskImage forKey:key cost:cost];</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (doneBlock) &#123;</div><div class="line">                <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                    doneBlock(diskImage, diskData, SDImageCacheTypeDisk);</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> operation;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç§»é™¤å›¾ç‰‡"><a href="#ç§»é™¤å›¾ç‰‡" class="headerlink" title="ç§»é™¤å›¾ç‰‡"></a>ç§»é™¤å›¾ç‰‡</h4><p>å›¾ç‰‡çš„ç§»é™¤æ“ä½œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ä»å†…å­˜å’Œç£ç›˜ä¸­ç§»é™¤å›¾ç‰‡</span></div><div class="line">- (<span class="keyword">void</span>)removeImageForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key withCompletion:(<span class="keyword">nullable</span> SDWebImageNoParamsBlock)completion;</div><div class="line"><span class="comment">//ä»å†…å­˜ æˆ– å¯é€‰ç£ç›˜ä¸­ç§»é™¤å›¾ç‰‡</span></div><div class="line">- (<span class="keyword">void</span>)removeImageForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key fromDisk:(<span class="built_in">BOOL</span>)fromDisk withCompletion:(<span class="keyword">nullable</span> SDWebImageNoParamsBlock)completion;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©åŒæ—¶ç§»é™¤å†…å­˜åŠç£ç›˜ä¸Šçš„å›¾ç‰‡,æˆ–è€…åªç§»é™¤å†…å­˜ä¸­çš„å›¾ç‰‡ã€‚</p>
<h4 id="æ¸…ç†å›¾ç‰‡"><a href="#æ¸…ç†å›¾ç‰‡" class="headerlink" title="æ¸…ç†å›¾ç‰‡"></a>æ¸…ç†å›¾ç‰‡</h4><p>ç£ç›˜ç¼“å­˜å›¾ç‰‡çš„æ“ä½œå¯ä»¥åˆ†ä¸ºå®Œå…¨æ¸…ç©ºå’Œéƒ¨åˆ†æ¸…ç†ã€‚å®Œå…¨æ¸…ç©ºæ“ä½œæ˜¯ç›´æ¥æŠŠç¼“å­˜çš„æ–‡ä»¶å¤¹ç§»é™¤ï¼Œéƒ¨åˆ†æ¸…ç†æ˜¯æ¸…ç†æ‰è¿‡æ—¶çš„æ—§å›¾ç‰‡ï¼Œæ¸…ç©ºæ“ä½œæœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//æ¸…é™¤å†…å­˜ç¼“å­˜</span></div><div class="line">- (<span class="keyword">void</span>)clearMemory;</div><div class="line"></div><div class="line"><span class="comment">//å®Œå…¨æ¸…ç©ºç£ç›˜ç¼“å­˜</span></div><div class="line">- (<span class="keyword">void</span>)clearDiskOnCompletion:(<span class="keyword">nullable</span> SDWebImageNoParamsBlock)completion;</div><div class="line"></div><div class="line"><span class="comment">//æ¸…ç©ºæ—§å›¾ç‰‡</span></div><div class="line">- (<span class="keyword">void</span>)deleteOldFilesWithCompletionBlock:(<span class="keyword">nullable</span> SDWebImageNoParamsBlock)completionBlock;</div></pre></td></tr></table></figure>
<p>è€Œéƒ¨åˆ†æ¸…ç†åˆ™æ˜¯æ ¹æ®æˆ‘ä»¬è®¾å®šçš„ä¸€äº›å‚æ•°æ¥ç§»é™¤ä¸€äº›æ–‡ä»¶ï¼Œè¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªæŒ‡æ ‡ï¼šæ–‡ä»¶çš„ç¼“å­˜æœ‰æ•ˆæœŸåŠæœ€å¤§ç¼“å­˜ç©ºé—´å¤§å°ã€‚æ–‡ä»¶çš„ç¼“å­˜æœ‰æ•ˆæœŸå¯ä»¥é€šè¿‡<code>SDImageCacheConfig</code>ç±»çš„<code>maxCacheAge</code>å±æ€§æ¥è®¾ç½®ï¼Œé»˜è®¤æ˜¯1å‘¨çš„æ—¶é—´ã€‚å¦‚æœæ–‡ä»¶çš„ç¼“å­˜æ—¶é—´è¶…è¿‡è¿™ä¸ªæ—¶é—´å€¼ï¼Œåˆ™å°†å…¶ç§»é™¤ã€‚è€Œæœ€å¤§ç¼“å­˜ç©ºé—´å¤§å°æ˜¯é€šè¿‡<code>maxCacheSize</code>å±æ€§æ¥è®¾ç½®çš„ï¼Œå¦‚æœæ‰€æœ‰ç¼“å­˜æ–‡ä»¶çš„æ€»å¤§å°è¶…è¿‡è¿™ä¸€å¤§å°ï¼Œåˆ™ä¼šæŒ‰ç…§æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´çš„é€†åºï¼Œä»¥æ¯æ¬¡ä¸€åŠçš„é€’å½’æ¥ç§»é™¤é‚£äº›è¿‡æ—©çš„æ–‡ä»¶ï¼Œç›´åˆ°ç¼“å­˜çš„å®é™…å¤§å°å°äºæˆ‘ä»¬è®¾ç½®çš„æœ€å¤§ä½¿ç”¨ç©ºé—´ã€‚æ¸…ç†çš„æ“ä½œåœ¨<code>-deleteOldFilesWithCompletionBlock:</code>æ–¹æ³•ä¸­ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)deleteOldFilesWithCompletionBlock:(<span class="keyword">nullable</span> SDWebImageNoParamsBlock)completionBlock &#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</div><div class="line">        <span class="built_in">NSURL</span> *diskCacheURL = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="keyword">self</span>.diskCachePath isDirectory:<span class="literal">YES</span>];</div><div class="line">        <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *resourceKeys = @[<span class="built_in">NSURLIsDirectoryKey</span>, <span class="built_in">NSURLContentModificationDateKey</span>, <span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</div><div class="line"></div><div class="line">        <span class="comment">// 1. è¯¥æšä¸¾å™¨é¢„å…ˆè·å–ç¼“å­˜æ–‡ä»¶çš„æœ‰ç”¨çš„å±æ€§</span></div><div class="line">        <span class="built_in">NSDirectoryEnumerator</span> *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL</div><div class="line">                                                   includingPropertiesForKeys:resourceKeys</div><div class="line">                                                                      options:<span class="built_in">NSDirectoryEnumerationSkipsHiddenFiles</span></div><div class="line">                                                                 errorHandler:<span class="literal">NULL</span>];</div><div class="line"></div><div class="line">        <span class="built_in">NSDate</span> *expirationDate = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:-<span class="keyword">self</span>.config.maxCacheAge];</div><div class="line">        <span class="built_in">NSMutableDictionary</span>&lt;<span class="built_in">NSURL</span> *, <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *&gt; *cacheFiles = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">        <span class="built_in">NSUInteger</span> currentCacheSize = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="comment">// 2. æšä¸¾ç¼“å­˜æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶ï¼Œè¯¥è¿­ä»£æœ‰ä¸¤ä¸ªç›®çš„ï¼šç§»é™¤æ¯”è¿‡æœŸæ—¥æœŸæ›´è€çš„æ–‡ä»¶ï¼›å­˜å‚¨æ–‡ä»¶å±æ€§ä»¥å¤‡åé¢æ‰§è¡ŒåŸºäºç¼“å­˜å¤§å°çš„æ¸…ç†æ“ä½œ</span></div><div class="line">        <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSURL</span> *&gt; *urlsToDelete = [[<span class="built_in">NSMutableArray</span> alloc] init];</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> fileEnumerator) &#123;</div><div class="line">            <span class="built_in">NSError</span> *error;</div><div class="line">            <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *resourceValues = [fileURL resourceValuesForKeys:resourceKeys error:&amp;error];</div><div class="line"></div><div class="line">            <span class="comment">// 3. è·³è¿‡æ–‡ä»¶å¤¹</span></div><div class="line">            <span class="keyword">if</span> (error || !resourceValues || [resourceValues[<span class="built_in">NSURLIsDirectoryKey</span>] boolValue]) &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// 4. ç§»é™¤æ—©äºæœ‰æ•ˆæœŸçš„è€æ–‡ä»¶</span></div><div class="line">            <span class="built_in">NSDate</span> *modificationDate = resourceValues[<span class="built_in">NSURLContentModificationDateKey</span>];</div><div class="line">            <span class="keyword">if</span> ([[modificationDate laterDate:expirationDate] isEqualToDate:expirationDate]) &#123;</div><div class="line">                [urlsToDelete addObject:fileURL];</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// 5. å­˜å‚¨æ–‡ä»¶çš„å¼•ç”¨å¹¶è®¡ç®—æ‰€æœ‰æ–‡ä»¶çš„æ€»å¤§å°ï¼Œä»¥å¤‡åç”¨</span></div><div class="line">            <span class="built_in">NSNumber</span> *totalAllocatedSize = resourceValues[<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</div><div class="line">            currentCacheSize += totalAllocatedSize.unsignedIntegerValue;</div><div class="line">            cacheFiles[fileURL] = resourceValues;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> urlsToDelete) &#123;</div><div class="line">            [_fileManager removeItemAtURL:fileURL error:<span class="literal">nil</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//6.å¦‚æœç£ç›˜ç¼“å­˜çš„å¤§å°å¤§äºæˆ‘ä»¬é…ç½®çš„æœ€å¤§å¤§å°ï¼Œåˆ™æ‰§è¡ŒåŸºäºæ–‡ä»¶å¤§å°çš„æ¸…ç†ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ é™¤æœ€è€çš„æ–‡ä»¶</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.config.maxCacheSize &gt; <span class="number">0</span> &amp;&amp; currentCacheSize &gt; <span class="keyword">self</span>.config.maxCacheSize) &#123;</div><div class="line">            <span class="comment">// 7. ä»¥è®¾ç½®çš„æœ€å¤§ç¼“å­˜å¤§å°çš„ä¸€åŠä½œä¸ºæ¸…ç†ç›®æ ‡</span></div><div class="line">            <span class="keyword">const</span> <span class="built_in">NSUInteger</span> desiredCacheSize = <span class="keyword">self</span>.config.maxCacheSize / <span class="number">2</span>;</div><div class="line"></div><div class="line">            <span class="comment">// 8. æŒ‰ç…§æœ€åä¿®æ”¹æ—¶é—´æ¥æ’åºå‰©ä¸‹çš„ç¼“å­˜æ–‡ä»¶</span></div><div class="line">            <span class="built_in">NSArray</span>&lt;<span class="built_in">NSURL</span> *&gt; *sortedFiles = [cacheFiles keysSortedByValueWithOptions:<span class="built_in">NSSortConcurrent</span></div><div class="line">                                                                     usingComparator:^<span class="built_in">NSComparisonResult</span>(<span class="keyword">id</span> obj1, <span class="keyword">id</span> obj2) &#123;</div><div class="line">                                                                         <span class="keyword">return</span> [obj1[<span class="built_in">NSURLContentModificationDateKey</span>] compare:obj2[<span class="built_in">NSURLContentModificationDateKey</span>]];</div><div class="line">                                                                     &#125;];</div><div class="line"></div><div class="line">            <span class="comment">// 9. åˆ é™¤æ–‡ä»¶ï¼Œç›´åˆ°ç¼“å­˜æ€»å¤§å°é™åˆ°æˆ‘ä»¬æœŸæœ›çš„å¤§å°</span></div><div class="line">            <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> sortedFiles) &#123;</div><div class="line">                <span class="keyword">if</span> ([_fileManager removeItemAtURL:fileURL error:<span class="literal">nil</span>]) &#123;</div><div class="line">                    <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *resourceValues = cacheFiles[fileURL];</div><div class="line">                    <span class="built_in">NSNumber</span> *totalAllocatedSize = resourceValues[<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</div><div class="line">                    currentCacheSize -= totalAllocatedSize.unsignedIntegerValue;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (currentCacheSize &lt; desiredCacheSize) &#123;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (completionBlock) &#123;</div><div class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                completionBlock();</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>ä»¥ä¸Šåˆ†æäº†å›¾ç‰‡ç¼“å­˜æ“ä½œï¼Œå½“ç„¶ï¼Œé™¤äº†ä¸Šé¢è®²çš„å‡ ä¸ªæ“ä½œï¼ŒSDWebImageç±»è¿˜æä¾›äº†ä¸€äº›è¾…åŠ©æ–¹æ³•ã€‚å¦‚è·å–ç¼“å­˜å¤§å°ã€ç¼“å­˜ä¸­å›¾ç‰‡çš„æ•°é‡ã€åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªkeyæŒ‡å®šçš„å›¾ç‰‡ã€‚å¦å¤–ï¼ŒSDWebImageç±»æä¾›äº†ä¸€ä¸ªå•ä¾‹æ–¹æ³•çš„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å…¶å½“åšå•ä¾‹å¯¹è±¡æ¥å¤„ç†ã€‚</p>
<h3 id="SDWebImageManager"><a href="#SDWebImageManager" class="headerlink" title="SDWebImageManager"></a>SDWebImageManager</h3><p>åœ¨å®é™…çš„è¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸ç›´æ¥ä½¿ç”¨SDWebImageDownloaderç±»åŠSDImageCacheç±»æ¥æ‰§è¡Œå›¾ç‰‡çš„ä¸‹è½½åŠç¼“å­˜ã€‚ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·çš„ä½¿ç”¨ï¼ŒSDWebImageæä¾›äº†SDWebImageManagerå¯¹è±¡æ¥ç®¡ç†å›¾ç‰‡çš„ä¸‹è½½ä¸ç¼“å­˜ã€‚è€Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„è¯¸å¦‚<code>UIImageView+WebCache</code>ç­‰æ§ä»¶çš„åˆ†ç±»éƒ½æ˜¯åŸºäºSDWebImageManagerå¯¹è±¡çš„ï¼Œè¯¥å¯¹è±¡å°†ä¸€ä¸ªä¸‹è½½å™¨å’Œä¸€ä¸ªå›¾ç‰‡ç¼“å­˜ç»‘å®šåœ¨ä¸€èµ·ï¼Œå¹¶å¯¹å¤–æä¾›ä¸¤ä¸ªåªè¯»å±æ€§æ¥è·å–å®ƒä»¬ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SDWebImageManager</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">id</span> &lt;SDWebImageManagerDelegate&gt; delegate;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) SDImageCache *imageCache;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) SDWebImageDownloader *imageDownloader;</div><div class="line">...</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ä¸€ä¸ªdelegateå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>id &lt;SDWebImageManagerDelegate&gt;</code>å¯¹è±¡ã€‚<code>SDWebImageManagerDelegate</code>å£°æ˜äº†ä¸¤ä¸ªå¯é€‰å®ç°çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// æ§åˆ¶å½“å›¾ç‰‡åœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°æ—¶ï¼Œåº”è¯¥ä¸‹è½½å“ªä¸ªå›¾ç‰‡</span></div><div class="line">- (<span class="built_in">BOOL</span>)imageManager:(SDWebImageManager *)imageManager shouldDownloadImageForURL:(<span class="built_in">NSURL</span> *)imageURL;</div><div class="line"><span class="comment">// å…è®¸åœ¨å›¾ç‰‡å·²ç»è¢«ä¸‹è½½å®Œæˆä¸”è¢«ç¼“å­˜åˆ°ç£ç›˜æˆ–å†…å­˜å‰ç«‹å³è½¬æ¢</span></div><div class="line">- (<span class="built_in">UIImage</span> *)imageManager:(SDWebImageManager *)imageManager transformDownloadedImage:(<span class="built_in">UIImage</span> *)image withURL:(<span class="built_in">NSURL</span> *)imageURL;</div></pre></td></tr></table></figure>
<p>è¿™ä¸¤ä¸ªä»£ç†æ–¹æ³•ä¼šåœ¨SDWebImageManagerçš„<code>-downloadImageWithURL:options:progress:completed:</code>æ–¹æ³•ä¸­è°ƒç”¨ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯SDWebImageManagerç±»çš„æ ¸å¿ƒæ‰€åœ¨ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒå…·ä½“çš„å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">id</span> &lt;SDWebImageOperation&gt;)loadImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                                     options:(SDWebImageOptions)options</div><div class="line">                                    progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                                   completed:(<span class="keyword">nullable</span> SDInternalCompletionBlock)completedBlock &#123;</div><div class="line">    ...</div><div class="line">    <span class="comment">// å‰é¢çœç•¥nè¡Œã€‚ä¸»è¦ä½œäº†å¦‚ä¸‹å¤„ç†ï¼š</span></div><div class="line">    <span class="comment">// 1. åˆ¤æ–­urlçš„åˆæ³•æ€§</span></div><div class="line">    <span class="comment">// 2. åˆ›å»ºSDWebImageCombinedOperationå¯¹è±¡</span></div><div class="line">    <span class="comment">// 3. æŸ¥çœ‹urlæ˜¯å¦æ˜¯ä¹‹å‰ä¸‹è½½å¤±è´¥è¿‡çš„</span></div><div class="line">    <span class="comment">// 4. å¦‚æœurlä¸ºnilï¼Œæˆ–è€…åœ¨ä¸å¯é‡è¯•çš„æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªä¸‹è½½å¤±è´¥è¿‡çš„urlï¼Œåˆ™ç›´æ¥è¿”å›æ“ä½œå¯¹è±¡å¹¶è°ƒç”¨å®Œæˆå›è°ƒ</span></div><div class="line"></div><div class="line">    operation.cacheOperation = [<span class="keyword">self</span>.imageCache queryCacheOperationForKey:key done:^(<span class="built_in">UIImage</span> *cachedImage, <span class="built_in">NSData</span> *cachedData, SDImageCacheType cacheType) &#123;</div><div class="line">        <span class="keyword">if</span> (operation.isCancelled) &#123;</div><div class="line">            [<span class="keyword">self</span> safelyRemoveOperationFromRunning:operation];</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//å…ˆå»ç¼“å­˜ä¸­æŸ¥æ‰¾å›¾ç‰‡ï¼Œå¦‚æœå›¾ç‰‡ä¸å­˜åœ¨  æˆ–è€… å½“å‰å›¾ç‰‡çš„ä¸‹è½½æ¨¡å¼æ˜¯ SDWebImageRefreshCached å¼€å§‹ä¸‹è½½</span></div><div class="line">        <span class="keyword">if</span> ((!cachedImage || options &amp; SDWebImageRefreshCached) &amp;&amp; (![<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(imageManager:shouldDownloadImageForURL:)] || [<span class="keyword">self</span>.delegate imageManager:<span class="keyword">self</span> shouldDownloadImageForURL:url])) &#123;</div><div class="line">            ...</div><div class="line">            </div><div class="line">            <span class="comment">//ä¸‹è½½</span></div><div class="line">            SDWebImageDownloadToken *subOperationToken = [<span class="keyword">self</span>.imageDownloader downloadImageWithURL:url options:downloaderOptions progress:progressBlock completed:^(<span class="built_in">UIImage</span> *downloadedImage, <span class="built_in">NSData</span> *downloadedData, <span class="built_in">NSError</span> *error, <span class="built_in">BOOL</span> finished) &#123;</div><div class="line">                __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</div><div class="line">                <span class="keyword">if</span> (!strongOperation || strongOperation.isCancelled) &#123;</div><div class="line">                    <span class="comment">// æ“ä½œè¢«å–æ¶ˆï¼Œåˆ™ä¸åšä»»åŠ¡äº‹æƒ…</span></div><div class="line">                    </div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error) &#123;</div><div class="line">                    <span class="comment">// å¦‚æœå‡ºé”™ï¼Œåˆ™è°ƒç”¨å®Œæˆå›è°ƒï¼Œå¹¶å°†urlæ”¾å…¥ä¸‹è½½å¤±è´¥urlæ•°ç»„ä¸­	</span></div><div class="line">                    ...</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span> &#123;</div><div class="line">                    ...</div><div class="line">                    </div><div class="line">                    <span class="built_in">BOOL</span> cacheOnDisk = !(options &amp; SDWebImageCacheMemoryOnly);</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (options &amp; SDWebImageRefreshCached &amp;&amp; cachedImage &amp;&amp; !downloadedImage) &#123;</div><div class="line">                        <span class="comment">// Image refresh hit the NSURLCache cache, do not call the completion block</span></div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (downloadedImage &amp;&amp; (!downloadedImage.images || (options &amp; SDWebImageTransformAnimatedImage)) &amp;&amp; [<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(imageManager:transformDownloadedImage:withURL:)]) &#123;</div><div class="line">                        <span class="comment">// åœ¨å…¨å±€é˜Ÿåˆ—ä¸­å¹¶è¡Œå¤„ç†å›¾ç‰‡çš„ç¼“å­˜</span></div><div class="line">                        <span class="comment">// é¦–å…ˆå¯¹å›¾ç‰‡åšä¸ªè½¬æ¢æ“ä½œï¼Œè¯¥æ“ä½œæ˜¯ä»£ç†å¯¹è±¡å®ç°çš„</span></div><div class="line">                        <span class="comment">// ç„¶åå¯¹å›¾ç‰‡åšç¼“å­˜å¤„ç†</span></div><div class="line">                        <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>), ^&#123;</div><div class="line">                            <span class="built_in">UIImage</span> *transformedImage = [<span class="keyword">self</span>.delegate imageManager:<span class="keyword">self</span> transformDownloadedImage:downloadedImage withURL:url];</div><div class="line"></div><div class="line">                            <span class="keyword">if</span> (transformedImage &amp;&amp; finished) &#123;</div><div class="line">                                <span class="built_in">BOOL</span> imageWasTransformed = ![transformedImage isEqual:downloadedImage];</div><div class="line">                                <span class="comment">// pass nil if the image was transformed, so we can recalculate the data from the image</span></div><div class="line">                                [<span class="keyword">self</span>.imageCache storeImage:transformedImage imageData:(imageWasTransformed ? <span class="literal">nil</span> : downloadedData) forKey:key toDisk:cacheOnDisk completion:<span class="literal">nil</span>];</div><div class="line">                            &#125;</div><div class="line">                            </div><div class="line">                            ...</div><div class="line">                        &#125;);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="keyword">if</span> (downloadedImage &amp;&amp; finished) &#123;</div><div class="line">                            [<span class="keyword">self</span>.imageCache storeImage:downloadedImage imageData:downloadedData forKey:key toDisk:cacheOnDisk completion:<span class="literal">nil</span>];</div><div class="line">                        &#125;</div><div class="line">                        ...</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// ä¸‹è½½å®Œæˆå¹¶ç¼“å­˜åï¼Œå°†æ“ä½œä»é˜Ÿåˆ—ä¸­ç§»é™¤</span></div><div class="line">                <span class="keyword">if</span> (finished) &#123;</div><div class="line">                    [<span class="keyword">self</span> safelyRemoveOperationFromRunning:strongOperation];</div><div class="line">                &#125;</div><div class="line">            &#125;];</div><div class="line">            operation.cancelBlock = ^&#123;</div><div class="line">                [<span class="keyword">self</span>.imageDownloader cancel:subOperationToken];</div><div class="line">                __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</div><div class="line">                [<span class="keyword">self</span> safelyRemoveOperationFromRunning:strongOperation];</div><div class="line">            &#125;;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cachedImage) &#123;</div><div class="line">            ...</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            ...</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> operation;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹äºè¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æ²¡æœ‰åšè¿‡å¤šçš„è§£é‡Šã€‚å…¶ä¸»è¦å°±æ˜¯ä¸‹è½½å›¾ç‰‡å¹¶æ ¹æ®æ“ä½œé€‰é¡¹ç¼“å­˜å›¾ç‰‡ã€‚ä¸Šé¢è¿™ä¸ªä¸‹è½½æ–¹æ³•çš„æ“ä½œé€‰é¡¹å‚æ•°æ˜¯ç”±æšä¸¾<code>SDWebImageOptions</code>æ¥å®šä¹‰çš„ï¼Œè¿™ä¸ªæ“ä½œä¸­çš„ä¸€äº›é€‰é¡¹æ˜¯ä¸<code>SDWebImageDownloaderOptions</code>ä¸­çš„é€‰é¡¹å¯¹åº”çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ª<code>SDWebImageOptions</code>é€‰é¡¹éƒ½æœ‰å“ªäº›ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, SDWebImageOptions) &#123;</div><div class="line">    </div><div class="line">    <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“URLä¸‹è½½å¤±è´¥æ—¶ï¼ŒURLä¼šè¢«åˆ—å…¥é»‘åå•ï¼Œå¯¼è‡´åº“ä¸ä¼šå†å»é‡è¯•ï¼Œè¯¥æ ‡è®°ç”¨äºç¦ç”¨é»‘åå•</span></div><div class="line">    SDWebImageRetryFailed = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œå›¾ç‰‡ä¸‹è½½å¼€å§‹äºUIäº¤äº’ï¼Œè¯¥æ ‡è®°ç¦ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œè¿™æ ·ä¸‹è½½å»¶è¿Ÿåˆ°UIScrollViewå‡é€Ÿæ—¶</span></div><div class="line">    SDWebImageLowPriority = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// è¯¥æ ‡è®°ç¦ç”¨ç£ç›˜ç¼“å­˜</span></div><div class="line">    SDWebImageCacheMemoryOnly = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// è¯¥æ ‡è®°å¯ç”¨æ¸è¿›å¼ä¸‹è½½ï¼Œå›¾ç‰‡åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­æ˜¯æ¸æ¸æ˜¾ç¤ºçš„ï¼Œå¦‚åŒæµè§ˆå™¨ä¸€ä¸‹ã€‚</span></div><div class="line">    <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œå›¾åƒåœ¨ä¸‹è½½å®Œæˆåä¸€æ¬¡æ€§æ˜¾ç¤º</span></div><div class="line">    SDWebImageProgressiveDownload = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// å³ä½¿å›¾ç‰‡ç¼“å­˜äº†ï¼Œä¹ŸæœŸæœ›HTTPå“åº”cache controlï¼Œå¹¶åœ¨éœ€è¦çš„æƒ…å†µä¸‹ä»è¿œç¨‹åˆ·æ–°å›¾ç‰‡ã€‚</span></div><div class="line">    <span class="comment">// ç£ç›˜ç¼“å­˜å°†è¢«NSURLCacheå¤„ç†è€Œä¸æ˜¯SDWebImageï¼Œå› ä¸ºSDWebImageä¼šå¯¼è‡´è½»å¾®çš„æ€§èƒ½ä¸‹è½½ã€‚</span></div><div class="line">    <span class="comment">// è¯¥æ ‡è®°å¸®åŠ©å¤„ç†åœ¨ç›¸åŒè¯·æ±‚URLåé¢æ”¹å˜çš„å›¾ç‰‡ã€‚å¦‚æœç¼“å­˜å›¾ç‰‡è¢«åˆ·æ–°ï¼Œåˆ™å®Œæˆblockä¼šä½¿ç”¨ç¼“å­˜å›¾ç‰‡è°ƒç”¨ä¸€æ¬¡</span></div><div class="line">    <span class="comment">// ç„¶åå†ç”¨æœ€ç»ˆå›¾ç‰‡è°ƒç”¨ä¸€æ¬¡</span></div><div class="line">    SDWebImageRefreshCached = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// åœ¨iOS 4+ç³»ç»Ÿä¸­ï¼Œå½“ç¨‹åºè¿›å…¥åå°åç»§ç»­ä¸‹è½½å›¾ç‰‡ã€‚è¿™å°†è¦æ±‚ç³»ç»Ÿç»™äºˆé¢å¤–çš„æ—¶é—´è®©è¯·æ±‚å®Œæˆ</span></div><div class="line">    <span class="comment">// å¦‚æœåå°ä»»åŠ¡è¶…æ—¶ï¼Œåˆ™æ“ä½œè¢«å–æ¶ˆ</span></div><div class="line">    SDWebImageContinueInBackground = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// é€šè¿‡è®¾ç½®NSMutableURLRequest.HTTPShouldHandleCookies = YES;æ¥å¤„ç†å­˜å‚¨åœ¨NSHTTPCookieStoreä¸­çš„cookie</span></div><div class="line">    SDWebImageHandleCookies = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// å…è®¸ä¸å—ä¿¡ä»»çš„SSLè®¤è¯</span></div><div class="line">    SDWebImageAllowInvalidSSLCertificates = <span class="number">1</span> &lt;&lt; <span class="number">7</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œå›¾ç‰‡ä¸‹è½½æŒ‰å…¥é˜Ÿçš„é¡ºåºæ¥æ‰§è¡Œã€‚è¯¥æ ‡è®°å°†å…¶ç§»åˆ°é˜Ÿåˆ—çš„å‰é¢ï¼Œ</span></div><div class="line">    <span class="comment">// ä»¥ä¾¿å›¾ç‰‡èƒ½ç«‹å³ä¸‹è½½è€Œä¸æ˜¯ç­‰åˆ°å½“å‰é˜Ÿåˆ—è¢«åŠ è½½</span></div><div class="line">    SDWebImageHighPriority = <span class="number">1</span> &lt;&lt; <span class="number">8</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œå ä½å›¾ç‰‡åœ¨åŠ è½½å›¾ç‰‡çš„åŒæ—¶è¢«åŠ è½½ã€‚è¯¥æ ‡è®°å»¶è¿Ÿå ä½å›¾ç‰‡çš„åŠ è½½ç›´åˆ°å›¾ç‰‡å·²ä»¥è¢«åŠ è½½å®Œæˆ</span></div><div class="line">    SDWebImageDelayPlaceholder = <span class="number">1</span> &lt;&lt; <span class="number">9</span>,</div><div class="line">    </div><div class="line">    <span class="comment">// é€šå¸¸æˆ‘ä»¬ä¸è°ƒç”¨åŠ¨ç”»å›¾ç‰‡çš„transformDownloadedImageä»£ç†æ–¹æ³•ï¼Œå› ä¸ºå¤§å¤šæ•°è½¬æ¢ä»£ç å¯ä»¥ç®¡ç†å®ƒã€‚</span></div><div class="line">    <span class="comment">// ä½¿ç”¨è¿™ä¸ªç¥¨æˆ¿åˆ™ä¸ä»»ä½•æƒ…å†µä¸‹éƒ½è¿›è¡Œè½¬æ¢ã€‚</span></div><div class="line">    SDWebImageTransformAnimatedImage = <span class="number">1</span> &lt;&lt; <span class="number">10</span>,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>å¤§å®¶å†çœ‹<code>-downloadImageWithURL:options:progress:completed:</code>ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ª<code>SDWebImageOptions</code>ä¸<code>SDWebImageDownloaderOptions</code>ä¸­çš„é€‰é¡¹æ˜¯å¦‚ä½•å¯¹åº”èµ·æ¥çš„ï¼Œåœ¨æ­¤ä¸å¤šåšè§£é‡Šã€‚</p>
<h3 id="è§†å›¾æ‰©å±•"><a href="#è§†å›¾æ‰©å±•" class="headerlink" title="è§†å›¾æ‰©å±•"></a>è§†å›¾æ‰©å±•</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨SDWebImageçš„æ—¶å€™ï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯<code>UIImageView+WebCache</code>ä¸­çš„é’ˆå¯¹<code>UIImageView</code>çš„æ‰©å±•æ–¹æ³•ï¼Œè¿™äº›æ‰©å±•æ–¹æ³•å°†<code>UIImageView</code>ä¸<code>WebCache</code>é›†æˆåœ¨ä¸€èµ·ï¼Œæ¥è®©<code>UIImageView</code>å¯¹è±¡æ‹¥æœ‰å¼‚æ­¥ä¸‹è½½å’Œç¼“å­˜è¿œç¨‹å›¾ç‰‡çš„èƒ½åŠ›ã€‚åœ¨4.0.0ç‰ˆæœ¬ä»¥åï¼Œç»™UIViewæ–°å¢äº†å¥½å¤šæ–¹æ³•ï¼Œå…¶ä¸­æœ€ä¹‹å‰<code>UIImageView+WebCache</code>æœ€æ ¸å¿ƒçš„æ–¹æ³•<code>-sd_setImageWithURL:placeholderImage:options:progress:completed:</code>ï¼Œç°åœ¨ä½¿ç”¨çš„æ˜¯<code>UIView+WebCache</code>ä¸­æ–°å¢çš„æ–¹æ³•<code>sd_internalSetImageWithURL:placeholderImage:options:operationKey:setImageBlock:progress:completed:</code>,å…¶ä½¿ç”¨<code>SDWebImageManager</code>å•ä¾‹å¯¹è±¡ä¸‹è½½å¹¶ç¼“å­˜å›¾ç‰‡ï¼Œå®Œæˆåå°†å›¾ç‰‡èµ‹å€¼ç»™<code>UIImageView</code>å¯¹è±¡çš„imageå±æ€§ï¼Œä»¥ä½¿å›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥ï¼Œå…¶å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)sd_internalSetImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                  placeholderImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)placeholder</div><div class="line">                           options:(SDWebImageOptions)options</div><div class="line">                      operationKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)operationKey</div><div class="line">                     setImageBlock:(<span class="keyword">nullable</span> SDSetImageBlock)setImageBlock</div><div class="line">                          progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                         completed:(<span class="keyword">nullable</span> SDExternalCompletionBlock)completedBlock &#123;</div><div class="line">    </div><div class="line">	...</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (url) &#123;</div><div class="line">        <span class="comment">// check if activityView is enabled or not</span></div><div class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span> sd_showActivityIndicatorView]) &#123;</div><div class="line">            [<span class="keyword">self</span> sd_addActivityIndicator];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        __<span class="keyword">weak</span> __<span class="keyword">typeof</span>(<span class="keyword">self</span>)wself = <span class="keyword">self</span>;</div><div class="line">        <span class="comment">// ä½¿ç”¨SDWebImageManagerå•ä¾‹å¯¹è±¡æ¥ä¸‹è½½å›¾ç‰‡</span></div><div class="line">        <span class="keyword">id</span> &lt;SDWebImageOperation&gt; operation = [SDWebImageManager.sharedManager loadImageWithURL:url options:options progress:progressBlock completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">BOOL</span> finished, <span class="built_in">NSURL</span> *imageURL) &#123;</div><div class="line">            __<span class="keyword">strong</span> __<span class="keyword">typeof</span> (wself) sself = wself;</div><div class="line">            [sself sd_removeActivityIndicator];</div><div class="line">            <span class="keyword">if</span> (!sself) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            dispatch_main_async_safe(^&#123;</div><div class="line">                <span class="keyword">if</span> (!sself) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (image &amp;&amp; (options &amp; SDWebImageAvoidAutoSetImage) &amp;&amp; completedBlock) &#123;</div><div class="line">                    completedBlock(image, error, cacheType, url);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (image) &#123;</div><div class="line">                    <span class="comment">// å›¾ç‰‡ä¸‹è½½å®Œåæ˜¾ç¤ºå›¾ç‰‡</span></div><div class="line">                    [sself sd_setImage:image imageData:data basedOnClassOrViaCustomSetImageBlock:setImageBlock];</div><div class="line">                    [sself sd_setNeedsLayout];</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">if</span> ((options &amp; SDWebImageDelayPlaceholder)) &#123;</div><div class="line">                        [sself sd_setImage:placeholder imageData:<span class="literal">nil</span> basedOnClassOrViaCustomSetImageBlock:setImageBlock];</div><div class="line">                        [sself sd_setNeedsLayout];</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (completedBlock &amp;&amp; finished) &#123;</div><div class="line">                    completedBlock(image, error, cacheType, url);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;];</div><div class="line">        [<span class="keyword">self</span> sd_setImageLoadOperation:operation forKey:validOperationKey];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">       ...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é™¤äº†æ‰©å±•<code>UIImageView</code>ä¹‹å¤–ï¼ŒSDWebImageè¿˜æ‰©å±•äº†<code>UIView</code>ã€<code>UIButton</code>ã€<code>MKAnnotationView</code>ç­‰è§†å›¾ç±»ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒæºç ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨è¿™äº›æ‰©å±•ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨SDWebImageManageræ¥ä¸‹è½½å›¾ç‰‡ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆOKçš„ã€‚</p>
<h3 id="æŠ€æœ¯ç‚¹"><a href="#æŠ€æœ¯ç‚¹" class="headerlink" title="æŠ€æœ¯ç‚¹"></a>æŠ€æœ¯ç‚¹</h3><p>SDWebImageçš„ä¸»è¦ä»»åŠ¡å°±æ˜¯å›¾ç‰‡çš„ä¸‹è½½å’Œç¼“å­˜ã€‚ä¸ºäº†æ”¯æŒè¿™äº›æ“ä½œï¼Œå®ƒä¸»è¦ä½¿ç”¨äº†ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li><code>dispatch_barrier_sync</code>å‡½æ•°ï¼šè¯¥æ–¹æ³•ç”¨äºå¯¹æ“ä½œè®¾ç½®ç­‰å¾…ï¼Œç¡®ä¿åœ¨æ‰§è¡Œå®Œä»»åŠ¡åæ‰ä¼šæ‰§è¡Œåç»­æ“ä½œã€‚è¯¥æ–¹æ³•å¸¸ç”¨äºç¡®ä¿ç±»çš„çº¿ç¨‹å®‰å…¨æ€§æ“ä½œã€‚</li>
<li><code>NSMutableURLRequest</code>ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªç½‘ç»œè¯·æ±‚å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦æ¥é…ç½®è¯·æ±‚æŠ¥å¤´ç­‰ä¿¡æ¯ã€‚</li>
<li><code>NSOperation</code>åŠ<code>NSOperationQueue</code>ï¼šæ“ä½œé˜Ÿåˆ—æ˜¯Objective-Cä¸­ä¸€ç§é«˜çº§çš„å¹¶å‘å¤„ç†æ–¹æ³•ï¼Œç°åœ¨å®ƒæ˜¯åŸºäºGCDæ¥å®ç°çš„ã€‚ç›¸å¯¹äºGCDæ¥è¯´ï¼Œæ“ä½œé˜Ÿåˆ—çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å–æ¶ˆåœ¨ä»»åŠ¡å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¦å¤–åœ¨ç®¡ç†æ“ä½œé—´çš„ä¾èµ–å…³ç³»æ–¹é¢ä¹Ÿå®¹æ˜“ä¸€äº›ã€‚å¯¹SDWebImageä¸­æˆ‘ä»¬å°±çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ä¾èµ–å°†ä¸‹è½½é¡ºåºè®¾ç½®æˆåè¿›å…ˆå‡ºçš„é¡ºåºã€‚(æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹æˆ‘è¿™ç¯‡åšå®¢-&gt;<a href="http://www.guiyongdong.com/2016/09/18/%E8%81%8A%E4%B8%80%E8%81%8ANSOperation%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/">èŠä¸€èŠNSOperationçš„é‚£äº›äº‹</a>)</li>
<li>NSURLSessionï¼šç”¨äºç½‘ç»œè¯·æ±‚åŠå“åº”å¤„ç†ã€‚åœ¨iOS7.0åï¼Œè‹¹æœæ¨å‡ºäº†ä¸€å¥—æ–°çš„ç½‘ç»œè¯·æ±‚æ¥å£ï¼Œå³NSURLSessionç±»ã€‚(æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹æˆ‘è¿™ç¯‡åšå®¢-&gt;<a href="http://www.guiyongdong.com/2016/11/18/NSURLSession%E4%B8%8ENSURLConnection%E5%8C%BA%E5%88%AB/">NSURLSessionä¸NSURLConnectionåŒºåˆ«</a>)</li>
<li>å¼€å¯ä¸€ä¸ªåå°ä»»åŠ¡ã€‚</li>
<li><code>NSCache</code>ç±»ï¼šä¸€ä¸ªç±»ä¼¼äºé›†åˆçš„å®¹å™¨ã€‚å®ƒå­˜å‚¨key-valueå¯¹ï¼Œè¿™ä¸€ç‚¹ç±»ä¼¼äºNSDictionaryç±»ã€‚æˆ‘ä»¬é€šå¸¸ç”¨ä½¿ç”¨ç¼“å­˜æ¥ä¸´æ—¶å­˜å‚¨çŸ­æ—¶é—´ä½¿ç”¨ä½†åˆ›å»ºæ˜‚è´µçš„å¯¹è±¡ã€‚é‡ç”¨è¿™äº›å¯¹è±¡å¯ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼ä¸éœ€è¦é‡æ–°è®¡ç®—ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œè¿™äº›å¯¹è±¡å¯¹äºç¨‹åºæ¥è¯´ä¸æ˜¯ç´§è¦çš„ï¼Œåœ¨å†…å­˜ç´§å¼ æ—¶ä¼šè¢«ä¸¢å¼ƒã€‚</li>
<li>æ¸…ç†ç¼“å­˜å›¾ç‰‡çš„ç­–ç•¥ï¼šç‰¹åˆ«æ˜¯æœ€å¤§ç¼“å­˜ç©ºé—´å¤§å°çš„è®¾ç½®ã€‚å¦‚æœæ‰€æœ‰ç¼“å­˜æ–‡ä»¶çš„æ€»å¤§å°è¶…è¿‡è¿™ä¸€å¤§å°ï¼Œåˆ™ä¼šæŒ‰ç…§æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´çš„é€†åºï¼Œä»¥æ¯æ¬¡ä¸€åŠçš„é€’å½’æ¥ç§»é™¤é‚£äº›è¿‡æ—©çš„æ–‡ä»¶ï¼Œç›´åˆ°ç¼“å­˜çš„å®é™…å¤§å°å°äºæˆ‘ä»¬è®¾ç½®çš„æœ€å¤§ä½¿ç”¨ç©ºé—´ã€‚</li>
<li>å¯¹å›¾ç‰‡çš„è§£å‹ç¼©æ“ä½œï¼šè¿™ä¸€æ“ä½œå¯ä»¥æŸ¥çœ‹<code>SDWebImageDecoder.m</code>ä¸­<code>+decodedImageWithImage</code>æ–¹æ³•çš„å®ç°ã€‚</li>
<li>å¯¹GIFå›¾ç‰‡çš„å¤„ç†</li>
<li>å¯¹WebPå›¾ç‰‡çš„å¤„ç†</li>
<li>å¯¹cellçš„é‡ç”¨æœºåˆ¶çš„è§£å†³ï¼Œåˆ©ç”¨runtimeçš„å…³è”å¯¹è±¡ï¼Œä¼šä¸ºimageViewå¯¹è±¡å…³è”ä¸€ä¸ªä¸‹è½½åˆ—è¡¨ï¼Œå½“tableViewæ»‘åŠ¨æ—¶ï¼ŒimageViewé‡è®¾æ•°æ®æºï¼ˆurlï¼‰æ—¶ï¼Œä¼šcancelæ‰ä¸‹è½½åˆ—è¡¨ä¸­æ‰€æœ‰çš„ä»»åŠ¡ï¼Œç„¶åå¼€å¯ä¸€ä¸ªæ–°çš„ä¸‹è½½ä»»åŠ¡ã€‚è¿™æ ·å­å°±ä¿è¯äº†åªæœ‰å½“å‰å¯è§çš„cellå¯¹è±¡çš„imageViewå¯¹è±¡å…³è”çš„ä¸‹è½½ä»»åŠ¡èƒ½å¤Ÿå›è°ƒï¼Œä¸ä¼šå‘ç”Ÿimageé”™ä¹±ã€‚</li>
</ul>
<p>æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æ·±å…¥ç ”ç©¶ä¸€ä¸‹è¿™äº›çŸ¥è¯†ç‚¹ã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œæ›´å¤šçš„çŸ¥è¯†è¿˜æœ‰å¾…å¤§å®¶å»å‘æ˜ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SDWebImageæ˜¯ä¸€ä¸ªå¼€æºçš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒæä¾›äº†UIImageViewçš„ä¸€ä¸ªåˆ†ç±»ï¼Œä»¥æ”¯æŒä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½å¹¶ç¼“å­˜å›¾ç‰‡çš„åŠŸèƒ½ã€‚å®ƒå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æä¾›UIImageViewçš„ä¸€ä¸ªåˆ†ç±»ï¼Œä»¥æ”¯æŒç½‘ç»œå›¾ç‰‡çš„åŠ è½½ä¸ç¼“å­˜ç®¡ç†&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå¼‚æ­¥çš„å›¾ç‰‡åŠ è½½å™¨&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå¼‚æ­¥çš„å†…å­˜+ç£ç›˜å›¾ç‰‡ç¼“å­˜&lt;/li&gt;
&lt;li&gt;æ”¯æŒGIFå›¾ç‰‡&lt;/li&gt;
&lt;li&gt;æ”¯æŒWebPå›¾ç‰‡&lt;/li&gt;
&lt;li&gt;åå°å›¾ç‰‡è§£å‹ç¼©å¤„ç†&lt;/li&gt;
&lt;li&gt;ç¡®ä¿åŒä¸€ä¸ªURLä¸ä¼šè¢«åå¤åŠ è½½&lt;/li&gt;
&lt;li&gt;ç¡®ä¿ä¸‹è½½åŠç¼“å­˜æ—¶ï¼Œä¸»çº¿ç¨‹ä¸è¢«å µå¡&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»githubä¸Šå¯¹SDWebImageä½¿ç”¨æƒ…å†µå¯ä»¥çœ‹å‡ºï¼ŒSDWebImageåœ¨å›¾ç‰‡ä¸‹è½½åŠç¼“å­˜çš„å¤„ç†è¿˜æ˜¯è¢«è®¤å¯çš„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä»æºç çš„è§’åº¦æ¥åˆ†æä¸€ä¸‹SDWebImageçš„å®ç°æœºåˆ¶ã€‚è®¨è®ºçš„å†…å®¹å°†ä¸»è¦é›†ä¸­åœ¨å›¾ç‰‡çš„ä¸‹è½½åŠç¼“å­˜ï¼Œè€Œä¸åŒ…å«å¯¹GIFå›¾ç‰‡åŠWebPå›¾ç‰‡çš„æ”¯æŒæ“ä½œã€‚ä¸è¿‡åœ¨3.8.2ç‰ˆæœ¬ä»¥åï¼ŒSDWebImageå°†ä¼šä½¿ç”¨NSURLSessionä»£æ›¿åŸæ¥çš„NSURLConnectionï¼Œä¸»è¦æ˜¯æ›´æ–°çš„æ˜¯ä¸‹è½½åŠŸèƒ½éƒ¨åˆ†ã€‚å…·ä½“å˜åŒ–å¯ä»¥çœ‹:&lt;a href=&quot;https://github.com/rs/SDWebImage/blob/master/Docs/SDWebImage-4.0-Migration-guide.md&quot;&gt;ç‚¹è¿™é‡Œ&lt;/a&gt;ã€‚ç›®å‰æˆªæ­¢åˆ°å½“å‰æ—¶é—´ï¼Œæœ€æ–°çš„ç‰ˆæœ¬ä¸º4.0.0-beta2,è¿™ç¯‡æ–‡ç« æ˜¯åœ¨4.0.0-beta2åŸºç¡€ä¸Šè¿›è¡Œå‰–æã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æºç åˆ†æ" scheme="http://www.guiyongdong.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="æºç åˆ†æ" scheme="http://www.guiyongdong.com/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C Runtime è¿è¡Œæ—¶ä¹‹å…­ï¼šæ‹¾é—</title>
    <link href="http://www.guiyongdong.com/2017/01/03/Objective-C-Runtime-%E8%BF%90%E8%A1%8C%E6%97%B6%E4%B9%8B%E5%85%AD%EF%BC%9A%E6%8B%BE%E9%81%97/"/>
    <id>http://www.guiyongdong.com/2017/01/03/Objective-C-Runtime-è¿è¡Œæ—¶ä¹‹å…­ï¼šæ‹¾é—/</id>
    <published>2017-01-03T07:08:47.000Z</published>
    <updated>2017-03-09T07:03:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‰é¢å‡ ç¯‡åŸºæœ¬ä»‹ç»äº†runtimeä¸­çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹ç±»ä¸å¯¹è±¡ã€æˆå‘˜å˜é‡ä¸å±æ€§ã€æ–¹æ³•ä¸æ¶ˆæ¯ã€åˆ†ç±»ä¸åè®®çš„å¤„ç†ã€‚runtimeå¤§éƒ¨åˆ†çš„åŠŸèƒ½éƒ½æ˜¯å›´ç»•è¿™å‡ ç‚¹æ¥å®ç°çš„ã€‚</p>
<p>æœ¬ç« çš„å†…å®¹å¹¶ä¸ç®—é‡ç‚¹ï¼Œä¸»è¦é’ˆå¯¹å‰æ–‡ä¸­å¯¹Objective-C Runtime Referenceå†…å®¹é—æ¼çš„åœ°æ–¹åšäº›è¡¥å……ã€‚å½“ç„¶è¿™å¹¶ä¸èƒ½åŒ…å«æ‰€æœ‰çš„å†…å®¹ã€‚runtimeè¿˜æœ‰è®¸å¤šå†…å®¹ã€‚</p>
<a id="more"></a>
<h4 id="super"><a href="#super" class="headerlink" title="super"></a>super</h4><p>åœ¨Objective-Cä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ç±»çš„æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œé€šå¸¸éƒ½ä¼šç”¨åˆ°<code>super</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyViewController</span>: <span class="title">UIViewController</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span>	<span class="title">MyViewController</span></span></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">	[<span class="keyword">super</span> viewDidLoad];</div><div class="line">	<span class="comment">// do something</span></div><div class="line">	...</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>å¦‚ä½•ä½¿ç”¨superæˆ‘ä»¬éƒ½çŸ¥é“ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯superä¸selfä¸åŒã€‚selfæ˜¯ç±»çš„ä¸€ä¸ªéšè—å‚æ•°ï¼Œæ¯ä¸ªæ–¹æ³•çš„å®ç°çš„ç¬¬ä¸€ä¸ªå‚æ•°å³ä¸ºselfã€‚è€Œsuperå¹¶ä¸æ˜¯éšè—å‚æ•°ï¼Œå®ƒå®é™…ä¸Šåªæ˜¯ä¸€ä¸ªâ€ç¼–è¯‘å™¨æ ‡ç¤ºç¬¦â€ï¼Œå®ƒè´Ÿè´£å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå½“è°ƒç”¨viewDidLoadæ–¹æ³•æ—¶ï¼Œå»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯æœ¬ç±»ä¸­çš„æ–¹æ³•ã€‚è€Œå®ƒå®é™…ä¸Šä¸selfæŒ‡å‘çš„æ˜¯ç›¸åŒçš„æ¶ˆæ¯æ¥æ”¶è€…ã€‚ä¸ºäº†ç†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹superçš„å®šä¹‰</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_super &#123; <span class="keyword">id</span> receiver; Class superClass; &#125;;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªç»“æ„ä½“æœ‰ä¸¤ä¸ªæˆå‘˜ï¼š</p>
<ul>
<li>receiverï¼šå³æ¶ˆæ¯çš„å®é™…æ¥æ”¶è€…</li>
<li>superClassï¼šæŒ‡é’ˆå½“å‰ç±»çš„çˆ¶ç±»</li>
</ul>
<p>å½“æˆ‘ä»¬ä½¿ç”¨superæ¥æ¥æ”¶æ¶ˆæ¯æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªobjc_superç»“æ„ä½“ã€‚å°±ä¸Šé¢çš„ä¾‹å­è€Œè¨€ï¼Œè¿™ä¸ªç»“æ„ä½“çš„receiverå°±æ˜¯MyViewControllerå¯¹è±¡ï¼Œä¸selfç›¸åŒï¼›superClassæŒ‡å‘MyViewControllerçš„çˆ¶ç±»UIViewControllerã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå‘é€æ¶ˆæ¯æ—¶ï¼Œä¸æ˜¯è°ƒç”¨objc_msgSendå‡½æ•°ï¼Œè€Œæ˜¯è°ƒç”¨objc_msgSendSuperå‡½æ•°ï¼Œå…¶å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">id</span> objc_msgSendSuper ( <span class="keyword">struct</span> objc_super *<span class="keyword">super</span>, SEL op, ... );</div></pre></td></tr></table></figure>
<p>è¯¥å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°å³ä¸ºå‰é¢ç”Ÿæˆçš„objc_superç»“æ„ä½“ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•çš„selectorã€‚è¯¥å‡½æ•°å®é™…çš„æ“ä½œæ˜¯ï¼šä»objc_superç»“æ„ä½“æŒ‡å‘çš„superClassçš„æ–¹æ³•åˆ—è¡¨å¼€å§‹æŸ¥æ‰¾viewDidLoadçš„selectorï¼Œæ‰¾åˆ°åä»¥objc-&gt;receiverå»è°ƒç”¨è¿™ä¸ªselectorï¼Œè€Œæ­¤æ—¶çš„æ“ä½œæµç¨‹å°±æ˜¯å¦‚ä¸‹æ–¹å¼äº†</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">objc_msgSend(objc_super-&gt;receiver, <span class="keyword">@selector</span>(viewDidLoad))</div></pre></td></tr></table></figure>
<p>ç”±äºobjc_super-&gt;receiverå°±æ˜¯selfæœ¬èº«ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•å®é™…ä¸ä¸‹é¢è¿™ä¸ªè°ƒç”¨æ˜¯ç›¸åŒçš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">objc_msgSend(<span class="keyword">self</span>, <span class="keyword">@selector</span>(viewDidLoad))</div></pre></td></tr></table></figure>
<p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬çœ‹ä»¥ä¸‹å®ä¾‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyClass</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyClass</span></span></div><div class="line">- (<span class="keyword">void</span>)test &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"self class: %@"</span>, <span class="keyword">self</span>.class);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"super class: %@"</span>, <span class="keyword">super</span>.class);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è°ƒç”¨MyClassçš„testæ–¹æ³•åï¼Œå…¶è¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="number">2014</span><span class="number">-11</span><span class="number">-08</span> <span class="number">15</span>:<span class="number">55</span>:<span class="number">03.256</span> [<span class="number">824</span>:<span class="number">209297</span>] <span class="keyword">self</span> <span class="keyword">class</span>: MyClass</div><div class="line"><span class="number">2014</span><span class="number">-11</span><span class="number">-08</span> <span class="number">15</span>:<span class="number">55</span>:<span class="number">03.256</span> [<span class="number">824</span>:<span class="number">209297</span>] <span class="keyword">super</span> <span class="keyword">class</span>: MyClass</div></pre></td></tr></table></figure>
<p>ä»ä¸Šä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸¤è€…çš„è¾“å‡ºéƒ½æ˜¯MyClassã€‚</p>
<h4 id="åº“ç›¸å…³æ“ä½œ"><a href="#åº“ç›¸å…³æ“ä½œ" class="headerlink" title="åº“ç›¸å…³æ“ä½œ"></a>åº“ç›¸å…³æ“ä½œ</h4><p>åº“ç›¸å…³çš„æ“ä½œä¸»è¦æ˜¯ç”¨äºè·å–ç”±ç³»ç»Ÿæä¾›çš„åº“ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡½æ•°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–æ‰€æœ‰åŠ è½½çš„Objective-Cæ¡†æ¶å’ŒåŠ¨æ€åº“çš„åç§°</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> ** objc_copyImageNames ( <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// è·å–æŒ‡å®šç±»æ‰€åœ¨åŠ¨æ€åº“</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * class_getImageName ( Class cls );</div><div class="line"><span class="comment">// è·å–æŒ‡å®šåº“æˆ–æ¡†æ¶ä¸­æ‰€æœ‰ç±»çš„ç±»å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> ** objc_copyClassNamesForImage ( <span class="keyword">const</span> <span class="keyword">char</span> *image, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™å‡ ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°æŸä¸ªç±»æ‰€æœ‰çš„åº“ï¼Œä»¥åŠæŸä¸ªåº“ä¸­åŒ…å«å“ªäº›ç±»ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"è·å–æŒ‡å®šç±»æ‰€åœ¨åŠ¨æ€åº“"</span>);</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"UIView's Framework: %s"</span>, class_getImageName(<span class="built_in">NSClassFromString</span>(<span class="string">@"UIView"</span>)));</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"è·å–æŒ‡å®šåº“æˆ–æ¡†æ¶ä¸­æ‰€æœ‰ç±»çš„ç±»å"</span>);</div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> ** classes = objc_copyClassNamesForImage(class_getImageName(<span class="built_in">NSClassFromString</span>(<span class="string">@"UIView"</span>)), &amp;outCount);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; outCount; i++) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"class name: %s"</span>, classes[i]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">2014-11-08 12:57:32.689 [747:184013] è·å–æŒ‡å®šç±»æ‰€åœ¨åŠ¨æ€åº“</div><div class="line">2014-11-08 12:57:32.690 [747:184013] UIView's Framework: /System/Library/Frameworks/UIKit.framework/UIKit</div><div class="line">2014-11-08 12:57:32.690 [747:184013] è·å–æŒ‡å®šåº“æˆ–æ¡†æ¶ä¸­æ‰€æœ‰ç±»çš„ç±»å</div><div class="line">2014-11-08 12:57:32.691 [747:184013] class name: UIKeyboardPredictiveSettings</div><div class="line">2014-11-08 12:57:32.691 [747:184013] class name: _UIPickerViewTopFrame</div><div class="line">2014-11-08 12:57:32.691 [747:184013] class name: _UIOnePartImageView</div><div class="line">2014-11-08 12:57:32.692 [747:184013] class name: _UIPickerViewSelectionBar</div><div class="line">2014-11-08 12:57:32.692 [747:184013] class name: _UIPickerWheelView</div><div class="line">2014-11-08 12:57:32.692 [747:184013] class name: _UIPickerViewTestParameters</div><div class="line">......</div></pre></td></tr></table></figure>
<h4 id="å—æ“ä½œ"><a href="#å—æ“ä½œ" class="headerlink" title="å—æ“ä½œ"></a>å—æ“ä½œ</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“blockç»™æˆ‘ä»¬å¸¦åˆ°æå¤§çš„æ–¹ä¾¿ï¼Œè‹¹æœä¹Ÿä¸æ–­æä¾›ä¸€äº›ä½¿ç”¨blockçš„æ–°çš„APIã€‚åŒæ—¶ï¼Œè‹¹æœåœ¨runtimeä¸­ä¹Ÿæä¾›äº†ä¸€äº›å‡½æ•°æ¥æ”¯æŒé’ˆå¯¹blockçš„æ“ä½œï¼Œè¿™äº›å‡½æ•°åŒ…æ‹¬ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå‡½æ•°çš„æŒ‡é’ˆï¼Œè¯¥å‡½æ•°è°ƒç”¨æ—¶ä¼šè°ƒç”¨ç‰¹å®šçš„block</span></div><div class="line">IMP imp_implementationWithBlock ( <span class="keyword">id</span> block );</div><div class="line"><span class="comment">// è¿”å›ä¸IMP(ä½¿ç”¨imp_implementationWithBlockåˆ›å»ºçš„)ç›¸å…³çš„block</span></div><div class="line"><span class="keyword">id</span> imp_getBlock ( IMP anImp );</div><div class="line"><span class="comment">// è§£é™¤blockä¸IMP(ä½¿ç”¨imp_implementationWithBlockåˆ›å»ºçš„)çš„å…³è”å…³ç³»ï¼Œå¹¶é‡Šæ”¾blockçš„æ‹·è´</span></div><div class="line"><span class="built_in">BOOL</span> imp_removeBlock ( IMP anImp );</div></pre></td></tr></table></figure>
<ul>
<li>imp_implementationWithBlockå‡½æ•°ï¼šå‚æ•°blockçš„ç­¾åå¿…é¡»æ˜¯method_return_type ^(id self, method_args â€¦)å½¢å¼çš„ã€‚è¯¥æ–¹æ³•èƒ½è®©æˆ‘ä»¬ä½¿ç”¨blockä½œä¸ºIMPã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyRuntimeBlock</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@end</span>	</div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyRuntimeBlock</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="comment">// æµ‹è¯•ä»£ç </span></div><div class="line">IMP imp = imp_implementationWithBlock(^(<span class="keyword">id</span> obj, <span class="built_in">NSString</span> *str) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</div><div class="line">&#125;);</div><div class="line">class_addMethod(MyRuntimeBlock.class, <span class="keyword">@selector</span>(testBlock:), imp, <span class="string">"v@:@"</span>);</div><div class="line">MyRuntimeBlock *runtime = [[MyRuntimeBlock alloc] init];</div><div class="line">[runtime performSelector:<span class="keyword">@selector</span>(testBlock:) withObject:<span class="string">@"hello world!"</span>];</div></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœæ˜¯</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="number">2014</span><span class="number">-11</span><span class="number">-09</span> <span class="number">14</span>:<span class="number">03</span>:<span class="number">19.779</span> [<span class="number">1172</span>:<span class="number">395446</span>] hello world!</div></pre></td></tr></table></figure>
<h4 id="å¼±å¼•ç”¨æ“ä½œ"><a href="#å¼±å¼•ç”¨æ“ä½œ" class="headerlink" title="å¼±å¼•ç”¨æ“ä½œ"></a>å¼±å¼•ç”¨æ“ä½œ</h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// åŠ è½½å¼±å¼•ç”¨æŒ‡é’ˆå¼•ç”¨çš„å¯¹è±¡å¹¶è¿”å›</span></div><div class="line"><span class="keyword">id</span> objc_loadWeak ( <span class="keyword">id</span> *location );</div><div class="line"><span class="comment">// å­˜å‚¨__weakå˜é‡çš„æ–°å€¼</span></div><div class="line"><span class="keyword">id</span> objc_storeWeak ( <span class="keyword">id</span> *location, <span class="keyword">id</span> obj );</div></pre></td></tr></table></figure>
<ul>
<li>objc_loadWeakå‡½æ•°ï¼šè¯¥å‡½æ•°åŠ è½½ä¸€ä¸ªå¼±æŒ‡é’ˆå¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶åœ¨å¯¹å…¶åšretainå’Œautoreleasingæ“ä½œåè¿”å›å®ƒã€‚è¿™æ ·ï¼Œå¯¹è±¡å°±å¯ä»¥åœ¨è°ƒç”¨è€…ä½¿ç”¨å®ƒæ—¶ä¿æŒè¶³å¤Ÿé•¿çš„ç”Ÿå‘½å‘¨æœŸã€‚è¯¥å‡½æ•°å…¸å‹çš„ç”¨æ³•æ˜¯åœ¨ä»»ä½•æœ‰ä½¿ç”¨__weakå˜é‡çš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚</li>
<li>objc_storeWeakå‡½æ•°ï¼šè¯¥å‡½æ•°çš„å…¸å‹ç”¨æ³•æ˜¯ç”¨äº__weakå˜é‡åšä¸ºèµ‹å€¼å¯¹è±¡æ—¶ã€‚</li>
</ul>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>è‡³æ­¤ï¼Œæœ¬ç³»åˆ—å¯¹runtimeçš„æ•´ç†å·²å®Œç»“ã€‚å½“ç„¶è¿™åªæ˜¯å¯¹runtimeçš„ä¸€äº›åŸºç¡€çŸ¥è¯†çš„å½’çº³ï¼ŒåŠ›å›¾èµ·ä¸ªæŠ›ç –å¼•ç‰çš„ä½œç”¨ã€‚è¿˜æœ‰è®¸å¤šå…³äºruntimeæœ‰æ„æ€ä¸œè¥¿è¿˜éœ€è¦è¯»è€…è‡ªå·±å»æ¢ç´¢å‘ç°ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰é¢å‡ ç¯‡åŸºæœ¬ä»‹ç»äº†runtimeä¸­çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹ç±»ä¸å¯¹è±¡ã€æˆå‘˜å˜é‡ä¸å±æ€§ã€æ–¹æ³•ä¸æ¶ˆæ¯ã€åˆ†ç±»ä¸åè®®çš„å¤„ç†ã€‚runtimeå¤§éƒ¨åˆ†çš„åŠŸèƒ½éƒ½æ˜¯å›´ç»•è¿™å‡ ç‚¹æ¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç« çš„å†…å®¹å¹¶ä¸ç®—é‡ç‚¹ï¼Œä¸»è¦é’ˆå¯¹å‰æ–‡ä¸­å¯¹Objective-C Runtime Referenceå†…å®¹é—æ¼çš„åœ°æ–¹åšäº›è¡¥å……ã€‚å½“ç„¶è¿™å¹¶ä¸èƒ½åŒ…å«æ‰€æœ‰çš„å†…å®¹ã€‚runtimeè¿˜æœ‰è®¸å¤šå†…å®¹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="http://www.guiyongdong.com/categories/Objective-C/"/>
    
    
      <category term="Runtime" scheme="http://www.guiyongdong.com/tags/Runtime/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C-Runtimeè¿è¡Œæ—¶ä¹‹äº”ï¼šåè®®ä¸åˆ†ç±»</title>
    <link href="http://www.guiyongdong.com/2016/12/18/Objective-C-Runtime%E8%BF%90%E8%A1%8C%E6%97%B6%E4%B9%8B%E4%BA%94%EF%BC%9A%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%88%86%E7%B1%BB/"/>
    <id>http://www.guiyongdong.com/2016/12/18/Objective-C-Runtimeè¿è¡Œæ—¶ä¹‹äº”ï¼šåè®®ä¸åˆ†ç±»/</id>
    <published>2016-12-18T06:25:59.000Z</published>
    <updated>2017-03-09T07:03:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>Objective-Cä¸­çš„åˆ†ç±»å…è®¸æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç±»æ·»åŠ æ–¹æ³•æ¥æ‰©å……å®ƒï¼ˆä½†æ˜¯é€šè¿‡categoryä¸èƒ½æ·»åŠ æ–°çš„å®ä¾‹å˜é‡ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸éœ€è¦è®¿é—®ç±»ä¸­çš„ä»£ç å°±å¯ä»¥åšåˆ°ã€‚</p>
<p>Objective-Cä¸­çš„åè®®æ˜¯æ™®éå­˜åœ¨çš„æ¥å£å®šä¹‰æ–¹å¼ï¼Œå³åœ¨ä¸€ä¸ªç±»ä¸­é€šè¿‡<code>@protocol</code>å®šä¹‰æ¥å£ï¼Œåœ¨å¦å¤–ç±»ä¸­å®ç°æ¥å£ï¼Œè¿™ç§æ¥å£å®šä¹‰æ–¹å¼ä¹Ÿæˆä¸ºâ€œdelegationâ€æ¨¡å¼ï¼Œ<code>@protocol</code>å£°æ˜äº†å¯ä»¥è¢«å…¶ä»–ä»»ä½•ç±»å®ç°çš„æ–¹æ³•ï¼Œåè®®ä»…ä»…æ˜¯å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè€Œç”±å…¶ä»–çš„ç±»å»è´Ÿè´£å®ç°ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹runtimeå¯¹åˆ†ç±»ä¸åè®®çš„æ”¯æŒã€‚</p>
<a id="more"></a>
<h4 id="åŸºç¡€æ•°æ®ç±»å‹"><a href="#åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="åŸºç¡€æ•°æ®ç±»å‹"></a>åŸºç¡€æ•°æ®ç±»å‹</h4><h5 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h5><p>Categoryæ˜¯è¡¨ç¤ºä¸€ä¸ªæŒ‡å‘åˆ†ç±»çš„ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_category *Category;</div><div class="line"><span class="keyword">struct</span> objc_category &#123;</div><div class="line">    <span class="keyword">char</span> *category_name                          OBJC2_UNAVAILABLE;	<span class="comment">// åˆ†ç±»å</span></div><div class="line">    <span class="keyword">char</span> *class_name                             OBJC2_UNAVAILABLE;	<span class="comment">// åˆ†ç±»æ‰€å±çš„ç±»å</span></div><div class="line">    <span class="keyword">struct</span> objc_method_list *instance_methods    OBJC2_UNAVAILABLE;	<span class="comment">// å®ä¾‹æ–¹æ³•åˆ—è¡¨</span></div><div class="line">    <span class="keyword">struct</span> objc_method_list *class_methods       OBJC2_UNAVAILABLE;	<span class="comment">// ç±»æ–¹æ³•åˆ—è¡¨</span></div><div class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols         OBJC2_UNAVAILABLE;	<span class="comment">// åˆ†ç±»æ‰€å®ç°çš„åè®®åˆ—è¡¨</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªç»“æ„ä½“ä¸»è¦åŒ…å«äº†åˆ†ç±»å®šä¹‰çš„å®ä¾‹æ–¹æ³•ä¸ç±»æ–¹æ³•ï¼Œå…¶ä¸­<code>instance_methods</code>åˆ—è¡¨æ˜¯å…ƒç±»æ–¹æ³•åˆ—è¡¨çš„ä¸€ä¸ªå­é›†ã€‚</p>
<h5 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h5><p>Protocolçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object Protocol;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒProtocolå…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ç»“æ„ä½“ã€‚</p>
<h5 id="æ“ä½œå‡½æ•°"><a href="#æ“ä½œå‡½æ•°" class="headerlink" title="æ“ä½œå‡½æ•°"></a>æ“ä½œå‡½æ•°</h5><p>Runtimeå¹¶æ²¡æœ‰åœ¨<code>&lt;objc/runtime.h&gt;</code>å¤´æ–‡ä»¶ä¸­æä¾›é’ˆå¯¹åˆ†ç±»çš„æ“ä½œå‡½æ•°ã€‚å› ä¸ºè¿™äº›åˆ†ç±»ä¸­çš„ä¿¡æ¯éƒ½åŒ…å«åœ¨<code>objc_class</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é’ˆå¯¹<code>objc_class</code>çš„æ“ä½œå‡½æ•°æ¥è·å–åˆ†ç±»çš„ä¿¡æ¯ã€‚å¦‚ä¸‹é‡Œæ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RuntimeCategoryClass</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="keyword">void</span>)method1;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RuntimeCategoryClass</span> (<span class="title">Category</span>)</span></div><div class="line">- (<span class="keyword">void</span>)method2;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RuntimeCategoryClass</span></span></div><div class="line">- (<span class="keyword">void</span>)method1 &#123;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RuntimeCategoryClass</span> (<span class="title">Category</span>)</span></div><div class="line">- (<span class="keyword">void</span>)method2 &#123;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="meta">#pragma mark -</span></div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"æµ‹è¯•objc_classä¸­çš„æ–¹æ³•åˆ—è¡¨æ˜¯å¦åŒ…å«åˆ†ç±»ä¸­çš„æ–¹æ³•"</span>);</div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> outCount = <span class="number">0</span>;</div><div class="line">Method *methodList = class_copyMethodList(RuntimeCategoryClass.class, &amp;outCount);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; outCount; i++) &#123;</div><div class="line">    Method method = methodList[i];</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name = sel_getName(method_getName(method));</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"RuntimeCategoryClass's method: %s"</span>, name);</div><div class="line">    <span class="keyword">if</span> (strcmp(name, sel_getName(<span class="keyword">@selector</span>(method2)))) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"åˆ†ç±»æ–¹æ³•method2åœ¨objc_classçš„æ–¹æ³•åˆ—è¡¨ä¸­"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶è¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">2014-11-08 10:36:39.213 [561:151847] æµ‹è¯•objc_classä¸­çš„æ–¹æ³•åˆ—è¡¨æ˜¯å¦åŒ…å«åˆ†ç±»ä¸­çš„æ–¹æ³•</div><div class="line">2014-11-08 10:36:39.215 [561:151847] RuntimeCategoryClass's method: method2</div><div class="line">2014-11-08 10:36:39.215 [561:151847] RuntimeCategoryClass's method: method1</div><div class="line">2014-11-08 10:36:39.215 [561:151847] åˆ†ç±»æ–¹æ³•method2åœ¨objc_classçš„æ–¹æ³•åˆ—è¡¨ä¸­</div></pre></td></tr></table></figure>
<p>è€Œå¯¹äºProtocolï¼Œruntimeæä¾›äº†ä¸€ç³»åˆ—å‡½æ•°æ¥å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œè¿™äº›å‡½æ•°åŒ…æ‹¬ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è¿”å›æŒ‡å®šçš„åè®®</span></div><div class="line">Protocol * objc_getProtocol ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// è·å–è¿è¡Œæ—¶æ‰€çŸ¥é“çš„æ‰€æœ‰åè®®çš„æ•°ç»„</span></div><div class="line">Protocol ** objc_copyProtocolList ( <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// åˆ›å»ºæ–°çš„åè®®å®ä¾‹</span></div><div class="line">Protocol * objc_allocateProtocol ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// åœ¨è¿è¡Œæ—¶ä¸­æ³¨å†Œæ–°åˆ›å»ºçš„åè®®</span></div><div class="line"><span class="keyword">void</span> objc_registerProtocol ( Protocol *proto );</div><div class="line"><span class="comment">// ä¸ºåè®®æ·»åŠ æ–¹æ³•</span></div><div class="line"><span class="keyword">void</span> protocol_addMethodDescription ( Protocol *proto, SEL name, <span class="keyword">const</span> <span class="keyword">char</span> *types, <span class="built_in">BOOL</span> isRequiredMethod, <span class="built_in">BOOL</span> isInstanceMethod );</div><div class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªå·²æ³¨å†Œçš„åè®®åˆ°åè®®ä¸­</span></div><div class="line"><span class="keyword">void</span> protocol_addProtocol ( Protocol *proto, Protocol *addition );</div><div class="line"><span class="comment">// ä¸ºåè®®æ·»åŠ å±æ€§</span></div><div class="line"><span class="keyword">void</span> protocol_addProperty ( Protocol *proto, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> objc_property_attribute_t *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount, <span class="built_in">BOOL</span> isRequiredProperty, <span class="built_in">BOOL</span> isInstanceProperty );</div><div class="line"><span class="comment">// è¿”å›åè®®å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * protocol_getName ( Protocol *p );</div><div class="line"><span class="comment">// æµ‹è¯•ä¸¤ä¸ªåè®®æ˜¯å¦ç›¸ç­‰</span></div><div class="line"><span class="built_in">BOOL</span> protocol_isEqual ( Protocol *proto, Protocol *other );</div><div class="line"><span class="comment">// è·å–åè®®ä¸­æŒ‡å®šæ¡ä»¶çš„æ–¹æ³•çš„æ–¹æ³•æè¿°æ•°ç»„</span></div><div class="line"><span class="keyword">struct</span> objc_method_description * protocol_copyMethodDescriptionList ( Protocol *p, <span class="built_in">BOOL</span> isRequiredMethod, <span class="built_in">BOOL</span> isInstanceMethod, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// è·å–åè®®ä¸­æŒ‡å®šæ–¹æ³•çš„æ–¹æ³•æè¿°</span></div><div class="line"><span class="keyword">struct</span> objc_method_description protocol_getMethodDescription ( Protocol *p, SEL aSel, <span class="built_in">BOOL</span> isRequiredMethod, <span class="built_in">BOOL</span> isInstanceMethod );</div><div class="line"><span class="comment">// è·å–åè®®ä¸­çš„å±æ€§åˆ—è¡¨</span></div><div class="line">objc_property_t * protocol_copyPropertyList ( Protocol *proto, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// è·å–åè®®çš„æŒ‡å®šå±æ€§</span></div><div class="line">objc_property_t protocol_getProperty ( Protocol *proto, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="built_in">BOOL</span> isRequiredProperty, <span class="built_in">BOOL</span> isInstanceProperty );</div><div class="line"><span class="comment">// è·å–åè®®é‡‡ç”¨çš„åè®®</span></div><div class="line">Protocol ** protocol_copyProtocolList ( Protocol *proto, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// æŸ¥çœ‹åè®®æ˜¯å¦é‡‡ç”¨äº†å¦ä¸€ä¸ªåè®®</span></div><div class="line"><span class="built_in">BOOL</span> protocol_conformsToProtocol ( Protocol *proto, Protocol *other );</div></pre></td></tr></table></figure>
<ul>
<li><code>objc_getProtocol</code>å‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä»…ä»…æ˜¯å£°æ˜äº†ä¸€ä¸ªåè®®ï¼Œè€Œæœªåœ¨ä»»ä½•ç±»ä¸­å®ç°è¿™ä¸ªåè®®ï¼Œåˆ™è¯¥å‡½æ•°è¿”å›çš„æ˜¯nilã€‚</li>
<li><code>objc_copyProtocolList</code>å‡½æ•°ï¼Œè·å–çš„æ•°å€¼éœ€è¦ä½¿ç”¨freeæ¥é‡Šæ”¾ã€‚</li>
<li><code>objc_allcateProtocol</code>å‡½æ•°ï¼Œå¦‚æœåŒåçš„åè®®å·²ç»å­˜åœ¨ï¼Œåˆ™è¿”å›nil.</li>
<li><code>objc_registerProtocol</code>å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åè®®åï¼Œå¿…é¡»è°ƒç”¨è¯¥å‡½æ•°ä»¥åœ¨è¿è¡Œæ—¶é’Ÿæ³¨å†Œæ–°çš„åè®®ã€‚åè®®æ³¨å†Œåä¾¿å¯ä»¥ä½¿ç”¨ï¼Œä½†ä¸èƒ½å†åšä¿®æ”¹ï¼Œå³æ³¨å†Œå®Œåä¸èƒ½å†å‘åè®®æ·»åŠ æ–¹æ³•æˆ–åè®®ã€‚</li>
</ul>
<p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œåè®®ä¸€æ—¦æ³¨å†Œåå°±ä¸èƒ½ä¿®æ”¹ï¼Œå³æ— æ³•å†é€šè¿‡è°ƒç”¨<code>protocol_addMethodDescription</code>ã€<code>protocol_addProtocol</code>å’Œ<code>protocol_addProperty</code>å¾€åè®®ä¸­æ·»åŠ æ–¹æ³•ç­‰ã€‚</p>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>Runtimeå¹¶æ²¡æœ‰æä¾›è¿‡å¤šçš„å‡½æ•°æ¥å¤„ç†åˆ†ç±»ã€‚å¯¹äºåè®®ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°åˆ›å»ºåè®®ï¼Œå¹¶å‘å…¶æ·»åŠ æ–¹æ³•ã€å±æ€§åŠç»§æ‰¿çš„åè®®ï¼Œå¹¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è·å–è¿™äº›ä¿¡æ¯ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Objective-Cä¸­çš„åˆ†ç±»å…è®¸æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç±»æ·»åŠ æ–¹æ³•æ¥æ‰©å……å®ƒï¼ˆä½†æ˜¯é€šè¿‡categoryä¸èƒ½æ·»åŠ æ–°çš„å®ä¾‹å˜é‡ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸éœ€è¦è®¿é—®ç±»ä¸­çš„ä»£ç å°±å¯ä»¥åšåˆ°ã€‚&lt;/p&gt;
&lt;p&gt;Objective-Cä¸­çš„åè®®æ˜¯æ™®éå­˜åœ¨çš„æ¥å£å®šä¹‰æ–¹å¼ï¼Œå³åœ¨ä¸€ä¸ªç±»ä¸­é€šè¿‡&lt;code&gt;@protocol&lt;/code&gt;å®šä¹‰æ¥å£ï¼Œåœ¨å¦å¤–ç±»ä¸­å®ç°æ¥å£ï¼Œè¿™ç§æ¥å£å®šä¹‰æ–¹å¼ä¹Ÿæˆä¸ºâ€œdelegationâ€æ¨¡å¼ï¼Œ&lt;code&gt;@protocol&lt;/code&gt;å£°æ˜äº†å¯ä»¥è¢«å…¶ä»–ä»»ä½•ç±»å®ç°çš„æ–¹æ³•ï¼Œåè®®ä»…ä»…æ˜¯å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè€Œç”±å…¶ä»–çš„ç±»å»è´Ÿè´£å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹runtimeå¯¹åˆ†ç±»ä¸åè®®çš„æ”¯æŒã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="http://www.guiyongdong.com/categories/Objective-C/"/>
    
    
      <category term="Runtime" scheme="http://www.guiyongdong.com/tags/Runtime/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C Runtime è¿è¡Œæ—¶ä¹‹å››ï¼šMethod Swizzling</title>
    <link href="http://www.guiyongdong.com/2016/12/09/Objective-C-Runtime-%E8%BF%90%E8%A1%8C%E6%97%B6%E4%B9%8B%E5%9B%9B%EF%BC%9AMethod-Swizzling/"/>
    <id>http://www.guiyongdong.com/2016/12/09/Objective-C-Runtime-è¿è¡Œæ—¶ä¹‹å››ï¼šMethod-Swizzling/</id>
    <published>2016-12-09T05:02:51.000Z</published>
    <updated>2017-03-09T07:03:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç†è§£<code>Method Swizzling</code>æ˜¯å­¦ä¹ Runtimeæœºåˆ¶çš„ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šã€‚<code>Method Swizzling</code>æ˜¯æ”¹å˜ä¸€ä¸ª<code>selector</code>çš„å®é™…å®ç°çš„æŠ€æœ¯ã€‚é€šè¿‡è¿™ä¸€æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ä¿®æ”¹ç±»çš„åˆ†å‘è¡¨ä¸­<code>selector</code>å¯¹åº”çš„å‡½æ•°ï¼Œæ¥ä¿®æ”¹æ–¹æ³•çš„å®ç°ã€‚</p>
<a id="more"></a>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è·Ÿè¸ªåœ¨ç¨‹åºä¸­æ¯ä¸€ä¸ªViewControllerå±•ç¤ºç»™ç”¨æˆ·çš„æ¬¡æ•°ï¼šå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªViewControllerçš„viewDidAppearä¸­æ·»åŠ è·Ÿè¸ªä»£ç ï¼Œä½†æ˜¯è¿™å¤ªè¿‡éº»çƒ¦ï¼Œéœ€è¦åœ¨æ¯ä¸ªViewControllerä¸­å†™é‡å¤çš„ä»£ç ã€‚åˆ›å»ºä¸€ä¸ªå­ç±»å¯èƒ½æ˜¯ä¸€ç§å®ç°æ–¹å¼ï¼Œä½†éœ€è¦åŒæ—¶åˆ›å»ºUIViewControllerï¼ŒUITableControllerï¼ŒUINavigationControlleråŠå…¶ä»–UIKitä¸­ViewControllerçš„å­ç±»ï¼Œè¿™æ ·ä¼šäº§ç”Ÿè®¸å¤šé‡å¤çš„ä»£ç ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>Method Swizzling</code>ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIViewController</span> (<span class="title">Tracking</span>)</span></div><div class="line">+ (<span class="keyword">void</span>)load &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        Class <span class="keyword">class</span> = [<span class="keyword">self</span> <span class="keyword">class</span>];         </div><div class="line">        <span class="comment">// When swizzling a class method, use the following:</span></div><div class="line">        <span class="comment">// Class class = object_getClass((id)self);</span></div><div class="line">        SEL originalSelector = <span class="keyword">@selector</span>(viewWillAppear:);</div><div class="line">        SEL swizzledSelector = <span class="keyword">@selector</span>(xxx_viewWillAppear:);</div><div class="line">        Method originalMethod = class_getInstanceMethod(<span class="keyword">class</span>, originalSelector);</div><div class="line">        Method swizzledMethod = class_getInstanceMethod(<span class="keyword">class</span>, swizzledSelector);</div><div class="line">        <span class="built_in">BOOL</span> didAddMethod = class_addMethod(<span class="keyword">class</span>,</div><div class="line">                originalSelector,</div><div class="line">                method_getImplementation(swizzledMethod),</div><div class="line">                method_getTypeEncoding(swizzledMethod));</div><div class="line">        <span class="keyword">if</span> (didAddMethod) &#123;</div><div class="line">            class_replaceMethod(<span class="keyword">class</span>,</div><div class="line">                swizzledSelector,</div><div class="line">                method_getImplementation(originalMethod),</div><div class="line">                method_getTypeEncoding(originalMethod));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            method_exchangeImplementations(originalMethod, swizzledMethod);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark - Method Swizzling</span></div><div class="line">- (<span class="keyword">void</span>)xxx_viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">    [<span class="keyword">self</span> xxx_viewWillAppear:animated];</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"viewWillAppear: %@"</span>, <span class="keyword">self</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡<code>Method Swizzling</code>ä¿®æ”¹äº†UIViewControllerçš„<code>@selector(viewWillAppear:)</code>å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œä½¿å…¶å®ç°æŒ‡å‘äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>xxx_viewWillAppear</code>çš„å®ç°ã€‚è¿™æ ·ï¼Œå½“UIViewControlleråŠå…¶å­ç±»çš„å¯¹è±¡è°ƒç”¨<code>viewWillAppear</code>æ—¶ï¼Œéƒ½ä¼šæ‰“å°ä¸€æ¡æ—¥å¿—ä¿¡æ¯ã€‚</p>
<p>ä¸Šé¢çš„ä¾‹å­å¾ˆå¥½åœ°å±•ç¤ºäº†ä½¿ç”¨<code>Method Swizlling</code>æ¥ä¸€ä¸ªç±»ä¸­æ³¨å…¥ä¸€äº›æˆ‘ä»¬æ–°çš„æ“ä½œã€‚å½“ç„¶ï¼Œè¿˜æœ‰è®¸å¤šåœºæ™¯å¯ä»¥ä½¿ç”¨<code>Mehtod Swizlling</code>ï¼Œåœ¨æ­¤ä¸å¤šä¸¾ä¾‹ã€‚åœ¨æ­¤æˆ‘ä»¬è¯´è¯´ä½¿ç”¨<code>method Swizlling</code>éœ€è¦æ³¨æ„çš„ä¸€äº›é—®é¢˜ã€‚</p>
<h3 id="Swizzlingåº”è¯¥æ€»æ˜¯åœ¨-loadä¸­æ‰§è¡Œ"><a href="#Swizzlingåº”è¯¥æ€»æ˜¯åœ¨-loadä¸­æ‰§è¡Œ" class="headerlink" title="Swizzlingåº”è¯¥æ€»æ˜¯åœ¨+loadä¸­æ‰§è¡Œ"></a>Swizzlingåº”è¯¥æ€»æ˜¯åœ¨+loadä¸­æ‰§è¡Œ</h3><p>åœ¨Objective-Cä¸­ï¼Œè¿è¡Œæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨æ¯ä¸ªç±»çš„ä¸¤ä¸ªæ–¹æ³•ã€‚<code>+load</code><em>ä¼šåœ¨ç±»åˆå§‹åŠ è½½æ—¶è°ƒç”¨</em>ï¼Œ<code>+initialize</code><em>ä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ç±»çš„ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ä¹‹å‰è¢«è°ƒç”¨</em>ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œä¸”åªæœ‰åœ¨å®ç°äº†å®ƒä»¬æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚ç”±äºmethod swizzlingä¼šå½±å“åˆ°ç±»çš„å…¨å±€çŠ¶æ€ï¼Œå› æ­¤è¦å°½é‡é¿å…åœ¨å¹¶å‘å¤„ç†ä¸­å‡ºç°ç«äº‰çš„æƒ…å†µã€‚+loadèƒ½ä¿è¯åœ¨ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­è¢«åŠ è½½ï¼Œå¹¶ä¿è¯è¿™ç§æ”¹å˜åº”ç”¨çº§åˆ«çš„è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ+initializeåœ¨å…¶æ‰§è¡Œæ—¶ä¸æä¾›è¿™ç§ä¿è¯â€“äº‹å®ä¸Šï¼Œå¦‚æœåœ¨åº”ç”¨ä¸­æ²¡ä¸ºç»™è¿™ä¸ªç±»å‘é€æ¶ˆæ¯ï¼Œåˆ™å®ƒå¯èƒ½æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚</p>
<h3 id="Swizzlingåº”è¯¥æ€»æ˜¯åœ¨dispatch-onceä¸­æ‰§è¡Œ"><a href="#Swizzlingåº”è¯¥æ€»æ˜¯åœ¨dispatch-onceä¸­æ‰§è¡Œ" class="headerlink" title="Swizzlingåº”è¯¥æ€»æ˜¯åœ¨dispatch_onceä¸­æ‰§è¡Œ"></a>Swizzlingåº”è¯¥æ€»æ˜¯åœ¨dispatch_onceä¸­æ‰§è¡Œ</h3><p>ä¸ä¸Šé¢ç›¸åŒï¼Œå› ä¸º<code>swizzling</code>ä¼šæ”¹å˜å…¨å±€çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œæ—¶é‡‡å–ä¸€äº›é¢„é˜²æªæ–½ã€‚åŸå­æ€§å°±æ˜¯è¿™æ ·ä¸€ç§æªæ–½ï¼Œå®ƒç¡®ä¿ä»£ç åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªçº¿ç¨‹ã€‚GCDçš„<code>dispatch_once</code>å¯ä»¥ç¡®ä¿è¿™ç§è¡Œä¸ºï¼Œæˆ‘ä»¬åº”è¯¥å°†å…¶ä½œä¸º<code>method swizzling</code>çš„æœ€ä½³å®è·µã€‚</p>
<h3 id="é€‰æ‹©å™¨ã€æ–¹æ³•ä¸å®ç°"><a href="#é€‰æ‹©å™¨ã€æ–¹æ³•ä¸å®ç°" class="headerlink" title="é€‰æ‹©å™¨ã€æ–¹æ³•ä¸å®ç°"></a>é€‰æ‹©å™¨ã€æ–¹æ³•ä¸å®ç°</h3><p>åœ¨Objective-Cä¸­ï¼Œé€‰æ‹©å™¨(<code>selector</code>)ã€æ–¹æ³•(<code>method</code>)å’Œå®ç°(<code>implementation</code>)æ˜¯è¿è¡Œæ—¶ä¸­ä¸€ä¸ªç‰¹æ®Šç‚¹ï¼Œè™½ç„¶åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™äº›æœ¯è¯­æ›´å¤šçš„æ˜¯ç”¨åœ¨æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹æè¿°ä¸­ã€‚</p>
<p>ä»¥ä¸‹æ˜¯<code>Objective-C Runtime Reference</code>ä¸­çš„å¯¹è¿™å‡ ä¸ªæœ¯è¯­ä¸€äº›æè¿°ï¼š</p>
<ul>
<li><code>Selector(typedef struct objc_selector *SEL)</code>ï¼šç”¨äºåœ¨è¿è¡Œæ—¶ä¸­è¡¨ç¤ºä¸€ä¸ªæ–¹æ³•çš„åç§°ã€‚ä¸€ä¸ªæ–¹æ³•é€‰æ‹©å™¨æ˜¯ä¸€ä¸ªCå­—ç¬¦ä¸²ï¼Œå®ƒæ˜¯åœ¨Objective-Cè¿è¡Œæ—¶è¢«æ³¨å†Œçš„ã€‚é€‰æ‹©å™¨ç”±ç¼–è¯‘å™¨ç”Ÿæˆï¼Œå¹¶ä¸”åœ¨ç±»è¢«åŠ è½½æ—¶ç”±è¿è¡Œæ—¶è‡ªåŠ¨åšæ˜ å°„æ“ä½œã€‚</li>
<li><code>Method(typedef struct objc_method *Method)</code>ï¼šåœ¨ç±»å®šä¹‰ä¸­è¡¨ç¤ºæ–¹æ³•çš„ç±»å‹</li>
<li><code>Implementation(typedef id (*IMP)(id, SEL, ...))</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•å®ç°å‡½æ•°çš„å¼€å§‹ä½ç½®ã€‚è¿™ä¸ªå‡½æ•°ä½¿ç”¨ä¸ºå½“å‰CPUæ¶æ„å®ç°çš„æ ‡å‡†Cè°ƒç”¨è§„èŒƒã€‚æ¯ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å‘å¯¹è±¡è‡ªèº«çš„æŒ‡é’ˆ(self)ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•é€‰æ‹©å™¨ã€‚ç„¶åæ˜¯æ–¹æ³•çš„å®é™…å‚æ•°ã€‚</li>
</ul>
<p>ç†è§£è¿™å‡ ä¸ªæœ¯è¯­ä¹‹é—´çš„å…³ç³»æœ€å¥½çš„æ–¹å¼æ˜¯ï¼šä¸€ä¸ªç±»ç»´æŠ¤ä¸€ä¸ªè¿è¡Œæ—¶å¯æ¥æ”¶çš„æ¶ˆæ¯åˆ†å‘è¡¨ï¼›åˆ†å‘è¡¨ä¸­çš„æ¯ä¸ªå…¥å£æ˜¯ä¸€ä¸ªæ–¹æ³•(Method)ï¼Œå…¶ä¸­keyæ˜¯ä¸€ä¸ªç‰¹å®šåç§°ï¼Œå³é€‰æ‹©å™¨(SEL)ï¼Œå…¶å¯¹åº”ä¸€ä¸ªå®ç°(IMP)ï¼Œå³æŒ‡å‘åº•å±‚Cå‡½æ•°çš„æŒ‡é’ˆã€‚</p>
<p>ä¸ºäº†swizzleä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†å‘è¡¨ä¸­å°†ä¸€ä¸ªæ–¹æ³•çš„ç°æœ‰çš„é€‰æ‹©å™¨æ˜ å°„åˆ°ä¸åŒçš„å®ç°ï¼Œè€Œå°†è¯¥é€‰æ‹©å™¨å¯¹åº”çš„åŸå§‹å®ç°å…³è”åˆ°ä¸€ä¸ªæ–°çš„é€‰æ‹©å™¨ä¸­ã€‚</p>
<h3 id="è°ƒç”¨-cmd"><a href="#è°ƒç”¨-cmd" class="headerlink" title="è°ƒç”¨_cmd"></a>è°ƒç”¨_cmd</h3><p>æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹å‰é¢æ–°çš„æ–¹æ³•çš„å®ç°ä»£ç ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)xxx_viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">    [<span class="keyword">self</span> xxx_viewWillAppear:animated];</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"viewWillAppear: %@"</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å’‹çœ‹ä¸Šå»æ˜¯ä¼šå¯¼è‡´æ— é™å¾ªç¯çš„ã€‚ä½†ä»¤äººæƒŠå¥‡çš„æ˜¯ï¼Œå¹¶æ²¡æœ‰å‡ºç°è¿™ç§æƒ…å†µã€‚åœ¨swizzlingçš„è¿‡ç¨‹ä¸­ï¼Œæ–¹æ³•ä¸­çš„<code>[self xxx_viewWillAppear:animated]</code>å·²ç»è¢«é‡æ–°æŒ‡å®šåˆ°UIViewControllerç±»çš„<code>-viewWillAppear:</code>ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ä¼šäº§ç”Ÿæ— é™å¾ªç¯ã€‚ä¸è¿‡å¦‚æœæˆ‘ä»¬è°ƒç”¨çš„æ˜¯<code>[self viewWillAppear:animated]</code>ï¼Œåˆ™ä¼šäº§ç”Ÿæ— é™å¾ªç¯ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•çš„å®ç°åœ¨è¿è¡Œæ—¶å·²ç»è¢«é‡æ–°æŒ‡å®šä¸º<code>xxx_viewWillAppear:</code>äº†ã€‚</p>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>Swizzlingé€šå¸¸è¢«ç§°ä½œæ˜¯ä¸€ç§é»‘é­”æ³•ï¼Œå®¹æ˜“äº§ç”Ÿä¸å¯é¢„çŸ¥çš„è¡Œä¸ºå’Œæ— æ³•é¢„è§çš„åæœã€‚è™½ç„¶å®ƒä¸æ˜¯æœ€å®‰å…¨çš„ï¼Œä½†å¦‚æœéµä»ä»¥ä¸‹å‡ ç‚¹é¢„é˜²æªæ–½çš„è¯ï¼Œè¿˜æ˜¯æ¯”è¾ƒå®‰å…¨çš„ï¼š</p>
<ol>
<li>æ€»æ˜¯è°ƒç”¨æ–¹æ³•çš„åŸå§‹å®ç°(é™¤éæœ‰æ›´å¥½çš„ç†ç”±ä¸è¿™ä¹ˆåš)ï¼šAPIæä¾›äº†ä¸€ä¸ªè¾“å…¥ä¸è¾“å‡ºçº¦å®šï¼Œä½†å…¶å†…éƒ¨å®ç°æ˜¯ä¸€ä¸ªé»‘ç›’ã€‚Swizzleä¸€ä¸ªæ–¹æ³•è€Œä¸è°ƒç”¨åŸå§‹å®ç°å¯èƒ½ä¼šæ‰“ç ´ç§æœ‰çŠ¶æ€åº•å±‚æ“ä½œï¼Œä»è€Œå½±å“åˆ°ç¨‹åºçš„å…¶å®ƒéƒ¨åˆ†ã€‚</li>
<li>é¿å…å†²çªï¼šç»™è‡ªå®šä¹‰çš„åˆ†ç±»æ–¹æ³•åŠ å‰ç¼€ï¼Œä»è€Œä½¿å…¶ä¸æ‰€ä¾èµ–çš„ä»£ç åº“ä¸ä¼šå­˜åœ¨å‘½åå†²çªã€‚</li>
<li>æ˜ç™½æ˜¯æ€ä¹ˆå›äº‹ï¼šç®€å•åœ°æ‹·è´ç²˜è´´swizzleä»£ç è€Œä¸ç†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä¸ä»…å±é™©ï¼Œè€Œä¸”ä¼šæµªè´¹å­¦ä¹ Objective-Cè¿è¡Œæ—¶çš„æœºä¼šã€‚é˜…è¯»<code>Objective-C Runtime Reference</code>å’ŒæŸ¥çœ‹<code>&lt;objc/runtime.h&gt;</code>å¤´æ–‡ä»¶ä»¥äº†è§£äº‹ä»¶æ˜¯å¦‚ä½•å‘ç”Ÿçš„ã€‚</li>
<li>å°å¿ƒæ“ä½œï¼šæ— è®ºæˆ‘ä»¬å¯¹Foundation, UIKitæˆ–å…¶å®ƒå†…å»ºæ¡†æ¶æ‰§è¡ŒSwizzleæ“ä½œæŠ±æœ‰å¤šå¤§ä¿¡å¿ƒï¼Œéœ€è¦çŸ¥é“åœ¨ä¸‹ä¸€ç‰ˆæœ¬ä¸­è®¸å¤šäº‹å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç†è§£&lt;code&gt;Method Swizzling&lt;/code&gt;æ˜¯å­¦ä¹ Runtimeæœºåˆ¶çš„ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šã€‚&lt;code&gt;Method Swizzling&lt;/code&gt;æ˜¯æ”¹å˜ä¸€ä¸ª&lt;code&gt;selector&lt;/code&gt;çš„å®é™…å®ç°çš„æŠ€æœ¯ã€‚é€šè¿‡è¿™ä¸€æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ä¿®æ”¹ç±»çš„åˆ†å‘è¡¨ä¸­&lt;code&gt;selector&lt;/code&gt;å¯¹åº”çš„å‡½æ•°ï¼Œæ¥ä¿®æ”¹æ–¹æ³•çš„å®ç°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="http://www.guiyongdong.com/categories/Objective-C/"/>
    
    
      <category term="Runtime" scheme="http://www.guiyongdong.com/tags/Runtime/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C Runtime è¿è¡Œæ—¶ä¹‹ä¸‰ï¼šæ–¹æ³•ä¸æ¶ˆæ¯</title>
    <link href="http://www.guiyongdong.com/2016/11/25/Objective-C-Runtime-%E8%BF%90%E8%A1%8C%E6%97%B6%E4%B9%8B%E4%B8%89%EF%BC%9A%E6%96%B9%E6%B3%95%E4%B8%8E%E6%B6%88%E6%81%AF/"/>
    <id>http://www.guiyongdong.com/2016/11/25/Objective-C-Runtime-è¿è¡Œæ—¶ä¹‹ä¸‰ï¼šæ–¹æ³•ä¸æ¶ˆæ¯/</id>
    <published>2016-11-25T06:05:08.000Z</published>
    <updated>2017-03-09T07:03:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‰é¢æˆ‘ä»¬è®¨è®ºäº†Runtimeä¸­å¯¹ç±»å’Œå¯¹è±¡çš„å¤„ç†ï¼ŒåŠå¯¹æˆå‘˜å˜é‡ä¸å±æ€§çš„å¤„ç†ã€‚è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°±è¦å¼€å§‹è®¨è®ºRuntimeä¸­æœ€æœ‰æ„æ€çš„ä¸€éƒ¨åˆ†ï¼šæ¶ˆæ¯å¤„ç†æœºåˆ¶ã€‚æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºæ¶ˆæ¯çš„å‘é€åŠæ¶ˆæ¯çš„è½¬å‘ã€‚ä¸è¿‡åœ¨è®¨è®ºæ¶ˆæ¯ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä¸æ–¹æ³•ç›¸å…³çš„ä¸€äº›å†…å®¹ã€‚</p>
<a id="more"></a>
<h3 id="åŸºç¡€æ•°æ®ç±»å‹"><a href="#åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="åŸºç¡€æ•°æ®ç±»å‹"></a>åŸºç¡€æ•°æ®ç±»å‹</h3><h4 id="SEL"><a href="#SEL" class="headerlink" title="SEL"></a>SEL</h4><p>SELåˆå«é€‰æ‹©å™¨ï¼Œæ˜¯è¡¨ç¤ºä¸€ä¸ªæ–¹æ³•çš„<code>selector</code>çš„æŒ‡é’ˆï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">typedef struct objc_selector *SEL;</div></pre></td></tr></table></figure></p>
<p><code>objc_selector</code>ç»“æ„ä½“çš„è¯¦ç»†å®šä¹‰æ²¡æœ‰åœ¨<code>&lt;objc/runtime.h&gt;</code>å¤´æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚æ–¹æ³•çš„<code>selector</code>ç”¨äºè¡¨ç¤ºè¿è¡Œæ—¶æ–¹æ³•çš„åå­—ã€‚Objective-Cåœ¨ç¼–è¯‘æ—¶ï¼Œä¼šæ ¹æ®æ¯ä¸€ä¸ªæ–¹æ³•çš„åå­—ã€å‚æ•°åºåˆ—ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ•´å‹æ ‡è¯†(Intç±»å‹çš„æ ‡è¯†)ï¼Œè¿™ä¸ªæ ‡è¯†å°±æ˜¯<code>SEL</code>ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤º:<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">SEL sel1 = <span class="keyword">@selector</span>(method1);</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"sel : %p"</span>, sel1);</div></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„è¾“å‡ºç»“æœä¸ºï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-30</span> <span class="number">18</span>:<span class="number">40</span>:<span class="number">07.518</span> RuntimeTest[<span class="number">52734</span>:<span class="number">466626</span>] sel : <span class="number">0x100002d72</span></div></pre></td></tr></table></figure></p>
<p>ä¸¤ä¸ªç±»ä¹‹é—´ï¼Œä¸ç®¡å®ƒä»¬æ˜¯çˆ¶ç±»ä¸å­ç±»çš„å…³ç³»ï¼Œè¿˜æ˜¯ä¹‹é—´æ²¡æœ‰è¿™ç§å…³ç³»ï¼Œåªè¦æ–¹æ³•åç›¸åŒï¼Œé‚£ä¹ˆæ–¹æ³•çš„SELå°±æ˜¯ä¸€æ ·çš„ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•éƒ½å¯¹åº”ç€ä¸€ä¸ªSELã€‚æ‰€ä»¥åœ¨Objective-CåŒä¸€ä¸ªç±»(åŠç±»çš„ç»§æ‰¿ä½“ç³»)ä¸­ï¼Œä¸èƒ½å­˜åœ¨2ä¸ªåŒåçš„æ–¹æ³•ï¼Œå³ä½¿å‚æ•°ç±»å‹ä¸åŒä¹Ÿä¸è¡Œã€‚ç›¸åŒçš„æ–¹æ³•åªèƒ½å¯¹åº”ä¸€ä¸ªSELã€‚è¿™ä¹Ÿå°±å¯¼è‡´Objective-Cåœ¨å¤„ç†ç›¸åŒæ–¹æ³•åä¸”å‚æ•°ä¸ªæ•°ç›¸åŒä½†ç±»å‹ä¸åŒçš„æ–¹æ³•æ–¹é¢çš„èƒ½åŠ›å¾ˆå·®ã€‚å¦‚æœæŸä¸ªç±»ä¸­å®šä¹‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setWidth:(<span class="keyword">int</span>)width;</div><div class="line">- (<span class="keyword">void</span>)setWidth:(<span class="keyword">double</span>)width;</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·çš„å®šä¹‰è¢«è®¤ä¸ºæ˜¯ä¸€ç§ç¼–è¯‘é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åƒC++,C#é‚£æ ·ã€‚è€Œæ˜¯éœ€è¦åƒä¸‹é¢è¿™æ ·æ¥å£°æ˜ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)setWidthIntValue:(<span class="keyword">int</span>)width;</div><div class="line">-(<span class="keyword">void</span>)setWidthDoubleValue:(<span class="keyword">double</span>)width;</div></pre></td></tr></table></figure></p>
<p>å½“ç„¶ï¼Œä¸åŒçš„ç±»å¯ä»¥æ‹¥æœ‰ç›¸åŒçš„Selectorï¼Œè¿™ä¸ªæ²¡æœ‰é—®é¢˜ã€‚ä¸åŒçš„ç±»çš„å®ä¾‹å¯¹è±¡æ‰§è¡Œç›¸åŒçš„Selectoræ—¶ï¼Œä¼šåœ¨å„è‡ªçš„æ–¹æ³•åˆ—è¡¨ä¸­æ ¹æ®Selectorå»å¯»æ‰¾è‡ªå·±å¯¹åº”çš„IMPã€‚</p>
<p>å·¥ç¨‹ä¸­çš„æ‰€æœ‰SELç»„æˆä¸€ä¸ªSeté›†åˆï¼ŒSetçš„ç‰¹ç‚¹å°±æ˜¯å”¯ä¸€ï¼Œå› æ­¤SELæ˜¯å”¯ä¸€çš„ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ°è¿™ä¸ªæ–¹æ³•é›†åˆä¸­æŸ¥æ‰¾æŸä¸ªæ–¹æ³•æ—¶ï¼Œåªéœ€è¦æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•å¯¹åº”çš„SELå°±è¡Œäº†ï¼ŒSELå®é™…ä¸Šå°±æ˜¯æ ¹æ®æ–¹æ³•åhashåŒ–äº†çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œå¯¹äºå­—ç¬¦ä¸²çš„æ¯”è¾ƒä»…ä»…éœ€è¦æ¯”è¾ƒä»–ä»¬çš„åœ°å€å°±å¯ä»¥äº†ï¼Œå¯ä»¥è¯´é€Ÿåº¦ä¸Šæ— ä¸ä¼¦æ¯”ï¼ä½†æ˜¯ï¼Œä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ•°æ®å¢å¤šä¼šå¢å¤§hashå†²çªè€Œå¯¼è‡´çš„æ€§èƒ½ä¸‹é™(æˆ–æ˜¯æ²¡æœ‰å†²çªï¼Œå› ä¸ºä¹Ÿå¯èƒ½ç”¨çš„æ˜¯prefecthash)ã€‚ä½†ä¸ç®¡ä½¿ç”¨ä»€ä¹ˆæ ·çš„æ–¹æ³•åŠ é€Ÿï¼Œå¦‚æœèƒ½å¤Ÿå°†æ€»é‡å‡å°‘ï¼ˆå¤šä¸ªæ–¹æ³•å¯èƒ½å¯¹åº”åŒä¸€ä¸ªSELï¼‰ã€‚é‚£å°†æ˜¯æœ€çŠ€åˆ©çš„æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ä¸éš¾ç†è§£ï¼Œä¸ºä»€ä¹ˆSELä»…ä»…æ˜¯å‡½æ•°åäº†ã€‚</p>
<p>æœ¬è´¨ä¸Šï¼ŒSELåªæ˜¯ä¸€ä¸ªæŒ‡å‘æ–¹æ³•çš„æŒ‡é’ˆï¼ˆå‡†ç¡®çš„è¯´ï¼Œåªæ˜¯ä¸€ä¸ªæ ¹æ®æ–¹æ³•åhashåŒ–äº†çš„KEYå€¼ï¼Œèƒ½å”¯ä¸€ä»£è¡¨ä¸€ä¸ªæ–¹æ³•ï¼‰ï¼Œå®ƒçš„å­˜åœ¨åªæ˜¯ä¸ºäº†åŠ å¿«æ–¹æ³•çš„æŸ¥è¯¢é€Ÿåº¦ã€‚è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹æˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®ºã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ æ–°çš„selectorï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶è·å–å·²å­˜åœ¨çš„selectorï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•æ¥è·å–SELï¼š</p>
<ul>
<li><code>sel_registerName</code>å‡½æ•°</li>
<li>Objective-Cç¼–è¯‘å™¨æä¾›çš„<code>@selector()</code></li>
<li><code>NSSelectorFromString()</code>æ–¹æ³•</li>
</ul>
<h4 id="IMP"><a href="#IMP" class="headerlink" title="IMP"></a>IMP</h4><p>IMPå®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘æ–¹æ³•å®ç°çš„é¦–åœ°å€ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">id</span> (*IMP)(<span class="keyword">id</span>, SEL, ...)</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå‡½æ•°ä½¿ç”¨å½“å‰CPUæ¶æ„å®ç°çš„æ ‡å‡†Cè°ƒç”¨çº¦å®šã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å‘selfçš„æŒ‡é’ˆï¼ˆå¦‚æœæ˜¯å®ä¾‹æ–¹æ³•ï¼Œåˆ™æ˜¯ç±»å®ä¾‹çš„å†…å­˜åœ°å€ï¼›å¦‚æœæ˜¯ç±»æ–¹æ³•ï¼Œåˆ™æ˜¯æŒ‡å‘å…ƒç±»çš„æŒ‡é’ˆï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•é€‰æ‹©å™¨ï¼ˆselectorï¼‰ï¼Œæ¥ä¸‹æ¥æ˜¯æ–¹æ³•çš„å®é™…å‚æ•°åˆ—è¡¨ã€‚</p>
<p>å‰é¢ä»‹ç»è¿‡çš„SELå°±æ˜¯ä¸ºäº†æŸ¥æ‰¾æ–¹æ³•çš„æœ€ç»ˆå®ç°IMPçš„ã€‚ç”±äºæ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”å”¯ä¸€çš„SELï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡SELæ–¹ä¾¿å¿«é€Ÿå‡†ç¡®åœ°è·å¾—å®ƒæ‰€å¯¹åº”çš„IMPï¼ŒæŸ¥æ‰¾è¿‡ç¨‹å°†åœ¨ä¸‹é¢è®¨è®ºã€‚å–å¾—IMPåï¼Œæˆ‘ä»¬å°±è·å¾—äº†æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ä»£ç çš„å…¥å£ç‚¹ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒè°ƒç”¨æ™®é€šçš„Cè¯­è¨€å‡½æ•°ä¸€æ ·æ¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆäº†ã€‚</p>
<p>é€šè¿‡å–å¾—IMPï¼Œæˆ‘ä»¬å¯ä»¥è·³è¿‡Runtimeçš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œç›´æ¥æ‰§è¡ŒIMPæŒ‡å‘çš„å‡½æ•°å®ç°ï¼Œè¿™æ ·çœå»äº†Runtimeæ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­æ‰€åšçš„ä¸€ç³»åˆ—æŸ¥æ‰¾æ“ä½œï¼Œä¼šæ¯”ç›´æ¥å‘å¯¹è±¡å‘é€æ¶ˆæ¯é«˜æ•ˆä¸€äº›ã€‚</p>
<h4 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h4><p>ä»‹ç»å®ŒSELå’ŒIMPï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥è®²è®²Methodäº†ã€‚Methodç”¨äºè¡¨ç¤ºç±»å®šä¹‰çš„æ–¹æ³•ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_method *Method;</div><div class="line"><span class="keyword">struct</span> objc_method &#123;</div><div class="line">    SEL method_name                	OBJC2_UNAVAILABLE;	<span class="comment">// æ–¹æ³•å</span></div><div class="line">    <span class="keyword">char</span> *method_types                	OBJC2_UNAVAILABLE;</div><div class="line">    IMP method_imp             			OBJC2_UNAVAILABLE;	<span class="comment">// æ–¹æ³•å®ç°</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç»“æ„ä½“ä¸­åŒ…å«ä¸€ä¸ªSELå’ŒIMPï¼Œå®é™…ä¸Šç›¸å½“äºåœ¨SELå’ŒIMPä¹‹é—´ä½œäº†ä¸€ä¸ªæ˜ å°„ã€‚æœ‰ä¸ªSELï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„IMPï¼Œä»è€Œè°ƒç”¨æ–¹æ³•çš„å®ç°ä»£ç ã€‚å…·ä½“çš„æ“ä½œæµç¨‹æˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®ºã€‚</p>
<h5 id="objc-method-description"><a href="#objc-method-description" class="headerlink" title="objc_method_description"></a>objc_method_description</h5><p><code>objc_method_description</code>å®šä¹‰äº†ä¸€ä¸ªObjective-Cæ–¹æ³•ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_method_description &#123; SEL name; <span class="keyword">char</span> *types; &#125;;</div></pre></td></tr></table></figure></p>
<h3 id="æ–¹æ³•ç›¸å…³æ“ä½œå‡½æ•°"><a href="#æ–¹æ³•ç›¸å…³æ“ä½œå‡½æ•°" class="headerlink" title="æ–¹æ³•ç›¸å…³æ“ä½œå‡½æ•°"></a>æ–¹æ³•ç›¸å…³æ“ä½œå‡½æ•°</h3><p>Runtimeæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥å¤„ç†ä¸æ–¹æ³•ç›¸å…³çš„æ“ä½œã€‚åŒ…æ‹¬æ–¹æ³•æœ¬èº«åŠSELã€‚æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹è¿™äº›å‡½æ•°ã€‚</p>
<h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p>æ–¹æ³•æ“ä½œç›¸å…³å‡½æ•°åŒ…æ‹¬ä»¥ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è°ƒç”¨æŒ‡å®šæ–¹æ³•çš„å®ç°</span></div><div class="line"><span class="keyword">id</span> method_invoke ( <span class="keyword">id</span> receiver, Method m, ... );</div><div class="line"><span class="comment">// è°ƒç”¨è¿”å›ä¸€ä¸ªæ•°æ®ç»“æ„çš„æ–¹æ³•çš„å®ç°</span></div><div class="line"><span class="keyword">void</span> method_invoke_stret ( <span class="keyword">id</span> receiver, Method m, ... );</div><div class="line"><span class="comment">// è·å–æ–¹æ³•å</span></div><div class="line">SEL method_getName ( Method m );</div><div class="line"><span class="comment">// è¿”å›æ–¹æ³•çš„å®ç°</span></div><div class="line">IMP method_getImplementation ( Method m );</div><div class="line"><span class="comment">// è·å–æè¿°æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼ç±»å‹çš„å­—ç¬¦ä¸²</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * method_getTypeEncoding ( Method m );</div><div class="line"><span class="comment">// è·å–æ–¹æ³•çš„è¿”å›å€¼ç±»å‹çš„å­—ç¬¦ä¸²</span></div><div class="line"><span class="keyword">char</span> * method_copyReturnType ( Method m );</div><div class="line"><span class="comment">// è·å–æ–¹æ³•çš„æŒ‡å®šä½ç½®å‚æ•°çš„ç±»å‹å­—ç¬¦ä¸²</span></div><div class="line"><span class="keyword">char</span> * method_copyArgumentType ( Method m, <span class="keyword">unsigned</span> <span class="keyword">int</span> index );</div><div class="line"><span class="comment">// é€šè¿‡å¼•ç”¨è¿”å›æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å­—ç¬¦ä¸²</span></div><div class="line"><span class="keyword">void</span> method_getReturnType ( Method m, <span class="keyword">char</span> *dst, size_t dst_len );</div><div class="line"><span class="comment">// è¿”å›æ–¹æ³•çš„å‚æ•°çš„ä¸ªæ•°</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> method_getNumberOfArguments ( Method m );</div><div class="line"><span class="comment">// é€šè¿‡å¼•ç”¨è¿”å›æ–¹æ³•æŒ‡å®šä½ç½®å‚æ•°çš„ç±»å‹å­—ç¬¦ä¸²</span></div><div class="line"><span class="keyword">void</span> method_getArgumentType ( Method m, <span class="keyword">unsigned</span> <span class="keyword">int</span> index, <span class="keyword">char</span> *dst, size_t dst_len );</div><div class="line"><span class="comment">// è¿”å›æŒ‡å®šæ–¹æ³•çš„æ–¹æ³•æè¿°ç»“æ„ä½“</span></div><div class="line"><span class="keyword">struct</span> objc_method_description * method_getDescription ( Method m );</div><div class="line"><span class="comment">// è®¾ç½®æ–¹æ³•çš„å®ç°</span></div><div class="line">IMP method_setImplementation ( Method m, IMP imp );</div><div class="line"><span class="comment">// äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°</span></div><div class="line"><span class="keyword">void</span> method_exchangeImplementations ( Method m1, Method m2 );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>method_invoke</code>å‡½æ•°ï¼Œè¿”å›çš„æ˜¯å®é™…å®ç°çš„è¿”å›å€¼ã€‚å‚æ•°<code>receiver</code>ä¸èƒ½ä¸ºç©ºã€‚è¿™ä¸ªæ–¹æ³•çš„æ•ˆç‡ä¼šæ¯”<code>method_getImplementation</code>å’Œ<code>method_getName</code>æ›´å¿«ã€‚</li>
<li><code>method_getName</code>å‡½æ•°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªSELã€‚å¦‚æœæƒ³è·å–æ–¹æ³•åçš„Cå­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨<code>sel_getName(method_getName(method))</code>ã€‚</li>
<li><code>method_getReturnType</code>å‡½æ•°ï¼Œç±»å‹å­—ç¬¦ä¸²ä¼šè¢«æ‹·è´åˆ°dstä¸­ã€‚</li>
<li><code>method_setImplementation</code>å‡½æ•°ï¼Œæ³¨æ„è¯¥å‡½æ•°è¿”å›å€¼æ˜¯æ–¹æ³•ä¹‹å‰çš„å®ç°ã€‚</li>
</ul>
<h4 id="æ–¹æ³•é€‰æ‹©å™¨"><a href="#æ–¹æ³•é€‰æ‹©å™¨" class="headerlink" title="æ–¹æ³•é€‰æ‹©å™¨"></a>æ–¹æ³•é€‰æ‹©å™¨</h4><p>é€‰æ‹©å™¨ç›¸å…³çš„æ“ä½œå‡½æ•°åŒ…æ‹¬ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è¿”å›ç»™å®šé€‰æ‹©å™¨æŒ‡å®šçš„æ–¹æ³•çš„åç§°</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * sel_getName ( SEL sel );</div><div class="line"><span class="comment">// åœ¨Objective-C Runtimeç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–¹æ³•ï¼Œå°†æ–¹æ³•åæ˜ å°„åˆ°ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œå¹¶è¿”å›è¿™ä¸ªé€‰æ‹©å™¨</span></div><div class="line">SEL sel_registerName ( <span class="keyword">const</span> <span class="keyword">char</span> *str );</div><div class="line"><span class="comment">// åœ¨Objective-C Runtimeç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–¹æ³•</span></div><div class="line">SEL sel_getUid ( <span class="keyword">const</span> <span class="keyword">char</span> *str );</div><div class="line"><span class="comment">// æ¯”è¾ƒä¸¤ä¸ªé€‰æ‹©å™¨</span></div><div class="line"><span class="built_in">BOOL</span> sel_isEqual ( SEL lhs, SEL rhs );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>sel_registerName</code>å‡½æ•°ï¼šåœ¨æˆ‘ä»¬å°†ä¸€ä¸ªæ–¹æ³•æ·»åŠ åˆ°ç±»å®šä¹‰æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨<code>Objective Runtime</code>ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªæ–¹æ³•åä»¥è·å–æ–¹æ³•çš„é€‰æ‹©å™¨ã€‚</li>
</ul>
<h3 id="æ–¹æ³•è°ƒç”¨æµç¨‹"><a href="#æ–¹æ³•è°ƒç”¨æµç¨‹" class="headerlink" title="æ–¹æ³•è°ƒç”¨æµç¨‹"></a>æ–¹æ³•è°ƒç”¨æµç¨‹</h3><p>åœ¨Objective-Cä¸­ï¼Œæ¶ˆæ¯ç›´åˆ°è¿è¡Œæ—¶åœ¨ç»‘å®šåˆ°æ–¹æ³•å®ç°ä¸Šã€‚ç¼–è¯‘å™¨ä¼šå°†æ¶ˆæ¯è¡¨è¾¾å¼<code>[receiver message]</code>è½¬åŒ–ä¸ºä¸€ä¸ªæ¶ˆæ¯å‡½æ•°çš„è°ƒç”¨ï¼Œå³<code>objc_msgSend</code>ã€‚è¿™ä¸ªå‡½æ•°å°†æ¶ˆæ¯æ¥æ”¶è€…å’Œæ–¹æ³•åä½œä¸ºå…¶åŸºç¡€å‚æ•°ï¼Œå¦‚ä»¥ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">objc_msgSend(receiver, selector)</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæ¶ˆæ¯ä¸­è¿˜æœ‰å…¶ä»–å‚æ•°ï¼Œåˆ™è¯¥æ–¹æ³•çš„å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">objc_msgSend(receiver, selector, arg1, arg2, ...)</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå‡½æ•°å®Œæˆäº†åŠ¨æ€ç»‘å®šçš„æ‰€æœ‰äº‹æƒ…ï¼š</p>
<ol>
<li>é¦–å…ˆå®ƒæ‰¾åˆ°selectorå¯¹åº”çš„æ–¹æ³•å®ç°ã€‚å› ä¸ºåŒä¸€ä¸ªæ–¹æ³•å¯èƒ½åœ¨ä¸åŒçš„ç±»ä¸­æœ‰ä¸åŒçš„å®ç°ï¼Œæ‰€ä»¥éœ€è¦ä¾èµ–æ¥æ”¶è€…çš„ç±»æ¥æ‰¾åˆ°ç¡®åˆ‡çš„å®ç°ã€‚</li>
<li>å®ƒè°ƒç”¨æ–¹æ³•å®ç°ï¼Œå¹¶å°†æ¥æ”¶è€…å¯¹è±¡åŠæ–¹æ³•çš„æ‰€æœ‰å‚æ•°ä¼ ç»™å®ƒã€‚</li>
<li>æœ€åï¼Œå®ƒå°†å®ç°è¿”å›çš„å€¼ä½œä¸ºå®ƒè‡ªå·±çš„è¿”å›å€¼ã€‚</li>
</ol>
<p>æ¶ˆæ¯çš„å…³é”®åœ¨äºæˆ‘ä»¬å‰é¢ç« èŠ‚è®¨è®ºè¿‡çš„ç»“æ„ä½“<code>Objc_class</code>ï¼Œè¿™ä¸ªç»“æ„ä½“æœ‰ä¸¤ä¸ªå­—æ®µæ˜¯æˆ‘ä»¬åœ¨æ¶ˆæ¯åˆ†å‘çš„å…³æ³¨çš„ï¼š</p>
<ol>
<li>æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆ</li>
<li>ä¸€ä¸ªç±»çš„æ–¹æ³•åˆ†å‘è¡¨ï¼Œå³<code>methodLists</code></li>
</ol>
<p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡æ—¶ï¼Œå…ˆä¸ºå…¶åˆ†é…å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–å…¶æˆå‘˜å˜é‡ã€‚å…¶ä¸­isaæŒ‡é’ˆä¹Ÿä¼šè¢«åˆå§‹åŒ–ï¼Œè®©å¯¹è±¡å¯ä»¥è®¿é—®ç±»åŠç±»çš„ç»§æ‰¿ä½“ç³»ã€‚</p>
<p>ä¸‹å›¾æ¼”ç¤ºäº†è¿™æ ·ä¸€ä¸ªæ¶ˆæ¯çš„åŸºæœ¬æ¡†æ¶ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/runtime1.png?raw=true"><br></div>

<p>å½“æ¶ˆæ¯å‘é€ç»™ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ<code>objc_msgSend</code>é€šè¿‡å¯¹è±¡çš„isaæŒ‡é’ˆè·å–åˆ°ç±»çš„ç»“æ„ä½“ï¼Œç„¶ååœ¨æ–¹æ³•åˆ†å‘è¡¨é‡Œé¢æŸ¥æ‰¾æ–¹æ³•çš„selectorã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°selectorï¼Œåˆ™é€šè¿‡<code>objc_msgSend</code>ç»“æ„ä½“ä¸­çš„æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆæ‰¾åˆ°å…¶çˆ¶ç±»ï¼Œå¹¶åœ¨çˆ¶ç±»çš„åˆ†å‘è¡¨é‡Œé¢æŸ¥æ‰¾æ–¹æ³•çš„selectorã€‚ä¾æ­¤ï¼Œä¼šä¸€ç›´æ²¿ç”¨ç±»çš„ç»§æ‰¿ä½“ç³»åˆ°è¾¾NSObjectç±»ã€‚ä¸€æ—¦å®šä½åˆ°selectorï¼Œå‡½æ•°å°±è·å–åˆ°äº†å®ç°çš„å…¥å£ç‚¹ï¼Œå¹¶ä¼ å…¥ç›¸åº”çš„å‚æ•°æ¥æ‰§è¡Œæ–¹æ³•çš„å…·ä½“å®ç°ã€‚å¦‚æœæœ€åæ²¡æœ‰å®šä½åˆ°selectorï¼Œåˆ™ä¼šèµ°æ¶ˆæ¯è½¬å‘æµç¨‹ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨åé¢è®¨è®ºã€‚</p>
<p>ä¸ºäº†åŠ é€Ÿæ¶ˆæ¯çš„å¤„ç†ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿç¼“å­˜ä½¿ç”¨è¿‡çš„selectoråŠå¯¹åº”çš„æ–¹æ³•çš„åœ°å€ã€‚è¿™ç‚¹æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºå¯¹ï¼Œä¸å†é‡å¤ã€‚</p>
<h4 id="éšè—å‚æ•°"><a href="#éšè—å‚æ•°" class="headerlink" title="éšè—å‚æ•°"></a>éšè—å‚æ•°</h4><p><code>objc_msgSend</code>æœ‰ä¸¤ä¸ªéšè—å‚æ•°ï¼š</p>
<ol>
<li>æ¶ˆæ¯æ¥æ”¶å¯¹è±¡</li>
<li>æ–¹æ³•çš„selector</li>
</ol>
<p>è¿™ä¸¤ä¸ªå‚æ•°ä¸ºæ–¹æ³•çš„å®ç°æä¾›äº†è°ƒç”¨è€…çš„ä¿¡æ¯ã€‚ä¹‹æ‰€ä»¥è¯´æ˜¯éšè—çš„ï¼Œæ˜¯å› ä¸ºå®ƒä»¬åœ¨å®šä¹‰æ–¹æ³•çš„æºä»£ç ä¸­æ²¡æœ‰å£°æ˜ã€‚å®ƒä»¬æ˜¯åœ¨ç¼–è¯‘å™¨è¢«æ’å…¥å®ç°ä»£ç çš„ã€‚</p>
<p>è™½ç„¶è¿™äº›å‚æ•°æ²¡æœ‰æ˜¾ç¤ºå£°æ˜ï¼Œä½†åœ¨ä»£ç ä¸­ä»ç„¶å¯ä»¥å¼•ç”¨å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨selfæ¥å¼•ç”¨æ¥æ”¶è€…å¯¹è±¡ï¼Œä½¿ç”¨<code>_cmd</code>æ¥å¼•ç”¨é€‰æ‹©å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- strange</div><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span>  target = getTheReceiver();</div><div class="line">    SEL method = getTheMethod();</div><div class="line">    <span class="keyword">if</span> ( target == <span class="keyword">self</span> || method == _cmd )</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">return</span> [target performSelector:method];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å½“ç„¶ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯self,<code>_cmd</code>åœ¨å®é™…ä¸­ç”¨çš„æ¯”è¾ƒå°‘ã€‚</p>
<h4 id="è·å–æ–¹æ³•åœ°å€"><a href="#è·å–æ–¹æ³•åœ°å€" class="headerlink" title="è·å–æ–¹æ³•åœ°å€"></a>è·å–æ–¹æ³•åœ°å€</h4><p>Runtimeä¸­æ–¹æ³•çš„åŠ¨æ€ç»‘å®šè®©æˆ‘ä»¬å†™ä»£ç æ—¶æ›´å…·çµæ´»æ€§ã€‚å¦‚æˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯è½¬å‘ç»™æˆ‘ä»¬æƒ³è¦çš„å¯¹è±¡ï¼Œæˆ–è€…éšæ„äº¤æ¢ä¸€ä¸ªæ–¹æ³•çš„å®ç°ç­‰ã€‚ä¸è¿‡çµæ´»æ€§çš„æå‡ä¹Ÿå¸¦æ¥äº†æ€§èƒ½ä¸Šçš„ä¸€äº›æŸè€—ã€‚æ¯•ç«Ÿæˆ‘ä»¬éœ€è¦å»æŸ¥æ‰¾æ–¹æ³•çš„å®ç°ï¼Œè€Œä¸åƒå‡½æ•°è°ƒç”¨æ¥çš„é‚£ä¹ˆç›´æ¥ã€‚å½“ç„¶ï¼Œæ–¹æ³•çš„ç¼“å­˜ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬ä¸Šé¢æåˆ°è¿‡ï¼Œæˆ‘ä»¬æƒ³è¦é¿å¼€è¿™ç§åŠ¨æ€ç»‘å®šæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·å–æ–¹æ³•å®ç°çš„åœ°å€ï¼Œç„¶åæƒ³è°ƒç”¨å‡½æ•°ä¸€æ ·æ¥ç›´æ¥è°ƒç”¨å®ƒã€‚ç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾ªç¯å†…é¢‘ç¹åœ°è°ƒç”¨ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•æ—¶ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚</p>
<p>NSObjectç±»æä¾›äº†<code>methodForSelector:</code>æ–¹æ³•ï¼Œè®©æˆ‘ä»¬å¯ä»¥è·å–åˆ°æ–¹æ³•çš„æŒ‡é’ˆï¼Œç„¶åé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥è°ƒç”¨å®ç°ä»£ç ã€‚æˆ‘ä»¬éœ€è¦å°†<code>methodForSelector:</code>è¿”å›çš„æŒ‡é’ˆè½¬æ¢ä¸ºåˆé€‚çš„å‡½æ•°ç±»å‹ï¼Œå‡½æ•°å‚æ•°å’Œè¿”å›å€¼éƒ½éœ€è¦åŒ¹é…ä¸Šã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹ä»£ç æ¥çœ‹çœ‹<code>methodForSelector:</code>çš„ä½¿ç”¨ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">void</span> (*<span class="keyword">setter</span>)(<span class="keyword">id</span>, SEL, <span class="built_in">BOOL</span>);</div><div class="line"><span class="keyword">int</span> i;</div><div class="line"><span class="keyword">setter</span> = (<span class="keyword">void</span> (*)(<span class="keyword">id</span>, SEL, <span class="built_in">BOOL</span>))[target methodForSelector:<span class="keyword">@selector</span>(setFilled:)];</div><div class="line"><span class="keyword">for</span> (i = <span class="number">0</span> ; i &lt; <span class="number">1000</span> ; i++)</div><div class="line">    <span class="keyword">setter</span>(targetList[i], <span class="keyword">@selector</span>(setFilled:), <span class="literal">YES</span>);</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯å‡½æ•°æŒ‡é’ˆçš„å‰ä¸¤ä¸ªå‚æ•°å¿…é¡»æ˜¯idå’ŒSELã€‚</p>
<p>å½“ç„¶è¿™ç§æ–¹å¼åªé€‚åˆäºåœ¨ç±»ä¼¼äºforå¾ªç¯è¿™ç§æƒ…å†µä¸‹é¢‘ç¹è°ƒç”¨åŒä¸€æ–¹æ³•ï¼Œä»¥æé«˜æ€§èƒ½çš„æƒ…å†µã€‚å¦å¤–ï¼Œ<code>methodForSelector:</code>æ˜¯ç”±Cocoaè¿è¡Œæ—¶æä¾›çš„ï¼›å®ƒä¸æ˜¯Objective-Cè¯­è¨€çš„ç‰¹æ€§ã€‚</p>
<h3 id="æ¶ˆæ¯è½¬å‘"><a href="#æ¶ˆæ¯è½¬å‘" class="headerlink" title="æ¶ˆæ¯è½¬å‘"></a>æ¶ˆæ¯è½¬å‘</h3><p>å½“ä¸€ä¸ªå¯¹è±¡èƒ½æ¥æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå°±ä¼šèµ°æ­£å¸¸çš„æ–¹æ³•è°ƒç”¨æµç¨‹ã€‚ä½†å¦‚æœä¸€ä¸ªå¯¹è±¡æ— æ³•æ¥æ”¶æŒ‡å®šçš„æ¶ˆæ¯æ—¶ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ˜¯ä»¥<code>[object message]</code>çš„æ–¹å¼è°ƒç”¨æ–¹æ³•ï¼Œå¦‚æœ<code>object</code>æ— æ³•å“åº”<code>message</code>æ¶ˆæ¯æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ä½†å¦‚æœæ˜¯ä»¥<code>perfrom...</code>çš„å½¢å¼æ¥è°ƒç”¨ï¼Œåˆ™éœ€è¦ç­‰åˆ°è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šobjectæ˜¯å¦èƒ½æ¥æ”¶<code>message</code>æ¶ˆæ¯ã€‚å¦‚æœä¸èƒ½ï¼Œåˆ™ç¨‹åºå´©æºƒã€‚</p>
<p>é€šå¸¸ï¼Œå½“æˆ‘ä»¬ä¸èƒ½ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦èƒ½æ¥æ”¶æŸä¸ªæ¶ˆæ¯æ—¶ï¼Œä¼šå…ˆè°ƒç”¨<code>respondsToSelector:</code>æ¥åˆ¤æ–­ä¸€ä¸‹ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:<span class="keyword">@selector</span>(method)]) &#123;</div><div class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(method)];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬è¿™è¾¹æƒ³è®¨è®ºä¸‹ä¸ä½¿ç”¨<code>respondsToSelector:</code>åˆ¤æ–­çš„æƒ…å†µã€‚è¿™æ‰æ˜¯æˆ‘ä»¬è¿™ä¸€èŠ‚çš„é‡ç‚¹ã€‚</p>
<p>å½“ä¸€ä¸ªå¯¹è±¡æ— æ³•æ¥æ”¶æŸä¸€æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šå¯åŠ¨æ‰€è°“â€™<em>æ¶ˆæ¯è½¬å‘(message forwarding)</em>â€˜æœºåˆ¶ï¼Œé€šè¿‡è¿™ä¸€æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰å¯¹è±¡å¦‚ä½•å¤„ç†æœªçŸ¥çš„æ¶ˆæ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡æ¥æ”¶åˆ°æœªçŸ¥çš„æ¶ˆæ¯ï¼Œä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œé€šè¿‡æ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å¼‚å¸¸ä¿¡æ¯ï¼š<br><figure class="highlight"><table><tr><td class="code"><pre><div class="line">-[SUTRuntimeMethod method]: unrecognized selector sent to instance 0x100111940</div><div class="line">*** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '-[SUTRuntimeMethod method]: unrecognized selector sent to instance 0x100111940'</div></pre></td></tr></table></figure></p>
<p>è¿™æ®µå¼‚å¸¸ä¿¡æ¯å®é™…ä¸Šæ˜¯ç”±NSObjectçš„<code>doesNotRecognizeSelector</code>æ–¹æ³•æŠ›å‡ºæ¥çš„ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€äº›æªæ–½ï¼Œè®©æˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œè€Œé¿å…ç¨‹åºçš„å´©æºƒã€‚</p>
<p>æ¶ˆæ¯è½¬å‘æœºåˆ¶åŸºæœ¬ä¸Šåˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åŠ¨æ€æ–¹æ³•è§£æ</li>
<li>å¤‡ç”¨æ¥æ”¶è€…</li>
<li>å®Œæ•´è½¬å‘</li>
</ol>
<p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†è®¨è®ºä¸€ä¸‹è¿™ä¸‰ä¸ªæ­¥éª¤ã€‚</p>
<h4 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h4><p>å¯¹è±¡åœ¨æ¥æ”¶åˆ°æœªçŸ¥çš„æ¶ˆæ¯æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨æ‰€å±ç±»çš„ç±»æ–¹æ³•<code>+resolveInstanceMethod:</code>(å®ä¾‹æ–¹æ³•)æˆ–è€…<code>+resolveClassMethod:</code>(ç±»æ–¹æ³•)ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æœ‰æœºä¼šä¸ºè¯¥æœªçŸ¥æ¶ˆæ¯æ–°å¢ä¸€ä¸ªâ€œå¤„ç†æ–¹æ³•â€ã€‚ä¸è¿‡ä½¿ç”¨è¯¥æ–¹æ³•çš„å‰ææ˜¯æˆ‘ä»¬å·²ç»å®ç°äº†è¯¥â€œå¤„ç†æ–¹æ³•â€ï¼Œåªéœ€è¦åœ¨è¿è¡Œæ—¶é€šè¿‡<code>class_addMethod</code>å‡½æ•°åŠ¨æ€æ·»åŠ åˆ°ç±»é‡Œé¢å°±å¯ä»¥äº†ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">void</span> functionForMethod1(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd) &#123;</div><div class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@, %p"</span>, <span class="keyword">self</span>, _cmd);</div><div class="line">&#125;</div><div class="line">	</div><div class="line">+ (<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel &#123;</div><div class="line">    <span class="built_in">NSString</span> *selectorString = <span class="built_in">NSStringFromSelector</span>(sel);</div><div class="line">    <span class="keyword">if</span> ([selectorString isEqualToString:<span class="string">@"method1"</span>]) &#123;</div><div class="line">        class_addMethod(<span class="keyword">self</span>.class, <span class="keyword">@selector</span>(method1), (IMP)functionForMethod1, <span class="string">"@:"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveInstanceMethod:sel];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸è¿‡è¿™ç§æ–¹æ¡ˆæ›´å¤šçš„æ˜¯ä¸ºäº†å®ç°<code>@dynamic</code>å±æ€§ã€‚</p>
<h4 id="å¤‡ç”¨æ¥æ”¶è€…"><a href="#å¤‡ç”¨æ¥æ”¶è€…" class="headerlink" title="å¤‡ç”¨æ¥æ”¶è€…"></a>å¤‡ç”¨æ¥æ”¶è€…</h4><p>å¦‚æœåœ¨ä¸Šä¸€æ­¥æ— æ³•å¤„ç†æ¶ˆæ¯ï¼Œåˆ™Runtimeä¼šç»§ç»­è°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªénilå¾—ç»“æœï¼Œåˆ™è¿™ä¸ªå¯¹è±¡ä¼šä½œä¸ºæ¶ˆæ¯çš„æ–°æ¥æ”¶è€…ï¼Œä¸”æ¶ˆæ¯ä¼šè¢«åˆ†å‘åˆ°è¿™ä¸ªå¯¹è±¡ã€‚å½“ç„¶è¿™ä¸ªå¯¹è±¡ä¸èƒ½æ˜¯<code>self</code>å±å£°ï¼Œå¦åˆ™å°±æ˜¯å‡ºç°æ— é™å¾ªç¯ã€‚å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šç›¸åº”çš„å¯¹è±¡æ¥å¤„ç†<code>aSelector</code>ï¼Œåˆ™åº”è¯¥è°ƒç”¨çˆ¶ç±»çš„å®ç°æ¥è¿”å›ç»“æœã€‚</p>
<p>ä½¿ç”¨è¿™ä¸ªæ–¹æ³•é€šå¸¸æ˜¯åœ¨å¯¹è±¡å†…éƒ¨ï¼Œå¯èƒ½è¿˜æœ‰ä¸€ç³»åˆ—å…¶ä»–å¯¹è±¡å¤„ç†è¯¥æ¶ˆæ¯ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç”¨è¿™äº›å¯¹è±¡æ¥å¤„ç†æ¶ˆæ¯å¹¶è¿”å›ï¼Œè¿™æ ·åœ¨å¯¹è±¡å¤–éƒ¨çœ‹æ¥ï¼Œè¿˜æ˜¯ç”±è¯¥å¯¹è±¡äº²è‡ªå¤„ç†äº†è¿™ä¸€æ¶ˆæ¯ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SUTRuntimeMethodHelper</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="keyword">void</span>)method2;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SUTRuntimeMethodHelper</span></span></div><div class="line">- (<span class="keyword">void</span>)method2 &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %p"</span>, <span class="keyword">self</span>, _cmd);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="meta">#pragma mark -</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SUTRuntimeMethod</span> () </span>&#123;</div><div class="line">    SUTRuntimeMethodHelper *_helper;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SUTRuntimeMethod</span></span></div><div class="line">+ (<span class="keyword">instancetype</span>)object &#123;</div><div class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] init];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">instancetype</span>)init &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> != <span class="literal">nil</span>) &#123;</div><div class="line">        _helper = [[SUTRuntimeMethodHelper alloc] init];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)test &#123;</div><div class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(method2)];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"forwardingTargetForSelector"</span>);</div><div class="line">    <span class="built_in">NSString</span> *selectorString = <span class="built_in">NSStringFromSelector</span>(aSelector);</div><div class="line">    <span class="comment">// å°†æ¶ˆæ¯è½¬å‘ç»™_helperæ¥å¤„ç†</span></div><div class="line">    <span class="keyword">if</span> ([selectorString isEqualToString:<span class="string">@"method2"</span>]) &#123;</div><div class="line">        <span class="keyword">return</span> _helper;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> forwardingTargetForSelector:aSelector];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸€æ­¥é€‚åˆäºæˆ‘ä»¬åªæƒ³å°†æ¶ˆæ¯è½¬å‘åˆ°å¦ä¸€ä¸ªèƒ½å¤„ç†è¯¥æ¶ˆæ¯çš„å¯¹è±¡ä¸Šã€‚ä½†è¿™ä¸€æ­¥æ— æ³•å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¦‚æ“ä½œæ¶ˆæ¯çš„å‚æ•°å’Œè¿”å›å€¼ã€‚</p>
<h4 id="å®Œæ•´æ¶ˆæ¯è½¬å‘"><a href="#å®Œæ•´æ¶ˆæ¯è½¬å‘" class="headerlink" title="å®Œæ•´æ¶ˆæ¯è½¬å‘"></a>å®Œæ•´æ¶ˆæ¯è½¬å‘</h4><p>å¦‚æœåœ¨ä¸Šä¸€æ­¥è¿˜ä¸èƒ½å¤„ç†æœªçŸ¥æ¶ˆæ¯ï¼Œåˆ™å”¯ä¸€èƒ½åšçš„å°±æ˜¯å¯ç”¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶äº†ã€‚æ­¤æ—¶ä¼šè°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation</div></pre></td></tr></table></figure></p>
<p>è¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨è¿™ä¸€æ­¥ç»™æ¶ˆæ¯æ¥æ”¶è€…æœ€åä¸€æ¬¡æœºä¼šå°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚å¯¹è±¡ä¼šåˆ›å»ºä¸€ä¸ªè¡¨ç¤ºæ¶ˆæ¯çš„NSInvocationå¯¹è±¡ï¼ŒæŠŠä¸å°šæœªå¤„ç†çš„æ¶ˆæ¯æœ‰å…³çš„å…¨éƒ¨ç»†èŠ‚éƒ½å°è£…åœ¨<code>anInvocation</code>ä¸­ï¼ŒåŒ…æ‹¬<code>selector</code>,ç›®æ ‡ï¼ˆ<code>target</code>ï¼‰å’Œå‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨<code>forwardInvocation</code>æ–¹æ³•ä¸­é€‰æ‹©å°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚</p>
<p><code>forwardInvocation</code>æ–¹æ³•çš„å®ç°æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼š</p>
<ol>
<li>å®šä½å¯ä»¥å“åº”å°è£…åœ¨<code>anInvocation</code>ä¸­çš„æ¶ˆæ¯å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä¸éœ€è¦èƒ½å¤„ç†æ‰€æœ‰æœªçŸ¥æ¶ˆæ¯ã€‚</li>
<li>ä½¿ç”¨<code>anInvocation</code>ä½œä¸ºå‚æ•°ï¼Œå°†æ¶ˆæ¯å‘é€ç»™é€‰ä¸­çš„å¯¹è±¡ã€‚<code>anInvocation</code>å°†ä¼šä¿ç•™è°ƒç”¨ç»“æœï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæå–è¿™ä¸€ç»“æœå¹¶å°†å…¶å‘é€åˆ°æ¶ˆæ¯çš„åŸå§‹å‘é€è€…ã€‚</li>
</ol>
<p>ä¸è¿‡ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥å®ç°ä¸€äº›æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¶ˆæ¯çš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚è¿½å›ä¸€ä¸ªå‚æ•°ç­‰ï¼Œç„¶åå†å»å‡ºå‘æ¶ˆæ¯ã€‚å¦å¤–ï¼Œè‹¥å‘ç°æŸä¸ªæ¶ˆæ¯ä¸åº”ç”±æœ¬ç±»å¤„ç†ï¼Œåˆ™åº”è°ƒç”¨çˆ¶ç±»çš„åŒåæ–¹æ³•ï¼Œä»¥ä¾¿ç»§æ‰¿ä½“ç³»ä¸­çš„æ¯ä¸ªç±»éƒ½æœ‰æœºä¼šå¤„ç†æ­¤è°ƒç”¨è¯·æ±‚ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»é‡æ–°å†™ä»¥ä¸‹æ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector</div></pre></td></tr></table></figure></p>
<p>æ¶ˆæ¯è½¬å‘æœºåˆ¶ä½¿ç”¨ä»è¿™ä¸ªæ–¹æ³•ä¸­è·å–çš„ä¿¡æ¯æ¥åˆ›å»º<code>NSInvocation</code>å¯¹è±¡ã€‚å› æ­¤æˆ‘ä»¬å¿…é¡»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œä¸ºç»™å®šçš„selectoræä¾›ä¸€ä¸ªåˆé€‚çš„ç­¾åæ–¹æ³•ã€‚</p>
<p>å®Œæ•´çš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector &#123;</div><div class="line">    <span class="built_in">NSMethodSignature</span> *signature = [<span class="keyword">super</span> methodSignatureForSelector:aSelector];</div><div class="line">    <span class="keyword">if</span> (!signature) &#123;</div><div class="line">        <span class="keyword">if</span> ([SUTRuntimeMethodHelper instancesRespondToSelector:aSelector]) &#123;</div><div class="line">            signature = [SUTRuntimeMethodHelper instanceMethodSignatureForSelector:aSelector];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> signature;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation &#123;</div><div class="line">    <span class="keyword">if</span> ([SUTRuntimeMethodHelper instancesRespondToSelector:anInvocation.selector]) &#123;</div><div class="line">        [anInvocation invokeWithTarget:_helper];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>NSObjectçš„<code>forwardInvocation:</code>æ–¹æ³•å®ç°åªæ˜¯ç®€å•è°ƒç”¨äº†<code>doesNotRecognizeSelector:</code>æ–¹æ³•ï¼Œå®ƒä¸ä¼šè½¬å‘ä»»ä½•æ¶ˆæ¯ã€‚è¿™æ ·ï¼Œå¦‚æœä¸åœ¨ä»¥ä¸Šæ‰€è¿°çš„ä¸‰ä¸ªæ­¥éª¤ä¸­å¤„ç†æœªçŸ¥æ¶ˆæ¯ï¼Œåˆ™ä¼šå¼•å‘ä¸€ä¸ªå¼‚å¸¸ã€‚</p>
<p>ä»æŸç§æ„ä¹‰ä¸Šæ¥è®²ï¼Œ<code>forwardInvocation:</code>å°±åƒä¸€ä¸ªæœªçŸ¥æ¶ˆæ¯çš„åˆ†å‘ä¸­å¿ƒï¼Œå°†è¿™äº›æœªçŸ¥çš„æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚æˆ–è€…ä¹Ÿå¯ä»¥åƒä¸€ä¸ªè¿è¾“ç«™ä¸€æ ·å°†æ‰€æœ‰æœªçŸ¥æ¶ˆæ¯éƒ½å‘é€ç»™åŒä¸€ä¸ªæ¥æ”¶å¯¹è±¡ã€‚è¿™å–å†³äºå…·ä½“çš„å®ç°ã€‚</p>
<h4 id="æ¶ˆæ¯è½¬å‘ä¸å¤šé‡ç»§æ‰¿"><a href="#æ¶ˆæ¯è½¬å‘ä¸å¤šé‡ç»§æ‰¿" class="headerlink" title="æ¶ˆæ¯è½¬å‘ä¸å¤šé‡ç»§æ‰¿"></a>æ¶ˆæ¯è½¬å‘ä¸å¤šé‡ç»§æ‰¿</h4><p>å›è¿‡å¤´æ¥çœ‹ç¬¬äºŒå’Œç¬¬ä¸‰æ­¥ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•æˆ‘ä»¬å¯ä»¥å…è®¸ä¸€ä¸ªå¯¹è±¡ä¸å…¶å®ƒå¯¹è±¡å»ºç«‹å…³ç³»ï¼Œä»¥å¤„ç†æŸäº›æœªçŸ¥æ¶ˆæ¯ï¼Œè€Œè¡¨é¢ä¸Šçœ‹ä»ç„¶æ˜¯è¯¥å¯¹è±¡åœ¨å¤„ç†æ¶ˆæ¯ã€‚é€šè¿‡è¿™ç§å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿâ€œå¤šé‡ç»§æ‰¿â€çš„æŸäº›ç‰¹æ€§ï¼Œè®©å¯¹è±¡å¯ä»¥â€œç»§æ‰¿â€å…¶å®ƒå¯¹è±¡çš„ç‰¹æ€§æ¥å¤„ç†ä¸€äº›äº‹æƒ…ã€‚ä¸è¿‡ï¼Œè¿™ä¸¤è€…é—´æœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼šå¤šé‡ç»§æ‰¿å°†ä¸åŒçš„åŠŸèƒ½é›†æˆåˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå®ƒä¼šè®©å¯¹è±¡å˜å¾—è¿‡å¤§ï¼Œæ¶‰åŠçš„ä¸œè¥¿è¿‡å¤šï¼›è€Œæ¶ˆæ¯è½¬å‘å°†åŠŸèƒ½åˆ†è§£åˆ°ç‹¬ç«‹çš„å°çš„å¯¹è±¡ä¸­ï¼Œå¹¶é€šè¿‡æŸç§æ–¹å¼å°†è¿™äº›å¯¹è±¡è¿æ¥èµ·æ¥ï¼Œå¹¶åšç›¸åº”çš„æ¶ˆæ¯è½¬å‘ã€‚</p>
<p>ä¸è¿‡æ¶ˆæ¯è½¬å‘è™½ç„¶ç±»ä¼¼äºç»§æ‰¿ï¼Œä½†NSObjectçš„ä¸€äº›æ–¹æ³•è¿˜æ˜¯èƒ½åŒºåˆ†ä¸¤è€…ã€‚å¦‚<code>respondsToSelector:</code>å’Œ<code>isKindOfClass:</code>åªèƒ½ç”¨äºç»§æ‰¿ä½“ç³»ï¼Œè€Œä¸èƒ½ç”¨äºè½¬å‘é“¾ã€‚ä¾¿å¦‚æœæˆ‘ä»¬æƒ³è®©è¿™ç§æ¶ˆæ¯è½¬å‘çœ‹èµ·æ¥åƒæ˜¯ç»§æ‰¿ï¼Œåˆ™å¯ä»¥é‡å†™è¿™äº›æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)respondsToSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> ( [<span class="keyword">super</span> respondsToSelector:aSelector])</div><div class="line">		<span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		<span class="comment">/* Here, test whether the aSelector message can     *</span></div><div class="line">		 * be forwarded to another object and whether that  *</div><div class="line">		 * object can respond to it. Return YES if it can.  */</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">NO</span>; 	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†Runtimeä¸­æ¶ˆæ¯å‘é€å’Œè½¬å‘çš„åŸºæœ¬æœºåˆ¶ã€‚è¿™ä¹Ÿæ˜¯Runtimeçš„å¼ºå¤§ä¹‹å¤„ï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç¨‹åºå¢åŠ å¾ˆå¤šåŠ¨æ€çš„è¡Œä¸ºï¼Œè™½ç„¶æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­å¾ˆå°‘ç›´æ¥ä½¿ç”¨è¿™äº›æœºåˆ¶(å¦‚ç›´æ¥è°ƒç”¨objc_msgSend)ï¼Œä½†äº†è§£å®ƒä»¬æœ‰åŠ©äºæˆ‘ä»¬æ›´å¤šåœ°å»äº†è§£åº•å±‚çš„å®ç°ã€‚å…¶å®åœ¨å®é™…çš„ç¼–ç è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çµæ´»åœ°ä½¿ç”¨è¿™äº›æœºåˆ¶ï¼Œå»å®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ï¼Œå¦‚hookæ“ä½œç­‰ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰é¢æˆ‘ä»¬è®¨è®ºäº†Runtimeä¸­å¯¹ç±»å’Œå¯¹è±¡çš„å¤„ç†ï¼ŒåŠå¯¹æˆå‘˜å˜é‡ä¸å±æ€§çš„å¤„ç†ã€‚è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°±è¦å¼€å§‹è®¨è®ºRuntimeä¸­æœ€æœ‰æ„æ€çš„ä¸€éƒ¨åˆ†ï¼šæ¶ˆæ¯å¤„ç†æœºåˆ¶ã€‚æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºæ¶ˆæ¯çš„å‘é€åŠæ¶ˆæ¯çš„è½¬å‘ã€‚ä¸è¿‡åœ¨è®¨è®ºæ¶ˆæ¯ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä¸æ–¹æ³•ç›¸å…³çš„ä¸€äº›å†…å®¹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="http://www.guiyongdong.com/categories/Objective-C/"/>
    
    
      <category term="Runtime" scheme="http://www.guiyongdong.com/tags/Runtime/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C Runtimeè¿è¡Œæ—¶ä¹‹äºŒï¼šæˆå‘˜å˜é‡ä¸å±æ€§</title>
    <link href="http://www.guiyongdong.com/2016/11/24/Objective-C-Runtime%E8%BF%90%E8%A1%8C%E6%97%B6%E4%B9%8B%E4%BA%8C-%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B1%9E%E6%80%A7/"/>
    <id>http://www.guiyongdong.com/2016/11/24/Objective-C-Runtimeè¿è¡Œæ—¶ä¹‹äºŒ-æˆå‘˜å˜é‡ä¸å±æ€§/</id>
    <published>2016-11-24T07:39:47.000Z</published>
    <updated>2017-03-09T07:03:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å‰é¢ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Runtimeä¸­ä¸ç±»å’Œå¯¹è±¡ç›¸å…³çš„å†…å®¹ï¼Œä»è¿™ç« å¼€å§‹ï¼Œæˆ‘ä»¬å°†è®¨è®ºç±»å®ç°ç»†èŠ‚ç›¸å…³çš„å†…å®¹ï¼Œä¸»è¦åŒ…æ‹¬ç±»ä¸­æˆå‘˜å˜é‡ï¼Œå±æ€§ï¼Œæ–¹æ³•ï¼Œåè®®ä¸åˆ†ç±»çš„å®ç°ã€‚</p>
<p>æœ¬ç« çš„ä¸»è¦å†…å®¹å°†èšé›†åœ¨Runtimeå¯¹æˆå‘˜å˜é‡ä¸å±æ€§çš„å¤„ç†ã€‚åœ¨è®¨è®ºä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼šç±»å‹ç¼–ç ã€‚</p>
<a id="more"></a>
<h3 id="ç±»å‹ç¼–ç -Type-Encoding"><a href="#ç±»å‹ç¼–ç -Type-Encoding" class="headerlink" title="ç±»å‹ç¼–ç (Type Encoding)"></a>ç±»å‹ç¼–ç (Type Encoding)</h3><p>ä½œä¸ºå¯¹Runtimeçš„è¡¥å……ï¼Œç¼–è¯‘å™¨å°†æ¯ä¸ªæ–¹æ³•çš„è¿”å›å€¼å’Œå‚æ•°ç±»å‹ç¼–ç ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶ä¸æ–¹æ³•çš„selectorå…³è”åœ¨ä¸€èµ·ã€‚è¿™ç§ç¼–ç æ–¹æ¡ˆåœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@encodeç¼–è¯‘å™¨æŒ‡ä»¤æ¥è·å–å®ƒã€‚å½“ç»™å®šä¸€ä¸ªç±»å‹æ—¶ï¼Œ@encodeè¿”å›è¿™ä¸ªç±»å‹çš„å­—ç¬¦ä¸²ç¼–ç ã€‚è¿™äº›ç±»å‹å¯ä»¥æ˜¯è¯¸å¦‚intã€æŒ‡é’ˆè¿™æ ·çš„åŸºæœ¬ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»“æ„ä½“ã€ç±»ç­‰ç±»å‹ã€‚äº‹å®ä¸Šï¼Œä»»ä½•å¯ä»¥ä½œä¸ºsizeof()æ“ä½œå‚æ•°çš„ç±»å‹éƒ½å¯ä»¥    ç”¨äº@encode()ã€‚</p>
<p>ä¸€ä¸ªæ•°ç»„çš„ç±»å‹ç¼–ç ä½äºæ–¹æ‹¬å·ä¸­ï¼›å…¶ä¸­åŒ…å«æ•°ç»„å…ƒç´ çš„ä¸ªæ•°åŠå…ƒç´ ç±»å‹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">float</span> a[] = &#123;<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>&#125;;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"array encoding type: %s"</span>, <span class="keyword">@encode</span>(<span class="keyword">typeof</span>(a)));</div></pre></td></tr></table></figure></p>
<p>è¾“å‡ºæ˜¯ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">44</span>:<span class="number">54.731</span> RuntimeTest[<span class="number">942</span>:<span class="number">50791</span>] array encoding type: [<span class="number">3</span>f]</div></pre></td></tr></table></figure></p>
<p>å…¶ä»–ç±»å‹å¯å‚è€ƒ<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html#//apple_ref/doc/uid/TP40008048-CH100-SW1" target="_blank" rel="external">Type Encoding</a>,åœ¨æ­¤ä¸ç»†è¯´ã€‚</p>
<p>å¯¹äºå±æ€§è€Œè¨€ï¼Œè¿˜ä¼šæœ‰ä¸€äº›ç‰¹æ®Šçš„ç±»å‹ç¼–ç ï¼Œä»¥è¡¨æ˜å±æ€§æ˜¯åªè¯»ã€æ‹·è´ã€retainç­‰ç­‰ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html#//apple_ref/doc/uid/TP40008048-CH101-SW6" target="_blank" rel="external">Property Type String</a></p>
<h3 id="æˆå‘˜å˜é‡ã€å±æ€§"><a href="#æˆå‘˜å˜é‡ã€å±æ€§" class="headerlink" title="æˆå‘˜å˜é‡ã€å±æ€§"></a>æˆå‘˜å˜é‡ã€å±æ€§</h3><p>Runtimeä¸­å…³äºæˆå‘˜å˜é‡å’Œå±æ€§çš„ç›¸å…³æ•°æ®ç»“æ„å¹¶ä¸å¤šï¼Œåªæœ‰ä¸‰ä¸ªï¼Œå¹¶ä¸”éƒ½å¾ˆç®€å•ã€‚ä¸è¿‡è¿˜æœ‰ä¸ªéå¸¸å®ç”¨ä½†å¯èƒ½ç»å¸¸è¢«å¿½è§†çš„ç‰¹æ€§ï¼Œå³å…³è”å¯¹è±¡ï¼Œæˆ‘ä»¬å°†åœ¨è¿™å°èŠ‚ä¸­è¯¦ç»†è®¨è®ºã€‚</p>
<h4 id="åŸºç¡€æ•°æ®ç±»å‹"><a href="#åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="åŸºç¡€æ•°æ®ç±»å‹"></a>åŸºç¡€æ•°æ®ç±»å‹</h4><h5 id="Ivar"><a href="#Ivar" class="headerlink" title="Ivar"></a>Ivar</h5><p>Ivaræ˜¯è¡¨ç¤ºå®ä¾‹å˜é‡çš„ç±»å‹ï¼Œå…¶å®é™…æ˜¯æŒ‡å‘objc_ivarç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_ivar *Ivar;</div><div class="line"><span class="keyword">struct</span> objc_ivar &#123;</div><div class="line">    <span class="keyword">char</span> *ivar_name              OBJC2_UNAVAILABLE;	<span class="comment">// å˜é‡å</span></div><div class="line">    <span class="keyword">char</span> *ivar_type             	OBJC2_UNAVAILABLE;	<span class="comment">// å˜é‡ç±»å‹</span></div><div class="line">    <span class="keyword">int</span> ivar_offset            		OBJC2_UNAVAILABLE;	<span class="comment">// åŸºåœ°å€åç§»å­—èŠ‚</span></div><div class="line"><span class="meta">#ifdef __LP64__</span></div><div class="line">    <span class="keyword">int</span> space                 		OBJC2_UNAVAILABLE;</div><div class="line"><span class="meta">#endif</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="objc-property-t"><a href="#objc-property-t" class="headerlink" title="objc_property_t"></a>objc_property_t</h5><p>objc_property_tæ˜¯è¡¨ç¤ºObjective-Cå£°æ˜çš„å±æ€§çš„ç±»å‹ï¼Œå…¶å®é™…æ˜¯æŒ‡å‘objc_propertyç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_property *objc_property_t;</div></pre></td></tr></table></figure>
<h5 id="objc-property-attribute-t"><a href="#objc-property-attribute-t" class="headerlink" title="objc_property_attribute_t"></a>objc_property_attribute_t</h5><p>objc_property_attribute_tå®šä¹‰äº†å±æ€§çš„ç‰¹æ€§(attribute)ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name;           <span class="comment">// ç‰¹æ€§å</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *value;          <span class="comment">// ç‰¹æ€§å€¼</span></div><div class="line">&#125; objc_property_attribute_t;</div></pre></td></tr></table></figure>
<h4 id="å…³è”å¯¹è±¡-Associated-Object"><a href="#å…³è”å¯¹è±¡-Associated-Object" class="headerlink" title="å…³è”å¯¹è±¡(Associated Object)"></a>å…³è”å¯¹è±¡(Associated Object)</h4><p>å…³è”å¯¹è±¡æ˜¯Runtimeä¸­ä¸€ä¸ªéå¸¸å®ç”¨çš„ç‰¹æ€§ï¼Œä¸è¿‡å¯èƒ½å¾ˆå®¹æ˜“è¢«å¿½è§†ã€‚</p>
<p>å…³è”å¯¹è±¡ç±»ä¼¼äºæˆå‘˜å˜é‡ï¼Œä¸è¿‡æ˜¯åœ¨è¿è¡Œæ—¶æ·»åŠ çš„ã€‚æˆ‘ä»¬é€šå¸¸ä¼šæŠŠæˆå‘˜å˜é‡(Ivar)æ”¾åœ¨ç±»å£°æ˜çš„å¤´æ–‡ä»¶ä¸­ï¼Œæˆ–è€…æ”¾åœ¨ç±»å®ç°çš„<code>@implementation</code>åé¢ã€‚ä½†è¿™æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œæˆ‘ä»¬ä¸èƒ½å†åˆ†ç±»ä¸­æ·»åŠ æˆå‘˜å˜é‡ã€‚å¦‚æœæˆ‘ä»¬å°è¯•åœ¨åˆ†ç±»ä¸­æ·»åŠ æ–°çš„æˆå‘˜å˜é‡ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
<p>æˆ‘ä»¬å¯èƒ½å¸Œæœ›é€šè¿‡ä½¿ç”¨(ç”šè‡³æ˜¯æ»¥ç”¨)å…¨å±€å˜é‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†è¿™äº›éƒ½ä¸æ˜¯Ivarï¼Œå› ä¸ºä»–ä»¬ä¸ä¼šè¿æ¥åˆ°ä¸€ä¸ªå•ç‹¬çš„å®ä¾‹ã€‚å› æ­¤ï¼Œè¿™ç§æ–¹æ³•å¾ˆå°‘ä½¿ç”¨ã€‚</p>
<p>Objective-Cé’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šå³å…³è”å¯¹è±¡(Associated Object)ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠå…³è”å¯¹è±¡æƒ³è±¡æˆä¸€ä¸ªObjective-Cå¯¹è±¡(å¦‚å­—å…¸),è¿™ä¸ªå¯¹è±¡é€šè¿‡ç»™å®šçš„keyè¿æ¥åˆ°ç±»çš„ä¸€ä¸ªå®ä¾‹ä¸Šã€‚ä¸è¿‡ç”±äºä½¿ç”¨çš„æ˜¯Cæ¥å£ï¼Œæ‰€ä»¥keyæ˜¯ä¸€ä¸ªvoidæŒ‡é’ˆ(const void*)ã€‚æˆ‘ä»¬è¿˜éœ€è¦åˆ¶å®šä¸€ä¸ªå†…å­˜ç®¡ç†ç­–ç•¥ï¼Œä»¥å‘Šè¯‰Runtimeå¦‚ä½•ç®¡ç†è¿™ä¸ªå¯¹è±¡çš„å†…å­˜ã€‚è¿™ä¸ªå†…å­˜ç®¡ç†çš„ç­–ç•¥å¯ä»¥ç”±ä»¥ä¸‹å€¼æŒ‡å®šï¼š</p>
<pre><code>OBJC_ASSOCIATION_ASSIGN                //assign
OBJC_ASSOCIATION_RETAIN_NONATOMIC    //retain  nonatomic
OBJC_ASSOCIATION_COPY_NONATOMIC        //copy nonatomic
OBJC_ASSOCIATION_RETAIN                    // retain
OBJC_ASSOCIATION_COPY                    //copy
</code></pre><p>å½“å®¿ä¸»å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œä¼šæ ¹æ®æŒ‡å®šçš„å†…å­˜ç®¡ç†ç­–ç•¥æ¥å¤„ç†å…³è”å¯¹è±¡ã€‚å¦‚æœæŒ‡å®šçš„ç­–ç•¥æ˜¯assignï¼Œåˆ™å®¿ä¸»é‡Šæ”¾æ—¶ï¼Œå…³è”å¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ï¼›è€Œå¦‚æœæŒ‡å®šçš„æ˜¯retainæˆ–è€…æ˜¯copyï¼Œåˆ™å®¿ä¸»é‡Šæ”¾æ—¶ï¼Œå…³è”å¯¹è±¡ä¼šè¢«é‡Šæ”¾ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥é€‰æ‹©æ˜¯å¦æ˜¯è‡ªåŠ¨retain/copyã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¤„ç†è®¿é—®å¯¹è±¡çš„å¤šçº¿ç¨‹ä»£ç æ—¶ï¼Œè¿™å°±éå¸¸æœ‰ç”¨äº†ã€‚</p>
<p>æˆ‘ä»¬å°†ä¸€ä¸ªå¯¹è±¡è¿æ¥åˆ°å…¶å®ƒå¯¹è±¡æ‰€éœ€è¦åšçš„å°±æ˜¯ä¸‹é¢ä¸¤è¡Œä»£ç ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> myKey;</div><div class="line">objc_setAssociatedObject(<span class="keyword">self</span>, &amp;myKey, anObject, OBJC_ASSOCIATION_RETAIN);</div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œselfå¯¹è±¡å°†è·å–ä¸€ä¸ªæ–°çš„å…³è”çš„å¯¹è±¡anObjectï¼Œä¸”å†…å­˜ç®¡ç†ç­–ç•¥æ˜¯è‡ªåŠ¨retainå…³è”å¯¹è±¡ï¼Œå½“selfå¯¹è±¡é‡Šæ”¾æ—¶ï¼Œä¼šè‡ªåŠ¨releaseå…³è”å¯¹è±¡ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨åŒä¸€ä¸ªkeyæ¥å…³è”å¦å¤–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨é‡Šæ”¾ä¹‹å‰å…³è”çš„å¯¹è±¡ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå…ˆå‰çš„å…³è”å¯¹è±¡ä¼šè¢«å¦¥å–„åœ°å¤„ç†æ‰ï¼Œå¹¶ä¸”æ–°çš„å¯¹è±¡ä¼šä½¿ç”¨å®ƒçš„å†…å­˜ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">id</span> anObject = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;myKey);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>objc_removeAssociatedObjects</code>å‡½æ•°æ¥ç§»é™¤ä¸€ä¸ªå…³è”å¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨<code>objc_setAssociatedObject</code>å‡½æ•°å°†keyæŒ‡å®šçš„å…³è”å¯¹è±¡è®¾ç½®ä¸ºnilã€‚</p>
<p>æˆ‘ä»¬ä¸‹é¢æ¥ç”¨å®ä¾‹æ¼”ç¤ºä¸€ä¸‹å…³è”å¯¹è±¡çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>å‡å®šæˆ‘ä»¬æƒ³è¦åŠ¨æ€åœ°å°†ä¸€ä¸ªTapæ‰‹åŠ¿æ“ä½œè¿æ¥åˆ°ä»»ä½•UIViewä¸­ï¼Œå¹¶ä¸”æ ¹æ®éœ€è¦æŒ‡å®šç‚¹å‡»åçš„å®é™…æ“ä½œã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ªæ‰‹åŠ¿å¯¹è±¡åŠæ“ä½œçš„blockå¯¹è±¡å…³è”åˆ°æˆ‘ä»¬çš„UIViewå¯¹è±¡ä¸­ã€‚è¿™é¡¹ä»»åŠ¡åˆ†ä¸¤éƒ¨åˆ†ã€‚é¦–å…ˆï¼Œå¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ‰‹åŠ¿è¯†åˆ«å¯¹è±¡å¹¶å°†å®ƒåŠblockåšä¸ºå…³è”å¯¹è±¡ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªUIViewçš„åˆ†ç±»<br><em>UIView+GG.h</em><br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIView</span> (<span class="title">GG</span>)</span></div><div class="line">- (<span class="keyword">void</span>)setTapActionWithBlock:(<span class="keyword">void</span> (^)(<span class="keyword">void</span>))block;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p><em>UIView+GG.m</em><br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"UIView+GG.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">void</span> *kDTActionHandlerTapGestureKey;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">void</span> * ;</div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIView</span> (<span class="title">GG</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setTapActionWithBlock:(<span class="keyword">void</span> (^)(<span class="keyword">void</span>))block &#123;</div><div class="line">    <span class="comment">//è·å–å…³è”å¯¹è±¡ï¼ˆæ‰‹åŠ¿ï¼‰</span></div><div class="line">    <span class="built_in">UITapGestureRecognizer</span> *gesture = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;kDTActionHandlerTapGestureKey);</div><div class="line">    <span class="comment">//å¦‚æœå…³è”å¯¹è±¡(æ‰‹åŠ¿)ä¸ºç©ºï¼Œåˆ›å»ºUIViewçš„å…³è”å¯¹è±¡ UITapGestureRecognizerå¯¹è±¡</span></div><div class="line">    <span class="keyword">if</span> (!gesture)</div><div class="line">    &#123;</div><div class="line">        gesture = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(__handleActionForTapGesture:)];</div><div class="line">        [<span class="keyword">self</span> addGestureRecognizer:gesture];</div><div class="line">        <span class="comment">//åˆ›å»ºå®ŒUITapGestureRecognizerå¯¹è±¡ï¼Œå¹¶è®¾ç½®ä¸ºå½“å‰UIViewçš„å…³è”å¯¹è±¡ã€‚</span></div><div class="line">        objc_setAssociatedObject(<span class="keyword">self</span>, &amp;kDTActionHandlerTapGestureKey, gesture, OBJC_ASSOCIATION_RETAIN);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è®¾ç½®blockä¸ºUIViewçš„å…³è”å¯¹è±¡ã€‚</span></div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;kDTActionHandlerTapBlockKey, block, OBJC_ASSOCIATION_COPY);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)__handleActionForTapGesture:(<span class="built_in">UITapGestureRecognizer</span> *)gesture</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (gesture.state == <span class="built_in">UIGestureRecognizerStateRecognized</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//è·å–å…³è”å¯¹è±¡(block)</span></div><div class="line">        <span class="keyword">void</span>(^action)(<span class="keyword">void</span>) = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;kDTActionHandlerTapBlockKey);</div><div class="line">        <span class="keyword">if</span> (action)</div><div class="line">        &#123;</div><div class="line">            action();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬åˆ†åˆ«å®šä¹‰äº†ä¸¤ä¸ªkeyï¼Œä½œä¸ºæˆ‘ä»¬å…³è”å¯¹è±¡çš„keyã€‚åœ¨<code>- (void)setTapActionWithBlock:(void (^)(void))block</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ£€æµ‹äº†æ‰‹åŠ¿è¯†åˆ«çš„å…³è”å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºå¹¶å»ºç«‹å…³è”å…³ç³»ã€‚åŒæ—¶ï¼Œå°†ä¼ å…¥çš„å—å¯¹è±¡è¿æ¥åˆ°æŒ‡å®šçš„keyä¸Šã€‚æ³¨æ„blockå¯¹è±¡çš„å…³è”å†…å­˜ç®¡ç†ç­–ç•¥ã€‚<br>æ‰‹åŠ¿è¯†åˆ«å¯¹è±¡éœ€è¦ä¸€ä¸ª<code>target</code>å’Œ<code>action</code>ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰äº†å¤„ç†æ–¹æ³•ï¼š<code>- (void)__handleActionForTapGesture:(UITapGestureRecognizer *)gesture</code>ã€‚æˆ‘ä»¬éœ€è¦æ£€æµ‹æ‰‹åŠ¿è¯†åˆ«å¯¹è±¡çš„çŠ¶æ€ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦åœ¨ç‚¹å‡»æ‰‹åŠ¿è¯†åˆ«å‡ºæ¥æ—¶æ‰æ‰§è¡Œæ“ä½œã€‚</p>
<p>ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…³è”å¯¹è±¡ä½¿ç”¨èµ·æ¥å¹¶ä¸å¤æ‚ã€‚å®ƒè®©æˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°å¢å¼ºç±»ç°æœ‰çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç¼–ç ä¸­çµæ´»åœ°è¿ç”¨è¿™ä¸€ç‰¹æ€§ã€‚</p>
<h4 id="æˆå‘˜å˜é‡ã€å±æ€§çš„æ“ä½œæ–¹æ³•"><a href="#æˆå‘˜å˜é‡ã€å±æ€§çš„æ“ä½œæ–¹æ³•" class="headerlink" title="æˆå‘˜å˜é‡ã€å±æ€§çš„æ“ä½œæ–¹æ³•"></a>æˆå‘˜å˜é‡ã€å±æ€§çš„æ“ä½œæ–¹æ³•</h4><h5 id="æˆå‘˜å˜é‡"><a href="#æˆå‘˜å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡"></a>æˆå‘˜å˜é‡</h5><p>æˆå‘˜å˜é‡æ“ä½œåŒ…å«ä»¥ä¸‹å‡½æ•°ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * ivar_getName ( Ivar v );</div><div class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡ç±»å‹ç¼–ç </span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * ivar_getTypeEncoding ( Ivar v );</div><div class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡çš„åç§»é‡</span></div><div class="line">ptrdiff_t ivar_getOffset ( Ivar v );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>ivar_getOffset</code>å‡½æ•°ï¼Œå¯¹äºç±»å‹idæˆ–å…¶å®ƒå¯¹è±¡ç±»å‹çš„å®ä¾‹å˜é‡ï¼Œå¯ä»¥è°ƒç”¨<code>object_getIvar</code>å’Œ<code>object_setIvar</code>æ¥ç›´æ¥è®¿é—®æˆå‘˜å˜é‡ï¼Œè€Œä¸é€‚ç”¨åç§»é‡ã€‚</li>
</ul>
<h5 id="å…³è”å¯¹è±¡"><a href="#å…³è”å¯¹è±¡" class="headerlink" title="å…³è”å¯¹è±¡"></a>å…³è”å¯¹è±¡</h5><p>å…³è”å¯¹è±¡æ“ä½œå‡½æ•°åŒ…æ‹¬ä»¥ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è®¾ç½®å…³è”å¯¹è±¡</span></div><div class="line"><span class="keyword">void</span> objc_setAssociatedObject ( <span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key, <span class="keyword">id</span> value, objc_AssociationPolicy policy );</div><div class="line"><span class="comment">// è·å–å…³è”å¯¹è±¡</span></div><div class="line"><span class="keyword">id</span> objc_getAssociatedObject ( <span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key );</div><div class="line"><span class="comment">// ç§»é™¤å…³è”å¯¹è±¡</span></div><div class="line"><span class="keyword">void</span> objc_removeAssociatedObjects ( <span class="keyword">id</span> object );</div></pre></td></tr></table></figure></p>
<p>å…³è”å¯¹è±¡åŠç›¸å…³å®ä¾‹å·²ç»åœ¨å‰é¢è®¨è®ºè¿‡äº†ï¼Œåœ¨æ­¤ä¸å†é‡å¤ã€‚</p>
<h5 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h5><p>å±æ€§æ“ä½œç›¸å…³å‡½æ•°åŒ…æ‹¬ä»¥ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–å±æ€§å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * property_getName ( objc_property_t property );</div><div class="line"><span class="comment">// è·å–å±æ€§ç‰¹æ€§æè¿°å­—ç¬¦ä¸²</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * property_getAttributes ( objc_property_t property );</div><div class="line"><span class="comment">// è·å–å±æ€§ä¸­æŒ‡å®šçš„ç‰¹æ€§</span></div><div class="line"><span class="keyword">char</span> * property_copyAttributeValue ( objc_property_t property, <span class="keyword">const</span> <span class="keyword">char</span> *attributeName );</div><div class="line"><span class="comment">// è·å–å±æ€§çš„ç‰¹æ€§åˆ—è¡¨</span></div><div class="line">objc_property_attribute_t * property_copyAttributeList ( objc_property_t property, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>property_copyAttributeValue</code>å‡½æ•°ï¼Œè¿”å›çš„<code>char*</code>åœ¨ä½¿ç”¨å®Œåéœ€è¦è°ƒç”¨free()é‡Šæ”¾ã€‚</li>
<li><code>property_copyAttributeList</code>å‡½æ•°ï¼Œè¿”å›å€¼åœ¨ä½¿ç”¨å®Œåéœ€è¦è°ƒç”¨free()é‡Šæ”¾ã€‚</li>
</ul>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>å‡å®šè¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬ä»æœåŠ¡ç«¯ä¸¤ä¸ªä¸åŒçš„æ¥å£è·å–ç›¸åŒçš„å­—å…¸æ•°æ®ï¼Œä½†è¿™ä¸¤ä¸ªæ¥å£æ˜¯ç”±ä¸¤ä¸ªäººå†™çš„ï¼Œç›¸åŒçš„ä¿¡æ¯ä½¿ç”¨äº†ä¸åŒçš„å­—æ®µè¡¨ç¤ºã€‚æˆ‘ä»¬æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œå¯å°†è¿™äº›æ•°æ®ä¿å­˜åœ¨ç›¸åŒçš„å¯¹è±¡ä¸­ã€‚å¯¹è±¡ç±»å¦‚ä¸‹å®šä¹‰ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyObject</span>: <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span>    *   name;                  </div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span>    *   status;                 </div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>æ¥å£Aã€Bè¿”å›çš„å­—å…¸æ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">@&#123;<span class="string">@"name1"</span>: <span class="string">"å¼ ä¸‰"</span>, <span class="string">@"status1"</span>: <span class="string">@"start"</span>&#125;</div><div class="line">@&#123;<span class="string">@"name2"</span>: <span class="string">"å¼ ä¸‰"</span>, <span class="string">@"status2"</span>: <span class="string">@"end"</span>&#125;</div></pre></td></tr></table></figure></p>
<p>é€šå¸¸çš„æ–¹æ³•æ˜¯å†™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«åšè½¬æ¢ï¼Œä¸è¿‡å¦‚æœèƒ½çµæ´»åœ°è¿ç”¨Runtimeçš„è¯ï¼Œå¯ä»¥åªå®ç°ä¸€ä¸ªè½¬æ¢ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªæ˜ å°„å­—å…¸(å…¨å±€å˜é‡)<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="built_in">NSMutableDictionary</span> *map = <span class="literal">nil</span>;</div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyObject</span>	</span></div><div class="line">+ (<span class="keyword">void</span>)load</div><div class="line">&#123;</div><div class="line">    map = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    map[<span class="string">@"name1"</span>]                = <span class="string">@"name"</span>;</div><div class="line">    map[<span class="string">@"status1"</span>]              = <span class="string">@"status"</span>;</div><div class="line">    map[<span class="string">@"name2"</span>]                = <span class="string">@"name"</span>;</div><div class="line">    map[<span class="string">@"status2"</span>]              = <span class="string">@"status"</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä»£ç å°†ä¸¤ä¸ªå­—å…¸ä¸­ä¸åŒçš„å­—æ®µæ˜ å°„åˆ°<code>MyObject</code>ä¸­ç›¸åŒçš„å±æ€§ä¸Šï¼Œè¿™æ ·ï¼Œè½¬æ¢æ–¹æ³•å¯å¦‚ä¸‹å¤„ç†ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setDataWithDic:(<span class="built_in">NSDictionary</span> *)dic</div><div class="line">&#123;</div><div class="line">    [dic enumerateKeysAndObjectsUsingBlock:^(<span class="built_in">NSString</span> *key, <span class="keyword">id</span> obj, <span class="built_in">BOOL</span> *stop) &#123;</div><div class="line">        <span class="built_in">NSString</span> *propertyKey = [<span class="keyword">self</span> propertyForKey:key];</div><div class="line">        <span class="keyword">if</span> (propertyKey)</div><div class="line">        &#123;</div><div class="line">            objc_property_t property = class_getProperty([<span class="keyword">self</span> <span class="keyword">class</span>], [propertyKey UTF8String]);</div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span> é’ˆå¯¹ç‰¹æ®Šæ•°æ®ç±»å‹åšå¤„ç†</span></div><div class="line">            <span class="built_in">NSString</span> *attributeString = [<span class="built_in">NSString</span> stringWithCString:property_getAttributes(property) encoding:<span class="built_in">NSUTF8StringEncoding</span>];</div><div class="line">            ...</div><div class="line">            [<span class="keyword">self</span> setValue:obj forKey:propertyKey];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å½“ç„¶ï¼Œä¸€ä¸ªå±æ€§èƒ½å¦é€šè¿‡ä¸Šé¢è¿™ç§æ–¹å¼æ¥å¤„ç†çš„å‰ææ˜¯å…¶æ”¯æŒKVCã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æœ¬ç« ä¸­æˆ‘ä»¬è®¨è®ºäº†Runtimeä¸­ä¸æˆå‘˜å˜é‡å’Œå±æ€§ç›¸å…³çš„å†…å®¹ã€‚æˆå‘˜å˜é‡ä¸å±æ€§æ˜¯ç±»çš„æ•°æ®åŸºç¡€ï¼Œåˆç†åœ°ä½¿ç”¨Runtimeä¸­çš„ç›¸å…³æ“ä½œèƒ½è®©æˆ‘ä»¬æ›´åŠ çµæ´»åœ°æ¥å¤„ç†ä¸ç±»æ•°æ®ç›¸å…³çš„å·¥ä½œã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨å‰é¢ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Runtimeä¸­ä¸ç±»å’Œå¯¹è±¡ç›¸å…³çš„å†…å®¹ï¼Œä»è¿™ç« å¼€å§‹ï¼Œæˆ‘ä»¬å°†è®¨è®ºç±»å®ç°ç»†èŠ‚ç›¸å…³çš„å†…å®¹ï¼Œä¸»è¦åŒ…æ‹¬ç±»ä¸­æˆå‘˜å˜é‡ï¼Œå±æ€§ï¼Œæ–¹æ³•ï¼Œåè®®ä¸åˆ†ç±»çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç« çš„ä¸»è¦å†…å®¹å°†èšé›†åœ¨Runtimeå¯¹æˆå‘˜å˜é‡ä¸å±æ€§çš„å¤„ç†ã€‚åœ¨è®¨è®ºä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼šç±»å‹ç¼–ç ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="http://www.guiyongdong.com/categories/Objective-C/"/>
    
    
      <category term="Runtime" scheme="http://www.guiyongdong.com/tags/Runtime/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C Runtime è¿è¡Œæ—¶ä¹‹ä¸€ï¼šç±»ä¸å¯¹è±¡</title>
    <link href="http://www.guiyongdong.com/2016/11/21/Objective-C-Runtime-%E8%BF%90%E8%A1%8C%E6%97%B6%E4%B9%8B%E4%B8%80%EF%BC%9A%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/"/>
    <id>http://www.guiyongdong.com/2016/11/21/Objective-C-Runtime-è¿è¡Œæ—¶ä¹‹ä¸€ï¼šç±»ä¸å¯¹è±¡/</id>
    <published>2016-11-21T09:22:10.000Z</published>
    <updated>2017-03-09T07:03:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>Objective-Cè¯­è¨€æ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œå®ƒå°†å¾ˆå¤šé™æ€è¯­è¨€åœ¨ç¼–è¯‘å’Œé“¾æ¥æ—¶æœŸåšçš„äº‹æ”¾åˆ°äº†è¿è¡Œæ—¶æ¥å¤„ç†ã€‚è¿™ç§åŠ¨æ€è¯­è¨€çš„ä¼˜åŠ¿åœ¨äºï¼šæˆ‘ä»¬å†™ä»£ç æ—¶æ›´å…·æœ‰çµæ´»æ€§ï¼Œå¦‚æˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯è½¬å‘ç»™æˆ‘ä»¬æƒ³è¦çš„å¯¹è±¡ï¼Œæˆ–è€…éšæ„äº¤æ¢ä¸€ä¸ªæ–¹æ³•çš„å®ç°ç­‰ã€‚</p>
<p>è¿™ç§ç‰¹æ€§æ„å‘³ç€Objective-Cä¸ä»…éœ€è¦ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œè¿˜éœ€è¦ä¸€ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿæ¥æ‰§è¡Œç¼–è¯‘çš„ä»£ç ã€‚å¯¹äºObjective-Cæ¥è¯´ï¼Œè¿™ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿå°±åƒä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸€æ ·ï¼Œè®©å®ƒæ‰€æœ‰çš„å·¥ä½œå¯ä»¥æ­£å¸¸è¿è¡Œã€‚è¿™ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿå³<code>Objc Runtime</code>ã€‚<code>Objc Runtime</code>å…¶å®å°±æ˜¯ä¸€ä¸ª<code>Runtime</code>åº“ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ç”¨Cå’Œæ±‡ç¼–å†™çš„ï¼Œè¿™ä¸ªåº“ä½¿å¾—Cè¯­è¨€æœ‰äº†é¢å‘å¯¹è±¡çš„èƒ½åŠ›ã€‚</p>
<a id="more"></a>
<p><code>Runtime</code>åº“ä¸»è¦åšä¸‹é¢å‡ ä»¶äº‹ï¼š</p>
<ul>
<li>å°è£…ï¼šåœ¨è¿™ä¸ªåº“ä¸­ï¼Œå¯¹è±¡å¯ä»¥ç”¨Cè¯­è¨€ä¸­çš„ç»“æ„ä½“è¡¨ç¤ºï¼Œè€Œæ–¹æ³•å¯ä»¥ç”¨Cå‡½æ•°æ¥å®ç°ï¼Œå¦å¤–å†åŠ ä¸Šäº†ä¸€äº›é¢å¤–çš„ç‰¹æ€§ã€‚è¿™äº›ç»“æ„ä½“å’Œå‡½æ•°è¢«Runtimeå‡½æ•°å°è£…åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºï¼Œæ£€æŸ¥ï¼Œä¿®æ”¹ç±»ã€å¯¹è±¡å’Œå®ƒä»¬çš„æ–¹æ³•äº†ã€‚</li>
<li>æ‰¾å‡ºæ–¹æ³•çš„æœ€ç»ˆæ‰§è¡Œä»£ç ï¼šå½“ç¨‹åºæ‰§è¡Œ<code>[object doSomething]</code>æ—¶ï¼Œä¼šå‘æ¶ˆæ¯æ¥æ”¶è€…(object)å‘é€ä¸€æ¡ä¿¡æ¯(doSomething)ï¼ŒRuntimeä¼šæ ¹æ®æ¶ˆæ¯æ¥æ”¶è€…æ˜¯å¦èƒ½å“åº”è¯¥æ¶ˆæ¯è€Œåšå‡ºä¸åŒçš„ååº”ã€‚è¿™å°†åœ¨åé¢è¯¦ç»†ä»‹ç»ã€‚</li>
</ul>
<p>Objective-C Runtimeç›®å‰æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š<code>Modern Runtime</code>å’Œ<code>Legacy Runtime</code>ã€‚<code>Modern Runtime</code>è¦†ç›–äº†64ä½çš„<code>Mac OS X Apps</code>è¿˜æœ‰<code>iOS AppS</code>,<code>Legacy Runtime</code>æ˜¯æ—©æœŸç”¨æ¥ç»™32ä½<code>Mac OS X Apps</code> ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä¸ç”¨ç®¡å°±æ˜¯äº†ã€‚</p>
<p>åœ¨è¿™ä¸€ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»Runtimeçš„åŸºæœ¬å·¥ä½œåŸç†ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒè®©æˆ‘ä»¬çš„ç¨‹åºå˜å¾—æ›´åŠ çµæ´»ã€‚CFRuntimeçš„ä»£ç æ˜¯å¼€æºçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œ<a href="https://opensource.apple.com/tarballs/CF/" target="_blank" rel="external">https://opensource.apple.com/tarballs/CF/</a>ä¸‹è½½æ•´ä¸ªCoreFoundationçš„æºç æ¥çœ‹ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹ç±»å’Œå¯¹è±¡ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡çš„åŸºç¡€ï¼Œæˆ‘ä»¬çœ‹çœ‹åœ¨Runtimeä¸­ï¼Œç±»æ˜¯å¦‚ä½•ä½“ç°çš„ã€‚</p>
<h3 id="ç±»ä¸å¯¹è±¡åŸºç¡€æ•°æ®ç»“æ„"><a href="#ç±»ä¸å¯¹è±¡åŸºç¡€æ•°æ®ç»“æ„" class="headerlink" title="ç±»ä¸å¯¹è±¡åŸºç¡€æ•°æ®ç»“æ„"></a>ç±»ä¸å¯¹è±¡åŸºç¡€æ•°æ®ç»“æ„</h3><h4 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h4><p>Objective-Cç±»æ˜¯ç”±Classç±»å‹æ¥è¡¨ç¤ºçš„ï¼Œå®ƒå®é™…ä¸Šæ˜¯æŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆã€‚å®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</div></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹<code>objc/runtime.h</code>ä¸­<code>objc_class</code>ç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_class &#123;</div><div class="line">    Class isa  OBJC_ISA_AVAILABILITY;</div><div class="line"><span class="meta">#if !__OBJC2__</span></div><div class="line">    Class super_class                   	OBJC2_UNAVAILABLE;	<span class="comment">// çˆ¶ç±»</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                      	OBJC2_UNAVAILABLE;	<span class="comment">// ç±»å</span></div><div class="line">    <span class="keyword">long</span> version                          	OBJC2_UNAVAILABLE;	<span class="comment">// ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤ä¸º0</span></div><div class="line">    <span class="keyword">long</span> info                            	OBJC2_UNAVAILABLE;	<span class="comment">// ç±»ä¿¡æ¯ï¼Œä¾›è¿è¡ŒæœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯†</span></div><div class="line">    <span class="keyword">long</span> instance_size                   	OBJC2_UNAVAILABLE;	<span class="comment">// è¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å°</span></div><div class="line">    <span class="keyword">struct</span> objc_ivar_list *ivars         	OBJC2_UNAVAILABLE;	<span class="comment">// è¯¥ç±»çš„æˆå‘˜å˜é‡é“¾è¡¨</span></div><div class="line">    <span class="keyword">struct</span> objc_method_list **methodLists 	OBJC2_UNAVAILABLE;	<span class="comment">// æ–¹æ³•å®šä¹‰çš„é“¾è¡¨</span></div><div class="line">    <span class="keyword">struct</span> objc_cache *cache              	OBJC2_UNAVAILABLE;	<span class="comment">// æ–¹æ³•ç¼“å­˜</span></div><div class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols 	OBJC2_UNAVAILABLE;	<span class="comment">// åè®®é“¾è¡¨</span></div><div class="line"><span class="meta">#endif</span></div><div class="line">&#125; OBJC2_UNAVAILABLE;</div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ä¸ªå®šä¹‰ä¸­ï¼Œä¸‹é¢å‡ ä¸ªå­—æ®µæ˜¯æˆ‘ä»¬æ„Ÿå…´è¶£çš„</p>
<ol>
<li><strong>isa</strong>: éœ€è¦æ³¨æ„çš„æ˜¯åœ¨Objective-Cä¸­ï¼Œæ‰€æœ‰çš„ç±»è‡ªèº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„Classé‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ªisaæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘metaClass(å…ƒç±»),æˆ‘ä»¬ä¼šåœ¨åé¢ä»‹ç»å®ƒã€‚</li>
<li><strong>super_class</strong>ï¼šæŒ‡å‘è¯¥ç±»çš„çˆ¶ç±»ï¼Œå¦‚æœè¯¥ç±»å·²ç»æ˜¯æœ€é¡¶å±‚çš„è·Ÿç±»(å¦‚NSObjectæˆ–è€…NSProxy)ï¼Œåˆ™super_classä¸ºNULLã€‚</li>
<li><strong>cache</strong>: ç”¨äºç¼“å­˜æœ€è¿‘ä½¿ç”¨çš„æ–¹æ³•ã€‚ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡æ¥æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šæ ¹æ®isaæŒ‡é’ˆå»æŸ¥æ‰¾èƒ½å¤Ÿå“åº”è¿™ä¸ªæ¶ˆæ¯çš„å¯¹è±¡ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡åªæœ‰ä¸€éƒ¨åˆ†æ–¹æ³•æ˜¯å¸¸ç”¨çš„ï¼Œå¾ˆå¤šæ–¹æ³•å¾ˆå°‘ç”¨æˆ–è€…æ ¹æœ¬ç”¨ä¸ä¸Šã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ¯æ¬¡æ¶ˆæ¯æ¥æ—¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯methodListsä¸­éå†ä¸€éï¼Œæ€§èƒ½åŠ¿å¿…å¾ˆå·®ã€‚è¿™æ—¶ï¼Œcacheå°±æ´¾ä¸Šç”¨åœºäº†ã€‚åœ¨æˆ‘ä»¬æ¯æ¬¡è°ƒç”¨è¿‡ä¸€ä¸ªæ–¹æ³•åï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¢«ç¼“å­˜åˆ°cacheåˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡è°ƒç”¨çš„æ—¶å€™runtimeå°±ä¼šä¼˜å…ˆå»cacheä¸­æŸ¥æ‰¾ï¼Œå¦‚æœcacheæ²¡æœ‰ï¼Œæ‰åˆ°methodListsä¸­æŸ¥æ‰¾æ–¹æ³•ã€‚è¿™æ ·ï¼Œå¯¹äºé‚£äº›ç»å¸¸ç”¨åˆ°çš„æ–¹æ³•çš„è°ƒç”¨ï¼Œæé«˜äº†è°ƒç”¨çš„æ•ˆç‡ã€‚</li>
<li><strong>version</strong>ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—æ®µæ¥æä¾›ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚è¿™å¯¹äºå¯¹è±¡çš„åºåˆ—åŒ–éå¸¸æœ‰ç”¨ï¼Œå®ƒå¯æ˜¯è®©æˆ‘ä»¬è¯†åˆ«å‡ºä¸åŒç±»å®šä¹‰ç‰ˆæœ¬ä¸­å®ä¾‹å˜é‡å¸ƒå±€çš„æ”¹å˜ã€‚</li>
</ol>
<p>é’ˆå¯¹cache,æˆ‘ä»¬ç”¨ä¸‹é¢ä¾‹å­æ¥è¯´æ˜å…¶æ‰§è¡Œè¿‡ç¨‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *array = [[<span class="built_in">NSArray</span> alloc] init];</div></pre></td></tr></table></figure></p>
<p>å…¶æµç¨‹æ˜¯ï¼š</p>
<ol>
<li><code>[NSArray alloc]</code>å…ˆè¢«æ‰§è¡Œã€‚å› ä¸ºNSArrayæ²¡æœ‰<code>+alloc</code>æ–¹æ³•ï¼Œäºæ˜¯å»çˆ¶ç±»NSObjectå»æŸ¥æ‰¾ã€‚</li>
<li>æ£€æµ‹NSObjectæ˜¯å¦å“åº”<code>+alloc</code>æ–¹æ³•ï¼Œå‘ç°å“åº”ï¼Œäºæ˜¯æ£€æµ‹NSArrayç±»ï¼Œå¹¶æ ¹æ®å…¶æ‰€éœ€çš„å†…å­˜ç©ºé—´å¤§å°å¼€å§‹åˆ†é…å†…å­˜ç©ºé—´ï¼Œç„¶åæŠŠ<code>isa</code>æŒ‡é’ˆæŒ‡å‘NSArrayç±»ã€‚åŒæ—¶ï¼Œ<code>+alloc</code>ä¹Ÿè¢«åŠ è¿›cacheåˆ—è¡¨é‡Œé¢ã€‚</li>
<li>æ¥ç€ï¼Œæ‰§è¡Œ<code>-init</code>æ–¹æ³•ï¼Œå¦‚æœNSArrayå“åº”è¯¥æ–¹æ³•ï¼Œåˆ™ç›´æ¥å°†å…¶åŠ å…¥<code>cache</code>ï¼›å¦‚æœä¸å“åº”ï¼Œåˆ™å»çˆ¶ç±»æŸ¥æ‰¾ã€‚</li>
<li>åœ¨åæœŸçš„æ“ä½œä¸­ï¼Œå¦‚æœå†ä»¥<code>[[NSArray alloc] init]</code>è¿™ç§æ–¹å¼æ¥åˆ›å»ºæ•°ç»„ï¼Œåˆ™ä¼šç›´æ¥ä»cacheä¸­å–å‡ºç›¸åº”çš„æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨ã€‚</li>
</ol>
<h4 id="objc-objectä¸id"><a href="#objc-objectä¸id" class="headerlink" title="objc_objectä¸id"></a>objc_objectä¸id</h4><p><code>objc_object</code>æ˜¯è¡¨ç¤ºä¸€ä¸ªç±»çš„å®ä¾‹çš„ç»“æ„ä½“ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹(<code>objc/objc.h</code>)ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_object &#123;</div><div class="line">    Class isa  OBJC_ISA_AVAILABILITY;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object *<span class="keyword">id</span>;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç»“æ„ä½“åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå³æŒ‡å‘å…¶ç±»çš„isaæŒ‡é’ˆï¼Œè¿™æ ·ï¼Œå½“æˆ‘ä»¬å‘ä¸€ä¸ªObjective-Cå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œæ—¶åº“ä¼šæ ¹æ®å®ä¾‹å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±çš„ç±»ã€‚runtimeåº“ä¼šåœ¨ç±»çš„æ–¹æ³•åˆ—è¡¨åŠçˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å»å¯»æ‰¾ä¸æ¶ˆæ¯å¯¹åº”çš„selectoræŒ‡å‘çš„æ–¹æ³•ã€‚æ‰¾åˆ°åå³è¿è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>å½“åˆ›å»ºä¸€ä¸ªç‰¹å®šç±»çš„å®ä¾‹å¯¹è±¡æ—¶ï¼Œåˆ†é…çš„å†…å­˜åŒ…å«ä¸€ä¸ªobjc_objectæ•°æ®ç»“æ„ï¼Œç„¶åæ˜¯ç±»çš„å®ä¾‹å˜é‡çš„æ•°æ®ã€‚NSObjectç±»çš„allocå’ŒallocWithZone:æ–¹æ³•ä½¿ç”¨å‡½æ•°class_createInstanceæ¥åˆ›å»ºobjc_objectæ•°æ®ç»“æ„ã€‚</p>
<p>å¦å¤–è¿˜æœ‰æˆ‘ä»¬å¸¸è§çš„idï¼Œå®ƒæ˜¯ä¸€ä¸ªobjc_objectç»“æ„ç±»å‹çš„æŒ‡é’ˆã€‚å®ƒçš„å­˜åœ¨å¯ä»¥è®©æˆ‘ä»¬å®ç°ç±»ä¼¼äºC++ä¸­æ³›å‹çš„ä¸€äº›æ“ä½œã€‚è¯¥ç±»å‹çš„å¯¹è±¡å¯ä»¥è½¬æ¢ä¸ºä»»ä½•ä¸€ç§å¯¹è±¡ï¼Œæœ‰ç‚¹ç±»ä¼¼äºCè¯­è¨€ä¸­void*æŒ‡é’ˆç±»å‹çš„ä½œç”¨ã€‚</p>
<h4 id="objc-cache"><a href="#objc-cache" class="headerlink" title="objc_cache"></a>objc_cache</h4><p>ä¸Šé¢æåˆ°äº†objc_classç»“æ„ä½“ä¸­çš„cacheå­—æ®µï¼Œå®ƒç”¨äºç¼“å­˜è°ƒç”¨è¿‡çš„æ–¹æ³•ã€‚è¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªæŒ‡å‘objc_cacheç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_cache &#123;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> mask <span class="comment">/* total = mask + 1 */</span>                 OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> occupied                                    OBJC2_UNAVAILABLE;</div><div class="line">    Method buckets[<span class="number">1</span>]                                        OBJC2_UNAVAILABLE;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>è¯¥ç»“æ„ä½“çš„å­—æ®µæè¿°å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>mask</strong>ï¼šä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šåˆ†é…çš„ç¼“å­˜buketçš„æ€»æ•°ã€‚åœ¨æ–¹æ³•æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼ŒObjective-C runtimeä½¿ç”¨è¿™ä¸ªå­—æ®µæ¥ç¡®å®šå¼€å§‹çº¿æ€§æŸ¥æ‰¾æ•°ç»„çš„ç´¢å¼•ä½ç½®ã€‚æŒ‡å‘æ–¹æ³•selectorçš„æŒ‡é’ˆä¸è¯¥å­—æ®µåšä¸€ä¸ªANDä½æ“ä½œ(index = (mask &amp; selector))ã€‚è¿™å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„hashæ•£åˆ—ç®—æ³•ã€‚</li>
<li><strong>occupied</strong>ï¼šä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šå®é™…å ç”¨çš„ç¼“å­˜bucketçš„æ€»æ•°ã€‚</li>
<li><strong>buckets</strong>ï¼šæŒ‡å‘Methodæ•°æ®ç»“æ„æŒ‡é’ˆçš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„å¯èƒ½åŒ…å«ä¸è¶…è¿‡mask+1ä¸ªå…ƒç´ ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŒ‡é’ˆå¯èƒ½ä¸ºMULLï¼Œè¡¨ç¤ºè¿™ä¸ªç¼“å­˜buketæ²¡æœ‰è¢«å ç”¨ï¼Œå¦å¤–è¢«å ç”¨çš„bucketå¯èƒ½æ˜¯ä¸è¿ç»­çš„ã€‚è¿™ä¸ªæ•°ç»„å¯èƒ½ä¼šéšç€æ—¶é—´è€Œå¢é•¿ã€‚</li>
</ol>
<h4 id="å…ƒç±»-Meta-Class"><a href="#å…ƒç±»-Meta-Class" class="headerlink" title="å…ƒç±»(Meta Class)"></a>å…ƒç±»(Meta Class)</h4><p>åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œæ‰€æœ‰çš„ç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å‘è¿™ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯(å³è°ƒç”¨ç±»æ–¹æ³•)ã€‚å¦‚ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> array];</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>+array</code>æ¶ˆæ¯å‘é€ç»™äº†NSArrayç±»ï¼Œè€Œè¿™ä¸ªNSArrayä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ—¢ç„¶æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä¹Ÿæ˜¯ä¸€ä¸ªobjc_objectæŒ‡é’ˆï¼Œå®ƒåŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶ç±»çš„ä¸€ä¸ªisaæŒ‡é’ˆã€‚é‚£ä¹ˆè¿™äº›å°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œè¿™ä¸ªisaæŒ‡é’ˆæŒ‡å‘å“ªé‡Œå‘¢ï¼Ÿä¸ºäº†è°ƒç”¨<code>+array</code>æ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„isaæŒ‡é’ˆå¿…é¡»æŒ‡å‘ä¸€ä¸ªåŒ…å«è¿™äº›ç±»æ–¹æ³•çš„ä¸€ä¸ªobjc_classç»“æ„ä½“ã€‚è¿™å°±å¼•å‡ºäº†meta-classçš„æ¦‚å¿µ<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">meta-<span class="keyword">class</span>æ˜¯ä¸€ä¸ªç±»å¯¹è±¡çš„ç±»ã€‚</div></pre></td></tr></table></figure></p>
<p>å½“æˆ‘ä»¬å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œruntimeä¼šåœ¨è¿™ä¸ªå¯¹è±¡æ‰€å±çš„è¿™ä¸ªç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾æ–¹æ³•ï¼Œè€Œå‘ä¸€ä¸ªç±»å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šåœ¨è¿™ä¸ªç±»çš„meta-classçš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ã€‚</p>
<p>meta-classä¹‹æ‰€ä»¥é‡è¦ï¼Œæ˜¯å› ä¸ºå®ƒå­˜å‚¨ç€ä¸€ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•ã€‚æ¯ä¸ªç±»éƒ½ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„meta-classï¼Œå› ä¸ºæ¯ä¸ªç±»çš„ç±»æ–¹æ³•åŸºæœ¬ä¸å¯èƒ½å®Œå…¨ç›¸åŒã€‚</p>
<p>å†æ·±å…¥ä¸€ä¸‹ï¼Œmeta-classä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œä¹Ÿå¯ä»¥å‘å®ƒå‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒçš„isaåˆæ˜¯æŒ‡å‘ä»€ä¹ˆå‘¢ï¼Ÿä¸ºäº†ä¸è®©è¿™ç§ç»“æ„æ— é™å»¶ä¼¸ä¸‹å»ï¼ŒObjective-Cçš„è®¾è®¡è€…è®©æ‰€æœ‰çš„meta-classçš„isaæŒ‡å‘åŸºç±»çš„meta-classï¼Œä»¥æ­¤ä½œä¸ºå®ƒä»¬çš„æ‰€å±ç±»ã€‚å³ï¼Œä»»ä½•NSObjectç»§æ‰¿ä½“ç³»ä¸‹çš„meta-classéƒ½ä½¿ç”¨NSObjectçš„meta-classä½œä¸ºè‡ªå·±çš„æ‰€å±ç±»ï¼Œè€ŒåŸºç±»çš„meta-classçš„isaæŒ‡é’ˆæ˜¯æŒ‡å‘å®ƒè‡ªå·±ã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå®Œç¾çš„é—­ç¯ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„æè¿°ï¼Œå†åŠ ä¸Šå¯¹objc_classç»“æ„ä¸­super_classæŒ‡é’ˆçš„åˆ†æï¼Œæˆ‘ä»¬å°±å¯ä»¥æç»˜å‡ºç±»åŠç›¸åº”meta-classç±»çš„ä¸€ä¸ªç»§æ‰¿ä½“ç³»äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/class-diagram.jpg?raw=true" alt="image"><br></div>

<p>å¯¹äºNSObjectç»§æ‰¿ä½“ç³»æ¥è¯´ï¼Œå…¶å®ä¾‹æ–¹æ³•å¯¹ä½“ç³»ä¸­çš„æ‰€æœ‰å®ä¾‹ã€ç±»å’Œmeta-classéƒ½æ˜¯æœ‰æ•ˆçš„ï¼›è€Œç±»æ–¹æ³•å¯¹äºä½“ç³»å†…çš„æ‰€æœ‰ç±»å’Œmeta-classéƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>è®²äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥å†™ä¸ªä¾‹å­å§ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">void</span> TestMetaClass(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"This objcet is %p"</span>, <span class="keyword">self</span>);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Class is %@, super class is %@"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], [<span class="keyword">self</span> superclass]);</div><div class="line">    Class currentClass = [<span class="keyword">self</span> <span class="keyword">class</span>];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Following the isa pointer %d times gives %p"</span>, i, currentClass);</div><div class="line">        currentClass = objc_getClass((__bridge <span class="keyword">void</span> *)currentClass);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"NSObject's class is %p"</span>, [<span class="built_in">NSObject</span> <span class="keyword">class</span>]);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"NSObject's meta class is %p"</span>, objc_getClass((__bridge <span class="keyword">void</span> *)[<span class="built_in">NSObject</span> <span class="keyword">class</span>]));</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark -</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Test</span></span></div><div class="line">- (<span class="keyword">void</span>)ex_registerClassPair &#123;</div><div class="line">    Class newClass = objc_allocateClassPair([<span class="built_in">NSError</span> <span class="keyword">class</span>], <span class="string">"TestClass"</span>, <span class="number">0</span>);</div><div class="line">    class_addMethod(newClass, <span class="keyword">@selector</span>(testMetaClass), (IMP)TestMetaClass, <span class="string">"v@:"</span>);</div><div class="line">    objc_registerClassPair(newClass);</div><div class="line">    <span class="keyword">id</span> instance = [[newClass alloc] initWithDomain:<span class="string">@"some domain"</span> code:<span class="number">0</span> userInfo:<span class="literal">nil</span>];</div><div class="line">    [instance performSelector:<span class="keyword">@selector</span>(testMetaClass)];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªä¾‹å­æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºäº†ä¸€ä¸ªNSErrorçš„å­ç±»TestClassï¼Œç„¶åä¸ºè¿™ä¸ªå­ç±»æ·»åŠ ä¸€ä¸ªæ–¹æ³•testMetaClassï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°æ˜¯TestMetaClasså‡½æ•°ã€‚</p>
<p>è¿è¡Œåï¼Œæ‰“å°ç»“æœæ˜¯:<br><figure class="highlight"><table><tr><td class="code"><pre><div class="line">2014-10-20 22:57:07.352 mountain[1303:41490] This objcet is 0x7a6e22b0</div><div class="line">2014-10-20 22:57:07.353 mountain[1303:41490] Class is TestStringClass, super class is NSError</div><div class="line">2014-10-20 22:57:07.353 mountain[1303:41490] Following the isa pointer 0 times gives 0x7a6e21b0</div><div class="line">2014-10-20 22:57:07.353 mountain[1303:41490] Following the isa pointer 1 times gives 0x0</div><div class="line">2014-10-20 22:57:07.353 mountain[1303:41490] Following the isa pointer 2 times gives 0x0</div><div class="line">2014-10-20 22:57:07.353 mountain[1303:41490] Following the isa pointer 3 times gives 0x0</div><div class="line">2014-10-20 22:57:07.353 mountain[1303:41490] NSObject's class is 0xe10000</div><div class="line">2014-10-20 22:57:07.354 mountain[1303:41490] NSObject's meta class is 0x0</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬åœ¨forå¾ªç¯ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡objc_getClassæ¥è·å–å¯¹è±¡çš„isa,å¹¶å°†å…¶æ‰“å°å‡ºæ¥ï¼Œä¾æ­¤ä¸€ç›´å›æº¯åˆ°NSObjectçš„meta-classã€‚åˆ†ææ‰“å°ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æœ€åæŒ‡é’ˆæŒ‡å‘çš„åœ°å€æ˜¯0x0ï¼Œå³NSObjectçš„meta-classçš„ç±»åœ°å€ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šæˆ‘ä»¬åœ¨ä¸€ä¸ªç±»å¯¹è±¡è°ƒç”¨classæ–¹æ³•æ˜¯æ— æ³•è·å–meta-class,å®ƒåªæ˜¯è¿”å›ä¸€ä¸ªç±»è€Œå·²ã€‚</p>
<h3 id="ç±»ä¸å¯¹è±¡æ“ä½œå‡½æ•°"><a href="#ç±»ä¸å¯¹è±¡æ“ä½œå‡½æ•°" class="headerlink" title="ç±»ä¸å¯¹è±¡æ“ä½œå‡½æ•°"></a>ç±»ä¸å¯¹è±¡æ“ä½œå‡½æ•°</h3><p>runtimeæä¾›äº†å¤§é‡çš„å‡½æ•°æ¥æ“ä½œç±»å’Œå¯¹è±¡ã€‚ç±»çš„æ“ä½œæ–¹æ³•å¤§éƒ¨åˆ†æ˜¯ä»¥<code>class_</code>ä¸ºå‰ç¼€çš„ï¼Œè€Œå¯¹è±¡çš„æ“ä½œæ–¹æ³•å¤§éƒ¨åˆ†æ˜¯ä»¥<code>objc_</code>æˆ–<code>object_</code>ä¸ºå‰ç¼€ã€‚ä¸‹é¢æˆ‘ä»¬å°†æ ¹æ®è¿™äº›æ–¹æ³•çš„ç”¨é€”æ¥åˆ†ç±»è®¨è®ºè¿™äº›æ–¹æ³•çš„ä½¿ç”¨ã€‚</p>
<h4 id="ç±»ç›¸å…³æ“ä½œå‡½æ•°"><a href="#ç±»ç›¸å…³æ“ä½œå‡½æ•°" class="headerlink" title="ç±»ç›¸å…³æ“ä½œå‡½æ•°"></a>ç±»ç›¸å…³æ“ä½œå‡½æ•°</h4><p>æˆ‘ä»¬å¯ä»¥å›è¿‡å¤´å»çœ‹çœ‹<code>objc_class</code>çš„å®šä¹‰ï¼Œruntimeæä¾›çš„æ“ä½œç±»çš„æ–¹æ³•ä¸»è¦å°±æ˜¯é’ˆå¯¹è¿™ä¸ªç»“æ„ä½“ä¸­çš„å„ä¸ªå­—æ®µçš„ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»è¿™ä¸€äº›å‡½æ•°ã€‚å¹¶åœ¨æœ€åä»¥å®ä¾‹æ¥æ¼”ç¤ºè¿™äº›å‡½æ•°çš„å…·ä½“æ–¹æ³•ã€‚</p>
<h5 id="ç±»å-name"><a href="#ç±»å-name" class="headerlink" title="ç±»å(name)"></a>ç±»å(name)</h5><p>ç±»åæ“ä½œçš„å‡½æ•°ä¸»è¦æœ‰ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–ç±»çš„ç±»å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * class_getName ( Class cls );</div></pre></td></tr></table></figure></p>
<ul>
<li>å¯¹äº<code>class_getName</code>å‡½æ•°ï¼Œå¦‚æœä¼ å…¥çš„clsä¸ºNilï¼Œåˆ™è¿”å›ä¸€ä¸ªnil</li>
</ul>
<h5 id="çˆ¶ç±»-super-class-å’Œå…ƒç±»-meta-class"><a href="#çˆ¶ç±»-super-class-å’Œå…ƒç±»-meta-class" class="headerlink" title="çˆ¶ç±»(super_class)å’Œå…ƒç±»(meta-class)"></a>çˆ¶ç±»(super_class)å’Œå…ƒç±»(meta-class)</h5><p>çˆ¶ç±»å’Œå…ƒç±»æ“ä½œçš„å‡½æ•°ä¸»è¦æœ‰ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–ç±»çš„çˆ¶ç±»</span></div><div class="line">Class class_getSuperclass ( Class cls );</div><div class="line"><span class="comment">// åˆ¤æ–­ç»™å®šçš„Classæ˜¯å¦æ˜¯ä¸€ä¸ªå…ƒç±»</span></div><div class="line"><span class="built_in">BOOL</span> class_isMetaClass ( Class cls );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>class_getSuperclass</code>å‡½æ•°ï¼Œå½“clsä¸ºnilæˆ–è€…clsä¸ºæ ¹ç±»æ—¶ï¼Œè¿”å›nilã€‚ä¸è¿‡é€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨NSObjectç±»çš„superclassæ–¹æ³•æ¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚</li>
<li><code>class_isMetaClass</code>å‡½æ•°ï¼Œå¦‚æœclsæ˜¯å…ƒç±»ï¼Œåˆ™è¿”å›YESï¼Œå¦‚æœå¦æˆ–è€…ä¼ å…¥çš„clsä¸ºnilï¼Œåˆ™è¿”å›NOã€‚</li>
</ul>
<h5 id="å®ä¾‹å˜é‡å¤§å°-instance-size"><a href="#å®ä¾‹å˜é‡å¤§å°-instance-size" class="headerlink" title="å®ä¾‹å˜é‡å¤§å°(instance_size)"></a>å®ä¾‹å˜é‡å¤§å°(instance_size)</h5><p>å®ä¾‹å˜é‡å¤§å°æ“ä½œçš„å‡½æ•°æœ‰ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–å®ä¾‹å¤§å°</span></div><div class="line">size_t class_getInstanceSize ( Class cls );</div></pre></td></tr></table></figure></p>
<h5 id="æˆå‘˜å˜é‡-ivars-åŠå±æ€§"><a href="#æˆå‘˜å˜é‡-ivars-åŠå±æ€§" class="headerlink" title="æˆå‘˜å˜é‡(ivars)åŠå±æ€§"></a>æˆå‘˜å˜é‡(ivars)åŠå±æ€§</h5><p>åœ¨<code>objc_class</code>ä¸­ï¼Œæ‰€æœ‰çš„æˆå‘˜å˜é‡ã€å±æ€§çš„ä¿¡æ¯æ˜¯æ”¾åœ¨é“¾è¡¨ivarsä¸­çš„ã€‚ivarsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ æ˜¯æŒ‡å‘Ivar(å˜é‡ä¿¡æ¯)çš„æŒ‡é’ˆã€‚runtimeæä¾›äº†ä¸°å¯Œçš„å‡½æ•°æ¥æ“ä½œè¿™ä¸€å­—æ®µã€‚å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š<br>1.æˆå‘˜å˜é‡æ“ä½œå‡½æ•°ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡½æ•°ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–ç±»ä¸­æŒ‡å®šåç§°å®ä¾‹æˆå‘˜å˜é‡çš„ä¿¡æ¯</span></div><div class="line">Ivar class_getInstanceVariable ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// è·å–ç±»æˆå‘˜å˜é‡çš„ä¿¡æ¯</span></div><div class="line">Ivar class_getClassVariable ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// æ·»åŠ æˆå‘˜å˜é‡</span></div><div class="line"><span class="built_in">BOOL</span> class_addIvar ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, size_t size, uint8_t alignment, <span class="keyword">const</span> <span class="keyword">char</span> *types );</div><div class="line"><span class="comment">// è·å–æ•´ä¸ªæˆå‘˜å˜é‡åˆ—è¡¨</span></div><div class="line">Ivar * class_copyIvarList ( Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>class_getInstanceVariable</code>å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæŒ‡å‘åŒ…å«nameæŒ‡å®šçš„æˆå‘˜å˜é‡ä¿¡æ¯çš„objc_ivarç»“æ„ä½“çš„æŒ‡é’ˆ(Ivar)ã€‚</li>
<li><code>class_getClassVariable</code>å‡½æ•°ï¼Œç›®å‰æ²¡æœ‰æ‰¾åˆ°å…³äºObjective-Cä¸­ç±»å˜é‡çš„ä¿¡æ¯ï¼Œä¸€èˆ¬è®¤ä¸ºObjective-Cä¸æ”¯æŒç±»å˜é‡ã€‚æ³¨æ„ï¼Œè¿”å›çš„åˆ—è¡¨ä¸åŒ…å«çˆ¶ç±»çš„æˆå‘˜å˜é‡å’Œå±æ€§ã€‚</li>
<li>Objective-Cä¸æ”¯æŒå¾€å·²ç»å­˜åœ¨çš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Œå› æ­¤ä¸ç®¡æ˜¯ç³»ç»Ÿåº“æä¾›çš„ç±»ï¼Œè¿˜æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»ï¼Œéƒ½æ— æ³•åŠ¨æ€æ·»åŠ æˆå‘˜å˜é‡ã€‚ä½†å¦‚æœæˆ‘ä»¬é€šè¿‡è¿è¡Œæ—¶æ¥åˆ›å»ºä¸€ä¸ªç±»çš„è¯ï¼Œåˆåº”è¯¥å¦‚ä½•ç»™å®ƒæ·»åŠ æˆå‘˜å˜é‡å‘¢ï¼Ÿè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨<code>class_addIvar</code>å‡½æ•°äº†ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨<code>objc_allocateClassPair</code>å‡½æ•°ä¸<code>objc_registerClassPair</code>ä¹‹é—´è°ƒç”¨ã€‚å¦å¤–ï¼Œè¿™ä¸ªç±»ä¹Ÿä¸èƒ½æ˜¯å…ƒç±»ã€‚æˆå‘˜å˜é‡çš„æŒ‰å­—èŠ‚æœ€å°å¯¹å…¶é‡æ˜¯1&lt;&lt;alignmentã€‚è¿™å–å†³äºivarçš„ç±»å‹å’Œæœºå™¨çš„æ¶æ„ã€‚å¦‚æœå˜é‡çš„ç±»å‹æ˜¯æŒ‡é’ˆç±»å‹ï¼Œåˆ™ä¼ é€’log2(sizeof(pointer_type))ã€‚</li>
<li><code>class_copyIvarList</code>å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæŒ‡å‘æˆå‘˜å˜é‡ä¿¡æ¯çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ æ˜¯æŒ‡å‘è¯¥æˆå‘˜å˜é‡ä¿¡æ¯çš„objc_ivarç»“æ„ä½“çš„æŒ‡é’ˆã€‚è¿™ä¸ªæ•°ç»„ä¸åŒ…å«åœ¨çˆ¶ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚outCountæŒ‡é’ˆè¿”å›æ•°ç»„çš„å¤§å°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨free()æ¥é‡Šæ”¾è¿™ä¸ªæ•°ç»„ã€‚</li>
</ul>
<p>2.å±æ€§æ“ä½œå‡½æ•°ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡½æ•°ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–æŒ‡å®šçš„å±æ€§</span></div><div class="line">objc_property_t class_getProperty ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// è·å–å±æ€§åˆ—è¡¨</span></div><div class="line">objc_property_t * class_copyPropertyList ( Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// ä¸ºç±»æ·»åŠ å±æ€§</span></div><div class="line"><span class="built_in">BOOL</span> class_addProperty ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> objc_property_attribute_t *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount );</div><div class="line"><span class="comment">// æ›¿æ¢ç±»çš„å±æ€§</span></div><div class="line"><span class="keyword">void</span> class_replaceProperty ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> objc_property_attribute_t *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount );</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸€ç§æ–¹æ³•ä¹Ÿæ˜¯é’ˆå¯¹ivarsæ¥æ“ä½œï¼Œä¸è¿‡åªæ“ä½œé‚£äº›å±æ€§çš„å€¼ã€‚æˆ‘ä»¬åœ¨åé¢ä¼šä»‹ç»å±æ€§æ—¶ä¼šå†é‡åˆ°è¿™äº›å‡½æ•°ã€‚</p>
<p>3.åœ¨MAC OS Xç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åƒåœ¾å›æ”¶å™¨ã€‚runtimeæä¾›äº†å‡ ä¸ªå‡½æ•°æ¥ç¡®å®šä¸€ä¸ªå¯¹è±¡çš„å†…å­˜åŒºåŸŸæ˜¯å¦å¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨æ‰«æï¼Œä»¥å¤„ç†strong/weakå¼•ç”¨ã€‚è¿™å‡ ä¸ªå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> uint8_t * class_getIvarLayout ( Class cls );</div><div class="line"><span class="keyword">void</span> class_setIvarLayout ( Class cls, <span class="keyword">const</span> uint8_t *layout );</div><div class="line"><span class="keyword">const</span> uint8_t * class_getWeakIvarLayout ( Class cls );</div><div class="line"><span class="keyword">void</span> class_setWeakIvarLayout ( Class cls, <span class="keyword">const</span> uint8_t *layout );</div></pre></td></tr></table></figure></p>
<p>ä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸»åŠ¨å»è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œåœ¨è°ƒç”¨<code>objc_registerClassPair</code>æ—¶ï¼Œä¼šç”Ÿæˆåˆç†çš„å¸ƒå±€ã€‚åœ¨æ­¤ä¸è¯¦ç»†ä»‹ç»è¿™äº›å‡½æ•°ã€‚</p>
<h5 id="æ–¹æ³•-methodLists"><a href="#æ–¹æ³•-methodLists" class="headerlink" title="æ–¹æ³•(methodLists)"></a>æ–¹æ³•(methodLists)</h5><p>æ–¹æ³•æ“ä½œä¸»è¦æœ‰ä»¥ä¸‹å‡½æ•°ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// æ·»åŠ æ–¹æ³•</span></div><div class="line"><span class="built_in">BOOL</span> class_addMethod ( Class cls, SEL name, IMP imp, <span class="keyword">const</span> <span class="keyword">char</span> *types );</div><div class="line"><span class="comment">// è·å–å®ä¾‹æ–¹æ³•</span></div><div class="line">Method class_getInstanceMethod ( Class cls, SEL name );</div><div class="line"><span class="comment">// è·å–ç±»æ–¹æ³•</span></div><div class="line">Method class_getClassMethod ( Class cls, SEL name );</div><div class="line"><span class="comment">// è·å–æ‰€æœ‰æ–¹æ³•çš„æ•°ç»„</span></div><div class="line">Method * class_copyMethodList ( Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// æ›¿ä»£æ–¹æ³•çš„å®ç°</span></div><div class="line">IMP class_replaceMethod ( Class cls, SEL name, IMP imp, <span class="keyword">const</span> <span class="keyword">char</span> *types );</div><div class="line"><span class="comment">// è¿”å›æ–¹æ³•çš„å…·ä½“å®ç°</span></div><div class="line">IMP class_getMethodImplementation ( Class cls, SEL name );</div><div class="line">IMP class_getMethodImplementation_stret ( Class cls, SEL name );</div><div class="line"><span class="comment">// ç±»å®ä¾‹æ˜¯å¦å“åº”æŒ‡å®šçš„selector</span></div><div class="line"><span class="built_in">BOOL</span> class_respondsToSelector ( Class cls, SEL sel );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>class_addMethod</code>çš„å®ç°ä¼šè¦†ç›–çˆ¶ç±»çš„æ–¹æ³•å®ç°ï¼Œä½†ä¸ä¼šå–ä»£æœ¬ç±»ä¸­å·²å­˜åœ¨çš„å®ç°ï¼Œå¦‚æœæœ¬ç±»ä¸­åŒ…å«ä¸€ä¸ªåŒåçš„å®ç°ï¼Œåˆ™å‡½æ•°ä¼šè¿”å›NOã€‚å¦‚æœè¦ä¿®æ”¹å·²å­˜åœ¨å®ç°ï¼Œå¯ä»¥ä½¿ç”¨<code>method_setImplementation</code>ã€‚ä¸€ä¸ªObjective-Cæ–¹æ³•æ˜¯ä¸€ä¸ªç®€å•çš„Cå‡½æ•°ï¼Œå®ƒè‡³å°‘åŒ…å«ä¸¤ä¸ªå‚æ•°selfå’Œ_cmdã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„å®ç°å‡½æ•°(IMPå‚æ•°æŒ‡å‘çš„å‡½æ•°)è‡³å°‘éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<figure class="highlight c"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">myMethodIMP</span><span class="params">(id self, SEL <span class="number">_</span>cmd)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// implementation ....</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>ä¸æˆå‘˜å˜é‡ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç±»åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œä¸ç®¡è¿™ä¸ªç±»æ˜¯å¦å·²ç»å­˜åœ¨ã€‚å¦å¤–ï¼Œå‚æ•°typesæ˜¯ä¸€ä¸ªæè¿°ä¼ é€’ç»™æ–¹æ³•çš„å‚æ•°ç±»å‹çš„å­—ç¬¦æ•°ç»„ï¼Œè¿™å°±æ¶‰åŠåˆ°ç±»å‹ç¼–ç ï¼Œæˆ‘ä»¬å°†åœ¨åé¢ä»‹ç»ã€‚</p>
<ul>
<li><code>class_getInstanceMethod</code>ã€<code>class_getClassMethod</code>å‡½æ•°,ä¸<code>class_copyMethodList</code>ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šå»æœç´¢çˆ¶ç±»çš„å®ç°ã€‚</li>
<li><code>class_copyMethodList</code>å‡½æ•°ï¼Œè¿”å›åŒ…å«æ‰€æœ‰å®ä¾‹æ–¹æ³•çš„æ•°ç»„ï¼Œå¦‚æœéœ€è¦è·å–ç±»æ–¹æ³•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>class_copyMethodList(object_getClass(cls),&amp;count)</code>(ä¸€ä¸ªç±»çš„å®ä¾‹æ–¹æ³•å®šä¹‰åœ¨å…ƒç±»é‡Œé¢)ã€‚è¯¥åˆ—è¡¨ä¸åŒ…å«çˆ¶ç±»å®ç°çš„æ–¹æ³•ã€‚<code>outCount</code>å‚æ•°è¿”å›æ–¹æ³•çš„ä¸ªæ•°ã€‚åœ¨è·å–åˆ°åˆ—è¡¨åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨free()æ–¹æ³•æ¥é‡Šæ”¾å®ƒã€‚</li>
<li><code>class_replaceMethod</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„è¡Œä¸ºå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå¦‚æœç±»ä¸­ä¸å­˜åœ¨nameæŒ‡å®šçš„æ–¹æ³•ï¼Œåˆ™ç±»ä¼¼äº<code>class_addMethod</code>å‡½æ•°ä¸€æ ·ä¼šæ·»åŠ æ–¹æ³•ï¼›å¦‚æœç±»ä¸­å·²ç»å­˜åœ¨nameæŒ‡å®šçš„æ–¹æ³•ï¼Œåˆ™ç±»ä¼¼ä¸<code>method_setImplementation</code>ä¸€æ ·æ›¿ä»£åŸæ–¹æ³•çš„å®ç°ã€‚</li>
<li><code>class_getMethodImplementation</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨å‘ç±»å®ä¾‹å‘é€æ¶ˆæ¯æ—¶ä¼šè¢«è°ƒç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘æ–¹æ³•å®ç°å‡½æ•°çš„æŒ‡é’ˆã€‚è¿™ä¸ªå‡½æ•°ä¼šæ¯”<code>method_getImplementation(class_getInstanceMethod(cls,name))</code>æ›´å¿«ã€‚è¿”å›çš„å‡½æ•°æŒ‡é’ˆå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘runtimeå†…éƒ¨çš„å‡½æ•°ï¼Œè€Œä¸ä¸€å®šæ˜¯æ–¹æ³•çš„å®é™…å®ç°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç±»å®ä¾‹æ— æ³•å“åº”selectorï¼Œåˆ™è¿”å›çš„å‡½æ•°æŒ‡é’ˆå°†æ˜¯è¿è¡Œæ—¶æ¶ˆæ¯è½¬å‘æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li><code>class_respondsToSelector</code>å‡½æ•°ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨NSObjectç±»çš„<code>respondsToSelector:</code>æˆ–<code>instanceRespondToSelector:</code>æ–¹æ³•æ¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚</li>
</ul>
<h5 id="åè®®-objc-protocol-list"><a href="#åè®®-objc-protocol-list" class="headerlink" title="åè®®(objc_protocol_list)"></a>åè®®(objc_protocol_list)</h5><p>åè®®ç›¸å…³çš„æ“ä½œåŒ…å«ä»¥ä¸‹å‡½æ•°ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// æ·»åŠ åè®®</span></div><div class="line"><span class="built_in">BOOL</span> class_addProtocol ( Class cls, Protocol *protocol );</div><div class="line"><span class="comment">// è¿”å›ç±»æ˜¯å¦å®ç°æŒ‡å®šçš„åè®®</span></div><div class="line"><span class="built_in">BOOL</span> class_conformsToProtocol ( Class cls, Protocol *protocol );</div><div class="line"><span class="comment">// è¿”å›ç±»å®ç°çš„åè®®åˆ—è¡¨</span></div><div class="line">Protocol * class_copyProtocolList ( Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>class_conformsToProtocol</code>å‡½æ•°å¯ä»¥ä½¿ç”¨NSObjectç±»çš„<code>conformsToProtocol:</code>æ–¹æ³•æ¥ä»£æ›¿ã€‚</li>
<li><code>class_copyProtocolList</code>å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨ä½¿ç”¨åæˆ‘ä»¬éœ€è¦ä½¿ç”¨free()æ‰‹åŠ¨é‡Šæ”¾ã€‚</li>
</ul>
<h5 id="ç‰ˆæœ¬-version"><a href="#ç‰ˆæœ¬-version" class="headerlink" title="ç‰ˆæœ¬(version)"></a>ç‰ˆæœ¬(version)</h5><p>ç‰ˆæœ¬ç›¸å…³çš„æ“ä½œåŒ…å«ä»¥ä¸‹å‡½æ•°ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–ç‰ˆæœ¬å·</span></div><div class="line"><span class="keyword">int</span> class_getVersion ( Class cls );</div><div class="line"><span class="comment">// è®¾ç½®ç‰ˆæœ¬å·</span></div><div class="line"><span class="keyword">void</span> class_setVersion ( Class cls, <span class="keyword">int</span> version );</div></pre></td></tr></table></figure></p>
<h5 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h5><p>runtimeè¿˜æä¾›äº†ä¸¤ä¸ªå‡½æ•°å·¥<code>CoreFoundation</code>å’Œ<code>tool-free bridging</code>ä½¿ç”¨ï¼Œå³ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">Class objc_getFutureClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="keyword">void</span> objc_setFutureClass ( Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name );</div></pre></td></tr></table></figure></p>
<p>é€šå¸¸æˆ‘ä»¬ä¸ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<h5 id="å®ä¾‹-Example"><a href="#å®ä¾‹-Example" class="headerlink" title="å®ä¾‹(Example)"></a>å®ä¾‹(Example)</h5><p>ä¸Šé¢åˆ—ä¸¾äº†å¤§é‡ç±»æ“ä½œçš„å‡½æ•°ï¼Œä¸‹é¢æˆ‘ä»¬å†™ä¸ªå®ä¾‹ï¼Œæ¥çœ‹çœ‹è¿™äº›å‡½æ•°çš„å®ä¾‹æ•ˆæœï¼š</p>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»MyClassï¼Œå¹¶ä¸”ç»™é›·æ·»åŠ ä¸€äº›å®ä¾‹å˜é‡å’Œæ–¹æ³•ã€‚</p>
<p><strong>MyClass.h</strong></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyClass</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>, <span class="title">NSCoding</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *array;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *string;</div><div class="line"></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)method1;</div><div class="line">- (<span class="keyword">void</span>)method2;</div><div class="line">+ (<span class="keyword">void</span>)classMethod1;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><strong>MyClass.m</strong></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"MyClass.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyClass</span> () </span>&#123;</div><div class="line">    <span class="built_in">NSInteger</span> _instance1;</div><div class="line">    <span class="built_in">NSString</span> *_instance2;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> integer;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)method3WithArg1:(<span class="built_in">NSInteger</span>)arg1 arg2:(<span class="built_in">NSString</span> *)arg2;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyClass</span></span></div><div class="line"></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)classMethod1 &#123;</div><div class="line">	<span class="built_in">NSLog</span>(<span class="string">@"è°ƒç”¨ç±»æ–¹æ³• classMethod1"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)method1 &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"è°ƒç”¨å®ä¾‹æ–¹æ³• method1"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)method2 &#123;</div><div class="line">	<span class="built_in">NSLog</span>(<span class="string">@"è°ƒç”¨å®ä¾‹æ–¹æ³• method2"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)method3WithArg1:(<span class="built_in">NSInteger</span>)arg1 arg2:(<span class="built_in">NSString</span> *)arg2 &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"arg1 : %ld, arg2 : %@"</span>,arg1,arg2);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>åœ¨ViewControllerä¸­çš„<code>- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event</code>æ–¹æ³•ä¸­è°ƒç”¨ä¾‹å­:</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"MyClass.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></div><div class="line"></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    MyClass *myClass = [[MyClass alloc] init];</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> outCount = <span class="number">0</span>;</div><div class="line">    Class cls = myClass.class;</div><div class="line">    </div><div class="line">    <span class="comment">//ç±»å</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"class name: %s"</span>,class_getName(cls));</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//çˆ¶ç±»</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"super class name: %s"</span>,class_getName(class_getSuperclass(cls)));</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//æ˜¯å¦æ˜¯å…ƒç±»</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MyClass is %@ a meta-class"</span>,class_isMetaClass(cls)?<span class="string">@""</span>:<span class="string">@"not"</span>);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//å…ƒç±»</span></div><div class="line">    Class meta_class = objc_getMetaClass(class_getName(cls));</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s's meta-class is  %s"</span>,class_getName(cls),class_getName(meta_class));</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//å˜é‡å®ä¾‹å¤§å°</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"instance size: %zu"</span>,class_getInstanceSize(cls));</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//æˆå‘˜å˜é‡</span></div><div class="line">    Ivar *ivars = class_copyIvarList(cls, &amp;outCount);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; outCount; i++) &#123;</div><div class="line">        Ivar ivar = ivars[i];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"instance variable's name:%s at index: %d"</span>,ivar_getName(ivar),i);</div><div class="line">    &#125;</div><div class="line">    free(ivars);</div><div class="line">    <span class="comment">//æŒ‡å®šåç§°çš„æˆå‘˜å˜é‡</span></div><div class="line">    Ivar string = class_getInstanceVariable(cls, <span class="string">"_string"</span>);</div><div class="line">    <span class="keyword">if</span> (string != <span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"instanve variable %s"</span>,ivar_getName(string));</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">//å±æ€§æ“ä½œ</span></div><div class="line">    objc_property_t *properties = class_copyPropertyList(cls, &amp;outCount);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; outCount; i++) &#123;</div><div class="line">        objc_property_t property = properties[i];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"property's name : %s"</span>,property_getName(property));</div><div class="line">    &#125;</div><div class="line">    free(properties);</div><div class="line">    <span class="comment">//æŒ‡å®šåç§°çš„å±æ€§</span></div><div class="line">    objc_property_t array = class_getProperty(cls, <span class="string">"_array"</span>);</div><div class="line">    <span class="keyword">if</span> (array != <span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"property %s"</span>,property_getName(array));</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//æ–¹æ³•æ“ä½œ </span></div><div class="line">    Method *methods = class_copyMethodList(cls, &amp;outCount);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; outCount; i++) &#123;</div><div class="line">        Method method = methods[i];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"method's signature: %s"</span>,method_getName(method));</div><div class="line">    &#125;</div><div class="line">    free(methods);</div><div class="line">    <span class="comment">//æŒ‡å®šæ–¹æ³•åå®ä¾‹æ–¹æ³•</span></div><div class="line">    Method method1 = class_getInstanceMethod(cls, <span class="keyword">@selector</span>(method1));</div><div class="line">    <span class="keyword">if</span> (method1 != <span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"instance method: %s "</span>,method_getName(method1));</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æŒ‡å®šæ–¹æ³•åç±»æ–¹æ³•</span></div><div class="line">    Method classMethod = class_getClassMethod(cls, <span class="keyword">@selector</span>(classMethod1));</div><div class="line">    <span class="keyword">if</span> (classMethod != <span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"class method :%s"</span>,method_getName(classMethod));</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦å®ç°æŸæ–¹æ³•</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MyClass is %@ responsd to selector: method3WithArg1:arg2:"</span>,class_respondsToSelector(cls, <span class="keyword">@selector</span>(method3WithArg1:arg2:))?<span class="string">@""</span>:<span class="string">@"not"</span>);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//è·å–æŒ‡å®šæ–¹æ³•å®ç°</span></div><div class="line">    IMP imp = class_getMethodImplementation(cls, <span class="keyword">@selector</span>(method1));</div><div class="line">    imp();</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//åè®®</span></div><div class="line">    Protocol * __<span class="keyword">unsafe_unretained</span> * protocols = class_copyProtocolList(cls, &amp;outCount);</div><div class="line">    Protocol *protocol;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; outCount; i++) &#123;</div><div class="line">        protocol = protocols[i];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"protocol name:%s"</span>,protocol_getName(protocol));</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"MyClass is %@ responsed to protocol %s"</span>,class_conformsToProtocol(cls, protocol)?<span class="string">@""</span>:<span class="string">@"not"</span>,protocol_getName(protocol));</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------------------------------"</span>);</div><div class="line">   </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š<br><figure class="highlight"><table><tr><td class="code"><pre><div class="line">2016-11-23 18:07:47.583 RuntimeDemo[3598:309543] class name: MyClass</div><div class="line">2016-11-23 18:07:47.583 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.583 RuntimeDemo[3598:309543] super class name: NSObject</div><div class="line">2016-11-23 18:07:47.583 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.583 RuntimeDemo[3598:309543] MyClass is not a meta-class</div><div class="line">2016-11-23 18:07:47.583 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.584 RuntimeDemo[3598:309543] MyClass's meta-class is  MyClass</div><div class="line">2016-11-23 18:07:47.584 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.584 RuntimeDemo[3598:309543] instance size: 48</div><div class="line">2016-11-23 18:07:47.584 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.584 RuntimeDemo[3598:309543] instance variable's name:_instance1 at index: 0</div><div class="line">2016-11-23 18:07:47.584 RuntimeDemo[3598:309543] instance variable's name:_instance2 at index: 1</div><div class="line">2016-11-23 18:07:47.585 RuntimeDemo[3598:309543] instance variable's name:_array at index: 2</div><div class="line">2016-11-23 18:07:47.585 RuntimeDemo[3598:309543] instance variable's name:_string at index: 3</div><div class="line">2016-11-23 18:07:47.585 RuntimeDemo[3598:309543] instance variable's name:_integer at index: 4</div><div class="line">2016-11-23 18:07:47.585 RuntimeDemo[3598:309543] instanve variable _string</div><div class="line">2016-11-23 18:07:47.585 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.585 RuntimeDemo[3598:309543] property's name : integer</div><div class="line">2016-11-23 18:07:47.586 RuntimeDemo[3598:309543] property's name : array</div><div class="line">2016-11-23 18:07:47.586 RuntimeDemo[3598:309543] property's name : string</div><div class="line">2016-11-23 18:07:47.586 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.586 RuntimeDemo[3598:309543] method's signature: method1</div><div class="line">2016-11-23 18:07:47.586 RuntimeDemo[3598:309543] method's signature: method3WithArg1:arg2:</div><div class="line">2016-11-23 18:07:47.586 RuntimeDemo[3598:309543] method's signature: method2</div><div class="line">2016-11-23 18:07:47.587 RuntimeDemo[3598:309543] method's signature: integer</div><div class="line">2016-11-23 18:07:47.587 RuntimeDemo[3598:309543] method's signature: setInteger:</div><div class="line">2016-11-23 18:07:47.587 RuntimeDemo[3598:309543] method's signature: setArray:</div><div class="line">2016-11-23 18:07:47.587 RuntimeDemo[3598:309543] method's signature: .cxx_destruct</div><div class="line">2016-11-23 18:07:47.587 RuntimeDemo[3598:309543] method's signature: string</div><div class="line">2016-11-23 18:07:47.587 RuntimeDemo[3598:309543] method's signature: setString:</div><div class="line">2016-11-23 18:07:47.587 RuntimeDemo[3598:309543] method's signature: array</div><div class="line">2016-11-23 18:07:47.588 RuntimeDemo[3598:309543] instance method: method1 </div><div class="line">2016-11-23 18:07:47.588 RuntimeDemo[3598:309543] MyClass is  responsd to selector: method3WithArg1:arg2:</div><div class="line">2016-11-23 18:07:47.588 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.588 RuntimeDemo[3598:309543] è°ƒç”¨å®ä¾‹æ–¹æ³• method1</div><div class="line">2016-11-23 18:07:47.588 RuntimeDemo[3598:309543] ---------------------------------</div><div class="line">2016-11-23 18:07:47.588 RuntimeDemo[3598:309543] protocol name:NSCopying</div><div class="line">2016-11-23 18:07:47.588 RuntimeDemo[3598:309543] protocol name:NSCoding</div><div class="line">2016-11-23 18:07:47.589 RuntimeDemo[3598:309543] MyClass is  responsed to protocol NSCoding</div></pre></td></tr></table></figure></p>
<h4 id="åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡"><a href="#åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡" class="headerlink" title="åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡"></a>åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡</h4><p>runtimeçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒèƒ½åœ¨è¿è¡Œæ—¶åˆ›å»ºç±»å’Œå¯¹è±¡ã€‚</p>
<h5 id="åŠ¨æ€åˆ›å»ºç±»"><a href="#åŠ¨æ€åˆ›å»ºç±»" class="headerlink" title="åŠ¨æ€åˆ›å»ºç±»"></a>åŠ¨æ€åˆ›å»ºç±»</h5><p>åŠ¨æ€åˆ›å»ºç±»æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°ç±»å’Œå…ƒç±»</span></div><div class="line">Class objc_allocateClassPair(Class superclass, <span class="keyword">const</span> <span class="keyword">char</span> *name, size_t extraBytes);</div><div class="line"><span class="comment">// é”€æ¯ä¸€ä¸ªç±»åŠå…¶ç›¸å…³è”çš„ç±»</span></div><div class="line"><span class="keyword">void</span> objc_disposeClassPair ( Class cls );</div><div class="line"><span class="comment">// åœ¨åº”ç”¨ä¸­æ³¨å†Œç”±objc_allocateClassPairåˆ›å»ºçš„ç±»</span></div><div class="line"><span class="keyword">void</span> objc_registerClassPair ( Class cls );</div></pre></td></tr></table></figure>
<ul>
<li><code>objc_allocateClassPair</code>å‡½æ•°ï¼šå¦‚æœæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ ¹ç±»ï¼Œåˆ™superclassæŒ‡å®šä¸ºNilã€‚<code>extraBytes</code>é€šå¸¸æŒ‡å®šä¸º0ï¼Œè¯¥å‚æ•°æ˜¯åˆ†é…ç»™ç±»å’Œå…ƒç±»å¯¹è±¡å°¾éƒ¨çš„ç´¢å¼•ivarsçš„å­—èŠ‚æ•°ã€‚</li>
<li><code>objc_registerClassPair</code>å‡½æ•°ï¼šä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°ç±»ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨<code>objc_allocateClassPair</code>ã€‚ç„¶åä½¿ç”¨è¯¸å¦‚<code>class_addMethod</code>,<code>class_addIvar</code>ç­‰å‡½æ•°æ¥ä¸ºæ–°çš„ç±»æ·»åŠ æ–¹æ³•ã€å®ä¾‹å˜é‡å’Œå±æ€§ç­‰ã€‚å®Œæˆè¿™äº›åï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨<code>objc_registerClassPair</code>å‡½æ•°æ¥æ³¨å†Œç±»ï¼Œä¹‹åè¿™ä¸ªç±»å°±å¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨äº†ã€‚å®ä¾‹æ–¹æ³•å’Œå®ä¾‹å˜é‡åº”è¯¥æ·»åŠ åˆ°ç±»è‡ªèº«ä¸Šï¼Œè€Œç±»æ–¹æ³•åº”è¯¥æ·»åŠ åˆ°ç±»çš„å…ƒç±»ä¸Šã€‚</li>
<li><code>objc_disposeClassPair</code>å‡½æ•°ï¼šç”¨äºé”€æ¯ä¸€ä¸ªç±»ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç¨‹åºè¿è¡Œä¸­è¿˜å­˜åœ¨ç±»æˆ–è€…å…¶å­ç±»çš„å®ä¾‹æ—¶ï¼Œåˆ™ä¸èƒ½é’ˆå¯¹ç±»è°ƒç”¨è¯¥æ–¹æ³•ã€‚</li>
</ul>
<p>åœ¨å‰é¢ä»‹ç»å…ƒç±»æ—¶ï¼Œæˆ‘ä»¬å·²ç»æœ‰æ¥è§¦åˆ°è¿™å‡ ä¸ªå‡½æ•°äº†ï¼Œåœ¨æ­¤æˆ‘ä»¬å†ä¸¾ä¸ªå®ä¾‹æ¥çœ‹çœ‹è¿™å‡ ä¸ªå‡½æ•°çš„ä½¿ç”¨ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">Class cls = objc_allocateClassPair(MyClass.class, <span class="string">"MySubClass"</span>, <span class="number">0</span>);</div><div class="line">class_addMethod(cls, <span class="keyword">@selector</span>(submethod1), (IMP)imp_submethod1, <span class="string">"v@:"</span>);</div><div class="line">class_replaceMethod(cls, <span class="keyword">@selector</span>(method1), (IMP)imp_submethod1, <span class="string">"v@:"</span>);</div><div class="line">class_addIvar(cls, <span class="string">"_ivar1"</span>, <span class="keyword">sizeof</span>(<span class="built_in">NSString</span> *), log(<span class="keyword">sizeof</span>(<span class="built_in">NSString</span> *)), <span class="string">"i"</span>);</div><div class="line">objc_property_attribute_t type = &#123;<span class="string">"T"</span>, <span class="string">"@\"NSString\""</span>&#125;;</div><div class="line">objc_property_attribute_t ownership = &#123; <span class="string">"C"</span>, <span class="string">""</span> &#125;;</div><div class="line">objc_property_attribute_t backingivar = &#123; <span class="string">"V"</span>, <span class="string">"_ivar1"</span>&#125;;</div><div class="line">objc_property_attribute_t attrs[] = &#123;type, ownership, backingivar&#125;;</div><div class="line">class_addProperty(cls, <span class="string">"property2"</span>, attrs, <span class="number">3</span>);</div><div class="line">objc_registerClassPair(cls);</div><div class="line"><span class="keyword">id</span> instance = [[cls alloc] init];</div><div class="line">[instance performSelector:<span class="keyword">@selector</span>(submethod1)];</div><div class="line">[instance performSelector:<span class="keyword">@selector</span>(method1)];</div></pre></td></tr></table></figure></p>
<p>ç¨‹åºçš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>2014-10-23 11:35:31.006 RuntimeTest[3800:66152] run sub method 1
2014-10-23 11:35:31.006 RuntimeTest[3800:66152] run sub method 1
</code></pre><h5 id="åŠ¨æ€åˆ›å»ºå¯¹è±¡"><a href="#åŠ¨æ€åˆ›å»ºå¯¹è±¡" class="headerlink" title="åŠ¨æ€åˆ›å»ºå¯¹è±¡"></a>åŠ¨æ€åˆ›å»ºå¯¹è±¡</h5><p>åŠ¨æ€åˆ›å»ºå¯¹è±¡çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºç±»å®ä¾‹</span></div><div class="line"><span class="keyword">id</span> class_createInstance ( Class cls, size_t extraBytes );</div><div class="line"><span class="comment">// åœ¨æŒ‡å®šä½ç½®åˆ›å»ºç±»å®ä¾‹</span></div><div class="line"><span class="keyword">id</span> objc_constructInstance ( Class cls, <span class="keyword">void</span> *bytes );</div><div class="line"><span class="comment">// é”€æ¯ç±»å®ä¾‹</span></div><div class="line"><span class="keyword">void</span> * objc_destructInstance ( <span class="keyword">id</span> obj );</div></pre></td></tr></table></figure>
<ul>
<li><code>class_createInstance</code>å‡½æ•°ï¼šåˆ›å»ºå®ä¾‹æ—¶ï¼Œä¼šåœ¨é»˜è®¤çš„å†…å­˜åŒºåŸŸä¸ºç±»åˆ†é…å†…å­˜ã€‚<code>extraBytes</code>å‚æ•°è¡¨ç¤ºåˆ†é…çš„é¢å¤–å­—èŠ‚æ•°ã€‚è¿™äº›é¢å¤–çš„å­—èŠ‚å¯ç”¨äºå­˜å‚¨åœ¨ç±»å®šä¹‰ä¸­æ‰€å®šä¹‰çš„å®ä¾‹å˜é‡ä¹‹å¤–çš„å®ä¾‹å˜é‡ã€‚è¯¥å‡½æ•°åœ¨ARCç¯å¢ƒä¸‹æ— æ³•ä½¿ç”¨ã€‚</li>
</ul>
<p>è°ƒç”¨<code>class_createInstance</code>çš„æ•ˆæœä¸<code>+alloc</code>æ–¹æ³•ç±»ä¼¼ã€‚ä¸è¿‡åœ¨ä½¿ç”¨<code>class_createInstance</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç¡®åˆ‡çš„çŸ¥é“æˆ‘ä»¬è¦ç”¨å®ƒæ¥åšä»€ä¹ˆã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨NSStringæ¥æµ‹è¯•ä¸€ä¸‹è¯¥å‡½æ•°çš„å®é™…æ•ˆæœï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">id</span> theObject = class_createInstance(<span class="built_in">NSString</span>.class, <span class="keyword">sizeof</span>(<span class="keyword">unsigned</span>));</div><div class="line"> </div><div class="line"><span class="keyword">id</span> str1 = [theObject init];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [str1 <span class="keyword">class</span>]);</div><div class="line"><span class="keyword">id</span> str2 = [[<span class="built_in">NSString</span> alloc] initWithString:<span class="string">@"test"</span>];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [str2 <span class="keyword">class</span>]);</div></pre></td></tr></table></figure></p>
<p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">46</span>:<span class="number">50.781</span> RuntimeTest[<span class="number">4039</span>:<span class="number">89088</span>] <span class="built_in">NSString</span></div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">46</span>:<span class="number">50.781</span> RuntimeTest[<span class="number">4039</span>:<span class="number">89088</span>] __NSCFConstantString</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨<code>class_createInstance</code>å‡½æ•°è·å–çš„æ˜¯NSStringå®ä¾‹ï¼Œè€Œä¸æ˜¯ç±»ç°‡ä¸­çš„é»˜è®¤ç«™ä½ç¬¦ç±»<code>__NSCFConstantString</code>ã€‚</p>
<ul>
<li><p><code>objc_constructInstance</code>å‡½æ•°ï¼šåœ¨æŒ‡å®šçš„ä½ç½®(bytes)åˆ›å»ºç±»å®ä¾‹ã€‚</p>
</li>
<li><p><code>objc_destructInstance</code>å‡½æ•°ï¼šé”€æ¯ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œä½†ä¸ä¼šé‡Šæ”¾å¹¶ç§»é™¤ä»»ä½•ä¸å…¶ç›¸å…³çš„å¼•ç”¨ã€‚</p>
</li>
</ul>
<h5 id="å®ä¾‹æ“ä½œå‡½æ•°"><a href="#å®ä¾‹æ“ä½œå‡½æ•°" class="headerlink" title="å®ä¾‹æ“ä½œå‡½æ•°"></a>å®ä¾‹æ“ä½œå‡½æ•°</h5><p>å®ä¾‹æ“ä½œå‡½æ•°ä¸»è¦æ˜¯é’ˆå¯¹æˆ‘ä»¬åˆ›å»ºçš„å®ä¾‹å¯¹è±¡çš„ä¸€ç³»åˆ—æ“ä½œå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç»„å‡½æ•°æ¥ä»å®ä¾‹å¯¹è±¡ä¸­è·å–æˆ‘ä»¬æƒ³è¦çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚å®ä¾‹å¯¹è±¡ä¸­å˜é‡çš„å€¼ã€‚è¿™ç»„å‡½æ•°å¯ä»¥åˆ†ä¸ºä¸‰å°ç±»ï¼š</p>
<p>1.é’ˆå¯¹æ•´ä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œè¿™ç±»å‡½æ•°åŒ…æ‹¬<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è¿”å›æŒ‡å®šå¯¹è±¡çš„ä¸€ä»½æ‹·è´</span></div><div class="line"><span class="keyword">id</span> object_copy ( <span class="keyword">id</span> obj, size_t size );</div><div class="line"><span class="comment">// é‡Šæ”¾æŒ‡å®šå¯¹è±¡å ç”¨çš„å†…å­˜</span></div><div class="line"><span class="keyword">id</span> object_dispose ( <span class="keyword">id</span> obj );</div></pre></td></tr></table></figure></p>
<p>æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ç±»Aå’Œç±»Bï¼Œä¸”ç±»Bæ˜¯ç±»Açš„å­ç±»ã€‚ç±»Bé€šè¿‡æ·»åŠ ä¸€äº›é¢å¤–çš„å±æ€§æ¥æ‰©å±•ç±»Aã€‚ç°åœ¨æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªAç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶å¸Œæœ›åœ¨è¿è¡Œæ—¶å°†è¿™ä¸ªå¯¹è±¡è½¬æ¢ä¸ºBç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥æ·»åŠ æ•°æ®åˆ°Bç±»çš„å±æ€§ä¸­ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ç›´æ¥è½¬æ¢ï¼Œä»¥ä¸ºBç±»çš„å®ä¾‹ä¼šæ¯”Aç±»çš„å®ä¾‹æ›´å¤§ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥æ”¾ç½®å¯¹è±¡ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä»¥ä¸Šå‡ ä¸ªå‡½æ•°æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSObject</span> *a = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line"><span class="keyword">id</span> newB = object_copy(a, class_getInstanceSize(MyClass.class));</div><div class="line">object_setClass(newB, MyClass.class);</div><div class="line">object_dispose(a);</div></pre></td></tr></table></figure></p>
<p>2.é’ˆå¯¹å¯¹è±¡å®ä¾‹å˜é‡è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œè¿™ç±»å‡½æ•°åŒ…å«ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// ä¿®æ”¹ç±»å®ä¾‹çš„å®ä¾‹å˜é‡çš„å€¼</span></div><div class="line">Ivar object_setInstanceVariable ( <span class="keyword">id</span> obj, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">void</span> *value );</div><div class="line"><span class="comment">// è·å–å¯¹è±¡å®ä¾‹å˜é‡çš„å€¼</span></div><div class="line">Ivar object_getInstanceVariable ( <span class="keyword">id</span> obj, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">void</span> **outValue );</div><div class="line"><span class="comment">// è¿”å›æŒ‡å‘ç»™å®šå¯¹è±¡åˆ†é…çš„ä»»ä½•é¢å¤–å­—èŠ‚çš„æŒ‡é’ˆ</span></div><div class="line"><span class="keyword">void</span> * object_getIndexedIvars ( <span class="keyword">id</span> obj );</div><div class="line"><span class="comment">// è¿”å›å¯¹è±¡ä¸­å®ä¾‹å˜é‡çš„å€¼</span></div><div class="line"><span class="keyword">id</span> object_getIvar ( <span class="keyword">id</span> obj, Ivar ivar );</div><div class="line"><span class="comment">// è®¾ç½®å¯¹è±¡ä¸­å®ä¾‹å˜é‡çš„å€¼</span></div><div class="line"><span class="keyword">void</span> object_setIvar ( <span class="keyword">id</span> obj, Ivar ivar, <span class="keyword">id</span> value );</div></pre></td></tr></table></figure></p>
<p>å¦‚æœå®ä¾‹å˜é‡çš„Ivarå·²ç»çŸ¥é“ï¼Œé‚£ä¹ˆè°ƒç”¨<code>object_getIvar</code>ä¼šæ¯”<code>object_getInstanceVariable</code>å‡½æ•°å¿«ï¼Œç›¸åŒæƒ…å†µä¸‹ï¼Œ<code>object_setIvar</code>ä¹Ÿæ¯”<code>object_setInstanceVariable</code>å¿«ã€‚</p>
<p>3.é’ˆå¯¹å¯¹è±¡çš„ç±»è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œè¿™ç±»å‡½æ•°åŒ…å«ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è¿”å›ç»™å®šå¯¹è±¡çš„ç±»å</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * object_getClassName ( <span class="keyword">id</span> obj );</div><div class="line"><span class="comment">// è¿”å›å¯¹è±¡çš„ç±»</span></div><div class="line">Class object_getClass ( <span class="keyword">id</span> obj );</div><div class="line"><span class="comment">// è®¾ç½®å¯¹è±¡çš„ç±»</span></div><div class="line">Class object_setClass ( <span class="keyword">id</span> obj, Class cls );</div></pre></td></tr></table></figure></p>
<h5 id="è·å–ç±»å®šä¹‰"><a href="#è·å–ç±»å®šä¹‰" class="headerlink" title="è·å–ç±»å®šä¹‰"></a>è·å–ç±»å®šä¹‰</h5><p>Objective-CåŠ¨æ€è¿è¡Œåº“ä¼šè‡ªåŠ¨æ³¨å†Œæˆ‘ä»¬ä»£ç ä¸­å®šä¹‰çš„æ‰€æœ‰çš„ç±»ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶åˆ›å»ºç±»å®šä¹‰å¹¶ä½¿ç”¨<code>objc_addClass</code>å‡½æ•°æ¥æ³¨å†Œå®ƒä»¬ã€‚runtimeæä¾›äº†ä¸€ç³»åˆ—å‡½æ•°æ¥è·å–ç±»å®šä¹‰ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™äº›å‡½æ•°ä¸»è¦åŒ…æ‹¬ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–å·²æ³¨å†Œçš„ç±»å®šä¹‰çš„åˆ—è¡¨</span></div><div class="line"><span class="keyword">int</span> objc_getClassList ( Class *buffer, <span class="keyword">int</span> bufferCount );</div><div class="line"><span class="comment">// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘æ‰€æœ‰å·²æ³¨å†Œç±»çš„æŒ‡é’ˆåˆ—è¡¨</span></div><div class="line">Class * objc_copyClassList ( <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount );</div><div class="line"><span class="comment">// è¿”å›æŒ‡å®šç±»çš„ç±»å®šä¹‰</span></div><div class="line">Class objc_lookUpClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line">Class objc_getClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line">Class objc_getRequiredClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div><div class="line"><span class="comment">// è¿”å›æŒ‡å®šç±»çš„å…ƒç±»</span></div><div class="line">Class objc_getMetaClass ( <span class="keyword">const</span> <span class="keyword">char</span> *name );</div></pre></td></tr></table></figure></p>
<ul>
<li><code>objc_getClassList</code>å‡½æ•°ï¼šè·å–å·²æ³¨å†Œçš„ç±»å®šä¹‰çš„åˆ—è¡¨ã€‚æˆ‘ä»¬ä¸èƒ½å‡è®¾ä»è¯¥å‡½æ•°ä¸­è·å–çš„ç±»å¯¹è±¡æ˜¯ç»§æ‰¿è‡ªNSObjectä½“ç³»çš„ï¼Œæ‰€ä»¥åœ¨è¿™äº›ç±»ä¸Šè°ƒç”¨æ–¹æ³•æ˜¯ï¼Œéƒ½åº”è¯¥å…ˆæ£€æµ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•æ˜¯å¦åœ¨è¿™ä¸ªç±»ä¸­å®ç°ã€‚</li>
</ul>
<p>ä¸‹é¢ä»£ç æ¼”ç¤ºäº†è¯¥å‡½æ•°çš„ç”¨æ³•ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">int</span> numClasses;</div><div class="line">Class * classes = <span class="literal">NULL</span>;</div><div class="line">numClasses = objc_getClassList(<span class="literal">NULL</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">if</span> (numClasses &gt; <span class="number">0</span>) &#123;</div><div class="line">    classes = malloc(<span class="keyword">sizeof</span>(Class) * numClasses);</div><div class="line">    numClasses = objc_getClassList(classes, numClasses);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"number of classes: %d"</span>, numClasses);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numClasses; i++) &#123;</div><div class="line">        Class cls = classes[i];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"class name: %s"</span>, class_getName(cls));</div><div class="line">    &#125;</div><div class="line">    free(classes);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.589</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] number of classes: <span class="number">1282</span></div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.589</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: DDTokenRegexp</div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.590</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: _NSMostCommonKoreanCharsKeySet</div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.590</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: OS_xpc_dictionary</div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.590</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: <span class="built_in">NSFileCoordinator</span></div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.590</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: <span class="built_in">NSAssertionHandler</span></div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.590</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: PFUbiquityTransactionLogMigrator</div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.591</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: <span class="built_in">NSNotification</span></div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.591</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: <span class="built_in">NSKeyValueNilSetEnumerator</span></div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.591</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: OS_tcp_connection_tls_session</div><div class="line"><span class="number">2014</span><span class="number">-10</span><span class="number">-23</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">52.591</span> RuntimeTest[<span class="number">8437</span>:<span class="number">188589</span>] <span class="keyword">class</span> name: _PFRoutines</div><div class="line">......è¿˜æœ‰å¤§é‡è¾“å‡º</div></pre></td></tr></table></figure></p>
<ul>
<li>è·å–ç±»å®šä¹‰çš„æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š<code>objc_lookUpClass</code>,<code>objc_getClass</code>å’Œ<code>objc_getRequiredClass</code>ã€‚å¦‚æœç±»åœ¨è¿è¡Œæ—¶æœªæ³¨å†Œï¼Œåˆ™<code>objc_lookUpClass</code>ä¼šè¿”å›nilï¼Œè€Œ<code>objc_getClass</code>ä¼šè°ƒç”¨ç±»å¤„ç†å›è°ƒï¼Œå¹¶å†æ¬¡ç¡®è®¤è¯¥ç±»æ˜¯å¦æ³¨å†Œï¼Œå¦‚æœç¡®è®¤æœªæ³¨å†Œï¼Œåˆ™è¿”å›nilã€‚è€Œ<code>objc_getRequiredClass</code>å‡½æ•°çš„æ“ä½œä¸<code>objc_getClass</code>ç›¸åŒï¼Œåªä¸è¿‡å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç±»ï¼Œåˆ™ä¼šæ€æ­»è¿›ç¨‹ã€‚</li>
<li><code>objc_getMetaClass</code>å‡½æ•°ï¼šå¦‚æœæŒ‡å®šçš„ç±»æ²¡æœ‰æ³¨å†Œï¼Œåˆ™è¯¥å‡½æ•°ä¼šè°ƒç”¨ç±»å¤„ç†å›è°ƒï¼Œå¹¶å†æ¬¡ç¡®è®¤ç±»æ˜¯å¦æ³¨å†Œï¼Œå¦‚æœç¡®è®¤æœªæ³¨å†Œï¼Œå†è¿”å›nilã€‚ä¸è¿‡ï¼Œæ¯ä¸ªç±»éƒ½å¿…é¡»æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å…ƒç±»å®šä¹‰ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°æ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªå…ƒç±»å®šä¹‰ï¼Œä¸ç®¡å®ƒæ˜¯å¦æœ‰æ•ˆã€‚</li>
</ul>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>åœ¨è¿™ä¸€ç« ä¸­æˆ‘ä»¬ä»‹ç»äº†Runtimeè¿è¡Œæ—¶ä¸­ä¸ç±»å’Œå¯¹è±¡ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡è¿™äº›æ•°æ®å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç®¡çª¥Objective-Cåº•å±‚é¢å‘å¯¹è±¡å®ç°çš„ä¸€äº›ä¿¡æ¯ã€‚å¦å¤–ï¼Œé€šè¿‡ä¸°å¯Œçš„æ“ä½œå‡½æ•°ï¼Œå¯ä»¥çµæ´»åœ°å¯¹è¿™äº›æ•°æ®è¿›è¡Œæ“ä½œã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Objective-Cè¯­è¨€æ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œå®ƒå°†å¾ˆå¤šé™æ€è¯­è¨€åœ¨ç¼–è¯‘å’Œé“¾æ¥æ—¶æœŸåšçš„äº‹æ”¾åˆ°äº†è¿è¡Œæ—¶æ¥å¤„ç†ã€‚è¿™ç§åŠ¨æ€è¯­è¨€çš„ä¼˜åŠ¿åœ¨äºï¼šæˆ‘ä»¬å†™ä»£ç æ—¶æ›´å…·æœ‰çµæ´»æ€§ï¼Œå¦‚æˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯è½¬å‘ç»™æˆ‘ä»¬æƒ³è¦çš„å¯¹è±¡ï¼Œæˆ–è€…éšæ„äº¤æ¢ä¸€ä¸ªæ–¹æ³•çš„å®ç°ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§ç‰¹æ€§æ„å‘³ç€Objective-Cä¸ä»…éœ€è¦ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œè¿˜éœ€è¦ä¸€ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿæ¥æ‰§è¡Œç¼–è¯‘çš„ä»£ç ã€‚å¯¹äºObjective-Cæ¥è¯´ï¼Œè¿™ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿå°±åƒä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸€æ ·ï¼Œè®©å®ƒæ‰€æœ‰çš„å·¥ä½œå¯ä»¥æ­£å¸¸è¿è¡Œã€‚è¿™ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿå³&lt;code&gt;Objc Runtime&lt;/code&gt;ã€‚&lt;code&gt;Objc Runtime&lt;/code&gt;å…¶å®å°±æ˜¯ä¸€ä¸ª&lt;code&gt;Runtime&lt;/code&gt;åº“ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ç”¨Cå’Œæ±‡ç¼–å†™çš„ï¼Œè¿™ä¸ªåº“ä½¿å¾—Cè¯­è¨€æœ‰äº†é¢å‘å¯¹è±¡çš„èƒ½åŠ›ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="http://www.guiyongdong.com/categories/Objective-C/"/>
    
    
      <category term="Runtime" scheme="http://www.guiyongdong.com/tags/Runtime/"/>
    
  </entry>
  
  <entry>
    <title>NSURLSessionä¸NSURLConnectionåŒºåˆ«</title>
    <link href="http://www.guiyongdong.com/2016/11/18/NSURLSession%E4%B8%8ENSURLConnection%E5%8C%BA%E5%88%AB/"/>
    <id>http://www.guiyongdong.com/2016/11/18/NSURLSessionä¸NSURLConnectionåŒºåˆ«/</id>
    <published>2016-11-18T06:09:19.000Z</published>
    <updated>2017-03-09T07:03:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©å»é¢è¯•ï¼Œè¢«é—®äº†ä¸€é“AFNetworking2.0å’Œ3.0æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå½“æ—¶å¿ƒæƒ³ï¼Œè¿™è°ä¸çŸ¥é“å•Šï¼Œéšå£ç­”åˆ°ï¼š2.0ä½¿ç”¨çš„NSURLConnection,3.0ä½¿ç”¨çš„æ˜¯NSURLSession,äººå®¶åˆé—®NSURLSesstionå’ŒNSURLConnectionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç¬é—´å‚»çœ¼äº†ï¼Œæ”¯æ”¯å¾å¾åªæ˜¯è¯´å‡ºäº†ç¼“å­˜ç­–ç•¥çš„ä¸åŒã€‚äº¡ç¾Šè¡¥ç‰¢ï¼Œä¸ºæ—¶æœªæ™šï¼Œè¿™ç¯‡åšå®¢å°±è®²è§£ä¸€ä¸‹å®ƒä»¬ä¸¤è€…åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<a id="more"></a>
<h4 id="ä½¿ç”¨ç°çŠ¶"><a href="#ä½¿ç”¨ç°çŠ¶" class="headerlink" title="ä½¿ç”¨ç°çŠ¶"></a>ä½¿ç”¨ç°çŠ¶</h4><p>NSURLSessionæ˜¯NSURLConnectionçš„æ›¿ä»£è€…ï¼Œåœ¨2013å¹´è‹¹æœå…¨çƒå¼€å‘è€…å¤§ä¼šä¸Šï¼ˆWWDC2013ï¼‰éšiOS7ä¸€èµ·å‘å¸ƒçš„ï¼Œæ˜¯å¯¹NSURLConnectionè¿›è¡Œäº†é‡æ„ä¼˜åŒ–åçš„æ–°çš„ç½‘ç»œæ¥å£ã€‚ä»iOS9å¼€å§‹ï¼ŒNSURLConnectionä¸­å‘é€è¯·æ±‚çš„ä¸¤ä¸ªæ–¹æ³•å·²ç»è¿‡æœŸï¼ˆåŒæ­¥è¯·æ±‚ï¼Œå¼‚æ­¥è¯·æ±‚ï¼‰,åˆå§‹åŒ–ç½‘ç»œè¿æ¥çš„æ–¹æ³•ä¹Ÿè¢«è®¾ç½®ä¸ºè¿‡æœŸï¼Œç³»ç»Ÿä¸å†æ¨èä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨NSURLSessionå‘é€ç½‘ç»œè¯·æ±‚ã€‚NSURLConnectionè¢«åºŸå¼ƒçš„ä¸»è¦æ¥å£ï¼š</p>
<pre><code>- (nullable instancetype)initWithRequest:(NSURLRequest *)request delegate:(nullable id)delegate startImmediately:(BOOL)startImmediately NS_DEPRECATED(10_5, 10_11, 2_0, 9_0, &quot;Use NSURLSession (see NSURLSession.h)&quot;) __WATCHOS_PROHIBITED;

- (nullable instancetype)initWithRequest:(NSURLRequest *)request delegate:(nullable id)delegate NS_DEPRECATED(10_3, 10_11, 2_0, 9_0, &quot;Use NSURLSession (see NSURLSession.h)&quot;) __WATCHOS_PROHIBITED;
+ (nullable NSURLConnection*)connectionWithRequest:(NSURLRequest *)request delegate:(nullable id)delegate NS_DEPRECATED(10_3, 10_11, 2_0, 9_0, &quot;Use NSURLSession (see NSURLSession.h)&quot;) __WATCHOS_PROHIBITED;
//å¼‚æ­¥è¯·æ±‚
+ (void)sendAsynchronousRequest:(NSURLRequest*) request
                          queue:(NSOperationQueue*) queue
              completionHandler:(void (^)(NSURLResponse* __nullable response, NSData* __nullable data, NSError* __nullable connectionError)) handler NS_DEPRECATED(10_7, 10_11, 5_0, 9_0, &quot;Use [NSURLSession dataTaskWithRequest:completionHandler:] (see NSURLSession.h&quot;) __WATCHOS_PROHIBITED;
//åŒæ­¥è¯·æ±‚             
+ (nullable NSData *)sendSynchronousRequest:(NSURLRequest *)request returningResponse:(NSURLResponse * __nullable * __nullable)response error:(NSError **)error NS_DEPRECATED(10_3, 10_11, 2_0, 9_0, &quot;Use [NSURLSession dataTaskWithRequest:completionHandler:] (see NSURLSession.h&quot;) __WATCHOS_PROHIBITED;
</code></pre><h4 id="æ™®é€šä»»åŠ¡å’Œä¸Šä¼ "><a href="#æ™®é€šä»»åŠ¡å’Œä¸Šä¼ " class="headerlink" title="æ™®é€šä»»åŠ¡å’Œä¸Šä¼ "></a>æ™®é€šä»»åŠ¡å’Œä¸Šä¼ </h4><p>NSURLSessioné’ˆå¯¹ä¸‹è½½/ä¸Šä¼ ç­‰å¤æ‚çš„ç½‘ç»œæ“ä½œæä¾›äº†ä¸“é—¨çš„è§£å†³æ–¹æ¡ˆï¼Œé’ˆå¯¹æ™®é€šã€ä¸Šä¼ å’Œä¸‹è½½åˆ†åˆ«å¯¹åº”ä¸‰ç§ä¸åŒçš„ç½‘ç»œè¯·æ±‚ä»»åŠ¡ï¼šNSURLSessionDataTask,NSURLSessionUploadTaskå’ŒNSURLSessionDownloadTaskã€‚åˆ›å»ºçš„taskéƒ½æ˜¯æŒ‚èµ·çŠ¶æ€ï¼Œéœ€è¦resumeæ‰èƒ½å¯åŠ¨ã€‚</p>
<p>å½“æœåŠ¡å™¨è¿”å›çš„æ•°æ®è¾ƒå°æ—¶,NSURLSessionä¸NSURLConnectionæ‰§è¡Œæ™®é€šä»»åŠ¡çš„æ“ä½œæ­¥éª¤æ²¡æœ‰åŒºåˆ«ã€‚<br>æ‰§è¡Œä¸Šä¼ ä»»åŠ¡æ—¶ï¼ŒNSURLSessionä¸NSURLConnectionä¸€æ ·éœ€è¦è®¾ç½®POSTè¯·æ±‚çš„è¯·æ±‚ä½“è¿›è¡Œä¸Šä¼ ã€‚</p>
<h4 id="ä¸‹è½½ä»»åŠ¡æ–¹å¼"><a href="#ä¸‹è½½ä»»åŠ¡æ–¹å¼" class="headerlink" title="ä¸‹è½½ä»»åŠ¡æ–¹å¼"></a>ä¸‹è½½ä»»åŠ¡æ–¹å¼</h4><p>NSURLConnectionä¸‹è½½æ–‡ä»¶æ—¶ï¼Œå…ˆæ˜¯å°†æ•´ä¸ªæ–‡ä»¶ä¸‹è½½åˆ°å†…å­˜ï¼Œç„¶åå†å†™å…¥åˆ°æ²™ç›’ï¼Œå¦‚æœæ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå°±ä¼šå‡ºç°å†…å­˜æš´æ¶¨çš„æƒ…å†µã€‚</p>
<p>è€Œä½¿ç”¨NSURLSessionUploadTaskä¸‹è½½æ–‡ä»¶ï¼Œä¼šé»˜è®¤ä¸‹è½½åˆ°æ²™ç›’ä¸­çš„temæ–‡ä»¶ä¸­ï¼Œä¸ä¼šå‡ºç°å†…å­˜æš´æ¶¨çš„æƒ…å†µï¼Œä½†æ˜¯åœ¨ä¸‹è½½å®Œæˆåä¼šæŠŠtemä¸­çš„ä¸´æ—¶æ–‡ä»¶åˆ é™¤ï¼Œéœ€è¦åœ¨åˆå§‹åŒ–ä»»åŠ¡æ–¹æ³•æ—¶ï¼Œåœ¨completionHandlerå›è°ƒä¸­å¢åŠ ä¿å­˜æ–‡ä»¶çš„ä»£ç ã€‚ï¼ˆåé¢ä¼šè¯¦ç»†è¯´ï¼‰</p>
<h4 id="è¯·æ±‚æ–¹æ³•çš„æ§åˆ¶"><a href="#è¯·æ±‚æ–¹æ³•çš„æ§åˆ¶" class="headerlink" title="è¯·æ±‚æ–¹æ³•çš„æ§åˆ¶"></a>è¯·æ±‚æ–¹æ³•çš„æ§åˆ¶</h4><p>NSURLConnectionå®ä¾‹åŒ–å¯¹è±¡ï¼Œå®ä¾‹åŒ–å¼€å§‹ï¼Œé»˜è®¤è¯·æ±‚å°±å‘é€(åŒæ­¥å‘é€),ä¸éœ€è¦è°ƒç”¨startæ–¹æ³•ã€‚è€Œcancelå¯ä»¥åœæ­¢è¯·æ±‚çš„å‘é€ï¼Œåœæ­¢åä¸èƒ½ç»§ç»­è®¿é—®ï¼Œéœ€è¦åˆ›å»ºæ–°çš„è¯·æ±‚ã€‚</p>
<p>NSURLSessionæœ‰ä¸‰ä¸ªæ§åˆ¶æ–¹æ³•ï¼Œå–æ¶ˆ(cancel)ã€æš‚åœ(suspend)ã€ç»§ç»­(resume)ï¼Œæš‚åœä»¥åå¯ä»¥é€šè¿‡ç»§ç»­æ¢å¤å½“å‰çš„è¯·æ±‚ä»»åŠ¡ã€‚</p>
<h4 id="æ–­ç‚¹ç»­ä¼ çš„æ–¹å¼"><a href="#æ–­ç‚¹ç»­ä¼ çš„æ–¹å¼" class="headerlink" title="æ–­ç‚¹ç»­ä¼ çš„æ–¹å¼"></a>æ–­ç‚¹ç»­ä¼ çš„æ–¹å¼</h4><p>NSURLConnectionè¿›è¡Œæ–­ç‚¹ä¸‹è½½ï¼Œé€šè¿‡è®¾ç½®è®¿é—®è¯·æ±‚çš„HTTPHeaderFieldçš„Rangeå±æ€§ï¼Œå¼€å¯è¿è¡Œå¾ªç¯ï¼ŒNSURLConnectionçš„ä»£ç†æ–¹æ³•ä½œä¸ºè¿è¡Œå¾ªç¯çš„äº‹ä»¶æºï¼Œæ¥æ”¶åˆ°ä¸‹è½½æ•°æ®æ—¶ä»£ç†æ–¹æ³•å°±ä¼šæŒç»­è°ƒç”¨ï¼Œå¹¶ä½¿ç”¨NSOutputStreamç®¡é“æµè¿›è¡Œæ•°æ®ä¿å­˜ã€‚</p>
<p>NSURLSessionè¿›è¡Œæ–­ç‚¹ä¸‹è½½ï¼Œå½“æš‚åœä¸‹è½½ä»»åŠ¡åï¼Œå¦‚æœdownloadTaskï¼ˆä¸‹è½½ä»»åŠ¡ï¼‰ä¸ºéç©ºï¼Œè°ƒç”¨<code>cancelByProducingResumeData:(void (^)(NSData *resumeData))completionHandler</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå®Œæˆå¤„ç†ä»£ç å—ï¼Œè¿™ä¸ªä»£ç å—æœ‰ä¸€ä¸ªNSDataå‚æ•°resumeDataï¼Œå¦‚æœresumeDataéç©ºï¼Œæˆ‘ä»¬å°±ä¿å­˜è¿™ä¸ªå¯¹è±¡åˆ°è§†å›¾æ§åˆ¶å™¨çš„resumeDataå±æ€§ä¸­ï¼Œåœ¨ç‚¹å‡»å†æ¬¡ä¸‹è½½æ—¶ï¼Œé€šè¿‡è°ƒç”¨<code>[ [self.session downloadTaskWithResumeData:self.resumeData]resume]</code>æ–¹æ³•è¿›è¡Œç»§ç»­ä¸‹è½½æ“ä½œ</p>
<p>ç»è¿‡ä»¥ä¸Šæ¯”è¾ƒå¯ä»¥å‘ç°ï¼Œä½¿ç”¨NSURLSessionè¿›è¡Œæ–­ç‚¹ä¸‹è½½æ›´åŠ ä¾¿æ·.</p>
<h4 id="é…ç½®ä¿¡æ¯"><a href="#é…ç½®ä¿¡æ¯" class="headerlink" title="é…ç½®ä¿¡æ¯"></a>é…ç½®ä¿¡æ¯</h4><p>NSURLSessionçš„æ„é€ æ–¹æ³•<code>ï¼ˆsessionWithConfiguration:delegate:delegateQueueï¼‰</code>ä¸­æœ‰ä¸€ä¸ªNSURLSessionConfigurationç±»çš„å‚æ•°å¯ä»¥è®¾ç½®é…ç½®ä¿¡æ¯ï¼Œå…¶å†³å®šäº†cookieï¼Œå®‰å…¨å’Œé«˜é€Ÿç¼“å­˜ç­–ç•¥ï¼Œæœ€å¤§ä¸»æœºè¿æ¥æ•°ï¼Œèµ„æºç®¡ç†ï¼Œç½‘ç»œè¶…æ—¶ç­‰é…ç½®ã€‚NSURLConnectionä¸èƒ½è¿›è¡Œè¿™ä¸ªé…ç½®ï¼Œç›¸æ¯”è¾ƒä¸NSURLConnectionä¾èµ–ä¸ä¸€ä¸ªå…¨å±€çš„é…ç½®å¯¹è±¡ï¼Œç¼ºä¹çµæ´»æ€§è€Œè¨€ï¼ŒNSURLSessionæœ‰å¾ˆå¤§çš„æ”¹è¿›äº†ã€‚(å…³äºé…ç½®ä¿¡æ¯ï¼Œåé¢ä¼šè®²è§£åˆ°)</p>
<p>é€šè¿‡ä»¥ä¸Šå‡ ç‚¹ï¼Œå¤§æ¦‚çŸ¥é“äº†NSURLSessionå’ŒNSURLConnectionçš„åŒºåˆ«ï¼Œæƒ³å¿…ä¸‹è½½å†é‡åˆ°è¿™æ ·çš„é—®é¢˜ä¸ä¼šæ”¯æ”¯å¾å¾äº†ã€‚ä¸‹é¢æ¥ç‚¹NSURLSessionçš„å¹²è´§ã€‚</p>
<hr>
<p><strong><p align="center">å¹²è´§å¼€å§‹</p></strong></p>
<hr>
<h3 id="NSURLSession"><a href="#NSURLSession" class="headerlink" title="NSURLSession"></a>NSURLSession</h3><p>NSURLSession ä¸º HTTP æ•°æ®ä¼ è¾“æä¾›ä¸€ç³»åˆ—çš„æ¥å£ï¼Œè€Œä½¿ç”¨ NSURLSession æ€»å…±åªéœ€è¦ä¸‰æ­¥ï¼š</p>
<ol>
<li>åˆ›å»ºNSURLSessionå¯¹è±¡</li>
<li>é€šè¿‡ NSURLSession çš„å®ä¾‹åˆ›å»º Task</li>
<li>æ‰§è¡Œ Task</li>
</ol>
<h5 id="å¦‚ä½•è·å–Sessionå¯¹è±¡"><a href="#å¦‚ä½•è·å–Sessionå¯¹è±¡" class="headerlink" title="å¦‚ä½•è·å–Sessionå¯¹è±¡"></a>å¦‚ä½•è·å–Sessionå¯¹è±¡</h5><p> 1.è·å–é»˜è®¤çš„ Session å¯¹è±¡</p>
<pre><code>/*
 * ç”¨äºåŸºæœ¬çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥å‡ è¡Œä»£ç å°±è·å– URL çš„å†…å®¹ï¼Œä½¿ç”¨ç®€å•
 * æ— æ³•ä¸æ–­çš„è·å–æœåŠ¡å™¨è¿”å›çš„æ•°æ®
 * æ— æ³•ä¿®æ”¹é»˜è®¤çš„è¿æ¥è¡Œä¸º
 * èº«ä»½éªŒè¯çš„èƒ½åŠ›æœ‰é™
 * ä»»åŠ¡åœ¨åå°æ—¶æ— æ³•ä¸Šä¼ å’Œä¸‹è½½
 */
+ (NSURLSession *)sharedSession;
</code></pre><p> 2.è‡ªå®šä¹‰ Session å¯¹è±¡</p>
<pre><code> // ä¸ç”¨ä»£ç†
+ (NSURLSession *)sessionWithConfiguration:(NSURLSessionConfiguration *)configuration;
// ç”¨ä»£ç†
+ (NSURLSession *)sessionWithConfiguration:(NSURLSessionConfiguration *)configuration
                                  delegate:(nullable id &lt;NSURLSessionDelegate&gt;)delegate
                             delegateQueue:(nullable NSOperationQueue *)queue;
</code></pre><p>åœ¨ä½¿ç”¨è‡ªå®šä¹‰æ–¹å¼åˆ›å»ºNSURLSessionå¯¹åƒæ—¶ï¼Œéƒ½éœ€è¦ä¼ å…¥ä¸€ä¸ªNSURLSessionConfigurationå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¯¹Sessionçš„ç½‘ç»œè¯·æ±‚çš„åŸºæœ¬é…ç½®ã€‚é‚£è¿™ä¸ªNSURLSessionConfigurationéƒ½æœ‰å“ªäº›é…ç½®å‘¢ï¼Ÿæ¥ç€å¾€ä¸‹çœ‹</p>
<h3 id="NSURLSessionConfiguration"><a href="#NSURLSessionConfiguration" class="headerlink" title="NSURLSessionConfiguration"></a>NSURLSessionConfiguration</h3><p>æœ‰ä¸‰ä¸ªæ–¹æ³•æ¥åˆ›å»ºNSURLSessionConfiguration:</p>
<ul>
<li><strong>defaultSessionConfiguration</strong> ä½¿ç”¨å…¨å±€çš„cacheï¼Œcookie,ä½¿ç”¨ç¡¬ç›˜æ¥ç¼“å­˜æ•°æ®ã€‚</li>
<li><strong>ephemeralSessionConfiguration</strong> ä¸´æ—¶sessioné…ç½®ï¼Œä¸é»˜è®¤é…ç½®ç›¸æ¯”ï¼Œè¿™ä¸ªé…ç½®ä¸ä¼šå°†ç¼“å­˜ã€cookieç­‰å­˜åœ¨æœ¬åœ°ï¼Œåªä¼šå­˜åœ¨å†…å­˜é‡Œï¼Œæ‰€ä»¥å½“ç¨‹åºé€€å‡ºæ—¶ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ä¼šæ¶ˆå¤±</li>
<li><strong>backgroundSessionConfiguration</strong> åå°sessioné…ç½®ï¼Œä¸é»˜è®¤é…ç½®ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ä¼šåœ¨åå°å¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ç½‘ç»œæ•°æ®ã€‚</li>
</ul>
<p>ä¸€æ—¦åˆ›å»ºäº†NSURLSessionConfigurationå°±å¯ä»¥ç»™å®ƒè®¾ç½®å„ç§å±æ€§</p>
<p><strong>çœ‹NSURLSessionConfigurationçš„å¤´æ–‡ä»¶:</strong></p>
<pre><code>@interface NSURLSessionConfiguration : NSObject &lt;NSCopying&gt;

/* ä¸‰ç§åˆ›å»ºæ–¹å¼ */

+ (NSURLSessionConfiguration *)defaultSessionConfiguration;
+ (NSURLSessionConfiguration *)ephemeralSessionConfiguration;
+ (NSURLSessionConfiguration *)backgroundSessionConfigurationWithIdentifier:(NSString *)identifier NS_AVAILABLE(10_10, 8_0);

/* å½“ä½¿ç”¨ä¸Šè¿°ç¬¬ä¸‰ç§æ–¹å¼åˆ›å»ºåå°sessionConfigurationæ—¶å¯ä»¥è¯»åˆ°åˆå§‹åŒ–æ—¶ä¼ å…¥çš„å”¯ä¸€æ ‡è¯†ï¼Œå…¶ä»–åˆ›å»ºæ–¹å¼éƒ½ä¸ºç©º */
@property (nullable, readonly, copy) NSString *identifier;

/* 
ç¼“å­˜ç­–ç•¥ï¼Œé»˜è®¤å€¼æ˜¯NSURLRequestUseProtocolCachePolicy
 */
@property NSURLRequestCachePolicy requestCachePolicy;

/* ç»™requestæŒ‡å®šæ¯æ¬¡æ¥æ”¶æ•°æ®è¶…æ—¶é—´éš”ï¼Œå¦‚æœä¸‹ä¸€æ¬¡æ¥å—æ–°æ•°æ®ç”¨æ—¶è¶…è¿‡è¯¥å€¼ï¼Œåˆ™å‘é€ä¸€ä¸ªè¯·æ±‚è¶…æ—¶ç»™è¯¥requestã€‚é»˜è®¤ä¸º60s */
@property NSTimeInterval timeoutIntervalForRequest;

/* ç»™æŒ‡å®šresourceè®¾å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œresourceéœ€è¦åœ¨æ—¶é—´åˆ°è¾¾ä¹‹å‰å®Œæˆã€‚é»˜è®¤æ˜¯7å¤©ã€‚ */
@property NSTimeInterval timeoutIntervalForResource;

/* æŒ‡å®šç½‘ç»œä¼ è¾“ç±»å‹ã€‚ç²¾åˆ‡æŒ‡å‡ºä¼ è¾“ç±»å‹ï¼Œå¯ä»¥è®©ç³»ç»Ÿå¿«é€Ÿå“åº”ï¼Œæé«˜ä¼ è¾“è´¨é‡ï¼Œå»¶é•¿ç”µæ± å¯¿å‘½ç­‰ã€‚
typedef NS_ENUM(NSUInteger, NSURLRequestNetworkServiceType)
{
    NSURLNetworkServiceTypeDefault = 0,    // æ™®é€šç½‘ç»œä¼ è¾“ï¼Œé»˜è®¤ä½¿ç”¨è¿™ä¸ª
    NSURLNetworkServiceTypeVoIP = 1,    // ç½‘ç»œè¯­éŸ³é€šä¿¡ä¼ è¾“ï¼Œåªèƒ½åœ¨VoIPä½¿ç”¨
    NSURLNetworkServiceTypeVideo = 2,    // å½±åƒä¼ è¾“
    NSURLNetworkServiceTypeBackground = 3, // ç½‘ç»œåå°ä¼ è¾“ï¼Œä¼˜å…ˆçº§ä¸é«˜æ—¶å¯ä½¿ç”¨ã€‚å¯¹ç”¨æˆ·ä¸éœ€è¦çš„ç½‘ç»œæ“ä½œå¯ä½¿ç”¨
    NSURLNetworkServiceTypeVoice = 4       // è¯­éŸ³ä¼ è¾“
};
 */
@property NSURLRequestNetworkServiceType networkServiceType;

/* æ˜¯å¦ä½¿ç”¨èœ‚çªç½‘ç»œï¼Œé»˜è®¤æ˜¯yes. */
@property BOOL allowsCellularAccess;

/* æ˜¯å¦ç”±ç³»ç»Ÿæ ¹æ®æ€§èƒ½è‡ªåŠ¨è£é‡åå°ä»»åŠ¡ã€‚é»˜è®¤å€¼æ˜¯NOã€‚åŒsessionSendsLaunchEventä¸€æ ·ï¼Œåªå¯¹åå°configurationæœ‰æ•ˆã€‚ */
@property (getter=isDiscretionary) BOOL discretionary NS_AVAILABLE(10_10, 7_0);

/* 
å¦‚æœè¦ä¸ºappçš„æ’ä»¶æä¾›sessionï¼Œéœ€è¦ç»™è¿™ä¸ªå€¼èµ‹å€¼
 */
@property (nullable, copy) NSString *sharedContainerIdentifier NS_AVAILABLE(10_10, 8_0);

/* 
 è¡¨ç¤ºå½“åå°ä¼ è¾“ç»“æŸæ—¶ï¼Œæ˜¯å¦å¯åŠ¨app.è¿™ä¸ªå±æ€§åªå¯¹ åå°sessionConfiguration ç”Ÿæ•ˆï¼Œå…¶ä»–configurationç±»å‹ä¼šè‡ªåŠ¨å¿½ç•¥è¯¥å€¼ã€‚é»˜è®¤å€¼æ˜¯YESã€‚
 */
@property BOOL sessionSendsLaunchEvents NS_AVAILABLE(NA, 7_0);

/* 
æŒ‡å®šäº†ä¼šè¯è¿æ¥ä¸­çš„ä»£ç†æœåŠ¡å™¨ã€‚åŒæ ·åœ°ï¼Œå¤§å¤šæ•°é¢å‘æ¶ˆè´¹è€…çš„åº”ç”¨ç¨‹åºéƒ½ä¸éœ€è¦ä»£ç†ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šä¸éœ€è¦é…ç½®è¿™ä¸ªå±æ€§,é»˜è®¤ä¸ºNULL
*/
@property (nullable, copy) NSDictionary *connectionProxyDictionary;

/* ç¡®å®šæ˜¯å¦æ”¯æŒSSLProtocolç‰ˆæœ¬çš„ä¼šè¯
 */
@property SSLProtocol TLSMinimumSupportedProtocol;

/* 
ç¡®å®šæ˜¯å¦æ”¯æŒSSLProtocolç‰ˆæœ¬çš„ä¼šè¯
*/
@property SSLProtocol TLSMaximumSupportedProtocol;

/* 
å®ƒå¯ä»¥è¢«ç”¨äºå¼€å¯HTTPç®¡é“ï¼Œè¿™å¯ä»¥æ˜¾ç€é™ä½è¯·æ±‚çš„åŠ è½½æ—¶é—´ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰è¢«æœåŠ¡å™¨å¹¿æ³›æ”¯æŒï¼Œé»˜è®¤æ˜¯ç¦ç”¨çš„
 */
@property BOOL HTTPShouldUsePipelining;

/* 
é»˜è®¤ä¸ºyes,æ˜¯å¦æä¾›æ¥è‡ªshareCookieStorgeçš„cookieï¼Œå¦‚æœæƒ³è¦è‡ªå·±æä¾›cookieï¼Œå¯ä»¥ä½¿ç”¨HTTPAdditionalHeadersæ¥æä¾›ã€‚
 */
@property BOOL HTTPShouldSetCookies;

/* Policy for accepting cookies.  This overrides the policy otherwise specified by the cookie storage. */
@property NSHTTPCookieAcceptPolicy HTTPCookieAcceptPolicy;

/* 
æŒ‡å®šäº†ä¸€ç»„é»˜è®¤çš„å¯ä»¥è®¾ç½®å‡ºç«™è¯·æ±‚çš„æ•°æ®å¤´ã€‚è¿™å¯¹äºè·¨ä¼šè¯å…±äº«ä¿¡æ¯ï¼Œå¦‚å†…å®¹ç±»å‹ï¼Œè¯­è¨€ï¼Œç”¨æˆ·ä»£ç†ï¼Œèº«ä»½è®¤è¯ï¼Œæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚
ä¾‹å¦‚ï¼š
    @{@&quot;Accept&quot;: @&quot;application/json&quot;,
     @&quot;Accept-Language&quot;: @&quot;en&quot;,
     @&quot;Authorization&quot;: authString,
     @&quot;User-Agent&quot;: userAgentString
   }
 */
@property (nullable, copy) NSDictionary *HTTPAdditionalHeaders;

/* 
åŒæ—¶è¿æ¥ä¸€ä¸ªhostçš„æœ€å¤§æ•°ã€‚iOSé»˜è®¤æ˜¯4.APPæ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥çœ‹çš„
 */
@property NSInteger HTTPMaximumConnectionsPerHost;

/* 
å­˜å‚¨cookieï¼Œæ¸…é™¤å­˜å‚¨ï¼Œç›´æ¥setä¸ºnilå³å¯ã€‚
å¯¹äºé»˜è®¤å’Œåå°çš„sessionï¼Œä½¿ç”¨sharedHTTPCookieStorageã€‚
å¯¹äºçŸ­æš‚çš„sessionï¼Œcookieä»…ä»…å‚¨å­˜åˆ°å†…å­˜ï¼Œsessionå¤±æ•ˆæ—¶ä¼šè‡ªåŠ¨æ¸…é™¤ã€‚
 */
@property (nullable, retain) NSHTTPCookieStorage *HTTPCookieStorage;

/* 
è¯ä¹¦å­˜å‚¨ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œå¯setä¸ºnil.
é»˜è®¤å’Œåå°sessionï¼Œé»˜è®¤ä½¿ç”¨çš„sharedCredentialStorage.
çŸ­æš‚çš„sessionä½¿ç”¨ä¸€ä¸ªç§æœ‰å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚sessionå¤±æ•ˆä¼šè‡ªåŠ¨æ¸…é™¤ã€‚
 */
@property (nullable, retain) NSURLCredentialStorage *URLCredentialStorage;

/* 
ç¼“å­˜NSURLRequestçš„responseã€‚
é»˜è®¤çš„configurationï¼Œé»˜è®¤å€¼çš„æ˜¯sharedURLCacheã€‚
åå°çš„configurationï¼Œé»˜è®¤å€¼æ˜¯nil
çŸ­æš‚çš„configurationï¼Œé»˜è®¤ä¸€ä¸ªç§æœ‰çš„cacheäºå†…å­˜ï¼Œsessionå¤±æ•ˆï¼Œcacheè‡ªåŠ¨æ¸…é™¤ã€‚
*/
@property (nullable, retain) NSURLCache *URLCache;

/* Enable extended background idle mode for any tcp sockets created.    Enabling this mode asks the system to keep the socket open
 *  and delay reclaiming it when the process moves to the background (see https://developer.apple.com/library/ios/technotes/tn2277/_index.html) 
 */
@property BOOL shouldUseExtendedBackgroundIdleMode NS_AVAILABLE(10_11, 9_0);

/* 
å¤„ç†NSURLRequestçš„NSURLProtocolçš„å­ç±»ã€‚
é‡è¦:å¯¹åå°Sessionå¤±æ•ˆã€‚
 */
@property (nullable, copy) NSArray&lt;Class&gt; *protocolClasses;

@end
</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚ä½•æ¥åˆ›å»ºä¸€ä¸ªSessionå¯¹è±¡äº†ï¼Œåˆ›å»ºå®ŒSessionå¯¹è±¡ï¼Œæ ¹æ®ä¸€ä¸ªRequestå¯¹è±¡æˆ‘ä»¬å°±å¯ä»¥å‘é€ç½‘ç»œè¯·æ±‚äº†ã€‚ä¸‹é¢çœ‹ä¸€ä¸‹NSURLSessionçš„å¤´æ–‡ä»¶ä¸­çš„è¿™äº›æ–¹æ³•ï¼Œå¦‚å›¾ï¼š</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/NSURLSession1.png?raw=true"><br></div>

<p>ä»è¿™äº›æ–¹æ³•ä¸­å¾—çŸ¥ï¼Œåˆ†åˆ«è¿”å›äº†<code>NSURLSessionDataTask</code>ã€<code>NSURLSessionUploadTask</code>ã€<code>NSURLSessionDownloadTask</code>ï¼Œ<code>NSURLSessionStreamTask</code> è¿™å››ä¸ªç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™å››ä¸ªç±»æ˜¯å¹²ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚</p>
<h3 id="URLSessionTask"><a href="#URLSessionTask" class="headerlink" title="URLSessionTask"></a>URLSessionTask</h3><p>NSURLSessionTaskæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶ä¸‹æœ‰4ä¸ªå®ä½“å­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š<code>NSURLSessionDataTask</code>ã€<code>NSURLSessionUploadTask</code>ã€<code>NSURLSessionDownloadTask</code>ã€<code>NSURLSessionStreamTask</code>ã€‚è¿™å››ä¸ªå­ç±»å°è£…äº†ç°ä»£ç¨‹åºå››ä¸ªæœ€åŸºæœ¬çš„ç½‘ç»œä»»åŠ¡ï¼šè·å–æ•°æ®ï¼Œæ¯”å¦‚JSONæˆ–è€…XMLï¼Œä¸Šä¼ æ–‡ä»¶å’Œä¸‹è½½æ–‡ä»¶è¿˜æœ‰æ•°æ®æµçš„è·å–ã€‚</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/NSURLSessionTask.png?raw=true"><br></div>

<p>NSURLSessionæ¯”NSURLConnectionæœ€æ–¹ä¾¿çš„åœ°æ–¹å°±æ˜¯ä»»åŠ¡å¯ä»¥æš‚åœï¼Œç»§ç»­ã€‚åœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼ŒçœŸæ­£å»æ‰§è¡Œä¸‹è½½æˆ–è€…ä¸Šä¼ ä»»åŠ¡çš„å°±æ˜¯URLSessionTaskï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒå¸¸ç”¨çš„æ–¹æ³•ï¼š</p>
<p><code>- (void)resume;</code> å½“ä½¿ç”¨NSURLSessionåˆ›å»ºä¸€ä¸ªNSURLSessionTaskä»»åŠ¡æ—¶ï¼Œè¦æ‰‹åŠ¨è°ƒç”¨æ­¤æ–¹æ³•ï¼Œä»»åŠ¡æ‰ä¼šå¼€å¯ï¼Œè€ŒNSURLConnectioné»˜è®¤å¼€å¯ã€‚</p>
<p><code>- (void)suspend;</code> æš‚åœä»»åŠ¡æ–¹æ³•ï¼Œæ‰‹åŠ¨è°ƒç”¨ä¼šæš‚åœå½“å‰ä»»åŠ¡ï¼Œå†æ¬¡å¼€å¯æ­¤ä»»åŠ¡æ—¶ï¼Œä¼šä»ç´§æ¥ä¸Šæ¬¡ä»»åŠ¡å¼€å§‹ï¼Œä¼šé¢ä¼šè¯´åˆ°å¦‚ä½•æš‚åœä»»åŠ¡å†å¼€å¯ä»»åŠ¡ã€‚</p>
<p><code>- (void)cancel;</code> å–æ¶ˆä»»åŠ¡ã€‚</p>
<p>NSURLSessionTaskè¿˜æœ‰ä¸ªå±æ€§ï¼Œ<code>@property (readonly) NSURLSessionTaskState state;</code> æ­¤å±æ€§æ ‡è¯†å½“å‰ä»»åŠ¡çš„çŠ¶æ€ï¼Œæšä¸¾ç±»å‹</p>
<pre><code>typedef NS_ENUM(NSInteger, NSURLSessionTaskState) {
    NSURLSessionTaskStateRunning = 0,                     /* æ­£åœ¨æ‰§è¡Œ */
    NSURLSessionTaskStateSuspended = 1,                   /* æš‚åœçŠ¶æ€ */
    NSURLSessionTaskStateCanceling = 2,                   /* å–æ¶ˆçŠ¶æ€*/
    NSURLSessionTaskStateCompleted = 3,                   /* ä»»åŠ¡å®ŒæˆçŠ¶æ€ */
}
</code></pre><p>ä¸Šé¢è¯´åˆ°çš„å››ä¸ªç±»ï¼Œéƒ½ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿NSURLSessionTaskï¼Œæ‰€æœ‰NSURLSessionTaskçš„æ–¹æ³•æˆ–è€…å±æ€§è¿™å››ä¸ªç±»éƒ½æœ‰ï¼Œé‚£ä¹ˆï¼Œç®€å•è¯´ä¸€ä¸‹è¿™å››ä¸ªç±»éƒ½æ˜¯å¹²ä»€ä¹ˆçš„ã€‚</p>
<h4 id="NSURLSessionDataTask"><a href="#NSURLSessionDataTask" class="headerlink" title="NSURLSessionDataTask"></a>NSURLSessionDataTask</h4><p>NSURLSessionDataTaskæ˜¯å¼€å‘ä¸­ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ï¼Œæˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„GETå’ŒPOSTè¯·æ±‚éƒ½æ˜¯é€šè¿‡å®ƒæ¥å®ç°çš„ï¼Œå¦‚æœè¯·æ±‚çš„æ•°æ®ç®€å•å¹¶ä¸”ä¸éœ€è¦å¯¹è·å–çš„æ•°æ®è¿›è¡Œå¤æ‚æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨ Block è§£æè¿”å›çš„æ•°æ®å³å¯ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<h5 id="ç®€å•-Get-è¯·æ±‚"><a href="#ç®€å•-Get-è¯·æ±‚" class="headerlink" title="ç®€å• Get è¯·æ±‚"></a>ç®€å• Get è¯·æ±‚</h5><pre><code>/**
 *  ç®€å• GET è¯·æ±‚
  */
- (void)getWithsharedSession
{
  // è·å–é»˜è®¤ Session
  NSURLSession *session = [NSURLSession sharedSession];
  // åˆ›å»º URL
  NSURL *url = [NSURL URLWithString:@&quot;https://www.baidu.com/s?wd=test&quot;];
  // åˆ›å»ºä»»åŠ¡ task
  NSURLSessionDataTask *task = [session dataTaskWithURL:url completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
    // è·å–æ•°æ®åè§£æå¹¶è¾“å‡º
     NSString *dataStr = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
    NSLog(@&quot;%@&quot;,dataStr);
  }];
  // å¯åŠ¨ä»»åŠ¡
  [task resume];
}
</code></pre><h5 id="ç®€å•-POST-è¯·æ±‚"><a href="#ç®€å•-POST-è¯·æ±‚" class="headerlink" title="ç®€å• POST è¯·æ±‚"></a>ç®€å• POST è¯·æ±‚</h5><pre><code>/**
 *  ç®€å• Post è¯·æ±‚ï¼ŒPOST å’Œ GET è¯·æ±‚åœ¨äºå¯¹ request çš„å¤„ç†ä¸åŒï¼Œå…¶ä½™å’Œ GET ç›¸åŒ
 */
- (void)postWithSharedSession
{
  // è·å–é»˜è®¤ Session
  NSURLSession *session = [NSURLSession sharedSession];
  // åˆ›å»º URL
  NSURL *url = [NSURL URLWithString:@&quot;http://120.25.226.186:32812/login&quot;];
  // åˆ›å»º request
  NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
  // è¯·æ±‚æ–¹æ³•
  request.HTTPMethod = @&quot;POST&quot;;
  // è¯·æ±‚ä½“
  request.HTTPBody = [@&quot;username=1234&amp;pwd=4321&quot; dataUsingEncoding:NSUTF8StringEncoding];
  // åˆ›å»ºä»»åŠ¡ task
  NSURLSessionDataTask *task = [session dataTaskWithRequest:request completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
          // è·å–æ•°æ®åè§£æå¹¶è¾“å‡º
          NSLog(@&quot;%@&quot;,[NSJSONSerialization JSONObjectWithData:data options:kNilOptions error:nil]);
  }];
  // å¯åŠ¨ä»»åŠ¡
  [task resume];
}
</code></pre><p>å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®sessionçš„ä»£ç†æ¥å®æ—¶çš„ç›‘å¬æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨NSURLSessionçš„<code>+ (NSURLSession *)sessionWithConfiguration:(NSURLSessionConfiguration *)configuration;</code>å’Œ<code>+ (NSURLSession *)sessionWithConfiguration:(NSURLSessionConfiguration *)configuration delegate:(nullable id &lt;NSURLSessionDelegate&gt;)delegate delegateQueue:(nullable NSOperationQueue *)queue;</code>è¿™ä¸¤ä¸ªæ–¹æ³•æ¥è®¾ç½®ä»£ç†ï¼Œå…·ä½“çš„åè®®ä¸º<code>NSURLSessionDelegate</code>ï¼Œå®ƒæœ‰å››ä¸ªç›´æ¥æˆ–é—´æ¥å­åè®®<code>NSURLSessionTaskDelegate</code>ï¼Œ<code>NSURLSessionDownloadDelegate</code>å’Œ <code>NSURLSessionStreamDelegate</code>ã€<code>NSURLSessionDataDelegate</code>ã€‚å…·ä½“ä»£ç†æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code>//åˆ›å»ºæœ‰ä»£ç†çš„session
- (void)sessionDataDelegate
{
    // åˆ›å»ºå¸¦æœ‰ä»£ç†æ–¹æ³•çš„è‡ªå®šä¹‰ session
    NSURLSession *session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration] delegate:self delegateQueue:[NSOperationQueue mainQueue]];

    // åˆ›å»ºä»»åŠ¡
    NSURLSessionDataTask *task = [session dataTaskWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@&quot;http://120.25.226.186:32812/login?username=1234&amp;pwd=4321&quot;]]];

    // å¯åŠ¨ä»»åŠ¡
    [task resume];
}

#pragma mark -
#pragma mark - NSURLSessionDelegate

// 1. æ¥æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”
- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveResponse:(NSURLResponse *)response completionHandler:(void (^)(NSURLSessionResponseDisposition))completionHandler
{
    NSLog(@&quot;æ¥æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”&quot;);
    // å¿…é¡»è®¾ç½®å¯¹å“åº”è¿›è¡Œå…è®¸å¤„ç†æ‰ä¼šæ‰§è¡Œåé¢ä¸¤ä¸ªæ“ä½œã€‚
    completionHandler(NSURLSessionResponseAllow);
}

// 2. æ¥æ”¶åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼ˆå¯èƒ½è°ƒç”¨å¤šæ¬¡ï¼‰
- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveData:(NSData *)data {
    // å¤„ç†æ¯æ¬¡æ¥æ”¶çš„æ•°æ®
    NSLog(@&quot;æ¥å—åˆ°æœåŠ¡å™¨çš„æ•°æ®%s&quot;,__func__);
}

// 3. è¯·æ±‚æˆåŠŸæˆ–è€…å¤±è´¥ï¼ˆå¦‚æœå¤±è´¥ï¼Œerroræœ‰å€¼ï¼‰
- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error {
    // è¯·æ±‚å®Œæˆ,æˆåŠŸæˆ–è€…å¤±è´¥çš„å¤„ç†
    NSLog(@&quot;SessionTask %s&quot;,__func__);
}
</code></pre><h4 id="NSURLSessionDownloadTask"><a href="#NSURLSessionDownloadTask" class="headerlink" title="NSURLSessionDownloadTask"></a>NSURLSessionDownloadTask</h4><p>NSURLSessionDownloadTaskåœ¨ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™ï¼Œæ˜¯å°†æ•°æ®ä¸€ç‚¹ç‚¹åœ°å†™å…¥æœ¬åœ°çš„ä¸´æ—¶æ–‡ä»¶ã€‚æ‰€ä»¥åœ¨ completionHandler è¿™ä¸ª block é‡Œï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ–‡ä»¶ä»ä¸€ä¸ªä¸´æ—¶åœ°å€ç§»åŠ¨åˆ°ä¸€ä¸ªæ°¸ä¹…çš„åœ°å€ä¿å­˜èµ·æ¥ï¼š</p>
<pre><code>/**
 *  NSURLSessionDownloadTask ä¸‹è½½ä»»åŠ¡
 */
- (void)downLoad
{
    NSURLSession *session = [NSURLSession sharedSession];
    NSURL *url = [NSURL URLWithString:@&quot;http://120.25.226.186:32812/resources/images/minion_01.png&quot;] ;
    NSURLSessionDownloadTask *task = [session downloadTaskWithURL:url completionHandler:^(NSURL *location, NSURLResponse *response, NSError *error) {
        // location æ˜¯æ²™ç›’ä¸­ tmp æ–‡ä»¶å¤¹ä¸‹çš„ä¸€ä¸ªä¸´æ—¶ urlï¼Œæ–‡ä»¶ä¸‹è½½åä¼šå­˜åˆ°è¿™ä¸ªä½ç½®ï¼Œç”±äº tmp ä¸­çš„æ–‡ä»¶éšæ—¶å¯èƒ½è¢«åˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±éœ€è¦æŠŠä¸‹è½½çš„æ–‡ä»¶æŒªåˆ° Caches æ–‡ä»¶å¤¹ä¸­
        NSString *path = [[NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:response.suggestedFilename];
        // å‰ªåˆ‡æ–‡ä»¶
        [[NSFileManager defaultManager] moveItemAtURL:location toURL:[NSURL fileURLWithPath:path] error:nil];
        NSLog(@&quot;%@&quot;,[NSThread currentThread]);
        //åˆ‡è®°å½“å‰ä¸ºå­çº¿ç¨‹ï¼Œ
        dispatch_async(dispatch_get_main_queue(), ^{
            self.imageView.image = [UIImage imageNamed:path];
        });

    }];
    // å¯åŠ¨ä»»åŠ¡
    [task resume];
}
</code></pre><p>ä»£ç†æ–¹æ³•ä¸‹è½½</p>
<pre><code>/**
 *  NSURLSessionDownloadTask ä»£ç†
 */
- (void)sessionDownloadTaskDelegate
{
  // åˆ›å»ºå¸¦æœ‰ä»£ç†æ–¹æ³•çš„è‡ªå®šä¹‰ session
  NSURLSession *session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration] delegate:self delegateQueue:[NSOperationQueue mainQueue]];

  // åˆ›å»ºä»»åŠ¡
  NSURLSessionDownloadTask *task = [session downloadTaskWithURL:[NSURL URLWithString:@&quot;http://120.25.226.186:32812/resources/images/minion_02.png&quot;]];

  // å¯åŠ¨ä»»åŠ¡
  [task resume];
}
#pragma mark -
#pragma mark -NSURLSessionDownloadDelegate
/**
 *  å†™å…¥ä¸´æ—¶æ–‡ä»¶æ—¶è°ƒç”¨
 *  @param bytesWritten              æœ¬æ¬¡å†™å…¥å¤§å°
 *  @param totalBytesWritten         å·²å†™å…¥æ–‡ä»¶å¤§å°
 *  @param totalBytesExpectedToWrite è¯·æ±‚çš„æ€»æ–‡ä»¶çš„å¤§å°
 */
- (void)URLSession:(NSURLSession *)session downloadTask:(nonnull NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite
{
    //å¯ä»¥ç›‘å¬ä¸‹è½½çš„è¿›åº¦
  CGFloat progress = 1.0 * totalBytesWritten / totalBytesExpectedToWrite;
  NSLog(@&quot;downloadTask %f&quot;,progress);
}

// 2. ä¸‹è½½å®Œæˆè°ƒç”¨
- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location
{
  // location è¿˜æ˜¯ä¸€ä¸ªä¸´æ—¶è·¯å¾„,éœ€è¦è‡ªå·±æŒªåˆ°éœ€è¦çš„è·¯å¾„ï¼ˆcaches æ–‡ä»¶å¤¹ï¼‰
  NSString *filePath = [[NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:downloadTask.response.suggestedFilename];
  [[NSFileManager defaultManager] moveItemAtURL:location toURL:[NSURL fileURLWithPath:filePath] error:nil];
  NSLog(@&quot;downloadTask ç§»åŠ¨æ–‡ä»¶è·¯å¾„&quot;);
}
</code></pre><h5 id="æ–­ç‚¹ç»­ä¼ "><a href="#æ–­ç‚¹ç»­ä¼ " class="headerlink" title="æ–­ç‚¹ç»­ä¼ "></a>æ–­ç‚¹ç»­ä¼ </h5><p>è¯´ä¸€ä¸‹å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„æ–­ç‚¹ç»­ä¼ ã€‚åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”±äºæŸç§åŸå› ï¼Œåœ¨ä¸‹è½½æˆ–ä¸Šä¼ çš„æ—¶å€™å¾€å¾€ä¸èƒ½ä¸€æ¬¡æ€§ä¸‹è½½æˆ–ä¸Šä¼ å®Œï¼Œæœ‰å¯èƒ½ä¸‹è½½æˆ–ä¸Šä¼ äº†ä¸€åŠå°±ç»ˆæ­¢äº†ï¼Œè¿™æ—¶å€™å½“æ¡ä»¶æ»¡è¶³ç»§ç»­ä¸‹è½½æˆ–ä¸Šä¼ æ—¶ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä»å¤´å¼€å§‹ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨æ–­ç‚¹ç»­ä¼ ã€‚å®ƒçš„å¤§æ¦‚æ€è·¯æ˜¯ï¼š</p>
<ul>
<li>æŸç§é™åˆ¶ï¼Œç»­ä¼ æš‚åœ</li>
<li>å°†æš‚åœåæ•°æ®ï¼ˆå½“å‰æ•°æ®ï¼‰ä¿å­˜èµ·æ¥â€“_resumeData = resumeData;</li>
<li>æ¡ä»¶å…è®¸ç»­ä¼ æ—¶ï¼Œä½¿ç”¨resumeDataåˆ›å»ºæ–°çš„NSURLSessionTask</li>
</ul>
<p>ä»£ç ï¼š</p>
<pre><code>- (IBAction)startDowning:(id)sender {


    if (_resumeData) {
        _downloadTask = [_session downloadTaskWithResumeData:_resumeData];
    }else {
        _session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration] delegate:self delegateQueue:nil];
        _request = [[NSURLRequest alloc] initWithURL:[NSURL URLWithString:@&quot;http://image.baidu.com/search/down?tn=download&amp;ipn=dwnl&amp;word=download&amp;ie=utf8&amp;fr=result&amp;url=http%3A%2F%2Fb.zol-img.com.cn%2Fdesk%2Fbizhi%2Fimage%2F6%2F960x600%2F1427787678554.jpg&amp;thumburl=http%3A%2F%2Fimg3.imgtn.bdimg.com%2Fit%2Fu%3D1996019669%2C1779575266%26fm%3D21%26gp%3D0.jpg&quot;]];
        _downloadTask = [_session downloadTaskWithRequest:_request];
    }
    [_downloadTask resume];
}

- (IBAction)stopDowning:(id)sender {
    if (_downloadTask) {
        __weak typeof (self)weakSelf = self;
        [_downloadTask cancelByProducingResumeData:^(NSData * _Nullable resumeData) {
            NSLog(@&quot;%@&quot;,resumeData);
            weakSelf.resumeData = resumeData;
            weakSelf.downloadTask = nil;
        }];
    }
}

#pragma mark -
#pragma mark - NSURLSessionDownloadDelegate

- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask
didFinishDownloadingToURL:(NSURL *)location {
    NSString *path = [[NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:downloadTask.response.suggestedFilename];
    // å‰ªåˆ‡æ–‡ä»¶
    [[NSFileManager defaultManager] moveItemAtURL:location toURL:[NSURL fileURLWithPath:path] error:nil];

    dispatch_async(dispatch_get_main_queue(), ^{
        self.imageView.image = [UIImage imageNamed:path];
    });
}
- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask
      didWriteData:(int64_t)bytesWritten
 totalBytesWritten:(int64_t)totalBytesWritten
totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite {
    CGFloat progress = 1.0 * totalBytesWritten / totalBytesExpectedToWrite;
    NSLog(@&quot;downloadTask %f&quot;,progress);
    dispatch_async(dispatch_get_main_queue(), ^{
        self.progressView.progress = progress;
    });

}
</code></pre><p><strong>æ³¨æ„ï¼š</strong>ä¸Šé¢çš„ä»£ç æ˜¯ä¸ä¼šæ–­ç‚¹ç»­ä¼ çš„ï¼ŒåŸå› æ˜¯è¿™ä¸ªå›¾ç‰‡çš„urlä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œåœ¨æ–­ç‚¹ç»­ä¼ æ—¶ï¼Œè¦å’ŒæœåŠ¡å™¨é…åˆå¥½ã€‚</p>
<h4 id="NSURLSessionUploadTask"><a href="#NSURLSessionUploadTask" class="headerlink" title="NSURLSessionUploadTask"></a>NSURLSessionUploadTask</h4><p>åœ¨ NSURLSession ä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ ä¸»è¦ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š</p>
<pre><code>- (NSURLSessionUploadTask *)uploadTaskWithRequest:(NSURLRequest *)request fromFile:(NSURL *)fileURL;
- (NSURLSessionUploadTask *)uploadTaskWithRequest:(NSURLRequest *)request fromData:(NSData *)bodyData;
</code></pre><p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œè¡¨å•çš„å½¢å¼ä¸Šä¼ æ•°æ®</p>
<pre><code>- (void)upload {
    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@&quot;https://api.weibo.com/2/statuses/public_timeline.json&quot;]];
    //è®¾ç½®HTTPè¯·æ±‚æ–¹å¼  GET / POST
    [request setHTTPMethod:@&quot;POST&quot;];
    //è®¾ç½®è¯·æ±‚å¤´
    NSString *boundary = @&quot;hwg&quot;;
    [request setValue:[NSString stringWithFormat: @&quot;multipart/form-data;%@&quot;, boundary]forHTTPHeaderField:@&quot;Content-type&quot;];
    //è®¾ç½®è¯·æ±‚ä½“
    //è·å–ä¸Šä¼ çš„å›¾ç‰‡çš„data
    NSData *data = [NSData dataWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@&quot;xiaoxin&quot; ofType:@&quot;jpeg&quot;]];
    //æ­¤å¤„æ·»åŠ éœ€è¦çœ‹æ¸…æ¥šå†…å®¹
    NSData *body =  [self httpFormDataBodyWithBoundary:boundary params:@{@&quot;access_token&quot;:@&quot;2.00cYYKWF6EKpiB3883361b1dJiZ4eD&quot;,@&quot;status&quot;:@&quot;å“ˆå“ˆï¼Œè¿™æ˜¯æˆ‘æµ‹è¯•NSURLSessionä¸Šä¼ æ–‡ä»¶çš„å¾®åš&quot;} fieldName:@&quot;pic&quot; fileName:@&quot;pic.png&quot; fileContentType:@&quot;image/png&quot; data:data];
    NSURLSession *session = [NSURLSession sharedSession];
    NSURLSessionUploadTask *upload_task = [session uploadTaskWithRequest:request fromData:body completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
        NSLog(@&quot;upload  success&quot;);
    }];
    //å¿…é¡»è¦ resume
    [upload_task resume];
}

#pragma mark-æ‹¼æ¥è¯·æ±‚ä½“
- (NSData *)httpFormDataBodyWithBoundary:(NSString *)boundary
                                 params:(NSDictionary *)params
                              fieldName:(NSString *)fieldName
                               fileName:(NSString *)fileName
                        fileContentType:(NSString *)fileContentType
                                   data:(NSData *)fileData {

    NSString *preBoundary = [NSString stringWithFormat:@&quot;--%@&quot;,boundary];
    NSString *endBoundary = [NSString stringWithFormat:@&quot;--%@--&quot;,boundary];
    NSMutableString *body = [[NSMutableString alloc] init];
    //éå†
    for (NSString *key in params) {
        //å¾—åˆ°å½“å‰çš„key
        //å¦‚æœkeyä¸æ˜¯å½“å‰çš„picï¼Œè¯´æ˜valueæ˜¯å­—ç¬¦ç±»å‹ï¼Œæ¯”å¦‚nameï¼šBoris
        //æ·»åŠ åˆ†ç•Œçº¿ï¼Œæ¢è¡Œï¼Œå¿…é¡»ä½¿ç”¨\r\n
        [body appendFormat:@&quot;%@\r\n&quot;,preBoundary];
        //æ·»åŠ å­—æ®µåç§°æ¢2è¡Œ
        [body appendFormat:@&quot;Content-Disposition: form-data; name=\&quot;%@\&quot;\r\n\r\n&quot;,key];
        //æ·»åŠ å­—æ®µå€¼
        [body appendFormat:@&quot;%@\r\n&quot;,[params objectForKey:key]];

    }
    //æ·»åŠ åˆ†ç•Œçº¿ï¼Œæ¢è¡Œ
    [body appendFormat:@&quot;%@\r\n&quot;,preBoundary];
    //å£°æ˜picå­—æ®µï¼Œæ–‡ä»¶åä¸ºboris.png
    [body appendFormat:@&quot;Content-Disposition: form-data; name=\&quot;%@\&quot;; filename=\&quot;%@\&quot;\r\n&quot;,fieldName,fileName];
    //å£°æ˜ä¸Šä¼ æ–‡ä»¶çš„æ ¼å¼
    [body appendFormat:@&quot;Content-Type: %@\r\n\r\n&quot;,fileContentType];
    //å£°æ˜ç»“æŸç¬¦
    NSString *endStr = [NSString stringWithFormat:@&quot;\r\n%@&quot;,endBoundary];
    //å£°æ˜myRequestDataï¼Œç”¨æ¥æ”¾å…¥http  body
    NSMutableData *myRequestData = [NSMutableData data];
    //å°†bodyå­—ç¬¦ä¸²è½¬åŒ–ä¸ºUTF8æ ¼å¼çš„äºŒè¿›åˆ¶
    [myRequestData appendData:[body dataUsingEncoding:NSUTF8StringEncoding]];
    //å°†imageçš„dataåŠ å…¥
    [myRequestData appendData:fileData];
    //åŠ å…¥ç»“æŸç¬¦--hwg--
    [myRequestData appendData:[endStr dataUsingEncoding:NSUTF8StringEncoding]];
    return myRequestData;
}
</code></pre><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‹¼æ¥ä¸€ä¸ªè¡¨å•æ•°æ®ï¼Œæ‰èƒ½å¤Ÿä¸Šä¼ æ•°æ®ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä»£ç†æ–¹æ³•æ¥ç›‘å¬ä¸Šä¼ çš„è¿›åº¦</p>
<pre><code>- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task
   didSendBodyData:(int64_t)bytesSent
    totalBytesSent:(int64_t)totalBytesSent
totalBytesExpectedToSend:(int64_t)totalBytesExpectedToSend {
    CGFloat progress = 1.0 * totalBytesSent / bytesSent;
    NSLog(@&quot;downloadTask %f&quot;,progress);
}
</code></pre><h4 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h4><p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»Šå¤©æ€»ç»“çš„ï¼Œå“ªé‡Œæœ‰é—®é¢˜è¿˜å¸Œæœ›å¤§å®¶æå‡ºæ„è§ã€‚å…¶å®åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨åˆ°è¿™äº›ï¼Œå› ä¸ºæ€»æ˜¯æœ‰ä¸€äº›ç‰›äººä¸ºæˆ‘ä»¬å°è£…äº†å„ç§åŠŸèƒ½çš„å¼ºå¤§åº“ï¼Œæ¯”å¦‚ç½‘ç»œç±»ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯AFNetworkingã€‚äººå®¶çš„åº“ä¸ºä»€ä¹ˆå¥½ç”¨ï¼Œè¯´ç™½äº†å°±æ˜¯å„ç§æƒ…å†µéƒ½è€ƒè™‘åˆ°äº†ã€‚æ‰€æœ‰æˆ‘ä»¬è¦å­¦çš„è¿˜æ˜¯äººå®¶çš„ç¼–ç¨‹æ€æƒ³ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šåšä¸€ä¸ªä¸“é¢˜ï¼Œç ”ç©¶ä¸€ä¸‹å„å¤§å¹³å¸¸ä½¿ç”¨åˆ°çš„åº“ï¼Œå®ƒä»¬åˆ°åº•ç‰›åœ¨å“ªé‡Œï¼Œæ•¬è¯·é˜…è¯»ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©å»é¢è¯•ï¼Œè¢«é—®äº†ä¸€é“AFNetworking2.0å’Œ3.0æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå½“æ—¶å¿ƒæƒ³ï¼Œè¿™è°ä¸çŸ¥é“å•Šï¼Œéšå£ç­”åˆ°ï¼š2.0ä½¿ç”¨çš„NSURLConnection,3.0ä½¿ç”¨çš„æ˜¯NSURLSession,äººå®¶åˆé—®NSURLSesstionå’ŒNSURLConnectionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç¬é—´å‚»çœ¼äº†ï¼Œæ”¯æ”¯å¾å¾åªæ˜¯è¯´å‡ºäº†ç¼“å­˜ç­–ç•¥çš„ä¸åŒã€‚äº¡ç¾Šè¡¥ç‰¢ï¼Œä¸ºæ—¶æœªæ™šï¼Œè¿™ç¯‡åšå®¢å°±è®²è§£ä¸€ä¸‹å®ƒä»¬ä¸¤è€…åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="http://www.guiyongdong.com/categories/Objective-C/"/>
    
    
      <category term="NSURLSession" scheme="http://www.guiyongdong.com/tags/NSURLSession/"/>
    
  </entry>
  
  <entry>
    <title>æ’åºç®—æ³•æ€»ç»“</title>
    <link href="http://www.guiyongdong.com/2016/11/15/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93/"/>
    <id>http://www.guiyongdong.com/2016/11/15/æ’åºç®—æ³•æ€»ç»“/</id>
    <published>2016-11-15T03:40:05.000Z</published>
    <updated>2016-11-16T08:26:44.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åå¤§æ’åºç®—æ³•æ¯”è¾ƒå›¾"><a href="#åå¤§æ’åºç®—æ³•æ¯”è¾ƒå›¾" class="headerlink" title="åå¤§æ’åºç®—æ³•æ¯”è¾ƒå›¾"></a>åå¤§æ’åºç®—æ³•æ¯”è¾ƒå›¾</h3><hr>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/15.png?raw=true"><br></div>



<h3 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h3><hr>
<p><strong>ç®—æ³•æè¿°</strong><br><strong>å†’å†’æ³¡æ’åºæ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚</strong></p>
<p><strong>ç®—æ³•å®ç°</strong></p>
<ol>
<li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢å®ƒä»¬ä¸¤ä¸ªï¼›</li>
<li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ï¼Œè¿™æ ·åœ¨æœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ï¼›</li>
<li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼›</li>
<li>é‡å¤æ­¥éª¤1~3ï¼Œç›´åˆ°æ’åºå®Œæˆã€‚</li>
</ol>
<p><strong>ä»£ç ï¼š</strong></p>
<pre><code>- (void)sortBubble:(NSMutableArray *)targetArray {
    BOOL flag = true;  //flag ç”¨æ¥åšæ ‡è®°
    NSInteger num = 0; //æ ‡è®°æ€»æ¯”è¾ƒæ¬¡æ•°
    for (NSInteger i = 0; i &lt; targetArray.count&amp;&amp;flag; i++) { //è‹¥flagä¸ºtrue  åˆ™é€€å‡ºå¾ªç¯
        flag = false;   //åˆå§‹æ˜¯false
        for (NSInteger j = 0; j &lt; targetArray.count - i-1; j++) {
            num++;
            NSLog(@&quot;---%ld&quot;,num);
            if ([targetArray[j] integerValue] &gt; [targetArray[j+1] integerValue]) {
                id temp = targetArray[j];
                targetArray[j] = targetArray[j+1];
                targetArray[j+1] = temp;
                flag = true;
            }
        }
    }
    NSLog(@&quot;%@&quot;,targetArray);
}
</code></pre><a id="more"></a>
<p><strong>æ—¶é—´å¤æ‚åº¦:</strong><br>åˆ†æä¸€ä¸‹å®ƒçš„æ—¶é—´å¤æ‚åº¦ã€‚å½“æœ€å¥½çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¦æ’åºçš„è¡¨æœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯”è¾ƒæ¬¡æ•°ï¼Œæ ¹æ®ä¸Šé¢çš„ä»£ç å¯ä»¥æ¨æ–­å°±æ˜¯n-1æ¬¡çš„æ¯”è¾ƒã€‚æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚å½“æœ€åçš„æƒ…å†µï¼Œå³å¾…æ’åºè¡¨æ˜¯é€†åºçš„æƒ…å†µï¼Œæ­¤æ—¶éœ€è¦æ¯”è¾ƒ:1+2+3+â€¦+(n-1)=n(n-1)/2æ¬¡ï¼Œå› æ­¤æ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n<sup>2</sup>)ã€‚</p>
<p><strong>åŠ¨å›¾æ¼”ç¤ºï¼š</strong></p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/16.gif?raw=true"><br></div>



<h3 id="ç®€å•é€‰æ‹©æ’åº"><a href="#ç®€å•é€‰æ‹©æ’åº" class="headerlink" title="ç®€å•é€‰æ‹©æ’åº"></a>ç®€å•é€‰æ‹©æ’åº</h3><hr>
<p><strong>ç®—æ³•æè¿°</strong><br><strong>é€‰æ‹©æ’åº(Selection-sort)æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†ï¼šé¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</strong></p>
<p><strong>ç®—æ³•å®ç°</strong></p>
<ol>
<li>åˆå§‹çŠ¶æ€ï¼šæ— åºåŒºä¸ºR[1..n]ï¼Œæœ‰åºåŒºä¸ºç©ºï¼›</li>
<li>ç¬¬iè¶Ÿæ’åº(i=1,2,3â€¦n-1)å¼€å§‹æ—¶ï¼Œå½“å‰æœ‰åºåŒºå’Œæ— åºåŒºåˆ†åˆ«ä¸ºR[1..i-1]å’ŒR(i..nï¼‰ã€‚è¯¥è¶Ÿæ’åºä»å½“å‰æ— åºåŒºä¸­-é€‰å‡ºå…³é”®å­—æœ€å°çš„è®°å½• R[k]ï¼Œå°†å®ƒä¸æ— åºåŒºçš„ç¬¬1ä¸ªè®°å½•Räº¤æ¢ï¼Œä½¿R[1..i]å’ŒR[i+1..n)åˆ†åˆ«å˜ä¸ºè®°å½•ä¸ªæ•°å¢åŠ 1ä¸ªçš„æ–°æœ‰åºåŒºå’Œè®°å½•ä¸ªæ•°å‡å°‘1ä¸ªçš„æ–°æ— åºåŒºï¼›</li>
<li>n-1è¶Ÿç»“æŸï¼Œæ•°ç»„æœ‰åºåŒ–äº†ã€‚</li>
</ol>
<p><strong>ä»£ç ï¼š</strong></p>
<pre><code>- (void)sortSimple:(NSMutableArray *)targetArray {
    NSInteger min;
    for (NSInteger i = 0; i &lt; targetArray.count - 1; i++) {
        min = i; //å°†å½“å‰ä¸‹æ ‡å®šä¹‰ä¸ºæœ€å°å€¼ä¸‹æ ‡
        for (NSInteger j = i + 1; j &lt; targetArray.count; j++) {
            if (targetArray[min] &gt; targetArray[j]) { //å¦‚æœæœ‰å°äºå½“å‰æœ€å°å€¼å¾—å…³é”®å­—
                min = j; //å°†æ­¤å…³é”®å­—çš„ä¸‹æ ‡èµ‹å€¼ç»™min
            }
        }
        if (i != min) {  //å¦‚æœminå’Œiä¸ç›¸ç­‰  è¯´æ˜æ‰¾åˆ°æœ€å°å€¼ï¼Œäº¤æ¢
            id temp = targetArray[i];
            targetArray[i] = targetArray[min];
            targetArray[min] = temp;
        }
    }
    NSLog(@&quot;%@&quot;,targetArray);
}
</code></pre><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong><br>ä»ç®€å•é€‰æ‹©æ’åºçš„è¿‡ç¨‹æ¥çœ‹ï¼Œå®ƒæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯äº¤æ¢ç§»åŠ¨æ•°æ®æ¬¡æ•°ç›¸å½“å°‘ï¼Œè¿™æ ·ä¹Ÿå°±èŠ‚çº¦äº†ç›¸åº”çš„æ—¶é—´ã€‚åˆ†æå®ƒçš„æ—¶é—´å¤æ‚åº¦å‘ç°ï¼Œæ— è®ºæœ€å¥½æœ€å·®çš„æƒ…å†µï¼Œå…¶æ¯”è¾ƒæ¬¡æ•°éƒ½æ˜¯ä¸€æ ·çš„å¤šï¼Œç¬¬iè¶Ÿæ’åºéœ€è¦è¿›è¡Œn-iæ¬¡å…³é”®å­—çš„æ¯”è¾ƒï¼Œæ­¤æ—¶éœ€è¦æ¯”è¾ƒn-1+n-2+â€¦+1=n(n-1)/2æ¬¡ã€‚è€Œå¯¹äºäº¤æ¢æ¬¡æ•°è€Œè¨€ï¼Œå½“æœ€å¥½çš„æ—¶å€™ï¼Œäº¤æ¢ä¸º0æ¬¡ï¼Œæœ€å·®çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯åˆå§‹é™åºæ—¶2ï¼Œäº¤æ¢æ¬¡æ•°ä¸ºn-1æ¬¡ï¼ŒåŸºäºæœ€ç»ˆçš„æ’åºæ—¶é—´æ˜¯æ¯”è¾ƒä¸äº¤æ¢çš„æ¬¡æ•°æ€»å’Œï¼Œå› æ­¤ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¾ç„¶ä¸ºO(n<sup>2</sup>)ã€‚</p>
<p><strong>åŠ¨å›¾æ¼”ç¤ºï¼š</strong></p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/17.gif?raw=true"><br></div>


<p>åº”è¯¥è¯´ï¼Œå°½ç®¡ä¸å†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦åŒä¸ºO(n<sup>2</sup>)ï¼Œä½†ç®€å•é€‰æ‹©æ’åºçš„æ€§èƒ½ä¸Šè¿˜æ˜¯è¦ç•¥ä¼˜äºå†’æ³¡æ’åºã€‚</p>
<h3 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h3><hr>
<p><strong>ç®—æ³•æè¿°</strong></p>
<p>æ’å…¥æ’åºï¼ˆInsertion-Sortï¼‰çš„ç®—æ³•æè¿°æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚æ’å…¥æ’åºåœ¨å®ç°ä¸Šï¼Œé€šå¸¸é‡‡ç”¨in-placeæ’åºï¼ˆå³åªéœ€ç”¨åˆ°O(1)çš„é¢å¤–ç©ºé—´çš„æ’åºï¼‰ï¼Œå› è€Œåœ¨ä»åå‘å‰æ‰«æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åå¤æŠŠå·²æ’åºå…ƒç´ é€æ­¥å‘åæŒªä½ï¼Œä¸ºæœ€æ–°å…ƒç´ æä¾›æ’å…¥ç©ºé—´ã€‚</p>
<p><strong>ç®—æ³•å®ç°</strong></p>
<ol>
<li>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åºï¼›</li>
<li>å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼›</li>
<li>å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼›</li>
<li>é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®ï¼›</li>
<li>å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åï¼›</li>
<li>é‡å¤æ­¥éª¤2~5ã€‚</li>
</ol>
<p><strong>ä»£ç ï¼š</strong></p>
<pre><code>- (void)sortInsertion:(NSMutableArray *)targetArray {
    for (NSInteger i = 1; i &lt; targetArray.count; i++) {
        id key = targetArray[i];
        NSInteger j = i - 1;
        while (j &gt;= 0 &amp;&amp; targetArray[j] &gt; key) {
            targetArray[j+1] = targetArray[j];
            j--;
        }
        targetArray[j+1]=key;
    }
    NSLog(@&quot;%@&quot;,targetArray);
}
</code></pre><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p>
<ul>
<li>æœ€ä½³æƒ…å†µï¼šè¾“å…¥æ•°ç»„æŒ‰å‡åºæ’åˆ—ã€‚T(n) = O(n)</li>
<li>æœ€åæƒ…å†µï¼šè¾“å…¥æ•°ç»„æŒ‰é™åºæ’åˆ—ã€‚T(n) = O(n2)</li>
<li>å¹³å‡æƒ…å†µï¼šT(n) = O(n2)</li>
</ul>
<p><strong>åŠ¨å›¾æ¼”ç¤ºï¼š</strong></p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/18.gif?raw=true"><br></div>


<h3 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h3><hr>
<p><strong>ç®—æ³•æè¿°</strong><br>å¸Œå°”æ’åºçš„æ ¸å¿ƒåœ¨äºé—´éš”åºåˆ—çš„è®¾å®šã€‚æ—¢å¯ä»¥æå‰è®¾å®šå¥½é—´éš”åºåˆ—ï¼Œä¹Ÿå¯ä»¥åŠ¨æ€çš„å®šä¹‰é—´éš”åºåˆ—ã€‚</p>
<p><strong>ç®—æ³•å®ç°</strong><br>å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå…·ä½“ç®—æ³•æè¿°ï¼š</p>
<ol>
<li>é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ—t1ï¼Œt2ï¼Œâ€¦ï¼Œtkï¼Œå…¶ä¸­ti&gt;tjï¼Œtk=1ï¼›</li>
<li>æŒ‰å¢é‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œk è¶Ÿæ’åºï¼›</li>
<li>æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸ºm çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚</li>
</ol>
<p><strong>ä»£ç ï¼š</strong></p>
<pre><code>- (void)sortShell:(NSMutableArray *)targetArray {
    NSInteger increment = targetArray.count;
    NSInteger i,j;
    do {
        increment = increment/3+1;//å¢é‡åºåˆ—
        for (i=increment; i&lt;targetArray.count; i++) {
            if ([targetArray[i] integerValue] &lt; [targetArray[i-increment] integerValue]) {
                id temp = targetArray[i];
                for (j=i-increment; j&gt;=0&amp;&amp;[targetArray[j] integerValue] &gt; [temp integerValue]; j-=increment) {
                    targetArray[j+increment] = targetArray[j];
                }
                targetArray[j+increment] = temp;
            }
        }

    } while (increment &gt; 1);

    NSLog(@&quot;%@&quot;,targetArray);
}
</code></pre><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p>
<ul>
<li>æœ€ä½³æƒ…å†µï¼šT(n) = O(nlog2 n)</li>
<li>æœ€åæƒ…å†µï¼šT(n) = O(nlog2 n)</li>
<li>å¹³å‡æƒ…å†µï¼šT(n) =O(nlog n)</li>
</ul>
<p><strong>åŠ¨å›¾æ¼”ç¤ºï¼š</strong></p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/19.jpg?raw=true"><br></div>


<h3 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h3><hr>
<p><strong>ç®—æ³•æè¿°</strong><br>å †æ’åºï¼ˆHeapsortï¼‰æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚</p>
<p><strong>ç®—æ³•å®ç°</strong></p>
<ul>
<li>å°†åˆå§‹å¾…æ’åºå…³é”®å­—åºåˆ—(R1,R2â€¦.Rn)æ„å»ºæˆå¤§é¡¶å †ï¼Œæ­¤å †ä¸ºåˆå§‹çš„æ— åºåŒºï¼›</li>
<li>å°†å †é¡¶å…ƒç´ R[1]ä¸æœ€åä¸€ä¸ªå…ƒç´ R[n]äº¤æ¢ï¼Œæ­¤æ—¶å¾—åˆ°æ–°çš„æ— åºåŒº(R1,R2,â€¦â€¦Rn-1)å’Œæ–°çš„æœ‰åºåŒº(Rn),ä¸”æ»¡è¶³R[1,2â€¦n-1]&lt;=R[n]ï¼›</li>
<li>ç”±äºäº¤æ¢åæ–°çš„å †é¡¶R[1]å¯èƒ½è¿åå †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦å¯¹å½“å‰æ— åºåŒº(R1,R2,â€¦â€¦Rn-1)è°ƒæ•´ä¸ºæ–°å †ï¼Œç„¶åå†æ¬¡å°†R[1]ä¸æ— åºåŒºæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œå¾—åˆ°æ–°çš„æ— åºåŒº(R1,R2â€¦.Rn-2)å’Œæ–°çš„æœ‰åºåŒº(Rn-1,Rn)ã€‚ä¸æ–­é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°æœ‰åºåŒºçš„å…ƒç´ ä¸ªæ•°ä¸ºn-1ï¼Œåˆ™æ•´ä¸ªæ’åºè¿‡ç¨‹å®Œæˆã€‚</li>
</ul>
<p><strong>ä»£ç ï¼š</strong></p>
<pre><code>- (void)sortHeap:(NSMutableArray *)targetArray {
    NSInteger heapSize = targetArray.count;
    id temp;
    //å»ºå †
    for (NSInteger i = heapSize/2-1; i&gt;=0; i--) {
        [self heapify:targetArray index:i lenght:heapSize];
    }
    //å †æ’åº
    for (NSInteger j = heapSize-1; j &gt;= 1; j--) {
        temp = targetArray[0];
        targetArray[0] = targetArray[j];
        targetArray[j] = temp;
        [self heapify:targetArray index:0 lenght:--heapSize];
    }
    NSLog(@&quot;%@&quot;,targetArray);
}

- (void)heapify:(NSMutableArray *)targetArray index:(NSInteger)x lenght:(NSInteger)len {
    NSInteger l=2*x+1,r=2*x+2,largest=x;
    id temp;
    if (l &lt; len &amp;&amp; [targetArray[l] integerValue] &gt; [targetArray[largest] integerValue]) {
        largest = l;
    }
    if (r &lt; len &amp;&amp; [targetArray[r] integerValue] &gt; [targetArray[largest] integerValue]) {
        largest = r;
    }
    if (largest != x) {
        temp = targetArray[x];
        targetArray[x] = targetArray[largest];
        targetArray[largest] = temp;
        [self heapify:targetArray index:largest lenght:len];
    }
}
</code></pre><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p>
<ul>
<li>æœ€ä½³æƒ…å†µï¼šT(n) = O(nlogn)</li>
<li>æœ€å·®æƒ…å†µï¼šT(n) = O(nlogn)</li>
<li>å¹³å‡æƒ…å†µï¼šT(n) = O(nlogn)</li>
</ul>
<p><strong>åŠ¨å›¾æ¼”ç¤ºï¼š</strong></p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/20.gif?raw=true"><br></div>


<h3 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h3><hr>
<p><strong>ç®—æ³•æè¿°</strong><br>å½’å¹¶æ’åºæ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å½’å¹¶æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸º2-è·¯å½’å¹¶ã€‚</p>
<p><strong>ç®—æ³•å®ç°</strong></p>
<ul>
<li>æŠŠé•¿åº¦ä¸ºnçš„è¾“å…¥åºåˆ—åˆ†æˆä¸¤ä¸ªé•¿åº¦ä¸ºn/2çš„å­åºåˆ—ï¼›</li>
<li>å¯¹è¿™ä¸¤ä¸ªå­åºåˆ—åˆ†åˆ«é‡‡ç”¨å½’å¹¶æ’åºï¼›</li>
<li>å°†ä¸¤ä¸ªæ’åºå¥½çš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„æ’åºåºåˆ—ã€‚</li>
</ul>
<p><strong>ä»£ç ï¼š</strong></p>
<pre><code>- (NSMutableArray *)sortMerge:(NSMutableArray *)targetArray {
    NSInteger len = targetArray.count;
    NSInteger middle = len/2;
    if (len &lt; 2) {
        return targetArray;
    }
    NSMutableArray *leftArray = [NSMutableArray arrayWithArray:[targetArray subarrayWithRange:NSMakeRange(0, middle)]];
    NSMutableArray *rightArray = [NSMutableArray arrayWithArray:[targetArray subarrayWithRange:NSMakeRange(middle, len-middle)]];
    NSMutableArray *array = [self merge:[self sortMerge:leftArray] right:[self sortMerge:rightArray]];
    NSLog(@&quot;%@&quot;,array);
    return array;

}

- (NSMutableArray *)merge:(NSMutableArray *)leftArray right:(NSMutableArray *)rightArray {
    NSMutableArray *resultArray = [NSMutableArray array];
    while (leftArray.count &amp;&amp; rightArray.count) {
        if ([leftArray[0] integerValue] &lt;= [rightArray[0] integerValue]) {
            [resultArray addObject:leftArray[0]];
            [leftArray removeObjectAtIndex:0];
        }else {
            [resultArray addObject:rightArray[0]];
            [rightArray removeObjectAtIndex:0];
        }
    }
    while (leftArray.count) {
        [resultArray addObject:leftArray[0]];
        [leftArray removeObjectAtIndex:0];
    }
    while (rightArray.count) {
        [resultArray addObject:rightArray[0]];
        [rightArray removeObjectAtIndex:0];
    }

    return resultArray;
}
</code></pre><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p>
<ul>
<li>æœ€ä½³æƒ…å†µï¼šT(n) = O(n)</li>
<li>æœ€å·®æƒ…å†µï¼šT(n) = O(nlogn)</li>
<li>å¹³å‡æƒ…å†µï¼šT(n) = O(nlogn)</li>
</ul>
<p><strong>åŠ¨å›¾æ¼”ç¤ºï¼š</strong></p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/21.gif?raw=true"><br></div>


<h3 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h3><hr>
<p><strong>ç®—æ³•æè¿°</strong><br>å¿«é€Ÿæ’åºçš„åŸºæœ¬æ€æƒ³ï¼šé€šè¿‡ä¸€è¶Ÿæ’åºå°†å¾…æ’è®°å½•åˆ†éš”æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…³é”®å­—å‡æ¯”å¦ä¸€éƒ¨åˆ†çš„å…³é”®å­—å°ï¼Œåˆ™å¯åˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è®°å½•ç»§ç»­è¿›è¡Œæ’åºï¼Œä»¥è¾¾åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚</p>
<p><strong>ç®—æ³•å®ç°</strong><br>å¿«é€Ÿæ’åºä½¿ç”¨åˆ†æ²»æ³•æ¥æŠŠä¸€ä¸ªä¸²ï¼ˆlistï¼‰åˆ†ä¸ºä¸¤ä¸ªå­ä¸²ï¼ˆsub-listsï¼‰ã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰ï¼›</li>
<li>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œï¼›</li>
<li>é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚</li>
</ul>
<p><strong>ä»£ç ï¼š</strong></p>
<pre><code>- (void)sortQuick:(NSMutableArray *)targetArray {
    [self quick:targetArray left:0 right:targetArray.count-1];
    NSLog(@&quot;%@&quot;,targetArray);
}

- (void)quick:(NSMutableArray *)targetArray left:(NSInteger)left right:(NSInteger)right {
    NSInteger pivot;
    if (left &lt; right) {
        pivot = [self partition:targetArray left:left right:right];
        [self quick:targetArray left:left right:pivot-1];
        [self quick:targetArray left:pivot+1 right:right];
    }
}

- (NSInteger)partition:(NSMutableArray *)targetArray left:(NSInteger)left right:(NSInteger)right {
    id pivotKey = targetArray[left];
    id temp;
    while (left &lt; right) {
        while (left &lt; right &amp;&amp; [targetArray[right] integerValue] &gt; [pivotKey integerValue]) {
            right--;
        }
        temp = targetArray[left];
        targetArray[left] = targetArray[right];
        targetArray[right] = temp;
        while (left &lt; right &amp;&amp; [targetArray[left] integerValue] &lt;= [pivotKey integerValue]) {
            left++;
        }
        temp = targetArray[left];
        targetArray[left] = targetArray[right];
        targetArray[right] = temp;
    }

    return left;
}
</code></pre><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p>
<ul>
<li>æœ€ä½³æƒ…å†µï¼šT(n) = O(nlogn)</li>
<li>æœ€å·®æƒ…å†µï¼šT(n) = O(n2)</li>
<li>å¹³å‡æƒ…å†µï¼šT(n) = O(nlogn)</li>
</ul>
<p><strong>åŠ¨å›¾æ¼”ç¤ºï¼š</strong></p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/22.gif?raw=true"><br></div>














]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;åå¤§æ’åºç®—æ³•æ¯”è¾ƒå›¾&quot;&gt;&lt;a href=&quot;#åå¤§æ’åºç®—æ³•æ¯”è¾ƒå›¾&quot; class=&quot;headerlink&quot; title=&quot;åå¤§æ’åºç®—æ³•æ¯”è¾ƒå›¾&quot;&gt;&lt;/a&gt;åå¤§æ’åºç®—æ³•æ¯”è¾ƒå›¾&lt;/h3&gt;&lt;hr&gt;
&lt;div align=center&gt;&lt;br&gt;&lt;img src=&quot;https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/15.png?raw=true&quot; /&gt;&lt;br&gt;&lt;/div&gt;



&lt;h3 id=&quot;å†’æ³¡æ’åº&quot;&gt;&lt;a href=&quot;#å†’æ³¡æ’åº&quot; class=&quot;headerlink&quot; title=&quot;å†’æ³¡æ’åº&quot;&gt;&lt;/a&gt;å†’æ³¡æ’åº&lt;/h3&gt;&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;ç®—æ³•æè¿°&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;å†’å†’æ³¡æ’åºæ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç®—æ³•å®ç°&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢å®ƒä»¬ä¸¤ä¸ªï¼›&lt;/li&gt;
&lt;li&gt;å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ï¼Œè¿™æ ·åœ¨æœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ï¼›&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼›&lt;/li&gt;
&lt;li&gt;é‡å¤æ­¥éª¤1~3ï¼Œç›´åˆ°æ’åºå®Œæˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- (void)sortBubble:(NSMutableArray *)targetArray {
    BOOL flag = true;  //flag ç”¨æ¥åšæ ‡è®°
    NSInteger num = 0; //æ ‡è®°æ€»æ¯”è¾ƒæ¬¡æ•°
    for (NSInteger i = 0; i &amp;lt; targetArray.count&amp;amp;&amp;amp;flag; i++) { //è‹¥flagä¸ºtrue  åˆ™é€€å‡ºå¾ªç¯
        flag = false;   //åˆå§‹æ˜¯false
        for (NSInteger j = 0; j &amp;lt; targetArray.count - i-1; j++) {
            num++;
            NSLog(@&amp;quot;---%ld&amp;quot;,num);
            if ([targetArray[j] integerValue] &amp;gt; [targetArray[j+1] integerValue]) {
                id temp = targetArray[j];
                targetArray[j] = targetArray[j+1];
                targetArray[j+1] = temp;
                flag = true;
            }
        }
    }
    NSLog(@&amp;quot;%@&amp;quot;,targetArray);
}
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://www.guiyongdong.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="æ’åº" scheme="http://www.guiyongdong.com/tags/%E6%8E%92%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>æŸ¥æ‰¾ç®—æ³•ä¹‹çº¿æ€§ç´¢å¼•æŸ¥æ‰¾æ³•</title>
    <link href="http://www.guiyongdong.com/2016/11/14/%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BA%BF%E6%80%A7%E7%B4%A2%E5%BC%95%E6%9F%A5%E6%89%BE%E6%B3%95/"/>
    <id>http://www.guiyongdong.com/2016/11/14/æŸ¥æ‰¾ç®—æ³•ä¹‹çº¿æ€§ç´¢å¼•æŸ¥æ‰¾æ³•/</id>
    <published>2016-11-14T07:28:07.000Z</published>
    <updated>2016-11-15T03:42:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°æ®ç»“æ„çš„æœ€ç»ˆç›®çš„æ˜¯æé«˜æ•°æ®çš„å¤„ç†é€Ÿåº¦ï¼Œç´¢å¼•æ˜¯ä¸ºäº†åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦è€Œè®¾è®¡çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œ<strong>ç´¢å¼•å°±æ˜¯æŠŠä¸€ä¸ªå…³é”®å­—ä¸å®ƒå¯¹åº”çš„è®°å½•ç›¸å…³è”çš„è¿‡ç¨‹ï¼Œ</strong>ä¸€ä¸ªç´¢å¼•ç”±è‹¥å¹²ä¸ªç´¢å¼•é¡¹æ„æˆï¼Œæ¯ä¸ªç´¢å¼•é¡¹è‡³å°‘åŒ…å«å…³é”®å­—å’Œå…¶å¯¹åº”çš„è®°å½•åœ¨å­˜å‚¨å™¨ä¸­çš„ä½ç½®ç­‰ä¿¡æ¯ã€‚ç´¢å¼•æŠ€æœ¯æ˜¯ç»„ç»‡å¤§å‹æ•°æ®åº“ä»¥åŠç£ç›˜æ–‡ä»¶çš„ä¸€ç§é‡è¦æŠ€æœ¯ã€‚</p>
<p>ç´¢å¼•æŒ‰ç…§ç»“æ„å¯ä»¥åˆ†ä¸ºçº¿æ€§ç´¢å¼•ã€æ ‘å½¢ç´¢å¼•å’Œå¤šçº§ç´¢å¼•ã€‚è¿™é‡Œåªä»‹ç»çº¿æ€§ç´¢å¼•æŠ€æœ¯ã€‚<strong>æ‰€è°“çº¿æ€§ç´¢å¼•å°±æ˜¯å°†ç´¢å¼•é¡¹é›†åˆç»„ç»‡ä¸ºçº¿æ€§ç»“æ„ï¼Œä¹Ÿç§°ä¸ºç´¢å¼•è¡¨ã€‚</strong>è¿™é‡Œä»‹ç»ä¸‰ç§çº¿æ€§ç´¢å¼•ï¼š<strong>ç¨ å¯†ç´¢å¼•ã€åˆ†å—ç´¢å¼•ã€å€’æ’ç´¢å¼•ã€‚</strong></p>
<a id="more"></a>
<h3 id="ç¨ å¯†ç´¢å¼•"><a href="#ç¨ å¯†ç´¢å¼•" class="headerlink" title="ç¨ å¯†ç´¢å¼•"></a>ç¨ å¯†ç´¢å¼•</h3><hr>
<p><strong>ç¨ å¯†ç´¢å¼•æ˜¯æŒ‡åœ¨çº¿æ€§ç´¢å¼•ä¸­ï¼Œå°†æ•°æ®é›†ä¸­çš„æ¯ä¸€ä¸ªè®°å½•å¯¹åº”ä¸€ä¸ªç´¢å¼•é¡¹ã€‚</strong></p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/11.png?raw=true"><br></div>

<p><strong>å¯¹äºç¨ å¯†ç´¢å¼•è¿™ä¸ªç´¢å¼•è¡¨æ¥è¯´ï¼Œç´¢å¼•é¡¹ä¸€å®šæ˜¯æŒ‰ç…§å…³é”®ç æœ‰åºçš„æ’åˆ—</strong></p>
<p>ç´¢å¼•é¡¹ä¹Ÿæœ‰åºä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬è¦æŸ¥æ‰¾å…³é”®å­—æ—¶ï¼Œå¯ä»¥ç”¨åˆ°æŠ˜åŠï¼Œæ’å€¼ï¼Œæ–æ³¢é‚£å¥‘ç­‰æœ‰åºæŸ¥æ‰¾ç®—æ³•ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚æ¯”å¦‚ä¸Šå›¾ï¼Œæˆ‘è¦æŸ¥æ‰¾å…³é”®å­—æ˜¯18çš„è®°å½•ï¼Œå¦‚æœç›´æ¥ä»å³ä¾§çš„æ•°æ®è¡¨ä¸­æŸ¥æ‰¾ï¼Œé‚£åªèƒ½é¡ºåºæŸ¥æ‰¾ï¼Œéœ€è¦æŸ¥æ‰¾6æ¬¡æ‰å¯ä»¥æŸ¥åˆ°ç»“æœã€‚è€Œå¦‚æœæ˜¯ä»å·¦ä¾§çš„ç´¢å¼•è¡¨ä¸­æŸ¥æ‰¾ï¼Œåªéœ€ä¸¤ä¾§æŠ˜åŠæŸ¥æ‰¾å°±å¯ä»¥å¾—åˆ°18å¯¹åº”çš„æŒ‡é’ˆï¼Œæœ€ç»ˆæŸ¥æ‰¾åˆ°ç»“æœã€‚</p>
<p>è¿™æ˜¾ç„¶æ˜¯ç¨ å¯†ç´¢å¼•ä¼˜ç‚¹ï¼Œåˆ°æ—¶å¦‚æœæ•°æ®é›†éå¸¸å¤§ï¼Œæ¯”å¦‚ä¸Šäº¿ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€ç´¢å¼•ä¹Ÿå¾—åŒæ ·çš„æ•°æ®é›†é•¿åº¦è§„æ¨¡ï¼Œå¯¹äºå†…å­˜æœ‰é™çš„è®¡ç®—æœºæ¥è¯´ ï¼Œå¯èƒ½å°±éœ€è¦åå¤å»è®¿é—®ç£ç›˜ï¼ŒæŸ¥æ‰¾æ€§èƒ½åè€Œå¤§å¤§ä¸‹é™äº†ã€‚</p>
<h3 id="åˆ†å—ç´¢å¼•"><a href="#åˆ†å—ç´¢å¼•" class="headerlink" title="åˆ†å—ç´¢å¼•"></a>åˆ†å—ç´¢å¼•</h3><hr>
<p>ç¨ å¯†ç´¢å¼•å› ä¸ºç´¢å¼•é¡¹ä¸æ•°æ®é›†çš„è®°å½•ä¸ªæ•°ç›¸åŒï¼Œæ‰€ä»¥ç©ºé—´ä»£ä»·å¾ˆå¤§ï¼Œä¸ºäº†å‡å°‘ç´¢å¼•é¡¹çš„ä¸ªæ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®é›†è¿›è¡Œåˆ†å—ï¼Œä½¿å…¶åˆ†å—æœ‰åºï¼Œç„¶åå†å¯¹æ¯ä¸€å—å»ºç«‹ç´¢å¼•é¡¹ï¼Œä»è€Œå‡å°‘ç´¢å¼•é¡¹çš„ä¸ªæ•°ã€‚</p>
<p><strong>åˆ†å—æœ‰åºï¼Œæ˜¯æŠŠæ•°æ®é›†çš„è®°å½•åˆ†æˆäº†è‹¥å¹²å—ï¼Œå¹¶ä¸”è¿™äº›å¿«éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</strong></p>
<ul>
<li><strong>å—å†…æ— åºï¼Œ</strong>å³æ¯ä¸€å—å†…çš„è®°å½•ä¸è¦æ±‚æœ‰åºï¼Œå½“ç„¶ï¼Œå¦‚æœå—å†…è®°å½•æœ‰åºæ›´ç†æƒ³ï¼Œä¸è¿‡å—å†…æœ‰åºéœ€è¦å¤§é‡æ—¶é—´å’Œç©ºé—´çš„ä»£ä»·ï¼Œé€šå¸¸è¦æ±‚å¿«å†…æ— åºã€‚</li>
<li><strong>å—é—´æœ‰åº,</strong>ä¾‹å¦‚ï¼Œè¦æ±‚ç¬¬äºŒå—æ‰€æœ‰è®°å½•çš„å…³é”®å­—å‡è¦å¤§äºç¬¬ä¸€å—ä¸­æ‰€æœ‰è®°å½•çš„å…³é”®å­—ï¼Œç¬¬ä¸‰å—çš„æ‰€æœ‰è®°å½•çš„å…³é”®å­—å‡è¦å¤§äºç¬¬äºŒå—çš„æ‰€æœ‰è®°å½•å…³é”®å­—â€¦â€¦å› ä¸ºåªæœ‰å—é—´æœ‰åºï¼Œæ‰æœ‰å¯èƒ½åœ¨æŸ¥æ‰¾æ—¶å¸¦æ¥æ•ˆç‡ã€‚</li>
</ul>
<p><strong>å¯¹äºåˆ†å—æœ‰åºçš„æ•°æ®é›†ï¼Œå°†æ¯å—å¯¹åº”ä¸€ä¸ªç´¢å¼•é¡¹ï¼Œè¿™ç§ç´¢å¼•æ–¹æ³•å«åšåˆ†å—ç´¢å¼•</strong></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œå®šä¹‰çš„åˆ†å—ç´¢å¼•çš„ç´¢å¼•é¡¹ç»“æ„åˆ†ä¸‰ä¸ªæ•°æ®é¡¹ï¼š</p>
<ul>
<li>æœ€å¤§å…³é”®ç ï¼Œå®ƒå­˜å‚¨æ¯ä¸€å—ä¸­çš„æœ€å¤§å…³é”®å­—ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯å¯ä»¥ä½¿å¾—åœ¨å®ƒä¹‹åçš„ä¸‹ä¸€å—ä¸­çš„æœ€å°å…³é”®å­—ä¹Ÿèƒ½æ¯”è¿™ä¸€å—çš„æœ€å¤§å…³é”®å­—è¦å¤§;</li>
<li>å­˜å‚¨äº†å—ä¸­çš„è®°å½•ä¸ªæ•°ï¼Œä»¥ä¾¿äºå¾ªç¯æ—¶ä½¿ç”¨;</li>
<li>ç”¨äºæŒ‡å‘å—é¦–æ•°æ®å…ƒç´ çš„æŒ‡é’ˆï¼Œä¾¿äºå¼€å§‹å¯¹è¿™ä¸€å—ä¸­è®°å½•è¿›è¡Œéå†ã€‚</li>
</ul>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/12.png?raw=true"><br></div>

<p>åœ¨åˆ†å—ç´¢å¼•è¡¨ä¸­æŸ¥æ‰¾ï¼Œå°±æ˜¯åˆ†ä¸¤æ­¥è¿›è¡Œï¼š</p>
<ol>
<li>åœ¨åˆ†å—ç´¢å¼•è¡¨ä¸­æŸ¥æ‰¾å…³é”®å­—æ‰€åœ¨çš„å—ã€‚ç”±äºåˆ†å—ç´¢å¼•è¡¨æ˜¯å¿«é—´æœ‰åºçš„ï¼Œå› æ­¤å¾ˆå®¹æ˜“åˆ©ç”¨æŠ˜åŠï¼Œæ’å€¼ç­‰ç®—æ³•å¾—åˆ°ç»“æœã€‚</li>
<li>æ ¹æ®å—é¦–æŒ‡é’ˆæ‰¾åˆ°ç›¸åº”çš„å—ï¼Œå¹¶åœ¨å—ä¸­é¡ºåºæŸ¥æ‰¾å…³é”®ç ã€‚å› ä¸ºå—ä¸­å¯ä»¥æ˜¯æ— åºçš„ï¼Œå› æ­¤åªèƒ½é¡ºåºæŸ¥æ‰¾ã€‚</li>
</ol>
<p>åˆ†å—ç´¢å¼•çš„æ—¶é—´å¤æ‚åº¦ï¼š<br>è®¾nä¸ªè®°å½•çš„æ•°æ®é›†è¢«å¹³åˆ†æˆmå—ï¼Œæ¯å—ä¸­æœ‰tæ¡è®°å½•ï¼Œæ˜¾ç„¶n=mÃ—t,æˆ–è€…è¯´m=n/tã€‚å†å‡è®¾L<sub>b</sub>ä¸ºæŸ¥æ‰¾ç´¢å¼•è¡¨çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ï¼Œå› æœ€å¥½ä¸æœ€å·®çš„ç­‰æ¦‚ç‡åŸåˆ™ï¼Œæ‰€ä»¥L<sub>b</sub>çš„å¹³å‡é•¿åº¦ä¸º(m+1)/2ã€‚L<sub>w</sub>ä¸ºå—ä¸­æŸ¥æ‰¾è®°å½•çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ï¼ŒåŒç†å¯çŸ¥å®ƒçš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸º(t+1)/2ã€‚è¿™æ ·åˆ†å—ç´¢å¼•æŸ¥æ‰¾çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸º:</p>
<div align="center"><br>ASL<sub>w</sub>=L<sub>b</sub>+L<sub>w</sub>=(m+1)/2+(t+1)/2=(1/2)*((n/t)+t)+1<br></div>

<p>æ³¨æ„ä¸Šé¢è¿™ä¸ªå¼å­çš„æ¨å¯¼æ˜¯ä¸ºäº†è®©æ•´ä¸ªåˆ†å—ç´¢å¼•æŸ¥æ‰¾é•¿åº¦ä¾èµ–nå’Œtä¸¤ä¸ªå˜é‡ã€‚ä»è¿™é‡Œæˆ‘ä»¬å¾—åˆ°ï¼Œå¹³å‡é•¿åº¦ä¸ä»…ä»…å–å†³äºæ•°æ®é›†çš„æ€»è®°å½•æ•°nï¼Œè¿˜å’Œæ¯ä¸€ä¸ªå—çš„è®°å½•æ•°tæœ‰å…³ï¼Œæœ€ä½³çš„æƒ…å†µå°±æ˜¯åˆ†çš„å—æ•°må’Œå—ä¸­çš„è®°å½•æ•°tç›¸åŒï¼Œæ­¤æ—¶æ„å‘³ç€n=mÃ—t=t<sup>2</sup>,å³ASL<sub>w</sub>=(1/2)*((n/t)+t)+1=&radic;n+1</p>
<p>å¯è§ï¼Œåˆ†å—ç´¢å¼•çš„æ•ˆç‡æ¯”ä¹‹é¡ºåºæŸ¥æ‰¾çš„O(n)æ˜¯é«˜äº†ä¸å°‘ã€‚ä¸è¿‡æ˜¾ç„¶å®ƒä¸æŠ˜åŠæŸ¥æ‰¾çš„O(logn)ç›¸æ¯”è¿˜æ˜¯æœ‰ä¸å°çš„å·®è·ï¼Œå› æ­¤åœ¨ç¡®å®šæ‰€åœ¨å—çš„è¿‡ç¨‹ä¸­ï¼Œç”±äºå—é—´æœ‰åºï¼Œæ‰€ä»¥å¯ä»¥åº”ç”¨æŠ˜åŠï¼Œæ’å€¼ç­‰æ‰‹æ®µæ¥æé«˜æ•ˆç‡ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œåˆ†å—ç´¢å¼•åœ¨å…¼é¡¾äº†å¯¹ç»†åˆ†å—ä¸éœ€è¦æœ‰åºçš„æƒ…å†µä¸‹ï¼Œå¤§å¤§å¢åŠ äº†æ•´ä½“æŸ¥æ‰¾çš„é€Ÿåº¦ï¼Œæ‰€ä»¥æ™®éè¢«ç”¨äºæ•°æ®è¡¨æŸ¥æ‰¾ç­‰æŠ€æœ¯çš„åº”ç”¨ä¸­ã€‚</p>
<h3 id="å€’æ’ç´¢å¼•"><a href="#å€’æ’ç´¢å¼•" class="headerlink" title="å€’æ’ç´¢å¼•"></a>å€’æ’ç´¢å¼•</h3><hr>
<p>åœ¨æˆ‘ä»¬ä½¿ç”¨ç™¾åº¦æˆ–è€…è°·æ­Œæœç´¢çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬è¾“å…¥æŸä¸ªä¿¡æ¯ï¼Œæœç´¢å¼•æ“éƒ½ä¼šåœ¨çŸ­æ—¶é—´å†…ç»™æˆ‘ä»¬ä¸€äº›ç»“æœï¼Œå¦‚å›¾ï¼Œå®ƒæ˜¯ç”¨åˆ°ä»€ä¹ˆç®—æ³•æŠ€æœ¯å®ç°çš„é«˜æ•ˆæŸ¥æ‰¾å‘¢ï¼Ÿ</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/13.png?raw=true"><br></div>

<p>è¿™é‡Œç®€å•ä»‹ç»ï¼Œä¹Ÿç®—æ˜¯æœ€åŸºç¡€çš„æœç´¢æŠ€æœ¯â€”â€”å€’æ’ç´¢å¼•ã€‚<br>å½“ç„¶ï¼Œæœç´¢å¼•æ“æ‰€ä½¿ç”¨åˆ°çš„ç®—æ³•ç»å¯¹æ¯”è¿™å¤æ‚çš„å¤šã€‚<br>ä¾‹å¦‚æˆ‘ä»¬çœ‹å¦‚ä¸‹ä¸¤å¥è¯ï¼š</p>
<ol>
<li>Books and friends should be few but good</li>
<li>A good book is a good friend</li>
</ol>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†å•è¯åšäº†æ’åºï¼Œä¹Ÿå°±æ˜¯è¡¨æ ¼æ˜¾ç¤ºäº†æ¯ä¸ªä¸åŒçš„å•è¯åˆ†åˆ«å‡ºç°åœ¨å“ªç¯‡æ–‡ç« ä¸­ã€‚</p>
<div align="center"><br><img src="https://github.com/guiyongdong/Resource/blob/master/hexoImage/miscellaneous/14.png?raw=true"><br></div>

<p>æœ‰äº†è¿™å¼ è¡¨ï¼Œæˆ‘ä»¬åœ¨æŸ¥æ¯ä¸ªå•è¯æ—¶éƒ½èƒ½å¾ˆå¿«çš„æŸ¥æ‰¾åˆ°è¿™ä¸ªå•è¯åœ¨å“ªç¯‡æ–‡ç« ã€‚<br>åœ¨è¿™é‡Œè¿™å¼ å•è¯è¡¨å°±æ˜¯ç´¢å¼•è¡¨ï¼Œç´¢å¼•é¡¹çš„é€šç”¨ç»“æ„æ˜¯ï¼š</p>
<ul>
<li>æ¬¡å…³é”®ç ï¼Œä¾‹å¦‚ä¸Šè¡¨ä¸­çš„â€œè‹±æ–‡å•è¯â€</li>
<li>è®°å½•å·è¡¨ï¼Œä¾‹å¦‚ä¸Šè¡¨ä¸­çš„â€œæ–‡ç« ç¼–å·â€</li>
</ul>
<p>å…¶ä¸­è®°å½•å·è¡¨å­˜å‚¨å…·æœ‰ç›¸åŒæ¬¡å…³é”®å­—çš„æ‰€æœ‰è®°å½•çš„è®°å½•å·ï¼ˆå¯ä»¥æ˜¯æŒ‡å‘è®°å½•çš„æŒ‡é’ˆæˆ–è€…æ˜¯è¯¥è®°å½•çš„ä¸»å…³é”®å­—ï¼‰ã€‚è¿™æ ·çš„ç´¢å¼•æ–¹æ³•å°±æ˜¯å€’æ’ç´¢å¼•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ•°æ®ç»“æ„çš„æœ€ç»ˆç›®çš„æ˜¯æé«˜æ•°æ®çš„å¤„ç†é€Ÿåº¦ï¼Œç´¢å¼•æ˜¯ä¸ºäº†åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦è€Œè®¾è®¡çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œ&lt;strong&gt;ç´¢å¼•å°±æ˜¯æŠŠä¸€ä¸ªå…³é”®å­—ä¸å®ƒå¯¹åº”çš„è®°å½•ç›¸å…³è”çš„è¿‡ç¨‹ï¼Œ&lt;/strong&gt;ä¸€ä¸ªç´¢å¼•ç”±è‹¥å¹²ä¸ªç´¢å¼•é¡¹æ„æˆï¼Œæ¯ä¸ªç´¢å¼•é¡¹è‡³å°‘åŒ…å«å…³é”®å­—å’Œå…¶å¯¹åº”çš„è®°å½•åœ¨å­˜å‚¨å™¨ä¸­çš„ä½ç½®ç­‰ä¿¡æ¯ã€‚ç´¢å¼•æŠ€æœ¯æ˜¯ç»„ç»‡å¤§å‹æ•°æ®åº“ä»¥åŠç£ç›˜æ–‡ä»¶çš„ä¸€ç§é‡è¦æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;ç´¢å¼•æŒ‰ç…§ç»“æ„å¯ä»¥åˆ†ä¸ºçº¿æ€§ç´¢å¼•ã€æ ‘å½¢ç´¢å¼•å’Œå¤šçº§ç´¢å¼•ã€‚è¿™é‡Œåªä»‹ç»çº¿æ€§ç´¢å¼•æŠ€æœ¯ã€‚&lt;strong&gt;æ‰€è°“çº¿æ€§ç´¢å¼•å°±æ˜¯å°†ç´¢å¼•é¡¹é›†åˆç»„ç»‡ä¸ºçº¿æ€§ç»“æ„ï¼Œä¹Ÿç§°ä¸ºç´¢å¼•è¡¨ã€‚&lt;/strong&gt;è¿™é‡Œä»‹ç»ä¸‰ç§çº¿æ€§ç´¢å¼•ï¼š&lt;strong&gt;ç¨ å¯†ç´¢å¼•ã€åˆ†å—ç´¢å¼•ã€å€’æ’ç´¢å¼•ã€‚&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://www.guiyongdong.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="æŸ¥æ‰¾" scheme="http://www.guiyongdong.com/tags/%E6%9F%A5%E6%89%BE/"/>
    
  </entry>
  
</feed>
